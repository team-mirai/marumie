olevba 0.60.2 on Python 3.13.11 - http://decalage.info/python/oletools
===============================================================================
FILE: data/reports/syushi_soft.xlsm
Type: OpenXML
WARNING  For now, VBA stomping cannot be detected for files in memory
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Sub Workbook_SheetChange(ByVal sh As Object, ByVal Target As Range)
    
    Dim wsSelect As Worksheet
    Set wsSelect = ActiveSheet
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    If StopSheetChangeEvent = True Then
        Exit Sub
    End If
    'シート追加により例外とする内容を変更
    'If wsSelect.name = "領収書一覧" Or wsSelect.name = "申請者一覧" Or wsSelect.name = "8号様式の2" Then
    If wsSelect.name = "領収書一覧" Or wsSelect.name = "申請者一覧" _
      Or wsSelect.name = "16号様式" Or wsSelect.name = "領収書管理" Then
        Exit Sub
    End If
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

    '編集操作を行なったため、「エラーチェック済」を消す
    Call SetChangeStatusAsNoCheck
    
    '通し番号を自動設定する（通し番号があるシートのみ）
    Call PutSeqNo(sh, Target)
    
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    Call ModuleChkAdr.CHK_ADR(sh, Target)
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END


End Sub

'Add mnaohiro 2009.11.09_START
'----------------------------------------------------------------
' 関数名 ： Workbook_SheetActivate
' 機　能 ： シートがアクティブになった時のイベント処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub Workbook_SheetActivate(ByVal objSheet As Object)
    
    '変数宣言
    Dim blnScreenUpdating   As Boolean
    Dim intZoom             As Integer

    With objSheet.Application
    
        '画面表示の更新状態を取得
        blnScreenUpdating = .ScreenUpdating
        
        '画面表示の更新状態をOFF（チラつき防止）
        .ScreenUpdating = False
    
        '表示倍率を変更し意図的に画面をリフレッシュ
        '→Excel2007で複数シートを選択して印刷した際、
        '　画面の再描画がされず、
        '　テキストボックスが拡大されて表示されたり等、
        '　不具合が発生する現象への対応。
        intZoom = .ActiveWindow.Zoom
        .ActiveWindow.Zoom = intZoom - 1
        .ActiveWindow.Zoom = intZoom
        
        '画面表示の更新状態を元の状態に戻す
        '→一律、画面表示の更新状態をONにしてしまうと、
        '　シートの追加・移動等を行う処理で、画面が
        '　チラつく挙動が出てしまう為、
        '　本処理では呼出し時の状態に戻すのみ。
        .ScreenUpdating = blnScreenUpdating
    
    End With
'ADD 2015/02/23 Fujitsu)Ito H27政治資金 START
    If TypeName(Selection) = "Range" Then
    Else
        Range("A1").Select
    End If
'ADD 2015/02/23 Fujitsu)Ito H27政治資金 END

End Sub
'Add mnaohiro 2009.11.09_END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Workbook_BeforePrint
' 機  能 ： 印刷実行前の処理
' 引  数 ：
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Workbook_BeforePrint(Cancel As Boolean)
    
    '変数宣言
    Dim wstTarget As Worksheet

    '表示する全シートのDisplayPageBreaksをTrueに設定
    '→印刷プレビューを表示して閉じると、画面上のボタンが
    '　印刷イメージとなってしまう不具合への対応
    For Each wstTarget In Worksheets
        If wstTarget.Visible = True Then
            wstTarget.DisplayPageBreaks = True
        End If
    Next
    
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END





-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet2.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'ADD 2016/11/01 H28政治資金 START
'----------------------------------------------------------------
' 関数名 ： Worksheet_Change
' 機　能 ： 報告日に変化があった時のイベント処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------

Private Sub Worksheet_Change(ByVal Target As Range)
    
    '報告年以外はチェックしない
    If Target.Address() <> "$U$5" Then Exit Sub

    On Error GoTo ErrRange:
    'その20　宣誓日
    Dim senseiDt As Range
    Set senseiDt = Worksheets("その20").Range("SENSEI_DT")
    
    '報告年が空の場合
    If Target.value = "" Then
        '宣誓日の背景色・コメントを初期化
        Call CellColorChange(senseiDt, False)
        Call deleteComment(senseiDt.Worksheet, senseiDt)
    Else
    
        Dim sheet As Object
        
        Application.EnableEvents = False
    
        Set sheet = ActiveSheet
        Dim YearStr As String
        Dim ReportYearDate As Date
        Dim ErrorCount As Long
        
        ErrorCount = 0
        YearStr = Target.value
        
        On Error GoTo ErrFlg
        
        '日付型チェック
        ReportYearDate = CDate(YearStr + "/1/1")
        ReportYearDate = CDate(YearStr + "/12/31")
        ReportYearDate = CDate(YearStr + "1月1日")
        ReportYearDate = CDate(YearStr + "12月31日")
        
        '日付型チェックで全てエラーの場合
        If ErrorCount = 4 Then
        
            Call CellColorChange(senseiDt, False)
            Call deleteComment(senseiDt.Worksheet, senseiDt)
            GoTo ErrMsg:
            
        Else
            
            Target.value = Format(ReportYearDate, "yyyy")
            
            '日付の範囲チェック
            If Target.value < 1900 Or 2117 < Target.value Then
                Call CellColorChange(senseiDt, False)
                Call deleteComment(senseiDt.Worksheet, senseiDt)
                GoTo ErrMsg:
            End If
            '宣誓日が空の場合
            If senseiDt.value = "" Then
                Call CellColorChange(senseiDt, False)
                Call deleteComment(senseiDt.Worksheet, senseiDt)
                Application.EnableEvents = True
                Exit Sub
            End If
            
            '報告年が宣誓日より未来または同じ年だった場合
            If Target.value >= Year(senseiDt.value) Then
                MsgBox MESSAGE_W191, vbExclamation
                Call CellColorChange(senseiDt, False, True, , 10079487)
                Call setComment(senseiDt.Worksheet, senseiDt, MESSAGE_W191)
            Else
                Call CellColorChange(senseiDt, False)
                Call deleteComment(senseiDt.Worksheet, senseiDt)
            End If
        End If
        
        Application.EnableEvents = True
    
    End If
    
    Exit Sub


ErrFlg:
    ErrorCount = ErrorCount + 1
    Resume Next
    
ErrRange:
    Resume Next

ErrMsg:

    MsgBox "報告年を入力します。" & vbCrLf & "年月日欄には「2020」、「R2」、「r2」、「令和2」のように入力してください。" & vbCrLf & "※　入力確定後は、「令和2」のように表示されます。", vbOKOnly + vbCritical
    Target.value = ""
    Application.EnableEvents = True

End Sub

-------------------------------------------------------------------------------
VBA MACRO Sheet3.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'----------------------------------------------------------------
' 関数名 ： Worksheet_Activate
' 機　能 ： シートがアクティブになった時のイベント処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub Worksheet_Activate()
    On Error GoTo ErrorTrap:
    
    '（うち特定寄附）【金額】の制御
    Call changeTokuteiKifu
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("（うち特定寄附）【金額】の制御")

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet4.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet5.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet6.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet7.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet8.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet8'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'----------------------------------------------------------------
' 関数名 ： Worksheet_Change
' 機　能 ： セルが変更された時のイベント処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub Worksheet_Change(ByVal Target As Range)

    On Error GoTo ErrorTrap:
    
    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その7(1)")
    
    With wsSelect
    
        Dim lngI As Long
        Dim lngFirstRow As Long
        Dim lngLastRow As Long
        lngFirstRow = .Range("行頭").Row + 1
        lngLastRow = .Range("行末").Row - 1
        
        Dim blnScreenUpdating As Boolean
        
        If Target.column = .Range("KIFUSYA_NM").column And _
            Target.Row >= lngFirstRow And Target.Row <= lngLastRow Then
            
            '画面表示の更新状態を取得
            blnScreenUpdating = .Application.ScreenUpdating
            '画面表示の更新状態をOFF（チラつき防止）
            .Application.ScreenUpdating = False
        
            Call changeTokuteiKifu
            
            '画面表示の更新状態を元の状態に戻す
            .Application.ScreenUpdating = blnScreenUpdating
        End If
    
    End With
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("（うち特定寄附）【金額】の制御")

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet9.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet9'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet10.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet10'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet11.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet11'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet12.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet12'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet13.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet13'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet14.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet14'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet15.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet15'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet16.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet16'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet17.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet17'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet18.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet18'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet19.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet19'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet20.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet20'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet21.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet21'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet22.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet22'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet23.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet23'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet24.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet24'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet25.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet25'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet26.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet26'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet27.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet27'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet28.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet28'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet29.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet29'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet30.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet30'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet31.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet31'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet32.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet32'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet33.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet33'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet34.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet34'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet35.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet35'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet36.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet36'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet37.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet37'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet38.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet38'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet39.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet39'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet40.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet40'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet41.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet41'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet42.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet42'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet43.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet43'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet44.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet44'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet45.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet45'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet46.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet46'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet47.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet47'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet48.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet48'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet49.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet49'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet50.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet50'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'ADD 2016/11/01 H28政治資金 START
'----------------------------------------------------------------
' 関数名 ： Worksheet_Change
' 機　能 ： 宣誓日に変化があった時のイベント処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------

Private Sub Worksheet_Change(ByVal Target As Range)
    
    If Target.Address() = "$G$16" Then
        
        If (TypeName(Target.value) <> "Date" And Target.value <> "") Or _
            (Target.value = 0 And Target.value <> "") Or _
            (TypeName(Target.value) = "Date" And #12/31/2117# < Target.value) Then
            MsgBox "年月日を入力してください。", vbCritical, "入力値エラー"
            Target.value = ""
            Call CellColorChange(Target, False)
            Call deleteComment(Target.Worksheet, Target)
            Exit Sub
        End If
        
        Dim houkokuYear As Range
        On Error GoTo last
        Set houkokuYear = Worksheets("その1").Range("HOUKOKU_NEN")
        
        If houkokuYear.value = "" Or Target.value = "" Then
            Call CellColorChange(Target, False)
            Call deleteComment(Target.Worksheet, Target)
            Exit Sub
        End If
        
        If houkokuYear.value >= Year(Target.value) Then
            Call CellColorChange(Target, False, True, , 10079487)
            Call setComment(Target.Worksheet, Target, MESSAGE_W191)
        Else
            Call CellColorChange(Target, False)
            Call deleteComment(Target.Worksheet, Target)
        End If
    End If
last:
End Sub
'ADD 2016/11/01 H28政治資金 END

-------------------------------------------------------------------------------
VBA MACRO Sheet51.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet51'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet52.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet52'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet53.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet53'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet54.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet54'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO Sheet55.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet55'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO ModuleXMLReference.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleXMLReference'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
'Required [Microsoft XML, v3.0] NT/2000/XP[%windir%\system32\msxml3.dll]
'Required [Microsoft XML, v3.0] 9x/Me[%windir%\system\msxml3.dll]

Sub XML_ImportPre()

    If SetReference = False Then
        MsgBox "設定に失敗しました。", vbOKOnly + vbCritical, "XML取込初期設定"
    Else
        MsgBox "設定が終了しました。", vbOKOnly + vbInformation, "XML取込初期設定"
    End If

End Sub

'指定した参照が設定されていなかったら、参照を設定する
Function SetReference() As Boolean
    
    Dim boolReturn As Boolean
    
    Select Case GetReference(ThisWorkbook, "MSXML2")
    Case False
        boolReturn = ReferenceFromFile(ThisWorkbook, "msxml3.dll")
        If boolReturn = False Then
            'MsgBox "参照設定に失敗しました。", vbOKOnly + vbCritical, "参照設定"
            SetReference = False
        Else
            SetReference = True
        End If
    Case True
        SetReference = True
    Case Else
        SetReference = False
    End Select

Exit Function

Err_SetReference:
    'MsgBox "ERROR NO. " & Err.Number & vbCrLf & Err.Description, vbOKOnly + vbExclamation, "SetReference"

End Function

'指定したブックの参照設定を取得､デバッグプリント
Function GetReference(wbSelect As Workbook, strRefName As String) As Integer

    On Error GoTo Err_GetReference
    
    Dim refSelect As Variant

    '参照設定名と参照設定ファイルパスをデバッグプリント
    For Each refSelect In wbSelect.VBProject.References
        'Debug.Print refSelect.Name
        'Debug.Print refSelect.FullPath
        If refSelect.name = strRefName Then
            GetReference = True
            Exit For
        End If
    Next refSelect

Exit Function

Err_GetReference:
    'MsgBox "ERROR NO. " & Err.Number & vbCrLf & Err.Description, vbOKOnly + vbExclamation, "GetReference"
    GetReference = 9

End Function

'指定ファイルの参照を設定
Function ReferenceFromFile(wbSelect As Workbook, strFileName As String) As Boolean

    On Error GoTo Error_ReferenceFromFile
    
    wbSelect.VBProject.References.AddFromFile (strFileName)
    ReferenceFromFile = True

Exit_ReferenceFromFile:
    Exit Function

Error_ReferenceFromFile:
    'MsgBox Err & " :  " & Err.Description
    ReferenceFromFile = False
    
    Resume Exit_ReferenceFromFile
    
End Function

-------------------------------------------------------------------------------
VBA MACRO EasyHashMap.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/EasyHashMap'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
' EasyHashMap クラス
'
' キーと値のペアを格納する配列
' （JavaのHashMapのようなクラス）

Option Explicit

'「Microsoft Scripting Runtime」(scrrun.dll)の参照設定が必要
'（ これはOffice 2000に同梱される。 2002/2003/2007についてもそれぞれ確認済み）
Private mdicMap As Scripting.Dictionary


'指定の値をコレクション内の指定のキーと関連付けます。
'コレクションが以前にこのキーのマッピングを保持していた場合、古い値が置き換えられます。
'戻り値:指定されたキーに関連した値。または、キーのマッピングがなかった場合は null。
'       戻り値 null は、コレクションが以前に null と指定されたキーを関連付けていたことを示す場合もある
Public Sub AddItem(key As String, value As Variant)
    
    If Not mdicMap.Exists(key) Then
        '値を追加
        mdicMap.Add key, value
    Else
        '既にキーが存在する場合は、上書きする
        mdicMap.Item(key) = value
    End If
    
End Sub

'コレクションが指定のキーをマップする値を返します。
'コレクションがこのキーのマッピングを保持していない場合は null を返します
'戻り値の null は、コレクションがキーのマッピングを保持していないことを示すとはかぎりません。つまり、マップが明示的にキーを null にマップすることもあります。
'戻り値:コレクションが指定されたキーをマップする値
Public Function GetItem(key As String) As Variant
     
    If mdicMap.Exists(key) Then
        GetItem = mdicMap.Item(key)
    Else
        GetItem = Null
    End If
    
End Function

'重複があれば、falseを返す。なければ、trueを返し、値を格納。空白は無視する
Public Function AddWithOverlapCheck(key As String, value As Variant) As Boolean
    
    '空白はtrueを返す
    If Len(key) = 0 Then
        AddWithOverlapCheck = True
        Exit Function
    End If
    
    If Not mdicMap.Exists(key) Then
        mdicMap.Add key, value
        AddWithOverlapCheck = True
    Else
        AddWithOverlapCheck = False
    End If
    
End Function

'値の個数を返す
Public Function CountItem() As Long
    
    CountItem = mdicMap.Count

End Function

'指定したキーに対応する値があればtrue, なければfalseを返す
Public Function ExistsKey(key As String) As Boolean

    ExistsKey = mdicMap.Exists(key)
    
End Function


Private Sub Class_Initialize()
    
    'コレクションを初期化
    Set mdicMap = New Scripting.Dictionary
    
    'キーの比較モードを設定（半角／全角などを区別するバイナリモード）
    mdicMap.CompareMode = BinaryCompare
    
End Sub

-------------------------------------------------------------------------------
VBA MACRO frmNayose.frm 
in file: xl/vbaProject.bin - OLE stream: 'VBA/frmNayose'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 



















Option Explicit

Private Sub cmdCancel_Click()
    Me.Tag = ""
    Me.Hide
End Sub

Private Sub cmdRun_Click()
    If chkRebuild.value = True Then
        Me.Tag = "Run_Checked"
    Else
        Me.Tag = "Run"
    End If
    
    Me.Hide
End Sub

-------------------------------------------------------------------------------
VBA MACRO ModuleCheck.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCheck'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
    '（その７）の寄附者の名称で使用禁止とする文字列
    Public Const NG_STRING_01 As String = "〃"
    Public Const NG_STRING_02 As String = "同上"
    Public Const NG_STRING_03 As String = "前掲"
    
    '（その１０）の入力チェックで対象とする列名
    Public Const COL_NAME_SHIHARAI_10_01 As String = "SHIHARAI_SU"
    Public Const COL_NAME_KINGAKU_10_01 As String = "KINGAKU"
    
    '費目の重複チェック時に使用する配列
    Private colHimokuArray As Collection
    
    '（その１）の政治団体区分
    Public dantai_kbn As String
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    Public ErrMovePoint As ErrorMovePoint '遷移先情報
    Public Const LIST_KOSYOKU_KBN2_KOUHO        As String = "（候補者）"
    Public Const LIST_KOSYOKU_KBN3_NAROU        As String = "（候補者となろうとする者）"
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'「項目チェック」ボタン押下時処理
Public Sub CheckBTN()
    
    Dim isSortedPartySheets As Boolean
    isSortedPartySheets = False
    
    On Error GoTo ErrorTrap:
    
    
    
    '外字チェックあり
    GaijiChkFlg = True
    GaijiErrCnt = 0
    'チェック実行
    Call ValidationCheck_All
    
    '「報告年 >= 宣誓日の年号」の場合ワーニングを表示
    Call senseiDtWarning
    
    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("項目チェック")

End Sub


'-------------------------------------------------------------------
  ' 関数名 ： ValidationCheck_All
  ' 機  能 ： 「項目チェック」ボタン押下時の処理
  '　　　　：
  ' 備　考 ： シートの並び順がパーティー順の場合、一時的に元の状態に
  '　　　　： 戻して本処理を実行すること。
  '　　　　： （エラーフラグ作成処理等に影響すると考えられるため）
'-------------------------------------------------------------------
Sub ValidationCheck_All(Optional isSilentMode As Boolean = False)

    Dim boolError As Boolean, boolAllEmpty As Boolean

    Dim wsSelect As Worksheet
    Dim strSheetName As String
    Dim intSheetIndex As Integer
    Dim intWCount As Integer
    intWCount = Worksheets.Count
    Dim AboolError() As Boolean
    Dim AboolAllEmpty() As Boolean
    ReDim AboolError(1 To intWCount)
    ReDim AboolAllEmpty(1 To intWCount)
    Dim strCellName As String, strCellNameE As String, strCellNameM As String
    Dim nmCellName As name, nmCellNameN As name
    Dim strKNo As String, strSKNo As String
    Dim boolS11ErrorOr(1 To 3) As Boolean, boolS11ErrorAnd(1 To 3) As Boolean, boolS11AllEmptyAnd(1 To 3) As Boolean
    Dim boolS12ErrorOr(1 To 3) As Boolean, boolS12ErrorAnd(1 To 3) As Boolean, boolS12AllEmptyAnd(1 To 3) As Boolean
    Dim boolS14ErrorOr(1 To 9) As Boolean, boolS14ErrorAnd(1 To 9) As Boolean, boolS14AllEmptyAnd(1 To 9) As Boolean
'    Dim boolS19ErrorOr(1 To 3) As Boolean, boolS19ErrorAnd(1 To 3) As Boolean, boolS19AllEmptyAnd(1 To 3) As Boolean
    Dim boolS19ErrorOr(0) As Boolean, boolS19ErrorAnd(0) As Boolean, boolS19AllEmptyAnd(0) As Boolean
    Dim rngFLG As Range, rngFLGN As Range, strFLGName As String
    Dim NasiCount() As Long, No8Count() As Long, KomokuNm() As String
    ReDim NasiCount(1 To 12), No8Count(1 To 12), KomokuNm(1 To 12)
    Dim lngKifusya As Long, lngSinseisya As Long, Kifusya() As String
    ReDim Kifusya(0)
    Dim giin_dantai_kbn As Integer
    Dim sheet19_KUBUN1_cnt As Integer
    Dim sheet19_KUBUN2_cnt As Integer
    Dim sheet19_KUBUN3_cnt As Integer
    Dim sheet19_KUBUN1_name As String
    Dim sheet19_KUBUN2_name As String
    Dim sheet19_KUBUN3_name As String
    
    '@@01MOD START
    Dim i As Long
    '@@01MOD END
    
    Dim NasiKingaku_Gk As Double, No8NasiKingaku_Gk As Double  '2004/07/12追加
    Dim intColRight As Integer
    
    Set colHimokuArray = New Collection 'その11,12,15で使用する費目のコレクションを初期化
    
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    'エラー時の遷移先情報を初期化
    ErrMovePoint.strSheet = ""
    ErrMovePoint.strName = ""
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStart("項目チェック")
    
    'ステータスバーに進捗の表示をする(進捗の母数はシート数＋２処理）
    Call CountStatusbar("項目チェックをしています...", Worksheets.Count + 2)
    
    Application.ScreenUpdating = False
    
    '各シートのチェック
    For Each wsSelect In Worksheets
    
        With wsSelect
    
        strSheetName = .name
        intSheetIndex = .Index
        boolError = False
        boolAllEmpty = True
        
        If strSheetName = "メニュー" Then
        
            AboolError(intSheetIndex) = False
            AboolAllEmpty(intSheetIndex) = False
        
        'その1
        ElseIf strSheetName = "その1" Then
            '単項目・項目関連チェック
            Call CheckSheet0701(wsSelect, boolError, boolAllEmpty, dantai_kbn, giin_dantai_kbn)
                
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty

        'その2
        ElseIf strSheetName = "その2" Then
        
            '12桁チェック 対象：「*_GK」のセル 対象外："ZENNEN_KKS_GK", "TOKUTEI_KIFU_GK", "ATUSEN_GK", "YOKUNEN_KKS_GK"
            '下の数値チェックにて12桁チェックも同時に行う項目、または手入力項目は対象外とする
            Call K12CHK(wsSelect, "*_GK", boolError, , Array("ZENNEN_KKS_GK", "TOKUTEI_KIFU_GK", "ATUSEN_GK", "YOKUNEN_KKS_GK"))
                                                   
            '必須チェック "ZENNEN_KKS_GK"
            Call HISSUCHK(wsSelect, "ZENNEN_KKS_GK", boolError)
            
            '数値チェック "TOKUTEI_KIFU_GK" <= "KOJIN_KIFU_GK" TOKUTEI_KIFU_GKの12桁チェックも同時に行う
            Call ValueCompareCheck(wsSelect, "TOKUTEI_KIFU_GK", "KOJIN_KIFU_GK", "<=", boolError, False, "(ｱ) 個人からの寄附")
            
            '数値チェック "ATUSEN_GK" <= "KIFU_SKEI_GK" ATUSEN_GKの12桁チェックも同時に行う
            Call ValueCompareCheck(wsSelect, "ATUSEN_GK", "KIFU_SKEI_GK", "<=", boolError, False, "小計　(ｱ)＋(ｲ)＋(ｳ)")
            
            '数値チェック "YOKUNEN_KKS_GK" >= 0     "ZENNEN_KKS_GK"はダミー YOKUNEN_KKS_GKの12桁チェックも同時に行う
            Call ValueCompareCheck(wsSelect, "YOKUNEN_KKS_GK", "ZENNEN_KKS_GK", ">=", boolError, True)
            
            '12桁チェック 対象：「*_SGK」のセル
            Call K12CHK(wsSelect, "*_SGK", boolError)
        
            '個人の負担する党費又は会費の金額と員数のどちらか一方に入力がある場合、もう片方も必須入力
            If IsEmptyString(.Range("KOJIN_FUTAN_KGK").Formula) And Not IsEmptyString(.Range("KOJIN_FUTAN_SU").Formula) Then
                Call HISSUCHK(wsSelect, "KOJIN_FUTAN_KGK", boolError)
                Call CellColorChange(.Range("KOJIN_FUTAN_SU"), False)
            ElseIf Not IsEmptyString(.Range("KOJIN_FUTAN_KGK").Formula) And IsEmptyString(.Range("KOJIN_FUTAN_SU").Formula) Then
                Call CellColorChange(.Range("KOJIN_FUTAN_KGK"), False)
                Call HISSUCHK(wsSelect, "KOJIN_FUTAN_SU", boolError)
            Else
                Call CellColorChange(.Range("KOJIN_FUTAN_KGK"), False)
                Call CellColorChange(.Range("KOJIN_FUTAN_SU"), False)
            End If
        
            Call CheckDoubleNumberEitherToZero(.Range("KOJIN_FUTAN_SU"), .Range("KOJIN_FUTAN_KGK"), boolError)
            
            '備考欄チェック（XML出力字の外字チェックが目的）
            boolError = boolError Or CheckSingleGaiji(.Range("KOJIN_KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("TOKUTEI_KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("HOJIN_KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SEIJI_KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KIFU_SKEI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("ATUSEN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("TOKUMEI_KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KIFU_GKEI_BIKOU"))
                      
            AboolError(intSheetIndex) = boolError
        
        ElseIf strSheetName Like "その7*" Then
    
            '小計の再計算
            Call SubtotalRecalc_Common(wsSelect)
            
            Call SheetNo(strSheetName, strKNo, strSKNo)
            
            '右端の列を取得
            If strSheetName = "その7(1)" Then
                intColRight = .Range("ZEIGAKUKOUJYO").column
            Else
                intColRight = .Range("SEQ_NO").column
            End If
            
            '明細行の各項目の入力チェック
            Call Validation_Check7(wsSelect, strKNo, intColRight, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
            
            '小計行重複チェック + 小計行金額12桁チェック
            Call SubtotalOverlapCHK_Common(wsSelect, boolError)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)
        
            Call CheckLineSubtotal(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 9, boolError)
            Call CheckLineSubtotalUmu(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 9, boolError)
                        
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName Like "その8*" Then
    
            '小計の再計算  2008/06/26追加
            Call SubtotalRecalc_Common(wsSelect)
                        
            Call Validation_Check8(wsSelect, .Range("SEQ_NO").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty, False)
                
            '小計行重複チェック + 小計行金額12桁チェック
            Call SubtotalOverlapCHK_Common(wsSelect, boolError)
            
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)
        
            Call CheckLineSubtotal(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 10, boolError)
            Call CheckLineSubtotalUmu(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 10, boolError)
        
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName Like "その11*" Or strSheetName Like "その12*" Then
    
            '小計の再計算  2008/06/26追加
            Call SubtotalRecalc_Common(wsSelect)

            Call SKBNCHK(wsSelect, "PATYI_NM", boolError)
        
            '小計行重複チェック + 小計行金額12桁チェック
            Call SubtotalOverlapCHK_Common(wsSelect, boolError)
            
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)
            
            If strSheetName Like "その11*" Then
                '小計行があるので、（その８）と同様のチェックを行う　2008/06/26変更
                Call Validation_Check8(wsSelect, .Range("SEQ_NO").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
                Call CheckLineSubtotal(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 10, 9, boolError)
                Call CheckLineSubtotalUmu(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 10, 9, boolError)
            Else
                '小計行があるので、（その８）と同様のチェックを行う　2008/06/26変更
                Call Validation_Check8(wsSelect, .Range("SEQ_NO").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty, False)
                Call CheckLineSubtotal(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 10, boolError)
                Call CheckLineSubtotalUmu(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, 11, 10, boolError)
            End If
            
            '政治資金パーティーの名称チェック（XML出力字の外字チェックが目的）
            If .Range("PATYI_NM").value <> "" Then
                If .Range("PATYI_NM").Comment Is Nothing Then
                    boolError = boolError Or CheckSingleGaiji(.Range("PATYI_NM"))
                End If
            End If
            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName = "その13" Then
            'あらかじめ、「光熱水費」「備品・消耗品費」「事務所費」の背景色をリセット
            Call CellColorChange(.Range("KOUNETU_GK"), False)
            Call CellColorChange(.Range("BIHIN_GK"), False)
            Call CellColorChange(.Range("JIMUSYO_GK"), False)
            
            '12桁チェック 対象：「*_GK」のセル 対象外："JINKENHI_GK", "KOUNETU_GK", "BIHIN_GK", "JIMUSYO_GK"
            Call K12CHK(wsSelect, "*_GK", boolError, , Array("JINKENHI_GK", "KOUNETU_GK", "BIHIN_GK", "JIMUSYO_GK"))
            
            '12桁チェック 対象：「*_KOUFU」のセル 対象："KEIHI_SKEI_KOUFU","SONOTA_JIGYO_KOUFU","KATUDOU_SKEI_KOUFU"
            Call K12CHK(wsSelect, "*_KOUFU", boolError, , _
                         Array("JINKENHI_KOUFU", "KOUNETU_KOUFU", "BIHIN_KOUFU", "JIMUSYO_KOUFU", _
                                "SOSIKI_KOUFU", "SENKYO_KOUFU", "HAKKOU_JIGYO_KOUFU", "SENDEN_KOUFU", _
                                "KAISAI_KOUFU", "SONOTA_KOUFU", "CYOUSA_KOUFU", "KIFU_KOUFU", _
                                "SONOTA_KEIHI_KOUFU"))
            
            '備考欄チェック（XML出力字の外字チェックが目的）
            boolError = boolError Or CheckSingleGaiji(.Range("JINKENHI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KOUNETU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("BIHIN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("JIMUSYO_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KEIHI_SKEI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SOSIKI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SENKYO_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SONOTA_JIGYO_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("HAKKOU_JIGYO_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SENDEN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KAISAI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SONOTA_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("CYOUSA_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KIFU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SONOTA_KEIHI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KATUDOU_SKEI_BIKOU"))
            
            AboolError(intSheetIndex) = boolError
            
        ElseIf strSheetName Like "その14*" Then
            
            Call Validation_Check(wsSelect, .Range("右端").column + 2, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
        
'            Call SKBNCHK(wsSelect, "HIMOKU", boolError)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)
            
            Call SheetNo(strSheetName, strKNo, strSKNo)
            NasiCount(strKNo) = NasiCount(strKNo) + Counter(wsSelect, .Range("RYOUSYU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, "領収書等を徴し難かった支出の明細書を作成する")
            '「第8号様式を作成する」の金額もチェックするために計算して保存する。様式その８でチェックする。 2004/07/12追加
            NasiKingaku_Gk = NasiKingaku_Gk + NasiKingaku(wsSelect, .Range("RYOUSYU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, strSheetName, .Range("KINGAKU").column)
            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName Like "その15*" Then
            
            Call Validation_Check(wsSelect, .Range("右端").column + 2, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
        
            Call SKBNCHK(wsSelect, "HIMOKU", boolError)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)
            
            Call SheetNo(strSheetName, strKNo, strSKNo)
            '（その14）分の3シートが追加された影響で、NasiCountテーブルの添え字を変更
            NasiCount(strKNo + 3) = NasiCount(strKNo + 3) + Counter(wsSelect, .Range("RYOUSYU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, "領収書等を徴し難かった支出の明細書を作成する")
            '「第8号様式を作成する」の金額もチェックするために計算して保存する。様式その８でチェックする。 2004/07/12追加
            NasiKingaku_Gk = NasiKingaku_Gk + NasiKingaku(wsSelect, .Range("RYOUSYU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, strSheetName, .Range("KINGAKU").column)
        
            '費目チェック（XML出力字の外字チェックが目的）
            If .Range("HIMOKU").value <> "" Then
                If .Range("HIMOKU").Comment Is Nothing Then
                    boolError = boolError Or CheckSingleGaiji(.Range("HIMOKU"))
                End If
            End If
            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName = "その17" Then
        
            '備考欄チェック（XML出力字の外字チェックが目的）
            boolError = boolError Or CheckSingleGaiji(.Range("TOCHI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("TATEMONO_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SYAKUCHI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("DOUSAN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("YOKIN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SINTAKU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SYOUKEN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SYUSSI_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KASITUKE_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SIKIKIN_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("SISETURIYOU_BIKOU"))
            boolError = boolError Or CheckSingleGaiji(.Range("KARIIRE_BIKOU"))
            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = False
        
        ElseIf strSheetName Like "その19*" Then
            
            Dim arrayRanges As Variant
            Dim arrayRanges2 As Variant
            
            '全区分の背景色をリセット
            Call CellColorChange(.Range("KOMOKU_KBN_1"), False)
            Call CellColorChange(.Range("KOMOKU_KBN_2"), False)
            Call CellColorChange(.Range("KOMOKU_KBN_3"), False)

            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
        
            Call K12CHK(wsSelect, "SIYOU_KAKAKU", boolError, , , boolAllEmpty, False)
            
            '項目別区分（入力時はひとつのみ選択可）
            If .Range("KUBUN").value > 0 Then
                arrayRanges = Array(.Range("KBN_1"), .Range("KBN_2"), .Range("KBN_3"))
                arrayRanges2 = Array(.Range("KOMOKU_KBN_1"), .Range("KOMOKU_KBN_2"), .Range("KOMOKU_KBN_3"))
                boolError = boolError Or CheckSelects(arrayRanges, SELECT_ONE, arrayRanges2)
            End If

            '明細行の入力が無く、区分のみ入力した場合
            If boolAllEmpty = True Then
                If .Range("KUBUN").value > 0 Then
                    boolError = True
                    '全区分を赤表示
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_1"), MESSAGE_E195)
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_2"), MESSAGE_E195)
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_3"), MESSAGE_E195)
                    Call CellColorChange(.Range("KOMOKU_KBN_1"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_2"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_3"), True)
                End If
            Else
                '明細行の入力があるのに、区分未入力の場合
                If .Range("KUBUN").value > 0 Then
                Else
                    boolError = True
                    '全区分を赤表示
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_1"), MESSAGE_E196)
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_2"), MESSAGE_E196)
                    Call setComment(wsSelect, .Range("KOMOKU_KBN_3"), MESSAGE_E196)
                    Call CellColorChange(.Range("KOMOKU_KBN_1"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_2"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_3"), True)
                End If
            End If

            Select Case .Range("KUBUN").value
                Case 1
                    sheet19_KUBUN1_cnt = sheet19_KUBUN1_cnt + 1
                    sheet19_KUBUN1_name = strSheetName
                Case 2
                    sheet19_KUBUN2_cnt = sheet19_KUBUN2_cnt + 1
                    sheet19_KUBUN2_name = strSheetName
                Case 3
                    sheet19_KUBUN3_cnt = sheet19_KUBUN3_cnt + 1
                    sheet19_KUBUN3_name = strSheetName
                Case Else
            End Select
            
            If sheet19_KUBUN1_cnt > 1 Or sheet19_KUBUN2_cnt > 1 Or sheet19_KUBUN3_cnt > 1 Then
                boolError = True
                '全区分を赤表示
                Call setComment(wsSelect, .Range("KOMOKU_KBN_1"), MESSAGE_E197)
                Call setComment(wsSelect, .Range("KOMOKU_KBN_2"), MESSAGE_E197)
                Call setComment(wsSelect, .Range("KOMOKU_KBN_3"), MESSAGE_E197)
                Call CellColorChange(.Range("KOMOKU_KBN_1"), True)
                Call CellColorChange(.Range("KOMOKU_KBN_2"), True)
                Call CellColorChange(.Range("KOMOKU_KBN_3"), True)
            End If
                                            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName = "その20" Then  '宣誓書
        
            '宣誓書チェック
            Call CheckSheet0720(wsSelect, boolError, boolAllEmpty, dantai_kbn, giin_dantai_kbn)
            
            '団体名称等チェック（XML出力字の外字チェックが目的）
            boolError = boolError Or CheckSingleGaiji(.Range("DAI_NM1"))
            boolError = boolError Or CheckSingleGaiji(.Range("DAI_NM2"))
        
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
                
        ElseIf strSheetName = "15号様式" Then
            
            KomokuNm(1) = "光熱水費"
            KomokuNm(2) = "備品・消耗品費"
            KomokuNm(3) = "事務所費"
            KomokuNm(4) = "組織活動費"
            KomokuNm(5) = "選挙関係費"
            KomokuNm(6) = "機関紙誌の発行事業費"
            KomokuNm(7) = "宣伝事業費"
            KomokuNm(8) = "政治資金パーティー開催事業費"
            KomokuNm(9) = "その他の事業費"
            KomokuNm(10) = "調査研究費"
            KomokuNm(11) = "寄附・交付金"
            KomokuNm(12) = "その他の経費"
            
            '前もって全セル色クリア
            Call CellColorChange(.Range(.Cells(.Range("行頭").Row + 1, .Range("左端").column), .Cells(.Range("行末").Row - 1, .Range("右端").column)), False)
            
            Dim intI As Integer, rngFindRange As Range, boolErrorT As Boolean
            For intI = 1 To 12
                
                '該当する項目が入っている件数を取得
                No8Count(intI) = Counter(wsSelect, .Range("KOMOKU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, KomokuNm(intI))
                '金額計算 2004/07/12追加
                No8NasiKingaku_Gk = NasiKingaku(wsSelect, .Range("KOMOKU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, strSheetName, .Range("KINGAKU").column)
                
                '該当する項目が入っているrangeを取得
                Set rngFindRange = FindRange(wsSelect, .Range("KOMOKU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, KomokuNm(intI))
                
                'その14の同じ項目のなしの数とその8の同じ項目の行数が異なる
                If NasiCount(intI) <> No8Count(intI) Then
                
                    boolError = True
                    
                    'その8に該当項目を含む行がない
                    If No8Count(intI) = 0 Then
                        '項目が空欄のrangeを取得
                        Set rngFindRange = FindRange(wsSelect, .Range("KOMOKU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, "")
                        boolErrorT = True
                    End If
                
                    If Not rngFindRange Is Nothing Then     'rngFindRangeがNothingの場合は処理しない 2008/8/8FIX

                        '該当行だけ赤
                        For i = 1 To rngFindRange.Areas.Count
                            Call setComment(wsSelect, .Cells(rngFindRange.Areas(i).Row, .Range("KOMOKU").column), MESSAGE_E176)
                            Call CellColorChange(rngFindRange.Areas(i), True)
                        Next
                        
                    End If
                
                '行数が一致
                Else
                    If Not rngFindRange Is Nothing Then
                        For i = 1 To rngFindRange.Areas.Count
                            If rngFindRange.Areas(i).Rows.Count > 1 Then
                                Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRange.Areas(i).Row + (rngFindRange.Areas(i).Rows.Count - 1), rngFindRange.Areas(i).Row, boolError, boolAllEmpty)
                            Else
                                Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRange.Areas(i).Row, rngFindRange.Areas(i).Row, boolError, boolAllEmpty)
                            End If
                        Next
                    End If
                End If
        
            Next intI
            
            '行数が一致している場合に処理する。 2004/07/12追加-START
            If boolError = False Then
                '金額が一致するか？
                If NasiKingaku_Gk <> No8NasiKingaku_Gk Then
                    boolError = True
                    '全セル赤
                    Call setComment(wsSelect, .Cells(.Range("行頭").Row + 1, .Range("左端").column), MESSAGE_E176)
                    Call CellColorChange(.Range(.Cells(.Range("行頭").Row + 1, .Range("左端").column), .Cells(.Range("行末").Row - 1, .Range("右端").column)), True)
                End If
            End If
            '2004/07/12追加-END
            
            If boolErrorT = False Then
                '項目が空欄のrangeを取得
                Set rngFindRange = FindRange(wsSelect, .Range("KOMOKU").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, "")
            
                '空欄部のチェックを行う
                If Not rngFindRange Is Nothing Then     'rngFindRangeがNothingの場合は処理しない 2008/8/8FIX
                
                    For i = 1 To rngFindRange.Areas.Count
                        If rngFindRange.Areas(i).Rows.Count > 1 Then
                            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRange.Areas(i).Row + (rngFindRange.Areas(i).Rows.Count - 1), rngFindRange.Areas(i).Row, boolError, boolAllEmpty)
                        Else
                            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRange.Areas(i).Row, rngFindRange.Areas(i).Row, boolError, boolAllEmpty)
                        End If
                    Next
                End If
            End If

            '政治団体の名称、会計責任者氏名に色をつける
            With wsSelect
                For i = 1 To (.Range("行末").Row + 4)
                    If .Cells(i, .Range("DT").column).value = "政治団体の名称" Or .Cells(i, .Range("DT").column).value = "会計責任者の氏名" Then
                            .Cells(i, .Range("DT").column + 1).Interior.ColorIndex = 36
                    End If
                Next
            End With
            
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName = "16号様式" Then
                        
            '単項目・項目関連チェック
            Call CheckSheet0802(wsSelect, boolError, boolAllEmpty)
                
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
                        
        ElseIf strSheetName = "領収書一覧" Then
        
            'pass
        
        ElseIf strSheetName = "寄附金" Then
        
            '寄附金チェック（外字チェック含む）
            Call KIFUCHK(wsSelect, boolError, boolAllEmpty)
            
            'デフォルトコメントを復活
            Call UnlockOneSheet(wsSelect)
            If TypeName(.Range("GIIN_NM").Comment) = "Nothing" Then
                'エラーコメントが存在なければ追加
                .Range("GIIN_NM").AddComment (MESSAGE_I001)
                .Range("GIIN_NM").Comment.Visible = False
                .Range("GIIN_NM").Comment.Shape.Width = 150
                .Range("GIIN_NM").Comment.Shape.Height = 63
                .Range("GIIN_NM").Comment.Shape.TextFrame.Characters.Font.Size = 12
                End If
            If TypeName(.Range("NM").Comment) = "Nothing" Then
                'エラーコメントが存在なければ追加
                .Range("NM").AddComment (MESSAGE_I002)
                .Range("NM").Comment.Visible = False
                .Range("NM").Comment.Shape.Width = 150
                .Range("NM").Comment.Shape.Height = 63
                .Range("NM").Comment.Shape.TextFrame.Characters.Font.Size = 12
            End If
            Call LockOneSheet(wsSelect)

            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
        
        ElseIf strSheetName = "申請者一覧" Then
            
            'その7(1)の寄附金（税額）控除が「必要」の寄附者を取得
            Kifusya = GetKoujyoKey()
            lngKifusya = UBound(Kifusya)
            
            '前もって全セル色クリア
            Call CellColorChange(.Range(.Cells(.Range("行頭").Row + 1, .Range("左端").column), .Cells(.Range("行末").Row - 1, .Range("右端").column)), False)
            
            Dim intS As Integer, intK As Integer, rngFindRangeS As Range, boolErrorS As Boolean, strSinseisya As String
            
            
            '①その7(1)の寄附金（税額）控除が「必要」の寄附者が、申請者一覧に存在しているかチェック
            For intK = 1 To lngKifusya
                
                '該当する項目が入っている件数を取得
                lngSinseisya = Counter(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, Kifusya(intK))
                '該当する項目が入っているrangeを取得
                Set rngFindRangeS = FindRange(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, Kifusya(intK))
                
                'その7(1)の寄附金（税額）控除が「必要」の寄附者が、申請者一覧に存在しない
                If lngSinseisya = 0 Then
                
                    boolError = True
                    boolErrorS = True
                    
                    '項目が空欄のrangeを取得
                    Set rngFindRangeS = FindRange(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, "")
                
                    If Not rngFindRangeS Is Nothing Then     'rngFindRangeがNothingの場合は処理しない 2008/8/8FIX
                        '該当行だけ赤
                        Call setComment(wsSelect, .Cells(rngFindRangeS.Row, rngFindRangeS.column), MESSAGE_E181)
                        Call CellColorChange(rngFindRangeS, True)
                    End If
                    
                '行数が一致
                Else
                    If Not rngFindRangeS Is Nothing Then
                        If rngFindRangeS.Rows.Count > 1 Then
                            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRangeS.Row + (rngFindRangeS.Rows.Count - 1), rngFindRangeS.Row, boolError, boolAllEmpty)
                        Else
                            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRangeS.Row, rngFindRangeS.Row, boolError, boolAllEmpty)
                        End If
                    End If
                End If
        
            Next intK
            
            
            '②申請者一覧の寄附者が、その7(1)の寄附金（税額）控除が必要な寄附者として存在しているかチェック
            lngSinseisya = Counter(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, "", True)
            For intS = 1 To lngSinseisya
            
                strSinseisya = .Cells(.Range("行頭").Row + intS, .Range("KEY").column)
                
                For intK = 1 To lngKifusya
                    If Kifusya(intK) = strSinseisya Then
                        Exit For
                    End If
                Next intK
            
                '申請者一覧に、寄附金（税額）控除が必要ではない寄附者が存在する
                If intK > lngKifusya Then
                
                    '項目が入っているrangeを取得
                    Set rngFindRangeS = FindRange(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, strSinseisya)
                
                    boolError = True
                    
                    If Not rngFindRangeS Is Nothing Then     'rngFindRangeがNothingの場合は処理しない 2008/8/8FIX
                        '該当行だけ赤
                        Call setComment(wsSelect, .Cells(rngFindRangeS.Row, rngFindRangeS.column), MESSAGE_E182)
                        Call CellColorChange(rngFindRangeS, True)
                    End If
                    
                End If
                
            Next intS
            
            
            If boolErrorS = False Then
                '項目が空欄のrangeを取得
                Set rngFindRangeS = FindRange(wsSelect, .Range("KEY").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, .Range("左端").column, .Range("右端").column, "")
            
                '空欄部のチェックを行う
                If Not rngFindRangeS Is Nothing Then     'rngFindRangeがNothingの場合は処理しない 2008/8/8FIX
                    If rngFindRangeS.Rows.Count > 1 Then
                        Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRangeS.Row + (rngFindRangeS.Rows.Count - 1), rngFindRangeS.Row, boolError, boolAllEmpty)
                    Else
                        Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, rngFindRangeS.Row, rngFindRangeS.Row, boolError, boolAllEmpty)
                    End If
                End If
            End If
        
            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
            
        ElseIf strSheetName = "その10" Then
    
            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty, False)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)

            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
    
        ElseIf strSheetName Like "その18*" Then
    
            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty, False)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)

            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
            
        ElseIf strSheetName = "FAQ" Then
            'pass
        ElseIf strSheetName = ModuleReceipt.SHEET_RECEIPT Then
            'pass
        ElseIf strSheetName = ModuleReceipt.SHEET_PDF Then
            'pass
        Else
    
            Call Validation_Check(wsSelect, .Range("右端").column, .Range("範囲右端").column, .Range("行末").Row - 1, .Range("行頭").Row + 1, boolError, boolAllEmpty)
        
            Call K12CHK(wsSelect, "*KINGAKU_GK", boolError, , , boolAllEmpty)

            AboolError(intSheetIndex) = boolError
            AboolAllEmpty(intSheetIndex) = boolAllEmpty
    
        End If
    
        End With
    
        'ステータスバーの進捗をカウントアップする(シート毎)
        Call CountStatusbar
    
    Next wsSelect
    
'2020/12/10 画面更新の再開位置を遅らせるため削除
'    Application.ScreenUpdating = True
'2020/12/10 ここまで
    
    
    '-------------------------------------------------------------------------------------------
    ' 報告書間チェック（複数シートをまたがる項目のチェック）
    '-------------------------------------------------------------------------------------------
    
    '汎用変数を定義
    Dim wsSheet1 As Worksheet
    Dim wsSheet2 As Worksheet
    Dim wsSheet3 As Worksheet
    Dim wsSheet4 As Worksheet
    Dim rngCheck1 As Range
    Dim rngCheck2 As Range
    Dim rngCheck3 As Range
    Dim rngCheck4 As Range

    '①(その13)「経常経費小計」＋(その13)「政治活動費小計」＝(その16)「合計」の突合せチェック（全国団体版の場合のみ）
    '該当項目が一致しない場合は、全ての該当セルをエラー表示
    '2019/06現在、全国団体版（DantaiKubun = 0）しか存在しない
    If DantaiKubun = 0 Then
        Set wsSheet1 = Worksheets("その13")
        Set wsSheet2 = Worksheets("その16")
        Set rngCheck1 = wsSheet1.Range("KEIHI_SKEI_KOUFU")
        Set rngCheck2 = wsSheet1.Range("KATUDOU_SKEI_KOUFU")
        Set rngCheck3 = wsSheet2.Range("KINGAKU_GK")
        
        'その13!KEIHI_SKEI_KOUFU + その13!KATUDOU_SKEI_KOUFU = その16!KINGAKU_GK でなければエラー
        If rngCheck1.value + rngCheck2.value <> rngCheck3.value Then
            
            '対象シートのエラーフラグ設定
            AboolError(wsSheet1.Index) = True
            AboolError(wsSheet2.Index) = True
            'エラーコメント
            Call setComment(wsSheet1, rngCheck1, MESSAGE_E183)
            Call setComment(wsSheet1, rngCheck2, MESSAGE_E183)
            Call setComment(wsSheet2, rngCheck3, MESSAGE_E184)
            'セルの背景色を設定（ハイライトのみ、塗りつぶしの解除は行わない）
            Call CellColorChange(rngCheck1, True)
            Call CellColorChange(rngCheck2, True)
            Call CellColorChange(rngCheck3, True)
        End If
    End If
    
    '①(その13)「(2)光熱水費」>=(その14(1))「合計」のチェック
    Set wsSheet1 = Worksheets("その13")
    Set rngCheck1 = wsSheet1.Range("KOUNETU_GK")
    
    Set wsSheet2 = Worksheets("その14(1)")
    Set rngCheck2 = wsSheet2.Range("KINGAKU_GK")
    
    'その13!KOUNETU_GK >= その14(1)!KINGAKU_GK_HIDE でなければエラー
    If rngCheck1.value < rngCheck2.value Then
        
        '対象シートのエラーフラグ設定
        AboolError(wsSheet1.Index) = True
        AboolError(wsSheet2.Index) = True
        'エラーコメント
        Call setComment(wsSheet1, rngCheck1, MESSAGE_E185)
        Call setComment(wsSheet2, rngCheck2, MESSAGE_E186)
        'セルの背景色を設定（ハイライトのみ、塗りつぶしの解除は行わない）
        Call CellColorChange(rngCheck1, True)
        Call CellColorChange(rngCheck2, True)
    End If
    
    '①(その13)「(3)備品・消耗品費」>=(その14(2))「合計」のチェック
    Set wsSheet1 = Worksheets("その13")
    Set rngCheck1 = wsSheet1.Range("BIHIN_GK")
    
    Set wsSheet2 = Worksheets("その14(2)")
    Set rngCheck2 = wsSheet2.Range("KINGAKU_GK")
    
    'その13!BIHIN_GK >= その14(2)!KINGAKU_GK_HIDE でなければエラー
    If rngCheck1.value < rngCheck2.value Then
        
        '対象シートのエラーフラグ設定
        AboolError(wsSheet1.Index) = True
        AboolError(wsSheet2.Index) = True
        'エラーコメント
        Call setComment(wsSheet1, rngCheck1, MESSAGE_E187)
        Call setComment(wsSheet2, rngCheck2, MESSAGE_E188)
        'セルの背景色を設定（ハイライトのみ、塗りつぶしの解除は行わない）
        Call CellColorChange(rngCheck1, True)
        Call CellColorChange(rngCheck2, True)
    End If
    
    '①(その13)「(4)事務所費」>=(その14(3))「合計」のチェック
    Set wsSheet1 = Worksheets("その13")
    Set rngCheck1 = wsSheet1.Range("JIMUSYO_GK")
    
    Set wsSheet2 = Worksheets("その14(3)")
    Set rngCheck2 = wsSheet2.Range("KINGAKU_GK")
    
    'その13!JIMUSYO_GK >= その14(3)!KINGAKU_GK_HIDE でなければエラー
    If rngCheck1.value < rngCheck2.value Then
        
        '対象シートのエラーフラグ設定
        AboolError(wsSheet1.Index) = True
        AboolError(wsSheet2.Index) = True
        'エラーコメント
        Call setComment(wsSheet1, rngCheck1, MESSAGE_E189)
        Call setComment(wsSheet2, rngCheck2, MESSAGE_E190)
        'セルの背景色を設定（ハイライトのみ、塗りつぶしの解除は行わない）
        Call CellColorChange(rngCheck1, True)
        Call CellColorChange(rngCheck2, True)
    End If
    
'ADD 2016/11/01 H28政治資金 START
    '"(その2)「翌年への繰越額」>= (その18(5))「金額」の合計"チェック
    Set wsSheet1 = Worksheets("その2")
    Set rngCheck1 = wsSheet1.Range("YOKUNEN_KKS_GK")
    
    Set wsSheet2 = Worksheets("その18(5)")
    Set rngCheck2 = wsSheet2.Range("YOKIN_ZNDK")
    
    If rngCheck1.value < WorksheetFunction.Sum(rngCheck2) Then

        '対象シートのエラーフラグ設定
        AboolError(wsSheet1.Index) = True
        AboolError(wsSheet2.Index) = True
        'エラーコメント
        Call setComment(wsSheet1, rngCheck1, MESSAGE_E170)
        'セルの背景色を設定（ハイライトのみ、塗りつぶしの解除は行わない）
        Call CellColorChange(rngCheck1, True)
        Call CellColorChange(rngCheck2, True)

    End If
'ADD 2016/11/01 H28政治資金 END
    
    'その18-その19 連携チェック
    'B-CCL-S006
    Call RenkeiCheck0719("その18(1)", "その19(1)", sheet19_KUBUN1_cnt, sheet19_KUBUN1_name, "KOMOKU_KBN_1", AboolAllEmpty, AboolError)
    Call RenkeiCheck0719("その18(2)", "その19(1)", sheet19_KUBUN2_cnt, sheet19_KUBUN2_name, "KOMOKU_KBN_2", AboolAllEmpty, AboolError)
    Call RenkeiCheck0719("その18(3)", "その19(1)", sheet19_KUBUN3_cnt, sheet19_KUBUN3_name, "KOMOKU_KBN_3", AboolAllEmpty, AboolError)
    
    Call CountStatusbar     'ステータスバーの進捗をカウントアップ(シート以外 1/2)
    
    '-------------------------------------------------------------------------------------------
    'メニューにてチェックの付加
    '-------------------------------------------------------------------------------------------
    Dim mapMeetKubun As New EasyHashMap     'メニューフラグ設定処理で、既に遭遇した様式・区分かどうかを判定するためのマップ
    Set wsSelect = Worksheets("メニュー")
    'その19シート用の初期設定
    wsSelect.Range("Mその191").value = False
    wsSelect.Range("Mその192").value = False
    wsSelect.Range("Mその193").value = False
    wsSelect.Range("Eその191").value = False
    wsSelect.Range("Eその192").value = False
    wsSelect.Range("Eその193").value = False
    
    For intSheetIndex = 1 To intWCount
    
        strSheetName = Sheets(intSheetIndex).name

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
        'If strSheetName = "メニュー" Or strSheetName = "領収書一覧" Or strSheetName = "寄附金書類" Or strSheetName = "FAQ" Then
        If strSheetName = "メニュー" Or strSheetName = "領収書一覧" Or strSheetName = "寄附金書類" Or strSheetName = "FAQ" Or _
           strSheetName = ModuleReceipt.SHEET_RECEIPT Or strSheetName = ModuleReceipt.SHEET_PDF Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        
        Else
                
            Call SheetNo(strSheetName, strKNo, strSKNo)
            
            If strKNo = 0 And strSKNo = 0 Then
                strCellName = strSheetName
            Else
                strCellName = Left(strSheetName, InStr(strSheetName, "(") - 1) & strKNo     '例：その7(1) → "その71", その11(3) → "その113"
            End If
        
            If strSheetName Like "その20" Then
            
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun)
            
            ElseIf strSheetName Like "その19*" Then
            
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strKNo, mapMeetKubun, boolS19ErrorOr(strSKNo), boolS19ErrorAnd(strSKNo), boolS19AllEmptyAnd(strSKNo))
'                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, boolS19ErrorOr(strKNo), boolS19ErrorAnd(strKNo), boolS19AllEmptyAnd(strKNo))
'                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), "その19", strSKNo)
            
            'その2
            ElseIf strSheetName Like "その2*" Then
                            
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun)
                                       
            ElseIf strSheetName Like "その11*" Then
            
                'シート小区分分割時のフラグ付加に対応（複数シートのどれかにエラーがあったらチェックを付加する）
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun, boolS11ErrorOr(strKNo), boolS11ErrorAnd(strKNo), boolS11AllEmptyAnd(strKNo))
            
            ElseIf strSheetName Like "その12*" Then
                
                'シート小区分分割時のフラグ付加に対応（複数シートのどれかにエラーがあったらチェックを付加する）
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun, boolS12ErrorOr(strKNo), boolS12ErrorAnd(strKNo), boolS12AllEmptyAnd(strKNo))
            
            ElseIf strSheetName Like "その15*" Then
            
                'シート小区分分割時のフラグ付加に対応（複数シートのどれかにエラーがあったらチェックを付加する）
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun, boolS14ErrorOr(strKNo), boolS14ErrorAnd(strKNo), boolS14AllEmptyAnd(strKNo))
            
            ElseIf strSheetName Like "その18*" Then
                strFLGName = "CHK" & strKNo
                'strFLGName = "_CHK" & strKNo
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                'Set nmCellName = Worksheets("その17").Names(strFLGName)
                Set nmCellName = Worksheets("その17").Names("_" & strFLGName)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                Set rngFLG = Worksheets("その17").Range(nmCellName)
                Set nmCellNameN = Worksheets("その17").Names("N" & strFLGName)
                Set rngFLGN = Worksheets("その17").Range(nmCellNameN)
            
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                'Call CheckFlgSet(strFLGName, Worksheets("その17"), rngFLG, rngFLGN, AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), mapMeetKubun)
                Call CheckFlgSet("_" & strFLGName, Worksheets("その17"), rngFLG, rngFLGN, AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), mapMeetKubun)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun)
            
            Else
            
                Call MenuCheckFLG(AboolError(intSheetIndex), AboolAllEmpty(intSheetIndex), strCellName, strSKNo, mapMeetKubun)
            
            End If
        
        End If
    
    Next intSheetIndex
    
    Call CountStatusbar     'ステータスバーの進捗をカウントアップ(シート以外 2/2)
    
    
    Dim nmsSelWS As Names
    Dim lngI As Long
    Dim ErrUMU As Integer
    Set wsSelect = Worksheets("メニュー")
    Set nmsSelWS = wsSelect.Names
    ErrUMU = 0
    
    'エラーがあるかどうかを、「エラー有無」の設定内容から判定する
    For lngI = 1 To nmsSelWS.Count
        If nmsSelWS(lngI).name Like wsSelect.name & "!E*" Then
            If wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = True Then
                ErrUMU = 1
            End If
        End If
    Next
    
'2020/12/10 画面更新の再開位置をここまで遅らせる
    Application.ScreenUpdating = True
'2020/12/10 ここまで

    'エラーステータスの設定、メッセージ出力
    If ErrUMU = 0 Then
        'イベントを無効にする
        Application.EnableEvents = False
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 START
        'Range("STATUS_ERR_CHECK").value = CHECKED_MESSAGE_OK
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 END
        If GaijiChkFlg = True Then
            gintCheckStatus = CHECK_STATUS_OK_GAIJI
        Else
            gintCheckStatus = CHECK_STATUS_OK
        End If
        'イベントを有効にする
        Application.EnableEvents = True
        If isSilentMode = False Then
'EDIT 2016/11/01 H28政治資金 START
            '"(その2)「翌年への繰越額」>= (その18(5))「預金又は貯金残高」、(その18(6))「金銭信託額」(その18(7))「有価証券価格」の合計"チェック
            Set wsSheet1 = Worksheets("その2")
            Set rngCheck1 = wsSheet1.Range("YOKUNEN_KKS_GK")
    
            Set wsSheet2 = Worksheets("その18(5)")
            Set rngCheck2 = wsSheet2.Range("YOKIN_ZNDK")
    
            Set wsSheet3 = Worksheets("その18(6)")
            Set rngCheck3 = wsSheet3.Range("KINSEN_SHINTAKU_GAKU")
    
            Set wsSheet4 = Worksheets("その18(7)")
            Set rngCheck4 = wsSheet4.Range("YUUKA_SHOUKEN_KAKAKU")
    
            If rngCheck1.value < WorksheetFunction.Sum(rngCheck2) + WorksheetFunction.Sum(rngCheck3) + WorksheetFunction.Sum(rngCheck4) Then
                MsgBox MESSAGE_W190, vbExclamation, "項目チェック"
                Call CellColorChange(rngCheck1, False, True, , 10079487)
                Call CellColorChange(rngCheck2, False, True, , 10079487)
                Call CellColorChange(rngCheck3, False, True, , 10079487)
                Call CellColorChange(rngCheck4, False, True, , 10079487)
                Call setComment(wsSheet1, rngCheck1, MESSAGE_W190)
            Else
                MsgBox "項目チェックが完了しました。" & vbCrLf & vbCrLf & "エラーはありません。", vbInformation, "項目チェック"
            End If
'EDIT 2016/11/01 H28政治資金 END
        End If
    Else
        '外字チェックあり かつ 外字エラーがある場合
        If GaijiChkFlg = True And GaijiErrCnt > 0 Then
            '外字エラーメッセージを出力
            Call DispGaijiError
        Else
            'イベントを無効にする
            Application.EnableEvents = False
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 START
            'Range("STATUS_ERR_CHECK").value = CHECKED_MESSAGE_NG
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 END
            gintCheckStatus = CHECK_STATUS_NG
            'イベントを有効にする
            Application.EnableEvents = True
            If isSilentMode = False Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'                MsgBox "エラーが見つかりました。エラーとなったシートを開き、入力内容を確認してください。", vbExclamation, "項目チェック"
                'エラー箇所に遷移するか確認
                '確認ダイアログ表示
                If (GetMessageBox(MESSAGE_G083, "項目チェック") = True) Then
'EDIT 2015/05/27 Fujitsu)Nakajima H27政治資金 START
'                   Worksheets(ErrMovePoint.strSheet).Activate
'                   Range(ErrMovePoint.strName).Select
                    
                    '遷移できない場合は無視する
                    On Error Resume Next
                    'OKボタン押下でエラー箇所へ遷移
                    '但し、遷移先情報がない場合は遷移しない
                    Worksheets(ErrMovePoint.strSheet).Activate
                    Range(ErrMovePoint.strName).Select
                    'エラートラップ解除
                    On Error GoTo 0
'EDIT 2015/05/27 Fujitsu)Nakajima H27政治資金 END
                End If
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
            
            End If
        End If
    End If

    '「印刷有無」のチェックボックスをセット
    Call PrintFlgSet
    
    'ステータスバーを元に戻す
    Application.StatusBar = False

    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStop("項目チェック")

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： RenkeiCheck0719
  ' 機  能 ： その18-その19 連携チェック
  '        ：
  ' 引  数 ： (in)  strSheet2     … 対象シート名（その18）
  '        ： (in)  strSheet3     … 対象シート名（その19）
  '        ： (in)  cnt … その19の各区分のチェック個数
  '        ： (in)  name   … その19の各区分のシート名
  '        ： (in)  kbnname  … 対象セル名
  '        ： (in)  boolAllEmpty … 空のシートであればTrueが格納される
  '        ： (out) boolError    … エラーがあればTrueが格納される
'-------------------------------------------------------------------

'その18-その19 連携チェック
'B-CCL-S006

Sub RenkeiCheck0719(strSheet2 As String, strSheet3 As String, cnt As Integer, name As String, kbnname As String, AboolAllEmpty() As Boolean, ByRef AboolError() As Boolean)
        
    Dim lngLineRow As Long
    Dim rngLine As Range
    Dim wsSheet1 As Worksheet
    Dim wsSheet2 As Worksheet
    Dim wsSheet3 As Worksheet
    Dim rngCheck1 As Range
    Set wsSheet2 = Worksheets(strSheet2)
    Set wsSheet3 = Worksheets(strSheet3)
    
    Dim strErrMsg As String
    If strSheet2 = "その18(1)" Then
        strErrMsg = "「その18(1)」シート（資産等の項目別内訳「ア　土地」）"
    ElseIf strSheet2 = "その18(2)" Then
        strErrMsg = "「その18(2)」シート（資産等の項目別内訳「イ　建物」）"
    Else
        strErrMsg = "「その18(3)」シート（資産等の項目別内訳「ウ　建物の所有を目的とする地上権又は土地の貸借権」）"
    End If
    
    '（その１）シートで、資金管理団体指定有無が「有」の場合（指定の期間は判断しない）
    Set wsSheet1 = Worksheets("その1")
    Set rngCheck1 = wsSheet1.Range("SIKIN_UMU")
    If rngCheck1 = True Then

        'その18(1)(2)(3)の明細行のいずれかのセルに入力がある場合､その19で対応する項目別区分が指定されたシートが存在すること｡
        '（エラーの場合、その１９の１枚目のシートの該当項目別区分セルを赤表示する）
        '18にあって
        If AboolAllEmpty(wsSheet2.Index) = False Then
        
            '19にない
            If cnt = 0 Then
                
                '単項目チェックでエラーなし
                If AboolError(wsSheet3.Index) = False Then
                    'err
                    Call setComment(wsSheet3, wsSheet3.Range(kbnname), MESSAGE_E192, strErrMsg)
                    Call CellColorChange(wsSheet3.Range(kbnname), True)
                    
                    '対象シートのエラーフラグ設定
                    AboolError(wsSheet3.Index) = True
                End If
    
            End If
        
        '18になくて
        Else
        
            '19にある
            If cnt > 0 Then
            
                'err
                With Worksheets(name)
                    
                    '単項目チェックでエラーなし
                    If AboolError(.Index) = False Then
                        '該当項目別区分にエラー
                        Call setComment(Worksheets(name), .Range(kbnname), MESSAGE_E193, strErrMsg)
                        Call CellColorChange(.Range(kbnname), True)
                        '入力のある詳細行にエラー
                        For lngLineRow = .Range("行頭").Row + 1 To .Range("行末").Row - 1
                            Set rngLine = .Range(.Cells(lngLineRow, .Range("左端").column), .Cells(lngLineRow, .Range("右端").column))
                            If Application.WorksheetFunction.CountA(rngLine) > 0 Then
                                Call setComment(Worksheets(name), .Cells(rngLine.Row, rngLine.column), MESSAGE_E193, strErrMsg)
                                Call CellColorChange(rngLine, True)
                            End If
                        Next
                        '対象シートのエラーフラグ設定
                        AboolError(.Index) = True
                    End If
                End With
                
            End If
        
        End If

    '上記に該当しない場合､入力が無いこと｡
    '（エラーの場合、入力のある行全てと項目別区分セルを赤表示する）
    Else
    
        '19にある
        If cnt > 0 Then
        
            'err
            With Worksheets(name)
                '単項目チェックでエラーなし
                If AboolError(.Index) = False Then
                    'すべての項目別区分にエラー
                    Call setComment(Worksheets(name), .Range("KOMOKU_KBN_1"), MESSAGE_E194)
                    Call setComment(Worksheets(name), .Range("KOMOKU_KBN_2"), MESSAGE_E194)
                    Call setComment(Worksheets(name), .Range("KOMOKU_KBN_3"), MESSAGE_E194)
                    Call CellColorChange(.Range("KOMOKU_KBN_1"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_2"), True)
                    Call CellColorChange(.Range("KOMOKU_KBN_3"), True)
                    '入力のある詳細行にエラー
                    For lngLineRow = .Range("行頭").Row + 1 To .Range("行末").Row - 1
                        Set rngLine = .Range(.Cells(lngLineRow, .Range("左端").column), .Cells(lngLineRow, .Range("右端").column))
                        If Application.WorksheetFunction.CountA(rngLine) > 0 Then
                            Call setComment(Worksheets(name), .Cells(rngLine.Row, rngLine.column), MESSAGE_E194)
                            Call CellColorChange(rngLine, True)
                        End If
                    Next
                    '対象シートのエラーフラグ設定
                    AboolError(.Index) = True
                End If
            End With
            
        End If
    
    End If

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： Validation_Check
  ' 機  能 ： 詳細行の部分のチェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect     … 対象シート
  '        ： (in)  intAllItem   … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  lngLastRow   … 行末の行数                （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (out) boolError    … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
Sub Validation_Check(wsSelect As Worksheet, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        lngLastRow As Long, _
                        lngFirstRow As Long, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        Optional isCheckThisYear As Boolean = True)

    'intAllItem 右端
    'intCheckItem 範囲右端
    'lngLastRow 行末-1
    'lngFirstRow 行頭-1
    
    Dim rngToCheckTemp As Variant
    Dim rtnDtCol() As Integer

    With wsSelect
    
    '範囲左端
    Dim intLeftCol As Integer
    intLeftCol = .Range("左端").column

    rngToCheckTemp = Array("0", _
                        .Range(.Cells(lngFirstRow, 1), .Cells(lngLastRow, 1)), _
                        .Range(.Cells(lngFirstRow, 2), .Cells(lngLastRow, 2)), _
                        .Range(.Cells(lngFirstRow, 3), .Cells(lngLastRow, 3)), _
                        .Range(.Cells(lngFirstRow, 4), .Cells(lngLastRow, 4)), _
                        .Range(.Cells(lngFirstRow, 5), .Cells(lngLastRow, 5)), _
                        .Range(.Cells(lngFirstRow, 6), .Cells(lngLastRow, 6)), _
                        .Range(.Cells(lngFirstRow, 7), .Cells(lngLastRow, 7)), _
                        .Range(.Cells(lngFirstRow, 8), .Cells(lngLastRow, 8)), _
                        .Range(.Cells(lngFirstRow, 9), .Cells(lngLastRow, 9)), _
                        .Range(.Cells(lngFirstRow, 10), .Cells(lngLastRow, 10)), _
                        .Range(.Cells(lngFirstRow, 11), .Cells(lngLastRow, 11)), _
                        .Range(.Cells(lngFirstRow, 12), .Cells(lngLastRow, 12)))

    '* 全行全列背景色なしに変更 *'
    Call CellColorChange(.Range(.Cells(lngFirstRow, intLeftCol), .Cells(lngLastRow, intAllItem)), False)

    '* 背景色例外 *'
    Call ExceptionCellColorChange(wsSelect, lngFirstRow, lngLastRow)

    End With

    '* 日付項目の列番号を取得する *'
    rtnDtCol = GetDtCol(wsSelect)

    If wsSelect.name = "その10" Then
        Dim rtnShiharaiCol(0)
        ' 金額 - 支払数の列番号を取得する
        rtnShiharaiCol(0) = GetShiharaiCol(wsSelect, COL_NAME_SHIHARAI_10_01, COL_NAME_KINGAKU_10_01)
        Call NeighborCellInputCheck(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, rtnDtCol, , isCheckThisYear, rtnShiharaiCol)
    Else
        Call NeighborCellInputCheck(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, rtnDtCol, , isCheckThisYear)
    End If
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： Validation_Check7
  ' 機  能 ： 詳細行の部分のチェックを行なう（その７用）
  '        ：
  ' 引  数 ： (in)  wsSelect     … 対象シート
  '        ： (in)  strKNo       … 対象シートの区分（1～3）
  '        ： (in)  intAllItem   … 右端の列数                （セルの名前「右端」+1を指定）
  '        ： (in)  intCheckItem … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  lngLastRow   … 行末の行数                （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (out) boolError    … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
Sub Validation_Check7(wsSelect As Worksheet, _
                        strKNo As String, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        lngLastRow As Long, _
                        lngFirstRow As Long, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        Optional isCheckThisYear As Boolean = True)

    'intAllItem 右端
    'intCheckItem 範囲右端
    'lngLastRow 行末-1
    'lngFirstRow 行頭-1

    Dim rngToCheckTemp As Variant
    Dim rtnDtCol() As Integer
    
    With wsSelect
    
    '範囲左端
    Dim intLeftCol As Integer
    intLeftCol = .Range("左端").column
    
    ''2003/09/22 数値チェックなしに変更された
    'チェック列 金額
    'Dim intValueCheckCol As Integer
    'intValueCheckCol = .Range("KINGAKU").Column
    
    '寄附金（税額）控除列（セル位置）の取得  2004/07/13追加-START
    Dim intkoujyoCol As Integer
    intkoujyoCol = .Range("ZEIGAKUKOUJYO").column
    '2004/07/13追加-END
    
    '小計FLG列
    Dim intSKFlgCol As Integer
    intSKFlgCol = .Range("ROWKBN").column
    
    '(特)チェック列 寄附者の氏名
    Dim intMarutokuCheckCol As Integer
    intMarutokuCheckCol = .Range("KIFUSYA_NM").column

    rngToCheckTemp = Array("0", _
                        .Range(.Cells(lngFirstRow, 1), .Cells(lngLastRow, 1)), _
                        .Range(.Cells(lngFirstRow, 2), .Cells(lngLastRow, 2)), _
                        .Range(.Cells(lngFirstRow, 3), .Cells(lngLastRow, 3)), _
                        .Range(.Cells(lngFirstRow, 4), .Cells(lngLastRow, 4)), _
                        .Range(.Cells(lngFirstRow, 5), .Cells(lngLastRow, 5)), _
                        .Range(.Cells(lngFirstRow, 6), .Cells(lngLastRow, 6)), _
                        .Range(.Cells(lngFirstRow, 7), .Cells(lngLastRow, 7)), _
                        .Range(.Cells(lngFirstRow, 8), .Cells(lngLastRow, 8)), _
                        .Range(.Cells(lngFirstRow, 9), .Cells(lngLastRow, 9)), _
                        .Range(.Cells(lngFirstRow, 10), .Cells(lngLastRow, 10)), _
                        .Range(.Cells(lngFirstRow, 11), .Cells(lngLastRow, 11)), _
                        .Range(.Cells(lngFirstRow, 12), .Cells(lngLastRow, 12)))

    '* 全行全列背景色なしに変更 *'
    Call CellColorChange(.Range(.Cells(lngFirstRow, intLeftCol), .Cells(lngLastRow, intAllItem)), False)

    '* 背景色例外 *'
    Call ExceptionCellColorChange(wsSelect, lngFirstRow, lngLastRow)

    End With
    
    '* 日付項目の列番号を取得する *'
    rtnDtCol = GetDtCol(wsSelect)

    ''2003/09/22 数値チェックなしに変更された
    'Select Case strKNo
    'Case "1"
    '    Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, True, intValueCheckCol, 0, 1500000)
    'Case "2"
    '    Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, True, intValueCheckCol, 0, 500000)
    'Case "3"
    '    Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, False)
    'End Select

    '2003/12/05 その7(1) (特)重複チェック
    Select Case strKNo
    Case "1"
        'Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, rtnDtCol, intMarutokuCheckCol, False, , , , True)
        '寄附者（税額）控除のセル位置（intkoujyoCol）追加  2004/07/13変更
        Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, rtnDtCol, intMarutokuCheckCol, False, , , , False, , intkoujyoCol, isCheckThisYear)
    Case Else
        'Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, rtnDtCol, intMarutokuCheckCol, False)
        '寄附者（税額）控除のセル位置（intkoujyoCol）追加  2004/07/13変更
        Call NeighborCellInputCheck7(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, rtnDtCol, intMarutokuCheckCol, False, , , , , , intkoujyoCol, isCheckThisYear)
    End Select

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： Validation_Check8
  ' 機  能 ： 詳細行の部分のチェックを行なう（その８用）
  '        ：
  ' 引  数 ： (in)  wsSelect     … 対象シート
  '        ： (in)  intAllItem   … 右端の列数                （セルの名前「右端」+1を指定）
  '        ： (in)  intCheckItem … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  lngLastRow   … 行末の行数                （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (out) boolError    … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
Sub Validation_Check8(wsSelect As Worksheet, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        lngLastRow As Long, _
                        lngFirstRow As Long, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        Optional isCheckThisYear As Boolean = True)

    Dim rngToCheckTemp As Variant
    Dim rtnDtCol() As Integer
    
    With wsSelect
    
    '範囲左端
    Dim intLeftCol As Integer
    intLeftCol = .Range("左端").column
    
    '小計FLG列
    Dim intSKFlgCol As Integer
    intSKFlgCol = .Range("ROWKBN").column

    rngToCheckTemp = Array("0", _
                        .Range(.Cells(lngFirstRow, 1), .Cells(lngLastRow, 1)), _
                        .Range(.Cells(lngFirstRow, 2), .Cells(lngLastRow, 2)), _
                        .Range(.Cells(lngFirstRow, 3), .Cells(lngLastRow, 3)), _
                        .Range(.Cells(lngFirstRow, 4), .Cells(lngLastRow, 4)), _
                        .Range(.Cells(lngFirstRow, 5), .Cells(lngLastRow, 5)), _
                        .Range(.Cells(lngFirstRow, 6), .Cells(lngLastRow, 6)), _
                        .Range(.Cells(lngFirstRow, 7), .Cells(lngLastRow, 7)), _
                        .Range(.Cells(lngFirstRow, 8), .Cells(lngLastRow, 8)), _
                        .Range(.Cells(lngFirstRow, 9), .Cells(lngLastRow, 9)), _
                        .Range(.Cells(lngFirstRow, 10), .Cells(lngLastRow, 10)), _
                        .Range(.Cells(lngFirstRow, 11), .Cells(lngLastRow, 11)), _
                        .Range(.Cells(lngFirstRow, 12), .Cells(lngLastRow, 12)))

    '* 全行全列背景色なしに変更 *'
    Call CellColorChange(.Range(.Cells(lngFirstRow, intLeftCol), .Cells(lngLastRow, intAllItem)), False)

    '* 背景色例外 *'
    Call ExceptionCellColorChange(wsSelect, lngFirstRow, lngLastRow)

    End With
    
    '* 日付項目の列番号を取得する *'
    rtnDtCol = GetDtCol(wsSelect)

    Call NeighborCellInputCheck8(intLeftCol, intAllItem, intCheckItem, rngToCheckTemp, boolError, boolAllEmpty, intSKFlgCol, rtnDtCol, , isCheckThisYear)

End Sub
  
'-------------------------------------------------------------------
  ' 関数名 ： NeighborCellInputCheck
  ' 機  能 ： 詳細行の部分のチェックを行なう
  '        ：
  '        ： (in)  intLeftCol     … 左端の列数                （セルの名前「左端」を指定）
  '        ： (in)  intAllItem     … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem   … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  rngToCheckTemp … 詳細行を１列ずつ縦に分割したRangeオブジェクトの配列
  '        ： (out) boolError      … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty   … 空のシートであればTrueが格納される
  '        ： (in)  rtnDtCol       … 日付項目の列指定（配列）
  '        ： (in)  lngHighlightColor … エラーの色
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
' 2004.06.07 日付チェックを追加
Sub NeighborCellInputCheck( _
                        intLeftCol As Integer, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        rngToCheckTemp As Variant, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        rtnDtCol() As Integer, _
                        Optional lngHighlightColor As Long = 13408767, _
                        Optional isCheckThisYear As Boolean = True, _
                        Optional rtnShiharaiCol As Variant = Null _
                        )

    Dim lngRowCounter As Long
    Dim intI As Integer
    
    Dim i As Integer
    
    Dim rngTemp() As Range
    ReDim rngTemp(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmpty() As Boolean
    ReDim boolEmpty(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmptyAnd As Boolean
    Dim boolEmptyOr As Boolean
    
    Dim boolErrorT As Boolean
    
    'boolAllEmpty = True
    'boolError = False
    
    If Not IsNull(rtnShiharaiCol) Then
        Dim rngShiharaiTemp() As Range
        ReDim rngShiharaiTemp(UBound(rtnShiharaiCol), 1)
    End If
    
    '行ループ
    For lngRowCounter = 1 To rngToCheckTemp(1).Rows.Count
    
        boolEmptyAnd = False
        boolEmptyOr = False
    
        '列ループ
        For intI = intLeftCol To intAllItem
    
            'Cells(行Row,列Col)
            Set rngTemp(lngRowCounter, intI) = rngToCheckTemp(intI).Cells(lngRowCounter, 1)
            boolEmpty(lngRowCounter, intI) = CellEmptyCheck(rngTemp(lngRowCounter, intI))
            
            If intI <= intCheckItem Then
            
                If intI = intLeftCol Then
                    boolEmptyAnd = boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmpty(lngRowCounter, intI)
                Else
                    boolEmptyAnd = boolEmptyAnd And boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmptyOr Or boolEmpty(lngRowCounter, intI)
                End If
            
            End If
        
        Next intI

        'Andは全件TrueのみTrue Orは全件FalseのみFalse
        '1列の全項目空
        If (boolEmptyAnd = True And boolEmptyOr = True) Then
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                
                '塗りつぶしなし
                boolErrorT = False
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
            
                boolErrorT = False

                '空でない
                If boolEmpty(lngRowCounter, intI) = False Then
                
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    boolAllEmpty = False
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E006)
                End If
            
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                
            Next intI
        
        '1列の全項目埋まっている
        ElseIf (boolEmptyAnd = False And boolEmptyOr = False) Then
            
            '列ループ
            For intI = intLeftCol To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                '日付妥当性エラーでなければ塗りつぶさない
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
            
                If Not IsNull(rtnShiharaiCol) Then
                    For i = 0 To UBound(rtnShiharaiCol)
                        If intI = rtnShiharaiCol(i)(0) Then
                            Set rngShiharaiTemp(i, 0) = rngTemp(lngRowCounter, intI)
                        ElseIf intI = rtnShiharaiCol(i)(1) Then
                            Set rngShiharaiTemp(i, 1) = rngTemp(lngRowCounter, intI)
                        End If
                    Next i
                End If
            Next intI
            
            If Not IsNull(rtnShiharaiCol) Then
                For i = 0 To UBound(rngShiharaiTemp, 1)
                    Call CheckDoubleNumberEitherToZero(rngShiharaiTemp(i, 0), rngShiharaiTemp(i, 1), boolError)
                Next i
            End If
            
            'If boolEmptyAnd = False And boolEmptyOr = False Then
            boolAllEmpty = False
        
        Else
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                    
                boolErrorT = False
                
                If boolEmpty(lngRowCounter, intI) = True Then
                    
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E001)
                Else
                    '* 日付項目で入力値が日付でない場合はエラーとする *'
                    boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                    boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                End If
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
                
                If Not IsNull(rtnShiharaiCol) Then
                    For i = 0 To UBound(rtnShiharaiCol)
                        If intI = rtnShiharaiCol(i)(0) Then
                            Set rngShiharaiTemp(i, 0) = rngTemp(lngRowCounter, intI)
                        ElseIf intI = rtnShiharaiCol(i)(1) Then
                            Set rngShiharaiTemp(i, 1) = rngTemp(lngRowCounter, intI)
                        End If
                    Next i
                End If
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                '日付妥当性エラーでなければ塗りつぶさない
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
                If Not IsNull(rtnShiharaiCol) Then
                    For i = 0 To UBound(rtnShiharaiCol)
                        If intI = rtnShiharaiCol(i)(0) Then
                            Set rngShiharaiTemp(i, 0) = rngTemp(lngRowCounter, intI)
                        ElseIf intI = rtnShiharaiCol(i)(1) Then
                            Set rngShiharaiTemp(i, 1) = rngTemp(lngRowCounter, intI)
                        End If
                    Next i
                End If
            Next intI
            
            If Not IsNull(rtnShiharaiCol) Then
                For i = 0 To UBound(rngShiharaiTemp, 1)
                    Call CheckDoubleNumberEitherToZero(rngShiharaiTemp(i, 0), rngShiharaiTemp(i, 1), boolError)
                Next i
            End If
            
            boolAllEmpty = False
        
        End If
            
    Next lngRowCounter

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： NeighborCellInputCheck7
  ' 機  能 ： 詳細行の部分のチェックを行なう（その７）
  '        ：
  ' 引  数 ： (in)  intLeftCol           … 左端の列数                （セルの名前「左端」を指定）
  '        ： (in)  intAllItem           … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem         … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  rngToCheckTemp       … 詳細行を１列ずつ縦に分割したRangeオブジェクトの配列
  '        ： (out) boolError            … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty         … 空のシートであればTrueが格納される
  '        ： (in)  intSKFlgCol　　　    … 行区分の列数
  '        ： (in)  rtnDtCol             … 日付項目の列指定（配列）
  '        ： (in)  intKifusyaCol        … 「寄附者の氏名」の列数
  '        ： (in)  boolValueCheckFLG    … 金額のチェックを行なうかどうか
  '        ： (in)  intValueCheckCol     … 金額列の列数
  '        ： (in)  lngLowValue          … 金額チェックのしきい値（最小）
  '        ： (in)  lngHighValue         … 金額チェックのしきい値（最大）
  '        ： (in)  boolMarutokuCheckFLG … 「(特)」の重複チェックを行なうかどうか(必ずOFFにしている)
  '        ： (in)  lngHighlightColor    … エラーの色
  '        ： (in)  intkoujyoCol         … 「寄附金（税額）控除」の列数
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
Sub NeighborCellInputCheck7( _
                        intLeftCol As Integer, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        rngToCheckTemp As Variant, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        intSKFlgCol As Integer, _
                        rtnDtCol() As Integer, _
                        intKifusyaCol As Integer, _
                        Optional boolValueCheckFLG As Boolean = False, _
                        Optional intValueCheckCol As Integer, _
                        Optional lngLowValue As Long, _
                        Optional lngHighValue As Long, _
                        Optional boolMarutokuCheckFLG As Boolean = False, _
                        Optional lngHighlightColor As Long = 13408767, _
                        Optional intkoujyoCol As Integer, _
                        Optional isCheckThisYear As Boolean = True)                 '2004/07/13追加

    Dim lngRowCounter As Long
    Dim intI As Integer
    
    Dim rngTemp() As Range
    ReDim rngTemp(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmpty() As Boolean
    ReDim boolEmpty(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmptyAnd As Boolean
    Dim boolEmptyOr As Boolean
    
    Dim boolErrorT As Boolean
    
    Dim boolMarutokuUmu As Boolean
    boolMarutokuUmu = False
    
    'boolAllEmpty = True
    'boolError = False
    
    '行ループ
    For lngRowCounter = 1 To rngToCheckTemp(1).Rows.Count
    
        boolEmptyAnd = False
        boolEmptyOr = False
    
        '列ループ
        For intI = intLeftCol To intAllItem
    
            'Cells(行Row,列Col)
            Set rngTemp(lngRowCounter, intI) = rngToCheckTemp(intI).Cells(lngRowCounter, 1)
            boolEmpty(lngRowCounter, intI) = CellEmptyCheck(rngTemp(lngRowCounter, intI))
            
            If intI <= intCheckItem Then
            
                If intI = intLeftCol Then
                    boolEmptyAnd = boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmpty(lngRowCounter, intI)
                Else
                    boolEmptyAnd = boolEmptyAnd And boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmptyOr Or boolEmpty(lngRowCounter, intI)
                End If
            
            End If
        
        Next intI

        '小計FLGありの場合
        If rngToCheckTemp(intSKFlgCol).Cells(lngRowCounter, 1).value = True Then
                
            'boolErrorT = False
        
            '金額の12桁チェック
            '9999999999999999以上はエラー
            'If rngTemp(lngRowCounter, intValueCheckCol).Value >= 1000000000000# Then
                
                '塗りつぶし
             '   boolErrorT = True
            '    boolError = True
            
            'End If

            'Call CellColorChange(rngTemp(lngRowCounter, intValueCheckCol), boolErrorT, True)
        
        'Andは全件TrueのみTrue Orは全件FalseのみFalse
        '1列の全項目空
        ElseIf (boolEmptyAnd = True And boolEmptyOr = True) Then
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                
                '塗りつぶしなし
                boolErrorT = False
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
                
                boolErrorT = False
                
                '空でない
                If boolEmpty(lngRowCounter, intI) = False Then
                
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    boolAllEmpty = False
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E006)
                End If
            
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
        
        '1列の全項目埋まっている
        ElseIf (boolEmptyAnd = False And boolEmptyOr = False) Then
            
            '列ループ
            For intI = intLeftCol To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                '日付妥当性エラーでなければ塗りつぶさない
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                
                '数値チェック
                GoSub ValueCheck
                
                '「寄附者の氏名（又は名称）」列の場合は、対象文字列をチェック
                If intI = intKifusyaCol Then
                    '寄附者の氏名チェック（禁止文字列チェック）
                    GoSub KifusyaNameCheck
                    '(特)チェック
                    GoSub MarutokuCheck
                
'                ElseIf intI = intkoujyoCol Then  '2004/07/13追加-START
'                    '寄附金（税額）控除チェック
'                    GoSub zeigakukoujyo_check
'                    '2004/07/13追加-END
                    
                End If
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                        
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
            
            Next intI
            
            'If boolEmptyAnd = False And boolEmptyOr = False Then
            boolAllEmpty = False
        
        Else
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                        
                boolErrorT = False
                
                If boolEmpty(lngRowCounter, intI) = True Then
                    
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E001)
                Else
                    
                    '* 日付項目で入力値が日付でない場合はエラーとする *'
                    boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                    boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                    
                    '数値チェック
                    GoSub ValueCheck
                    
                    '「寄附者の氏名（又は名称）」列の場合は、対象文字列をチェック
                    If intI = intKifusyaCol Then
                        '寄附者の氏名チェック（禁止文字列チェック）
                        GoSub KifusyaNameCheck
                        '(特)チェック (※使用していない)
                        GoSub MarutokuCheck
                
'                    ElseIf intI = intkoujyoCol Then  '2004/07/13追加-START
'                        '寄附金（税額）控除チェック
'                        GoSub zeigakukoujyo_check
'                        '2004/07/13追加-END
                        
                    End If
                    
                End If
            
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
            
            boolAllEmpty = False
        
        End If
            
    Next lngRowCounter

Exit Sub

KifusyaNameCheck:
    '2004.06.07 寄附者の氏名は「同上」「〃」等をエラーとする
    '寄附者の氏名（又は名称）の禁止文字列チェック
    If IsNGString(rngTemp(lngRowCounter, intI).value) Then
        '塗りつぶし
        boolErrorT = True
        boolError = True
        Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E156)
    End If

Return

ValueCheck:
    '数値チェック
    If boolValueCheckFLG = True And intI = intValueCheckCol And IsNumeric(rngTemp(lngRowCounter, intI).value) Then
    
        If rngTemp(lngRowCounter, intI).value < lngLowValue Or rngTemp(lngRowCounter, intI).value > lngHighValue Then
            '塗りつぶし
            boolErrorT = True
            boolError = True
            '現状未使用のためエラーコメントなし
        End If
    
    End If

Return

MarutokuCheck:
    
    '(特)チェック
    '  同一シート内で「(特)」で始まる寄附者の氏名が２以上ある場合はエラー
    '※使用していない (必ず boolMarutokuCheckFLG = False)
    If boolMarutokuCheckFLG = True Then
    
        If StrConv(rngTemp(lngRowCounter, intI).value, vbNarrow) Like "(特)*" Then
            Select Case boolMarutokuUmu
            Case True
                boolErrorT = True
                boolError = True
                '現状未使用のためエラーコメントなし
            Case False
                boolMarutokuUmu = True
            End Select
        End If
    
    End If

Return

zeigakukoujyo_check:
    
    '寄附金（税額）控除チェック                        2004/07/13追加SUB
    '  小計行以外に”必要”を指定してある場合はエラー
    If rngTemp(lngRowCounter, intI).value = "必要" Then
        '塗りつぶし
        boolErrorT = True
        boolError = True
        '現状未使用のためエラーコメントなし
    End If

Return


End Sub

'-------------------------------------------------------------------
  ' 関数名 ： NeighborCellInputCheck8
  ' 機  能 ： 詳細行の部分のチェックを行なう（その８）
  '        ：
  '        ： (in)  intLeftCol     … 左端の列数                （セルの名前「左端」を指定）
  '        ： (in)  intAllItem     … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem   … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  rngToCheckTemp … 詳細行を１列ずつ縦に分割したRangeオブジェクトの配列
  '        ： (out) boolError      … エラーがあればTrueが格納される
  '        ： (out) boolAllEmpty   … 空のシートであればTrueが格納される
  '        ： (in)  intSKFlgCol　　… 行区分の列数
  '        ： (in)  rtnDtCol       … 日付項目の列指定（配列）
  '        ： (in)  lngHighlightColor … エラーの色
  '        ： (in) isCheckThisYear … True:報告年と一致しているかチェックする, Flase:しない
'-------------------------------------------------------------------
Sub NeighborCellInputCheck8( _
                        intLeftCol As Integer, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        rngToCheckTemp As Variant, _
                        boolError As Boolean, _
                        boolAllEmpty As Boolean, _
                        intSKFlgCol As Integer, _
                        rtnDtCol() As Integer, _
                        Optional lngHighlightColor As Long = 13408767, _
                        Optional isCheckThisYear As Boolean = True)

    Dim lngRowCounter As Long
    Dim intI As Integer
    
    Dim rngTemp() As Range
    ReDim rngTemp(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmpty() As Boolean
    ReDim boolEmpty(1 To rngToCheckTemp(1).Rows.Count, intLeftCol To intAllItem)
    
    Dim boolEmptyAnd As Boolean
    Dim boolEmptyOr As Boolean
    
    Dim boolErrorT As Boolean
    
    Dim boolMarutokuUmu As Boolean
    boolMarutokuUmu = False
    
    'boolAllEmpty = True
    'boolError = False
    
    '行ループ
    For lngRowCounter = 1 To rngToCheckTemp(1).Rows.Count
    
        boolEmptyAnd = False
        boolEmptyOr = False
    
        '列ループ
        For intI = intLeftCol To intAllItem
    
            'Cells(行Row,列Col)
            Set rngTemp(lngRowCounter, intI) = rngToCheckTemp(intI).Cells(lngRowCounter, 1)
            boolEmpty(lngRowCounter, intI) = CellEmptyCheck(rngTemp(lngRowCounter, intI))
            
            If intI <= intCheckItem Then
            
                If intI = intLeftCol Then
                    boolEmptyAnd = boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmpty(lngRowCounter, intI)
                Else
                    boolEmptyAnd = boolEmptyAnd And boolEmpty(lngRowCounter, intI)
                    boolEmptyOr = boolEmptyOr Or boolEmpty(lngRowCounter, intI)
                End If
            
            End If
        
        Next intI

        '小計FLGありの場合
        If rngToCheckTemp(intSKFlgCol).Cells(lngRowCounter, 1).value = True Then
                
            'boolErrorT = False
        
            '金額の12桁チェック
            '9999999999999999以上はエラー
            'If rngTemp(lngRowCounter, intValueCheckCol).Value >= 1000000000000# Then
                
                '塗りつぶし
             '   boolErrorT = True
            '    boolError = True
            
            'End If

            'Call CellColorChange(rngTemp(lngRowCounter, intValueCheckCol), boolErrorT, True)
        
        'Andは全件TrueのみTrue Orは全件FalseのみFalse
        '1列の全項目空
        ElseIf (boolEmptyAnd = True And boolEmptyOr = True) Then
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                
                '塗りつぶしなし
                boolErrorT = False
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
                
                boolErrorT = False
                
                '空でない
                If boolEmpty(lngRowCounter, intI) = False Then
                
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    boolAllEmpty = False
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E006)
                End If
            
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
        
        '1列の全項目埋まっている
        ElseIf (boolEmptyAnd = False And boolEmptyOr = False) Then
            
            '列ループ
            For intI = intLeftCol To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                '日付妥当性エラーでなければ塗りつぶさない
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                                               
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
                
            Next intI
            
            'If boolEmptyAnd = False And boolEmptyOr = False Then
            boolAllEmpty = False
        
        Else
            
            '列ループ
            For intI = intLeftCol To intCheckItem
                        
                boolErrorT = False
                
                If boolEmpty(lngRowCounter, intI) = True Then
                    
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    Call setComment(rngTemp(lngRowCounter, intI).Worksheet, rngTemp(lngRowCounter, intI), MESSAGE_E001)
                Else
                    
                    '* 日付項目で入力値が日付でない場合はエラーとする *'
                    boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                    boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                                        
                End If
            
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
                
                If boolErrorT = False Then
                    boolError = boolError Or CheckRangeGaiji(rngTemp(lngRowCounter, intI), rngToCheckTemp(2).Cells(lngRowCounter, 1).value)
                End If
                
            Next intI
            
            '列ループ 範囲右端～右端
            For intI = intCheckItem + 1 To intAllItem
                
                '* 日付項目で入力値が日付でない場合はエラーとする *'
                boolErrorT = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), False, isCheckThisYear)
                boolError = DateErrorCheck(rtnDtCol, rngTemp(lngRowCounter, intI), boolError, isCheckThisYear)
                
                Call CellColorChangeErrorOnly(rngTemp(lngRowCounter, intI), boolErrorT)
            
            Next intI
            
            boolAllEmpty = False
        
        End If
            
    Next lngRowCounter

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： CellEmptyCheck
  ' 機  能 ： 指定セルが空であるかを返す
  '        ：
  ' 引  数 ： (in)  rngTemp … 対象セル
  ' 返り値 ： True:空のセルである, False:そうでない
'-------------------------------------------------------------------
Function CellEmptyCheck(rngTemp As Range) As Boolean

    If (IsNull(rngTemp.value) Or IsEmpty(rngTemp.value) Or rngTemp.value = "") = True Then
        CellEmptyCheck = True
    Else
        CellEmptyCheck = False
    End If

End Function

'-------------------------------------------------------------------
  ' 関数名 ： SKBNCHK
  ' 機  能 ： その11,12のパーティ名、その15の費目のチェックを行なう
  '        ： 未入力チェック、同じ区分内で重複していないかのチェックを行なう
  '        ： （小区分チェックの略らしい）
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  strCHKRange … 処理対象のセルの名称
  '        ： (out) boolError … エラーがあればTrueが格納される
  '        ： (in)  lngHighlightColor … エラーの場合の背景色
'-------------------------------------------------------------------
Sub SKBNCHK(wsSelect As Worksheet, strCHKRange As String, boolError As Boolean, Optional lngHighlightColor As Long = 13408767)

    Dim rngCHK As Range, boolErrorT As Boolean
    Dim lngI As Long
    Dim strKNo As String, strSKNo As String
    Dim strSheetAndKubun As String
    Dim strSearchItem As String
    Dim isFind As Boolean
    
    'Set wsSelect = ActiveSheet
    Set rngCHK = wsSelect.Range(strCHKRange)
    
    'KINGAKU_GKが0でない場合
    If wsSelect.Range("KINGAKU_GK").value <> 0 Then
        '空文字列の場合
        If rngCHK.value = "" Then
            boolErrorT = True
            boolError = True
            Call setComment(wsSelect, rngCHK, MESSAGE_E001)
        End If
    'KINGAKU_GKが0の場合
    Else
        '空文字列でない場合
        If rngCHK.value <> "" Then
            boolErrorT = True
            boolError = True
            Call setComment(wsSelect, rngCHK, MESSAGE_E019)
        End If
    End If
    
    If strCHKRange = "HIMOKU" Or strCHKRange = "PATYI_NM" Then
        GoSub HimokuCheckSub
    End If

    Call CellColorChange(rngCHK, boolErrorT)
    
    Set rngCHK = Nothing
    'Set wsSelect = Nothing

Exit Sub

'パーティー名、費目の重複チェック(2008/11/7 変更)
HimokuCheckSub:
    
    If IsEmptyString(rngCHK.value) = False Then
    
        '区分を取得
        Call SheetNo(wsSelect.name, strKNo, strSKNo)
        
        '様式・区分を表す文字列を取得（例：その11(1) → "その111", その12(3) → "その123"）
        strSheetAndKubun = Left(wsSelect.name, InStr(wsSelect.name, "(") - 1) & strKNo
        
        '"様式・区分"と、費目をカンマで結合する（例：「その111,○○パーティー」）
        strSearchItem = strSheetAndKubun & "," & rngCHK.value
        
        'コレクションから、同一様式・区分かつ同一費目を探す
        isFind = False
        For lngI = 1 To colHimokuArray.Count
            
            '見つかればエラー
            If CStr(colHimokuArray.Item(lngI)) = strSearchItem Then
                isFind = True
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, rngCHK, MESSAGE_E174)
                Exit For
            End If
            
        Next lngI
        
        '見つからなければ、費目をコレクションに格納
        If isFind = False Then
            colHimokuArray.Add strSearchItem
        End If
    End If

Return

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： CellColorChange
  ' 機  能 ： セルの背景色を変更する
  '        ： 引数のboolErrorがTrueであれば背景色を設定し、
  '        ： Falseであれば背景色を元に戻す
  '        ：
  ' 引  数 ： (in)  rngCHK … 処理対象セルオブジェクト
  '        ： (in)  boolError            … エラーがあればTrueが格納される
  '        ： (in)  boolLowlightColor … エラーで無い場合、lngLowlightColorを設定する場合True
  '        ： (in)  lngHighlightColor … エラーの場合の背景色
  '        ： (in)  lngLowlightColor … エラーでない場合の背景色
'-------------------------------------------------------------------
Sub CellColorChange(rngCHK As Range, _
                    boolError As Boolean, _
                    Optional boolLowlightColor As Boolean = False, _
                    Optional lngHighlightColor As Long = 13408767, _
                    Optional lngLowlightColor As Long = 10092543)
    If boolError = True Then
        'エラーの場合
        'エラーの場合の背景色を設定
        rngCHK.Interior.Color = lngHighlightColor
        
        If rngCHK.Parent.name <> "" Then
            'エラー箇所のシート名が取得出来たらエラー箇所の位置を格納する
            Call setMovePoint(ErrMovePoint, rngCHK.Parent.name, rngCHK.Address)
        End If
    Else
        'エラーではない場合
        If boolLowlightColor = True Then
            'エラーでない場合の背景色を設定
            rngCHK.Interior.Color = lngLowlightColor
        Else
            '背景色なし
            rngCHK.Interior.ColorIndex = xlColorIndexNone
        End If
        
        If rngCHK.Worksheet.name <> "" Then
            'シート名が取得出来た場合
            Dim lngR As Long
            Dim lngC As Long
            For lngR = 1 To rngCHK.Rows.Count
                For lngC = 1 To rngCHK.Columns.Count
                    If TypeName(rngCHK.Item(lngR, lngC).Comment) <> "Nothing" Then
                        'コメントが存在したら削除する
                        Dim wsSheet As Worksheet
                        Set wsSheet = Worksheets(rngCHK.Worksheet.name)
                        
                        Call UnlockOneSheet(wsSheet)
                        rngCHK.ClearComments
                        Call LockOneSheet(wsSheet)
                    End If
                Next lngC
            Next lngR
        End If
    End If
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： CellColorChangeErrorOnly
  ' 機  能 ： セルの背景色を変更する
  '        ： 引数のboolErrorがTrueであれば背景色を設定し、
  '        ： Falseであれば何もしない
  '        ：
  ' 引  数 ： (in)  rngCHK … 処理対象セルオブジェクト
  '        ： (in)  boolError … エラーかどうか
  '        ： (in)  lngHighlightColor … エラーの場合の背景色
'-------------------------------------------------------------------
Sub CellColorChangeErrorOnly(rngCHK As Range, boolError As Boolean, Optional lngHighlightColor As Long = 13408767)

    If boolError = True Then
        'エラーの場合
        'エラーの場合の背景色を設定
        rngCHK.Interior.Color = lngHighlightColor
        
        If rngCHK.Parent.name <> "" Then
            'エラー箇所のシート名が取得出来たらエラー箇所の位置を格納する
            Call setMovePoint(ErrMovePoint, rngCHK.Parent.name, rngCHK.Address)
        
        End If
    Else
        'エラーではない場合
        If rngCHK.Worksheet.name <> "" Then
            'シート名が取得出来た場合
            Dim lngR As Long
            Dim lngC As Long
            For lngR = 1 To rngCHK.Rows.Count
                For lngC = 1 To rngCHK.Columns.Count
                    If TypeName(rngCHK.Item(lngR, lngC).Comment) <> "Nothing" Then
                        'コメントが存在したら削除する
                        Dim wsSheet As Worksheet
                        Set wsSheet = Worksheets(rngCHK.Worksheet.name)
                        
                        Call UnlockOneSheet(wsSheet)
                        rngCHK.ClearComments
                        Call LockOneSheet(wsSheet)
                    End If
                Next lngC
            Next lngR
        End If
    End If

End Sub

'12桁チェック
Sub K12CHK(wsSelect As Worksheet, strGetVar As String, boolError As Boolean, Optional lngHighlightColor As Long = 13408767, _
            Optional Ext1 As Variant, _
            Optional boolAllEmpty As Boolean = False, _
            Optional boolNotInput As Boolean = True)
    
    Dim nmsSelWS As Names, rngCHK As Range
    Dim lngI As Long, boolErrorT As Boolean, boolPass As Boolean, intI As Integer
    
    Set nmsSelWS = wsSelect.Names

    For lngI = 1 To nmsSelWS.Count
    
        boolPass = False
        
        If IsMissing(Ext1) = False Then
            'Ext1は例外としてチェックから除く
            For intI = 0 To UBound(Ext1)
            
                If nmsSelWS(lngI).name = wsSelect.name & "!" & Ext1(intI) Then
            
                    'パスする際にTrue
                    boolPass = True
                    Exit For
                
                End If
            
            Next
        End If
    
        'パスされてない場合
        If boolPass = False Then
    
            'strGetVarに該当するものを検索
            If nmsSelWS(lngI).name Like strGetVar Then
    
                Set rngCHK = wsSelect.Range(nmsSelWS(lngI).name)
                
                '9999999999999999以上はエラー
                If rngCHK.value >= 1000000000000# Then
                    boolError = True
                    boolErrorT = True
                ElseIf rngCHK.value = 0 Then
                    boolErrorT = False
                Else
                    boolErrorT = False
                    boolAllEmpty = False
                End If
            
                Call CellColorChange(rngCHK, boolErrorT, True)
                '2019/4/26 追加
                If boolErrorT = True Then
                    If boolNotInput = False Then
                        '入力可能な項目
                        Call setComment(rngCHK.Worksheet, rngCHK, MESSAGE_E121, "12")
                    Else
                        '入力不可な項目
                        Call setComment(rngCHK.Worksheet, rngCHK, MESSAGE_E008)
                    End If
                End If
                
                Set rngCHK = Nothing
            
            End If
        
        End If
    
    Next

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ValueCompareCheck
  ' 機  能 ： その2の項目の値の大小関係をチェックする
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  strValueTarget … チェック対象のセルの名称
  '        ： (in)  strValueBase … 比較に使用するセルの名称
  '        ： (in)  strCompareType … 比較の指定（">=" or "<="）
  '        ： (out) boolError … エラーがあればTrueが格納される
  '        ： (in)  boolZeroBase … True:0と比較する, False:比較に使用するセルと比較する
  '        ： (in)  strErrorMsg … エラーメッセージ
'-------------------------------------------------------------------
Sub ValueCompareCheck(wsSelect As Worksheet, strValueTarget As String, strValueBase As String, strCompareType As String, _
                        boolError As Boolean, _
                        Optional boolZeroBase As Boolean = False, _
                        Optional strErrorMsg As String = "")

    Dim rngTarget As Range, rngBase As Range, boolErrorT As Boolean
    Set rngTarget = wsSelect.Range(strValueTarget)
    Set rngBase = wsSelect.Range(strValueBase)
    
    If rngTarget.value = "" Then GoTo ColorChange
    If rngBase.value = "" Then Exit Sub
    
    Select Case boolZeroBase
    Case False
    
        Select Case strCompareType
        Case "<="
        
            'Target が Base 以下  満たされなければエラー
            If rngTarget.value <= rngBase.value Then
            Else
                boolError = True
                boolErrorT = True
                Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E148, strErrorMsg)
            End If
        
        Case ">="
            
            'Target が Base 以上  満たされなければエラー
            If rngTarget.value >= rngBase.value Then
            Else
                boolError = True
                boolErrorT = True
                '未使用のためエラーコメントなし
            End If
        
        Case Else
        End Select
    
    Case True
    
        Select Case strCompareType
        Case "<="
        
            'Target が 0 以下  満たされなければエラー
            If rngTarget.value <= 0 Then
            Else
                boolError = True
                boolErrorT = True
                '未使用のためエラーコメントなし
            End If
        
        Case ">="
            
            'Target が 0 以上  満たされなければエラー
            If rngTarget.value >= 0 Then
            Else
                boolError = True
                boolErrorT = True
                Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E191)
            End If
        
        Case Else
        End Select
    
    End Select
    
    '12桁チェック
    If rngTarget.value >= 1000000000000# Then
        boolError = True
        boolErrorT = True
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E121, "12")
    End If
    
ColorChange:
    If rngTarget.Locked Then
        Call CellColorChange(rngTarget, boolErrorT, True)
    Else
        Call CellColorChange(rngTarget, boolErrorT)
    End If
    
    Set rngTarget = Nothing
    Set rngBase = Nothing

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： HISSUCHK
  ' 機  能 ： 必須チェックを行なう
  '        ： 指定項目が空("")の場合、エラーとする
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  strCHKRange … チェック対象のセルの名称
  '        ： (out) boolError … エラーがあればTrueが格納される
  '        ： (in)  lngHighlightColor … エラーの場合の背景色
'-------------------------------------------------------------------
Sub HISSUCHK(wsSelect As Worksheet, strCHKRange As String, boolError As Boolean, Optional lngHighlightColor As Long = 13408767)

    Dim rngCHK As Range
    Set rngCHK = wsSelect.Range(strCHKRange)
    
    '空文字列の場合
    If rngCHK.value = "" Then
        rngCHK.Interior.Color = lngHighlightColor
        boolError = True
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        If rngCHK.Parent.name <> "" Then
            'エラー箇所のシート名が取得出来たら格納する
            Call setMovePoint(ErrMovePoint, rngCHK.Parent.name, rngCHK.Address)
        End If
        '2019/4/26 追加
        Call setComment(rngCHK.Worksheet, rngCHK, MESSAGE_E001)
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    Else
        Call CellColorChange(rngCHK, False, False)
    End If

    Set rngCHK = Nothing

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： Counter
  ' 機  能 ： 列から、指定文字列と一致（または不一致）の件数を数える
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  intCHKCol … チェック対象列の列数
  '        ： (in)  lngLastRow   … 行末の行数  （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数  （セルの名前「行頭」+1を指定）
  '        ： (in)  strVal … 検索文字列
  '        ： (in)  boolTypeNot … True:検索文字列と不一致の件数を探す, False:検索文字列と一致する件数を探す
  ' 返り値 ： 件数
'-------------------------------------------------------------------
Function Counter(wsSelect As Worksheet, intCHKCol As Integer, lngLastRow As Long, lngFirstRow As Long, strVal As String, Optional boolTypeNot As Boolean = False) As Long

    Dim lngI As Long, lngCounter As Long

    '行頭から行末までloop
    For lngI = lngFirstRow To lngLastRow

        '検索タイプ
        If boolTypeNot = True Then
            
            'intCHKColの列において、strValと異なる場合lngCounterに1を足す
            If wsSelect.Cells(lngI, intCHKCol).value <> strVal Then lngCounter = lngCounter + 1
        
        Else

            'intCHKColの列において、strValと同じ場合lngCounterに1を足す
            If wsSelect.Cells(lngI, intCHKCol).value = strVal Then lngCounter = lngCounter + 1
    
        End If
    
    Next lngI

    Counter = lngCounter

End Function

'-------------------------------------------------------------------
  ' 関数名 ： NasiKingaku
  ' 機  能 ： その14及びその15, 8号様式から、「領収書等を徴し難かった支出の明細書を作成する」行の金額を加算して返す
  '        ： （8号様式の場合は、単純に金額を加算する）
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  intCHKCol … 「領収書等を徴し難かった支出の明細書を作成する」列の列数
  '        ： (in)  lngLastRow   … 行末の行数  （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数  （セルの名前「行頭」+1を指定）
  '        ： (in)  strVal … 対象シート名
  '        ： (in)  lngKingaku … 金額列の列数
  ' 返り値 ： 加算した合計金額
'-------------------------------------------------------------------
Function NasiKingaku(wsSelect As Worksheet, intCHKCol As Integer, lngLastRow As Long, lngFirstRow As Long, strVal As String, lngKingaku As Long) As Double

    Dim lngI As Long
    Dim DblKingaku As Double

    '行頭から行末までloop
    For lngI = lngFirstRow To lngLastRow

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'         If strVal = "8号様式" Then
         If strVal = "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
'@@01MOD START
'             DblKingaku = DblKingaku + wsSelect.Cells(LngI, lngKingaku).value
            If Len(Trim(wsSelect.Cells(lngI, wsSelect.Range("ICHIREN_NO").column).value & "")) > 0 Then
                If IsNumeric(wsSelect.Cells(lngI, wsSelect.Range("ICHIREN_NO").column).value) = True Then
                    DblKingaku = DblKingaku + wsSelect.Cells(lngI, lngKingaku).value
                End If
            End If
            
'@@01MOD END
             
         Else
             
             If wsSelect.Cells(lngI, intCHKCol).value = "領収書等を徴し難かった支出の明細書を作成する" Then
                 If wsSelect.Cells(lngI, lngKingaku).value <> "" Then
                     DblKingaku = DblKingaku + wsSelect.Cells(lngI, lngKingaku).value
                 End If
             End If
         
         End If
    
    Next lngI

    NasiKingaku = DblKingaku

End Function

'-------------------------------------------------------------------
  ' 関数名 ： FindRange
  ' 機  能 ： 列から、指定文字列と一致（または不一致）の行(複数)のRangeオブジェクトを取得する
  '        ：
  ' 引  数 ： (in)  wsSelect     … 処理対象シート
  '        ： (in)  intCHKCol    … チェック対象列の列数
  '        ： (in)  lngLastRow   … 行末の行数  （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow  … 行頭の行数  （セルの名前「行頭」+1を指定）
  '        ： (in)  intLeftCol   … 左端の列数  （セルの名前「左端」を指定）
  '        ： (in)  intRightCol  … 右端の列数  （セルの名前「右端」を指定）
  '        ： (in)  strVal       … 検索文字列
  '        ： (in)  boolTypeNot  … True:検索文字列と不一致の行を取得, False:検索文字列と一致する行を取得
  ' 返り値 ： 一致（または不一致）行範囲をすべて融合したのRangeオブジェクト
'-------------------------------------------------------------------
Function FindRange(wsSelect As Worksheet, intCHKCol As Integer, lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer, strVal As String, Optional boolTypeNot As Boolean = False) As Range

    Dim lngI As Long, rngFindRange As Range, rngFindRangeT As Range, lngFindRow() As Long, lngUB As Long

    With wsSelect

    '行頭から行末までloop
    For lngI = lngFirstRow To lngLastRow

        '検索タイプ
        If boolTypeNot = True Then
            
            'intCHKColの列において、strValと異なる行番号(lngI)を取得し、配列(lngFindRow)に代入
            If .Cells(lngI, intCHKCol).value <> strVal Then
                ReDim Preserve lngFindRow(1 To lngUB + 1) As Long
                lngFindRow(UBound(lngFindRow)) = lngI
                lngUB = UBound(lngFindRow)
            End If
        
        Else


            'intCHKColの列において、strValと同じである行番号(lngI)を取得し、配列(lngFindRow)に代入
'@@01MOD START
'            If .Cells(LngI, intCHKCol).value = strVal Then
'                ReDim Preserve lngFindRow(1 To lngUB + 1) As Long
'                lngFindRow(UBound(lngFindRow)) = LngI
'                lngUB = UBound(lngFindRow)
'            End If
            If Len(Trim(.Cells(lngI, .Range("ICHIREN_NO").column).value & "")) > 0 Then
                If IsNumeric(.Cells(lngI, .Range("ICHIREN_NO").column).value) = True Then
                    If .Cells(lngI, intCHKCol).value = strVal Then
                        ReDim Preserve lngFindRow(1 To lngUB + 1) As Long
                        lngFindRow(UBound(lngFindRow)) = lngI
                        lngUB = UBound(lngFindRow)
                    End If
                End If
            End If
            
'@@01MOD END
        
        End If
    
    Next lngI

    '検索された行数loop
    For lngI = 1 To lngUB
    
        '検索された行をrange化する
        Set rngFindRangeT = .Range(.Cells(lngFindRow(lngI), intLeftCol), .Cells(lngFindRow(lngI), intRightCol))
    
        If lngI = 1 Then
            Set rngFindRange = rngFindRangeT
        Else
            'rangeの集合
            Set rngFindRange = Union(rngFindRange, rngFindRangeT)
        End If
    
    Next lngI

    Set FindRange = rngFindRange
    
    End With

End Function

'-------------------------------------------------------------------
  ' 関数名 ： KIFUCHK
  ' 機  能 ： 寄附金シートの項目チェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
'-------------------------------------------------------------------
Sub KIFUCHK(wsSelect As Worksheet, boolError As Boolean, boolAllEmpty As Boolean)

    Dim boolErrorT As Boolean
    Dim boolKoujyo As Boolean
    
    Dim strErrMsg As String
    
    boolKoujyo = KoujyoCheck

    With wsSelect
    
        Select Case .Range("KUBUN").value
        
        Case 3
            '各項目クリア
            Call CellColorChange(.Range("GIIN_NM"), False)
            Call CellColorChange(.Range("NM"), False)
            Call CellColorChange(.Range("SENKYO_INP"), False)
            Call CellColorChange(.Range("DT"), False)
            '両チェックありは不可
            boolErrorT = True
            boolError = True
            
            Call setComment(wsSelect, .Range("_CHK1"), MESSAGE_E002)
            Call setComment(wsSelect, .Range("_CHK2"), MESSAGE_E002)
            Call CellColorChange(.Range("_CHK1"), boolErrorT)
            Call CellColorChange(.Range("_CHK2"), boolErrorT)
        
        Case 0
            '各項目クリア
            Call CellColorChange(.Range("GIIN_NM"), False)
            Call CellColorChange(.Range("NM"), False)
            Call CellColorChange(.Range("SENKYO_INP"), False)
            Call CellColorChange(.Range("DT"), False)
            '寄附金（税額）控除が有る場合、チェック無しは不可
            If boolKoujyo = True Then
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("_CHK1"), MESSAGE_E177)
                Call setComment(wsSelect, .Range("_CHK2"), MESSAGE_E177)
            End If
            
            Call CellColorChange(.Range("_CHK1"), boolErrorT)
            Call CellColorChange(.Range("_CHK2"), boolErrorT)
        
        Case 1
            '各項目クリア
            Call CellColorChange(.Range("GIIN_NM"), False)
            Call CellColorChange(.Range("NM"), False)
            Call CellColorChange(.Range("SENKYO_INP"), False)
            Call CellColorChange(.Range("DT"), False)
            '寄附金（税額）控除が無い場合、チェック有りは不可
            If boolKoujyo = False Then
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("_CHK1"), MESSAGE_E178)
            End If
            
            '団体の区分＝1の場合、（その１）の団体区分は政党、政治資金団体であること
            If dantai_kbn = "01" Or dantai_kbn = "02" Or dantai_kbn = "03" Then
            Else
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("_CHK1"), MESSAGE_E179)
            End If
            
            strErrMsg = "政党又は政治資金団体（租税特別措置法第４１条の１８第１項、第１号又は第２号）にチェック有り"
            
            Call CellColorChange(.Range("_CHK1"), boolErrorT)
            '特にチェックは不要
            Call CellColorChange(.Range("_CHK2"), False)
            
            '各項目への入力はあってはならない
            If Not IsEmptyString(.Range("GIIN_NM").Formula) Then        'その団体の主宰者又は主要な構成員である国会議員の氏名
                boolError = True
                Call setComment(wsSelect, .Range("GIIN_NM"), MESSAGE_E160, strErrMsg)
                Call CellColorChange(.Range("GIIN_NM"), True)
            End If
            If Not IsEmptyString(.Range("NM").Formula) Then             '(1) その団体が推薦し又は支持する者の氏名
                boolError = True
                Call setComment(wsSelect, .Range("NM"), MESSAGE_E160, strErrMsg)
                Call CellColorChange(.Range("NM"), True)
            End If
            If Not IsEmptyString(.Range("SENKYO_INP").Formula) Then      '(2) 上記(1)の者が立候補した選挙名
                boolError = True
                Call setComment(wsSelect, .Range("SENKYO_INP"), MESSAGE_E160, strErrMsg)
                Call CellColorChange(.Range("SENKYO_INP"), True)
            End If
            If Not IsEmptyString(.Range("DT").Formula) Then             '(2) 上記(1)の者が立候補した立候補年月日
                boolError = True
                Call setComment(wsSelect, .Range("DT"), MESSAGE_E160, strErrMsg)
                Call CellColorChange(.Range("DT"), True)
            End If

            boolAllEmpty = False
                
        Case 2
        
            '寄附金（税額）控除が無い場合、チェック有りは不可
            If boolKoujyo = False Then
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("_CHK2"), MESSAGE_E178)
                
                Call CellColorChange(.Range("_CHK2"), boolErrorT)
                Call CellColorChange(.Range("_CHK1"), False)
                
                Call CellColorChange(.Range("GIIN_NM"), False)
                Call CellColorChange(.Range("NM"), False)
                Call CellColorChange(.Range("SENKYO_INP"), False)
                Call CellColorChange(.Range("DT"), False)
            Else
                Call CellColorChange(.Range("_CHK2"), False)
                Call CellColorChange(.Range("_CHK1"), False)
            
                '団体の区分＝2の場合、（その１）の団体区分は政党、政治資金団体でないこと
                If dantai_kbn = "01" Or dantai_kbn = "02" Or dantai_kbn = "03" Then
                    boolErrorT = True
                    boolError = True
                    Call setComment(wsSelect, .Range("_CHK2"), MESSAGE_E180)
                End If
            
                Call CellColorChange(.Range("_CHK2"), boolErrorT)
                
                strErrMsg = "その団体の主宰者又は主要な構成員である国会議員の氏名に入力有り"
                
                'GIIN_NMが空でない
                If EmptyCheck(wsSelect, "GIIN_NM") = False Then
                
                    'NMが空でないときエラー
                    If EmptyCheck(wsSelect, "NM") = False Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("NM"), MESSAGE_E160, strErrMsg)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("NM"), boolErrorT)
                                        
                    'SENKYO_INPが空でないときエラー
                    If EmptyCheck(wsSelect, "SENKYO_INP") = False Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("SENKYO_INP"), MESSAGE_E160, strErrMsg)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("SENKYO_INP"), boolErrorT)
                    
                    'DTが空でないときエラー
                    If EmptyCheck(wsSelect, "DT") = False Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("DT"), MESSAGE_E160, strErrMsg)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("DT"), boolErrorT)
                    
                    '全部空でないときGIIN_NMもエラー
                    If EmptyCheck(wsSelect, "NM") = False And _
                        EmptyCheck(wsSelect, "SENKYO_INP") = False And _
                        EmptyCheck(wsSelect, "DT") = False Then
                        boolErrorT = True
                        boolError = True
                        strErrMsg = "（１）その団体が推薦し又は支持する者の氏名"
                        Call setComment(wsSelect, .Range("GIIN_NM"), MESSAGE_E160, strErrMsg)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("GIIN_NM"), boolErrorT)
                    
                    '外字チェック
                    If Not boolErrorT Then
                        If CheckSingleGaiji(.Range("GIIN_NM")) Then
                            boolErrorT = True
                            boolError = True
                        Else
                            boolErrorT = False
                        End If
                    End If
                    
                'GIIN_NMが空
                ElseIf EmptyCheck(wsSelect, "GIIN_NM") = True Then
                    
                    'NMが空または外字ありでエラー
                    If EmptyCheck(wsSelect, "NM") = True Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("NM"), MESSAGE_E001)
                    ElseIf CheckSingleGaiji(.Range("NM")) Then
                        boolErrorT = True
                        boolError = True
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("NM"), boolErrorT)
                                        
                    'SENKYO_INPが空でエラー > SENKYO_INPは任意、だがDTとペア 外字チェックも含む
                    If (EmptyCheck(wsSelect, "SENKYO_INP") = True And EmptyCheck(wsSelect, "DT") = False) Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("SENKYO_INP"), MESSAGE_E001)
                    ElseIf CheckSingleGaiji(.Range("SENKYO_INP")) Then
                        boolErrorT = True
                        boolError = True
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("SENKYO_INP"), boolErrorT)
                    
                    'DTが空でエラー > DTは任意、NMは必須、だがSENKYO_INPとペア
                    If EmptyCheck(wsSelect, "DT") = True And EmptyCheck(wsSelect, "SENKYO_INP") = False Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("DT"), MESSAGE_E001)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("DT"), boolErrorT)
                   
                    '全部空の時GIIN_NMもエラー
                    If EmptyCheck(wsSelect, "NM") = True And _
                        EmptyCheck(wsSelect, "SENKYO_INP") = True And _
                        EmptyCheck(wsSelect, "DT") = True Then
                        boolErrorT = True
                        boolError = True
                        Call setComment(wsSelect, .Range("GIIN_NM"), MESSAGE_E001)
                    Else
                        boolErrorT = False
                    End If
                    
                    Call CellColorChange(.Range("GIIN_NM"), boolErrorT)
                    
                End If
            
            End If
            
            boolAllEmpty = False
        
        Case Else
        End Select
    
    End With

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： KoujyoCheck
  ' 機  能 ： 寄附金（税額）控除が「必要」を指定した行があるかどうかを返す
  '        ：
  ' 返り値 ： True:その7(1)の「寄附金（税額）控除」項目に「必要」存在する, False:そうでない
'-------------------------------------------------------------------
Function KoujyoCheck() As Boolean

    KoujyoCheck = False
    
    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その7(1)")
    With wsSelect
    
        Dim lngI As Long
        Dim lngFirstRow As Long, lngLastRow As Long
        lngFirstRow = .Range("行頭").Row + 1
        lngLastRow = .Range("行末").Row - 1
    
        For lngI = lngFirstRow To lngLastRow
     
            If .Cells(lngI, .Range("ZEIGAKUKOUJYO").column).value = "必要" Then
                KoujyoCheck = True
                Exit For
            End If

        Next lngI

    End With
    Set wsSelect = Nothing

End Function

'-------------------------------------------------------------------
  ' 関数名 ： EmptyCheck
  ' 機  能 ： 指定セルが空であるかを返す（セルの名称で指定する）
  '        ：
  ' 引  数 ： (in)  wsSelect … 対象シート
  '        ： (in)  strRange … チェック対象のセルの名称
  ' 返り値 ： True:空のセルである, False:そうでない
'-------------------------------------------------------------------
Function EmptyCheck(wsSelect As Worksheet, strRange As String) As Boolean
    
    With wsSelect
    
        If IsEmpty(.Range(strRange).value) = False And IsNull(.Range(strRange).value) = False And .Range(strRange).value <> "" Then
            EmptyCheck = False
        Else
            EmptyCheck = True
        End If
    
    End With

End Function

'-------------------------------------------------------------------
  ' 関数名 ： GetKoujyoKey
  ' 機  能 ： その7(1)の「寄附金（税額）控除」項目に「必要」がある寄附者を配列で返す
  '        ：
  ' 返り値 ： 該当する寄附者の氏名の配列
'-------------------------------------------------------------------
Private Function GetKoujyoKey() As String()

    Dim wsSelect As Worksheet
    Dim Kifusya() As String
    Dim kifusyaCnt As Long
    Dim sumKingaku As Currency
    Dim targetSeqNo As String
    
    Dim intColZeigaku As Integer
    Dim intColSeqno As Integer
    Dim intColNm As Integer
    Dim intColDt As Integer
    Dim intColAdr As Integer
    Dim intColSyokugyo As Integer
    Dim intColKoujoDetail As Integer
    
    Dim lngRowSubLoop As Long
    Dim dateNewest As Date      '同一通し番号間において、最も新しい寄附日
    Dim lngRowNewst As Long     '同一通し番号間において、最も新しい寄附日がある行
    Dim dateThisRow As Date     'ループ中の行の日付
    Dim kifuDataSeq As New EasyHashMap  'ループ中、同一通し番号が既に出現したかどうかを格納するためのマップ
    
    
    Set wsSelect = Worksheets("その7(1)")
    ReDim Kifusya(0)
    kifusyaCnt = 0
    
    With wsSelect
    
        Dim lngI As Long
        Dim lngFirstRow As Long, lngLastRow As Long
        lngFirstRow = .Range("行頭").Row + 1
        lngLastRow = .Range("行末").Row - 1
        
        '列を取得する
        intColNm = .Range("KIFUSYA_NM").column
        intColAdr = .Range("ADR").column
        intColDt = .Range("DT").column
        intColSyokugyo = .Range("SYOKUGYO").column
        intColKoujoDetail = .Range("KOUJOGAKU_DETAIL_ONLY").column    '小計行を0とした金額(隠し列)
        intColSeqno = .Range("SEQ_NO").column
        intColZeigaku = .Range("ZEIGAKUKOUJYO").column
        
    
        For lngI = lngFirstRow To lngLastRow
        
            '寄附金（税額）控除が「必要」の場合
            If .Cells(lngI, intColZeigaku).value = "必要" Then
                            
                '通し番号が空欄の場合
                If .Cells(lngI, intColSeqno).value = "" Then
                                    
                    kifusyaCnt = kifusyaCnt + 1
                    '適当な頭文字を付けて前回通し番号を生成
                    targetSeqNo = "E-" & kifusyaCnt

                    ReDim Preserve Kifusya(kifusyaCnt)
                
                    '金額は該当行の金額のみを出力
                    sumKingaku = .Cells(lngI, intColKoujoDetail).value
                    
                    Kifusya(kifusyaCnt) = _
                        .Cells(lngI, intColNm).value _
                        + CStr(sumKingaku) _
                        + .Cells(lngI, intColAdr).value _
                        + .Cells(lngI, .Range("SYOKUGYO").column).value
                        
                
                'まだ処理していない通し番号の場合(処理済の通し番号行は無視する)
                ElseIf kifuDataSeq.AddWithOverlapCheck(.Cells(lngI, intColSeqno).value, lngI) = True Then
'                '通し番号が空欄でなく、前回通し番号と異なる場合
'                ElseIf .Cells(LngI, intColSeqno).value <> targetSeqNo Then
                                    
                    kifusyaCnt = kifusyaCnt + 1
                    targetSeqNo = .Cells(lngI, intColSeqno).value
    
                    ReDim Preserve Kifusya(kifusyaCnt)
                
                    '金額は同一通し番号の合計を出力
                    sumKingaku = Application.WorksheetFunction.SumIf( _
                        .Range(.Cells(lngFirstRow, intColSeqno), .Cells(lngLastRow, intColSeqno)), _
                        targetSeqNo, .Range(.Cells(lngFirstRow, intColKoujoDetail), .Cells(lngLastRow, intColKoujoDetail)))
                    
                    dateNewest = CDate(.Cells(lngI, intColDt).value)     '最新の寄附日 に初期値をセット
                    lngRowNewst = lngI
                    
                    '/* 対象行～最終行までのデータを検索し、同一通し番号のうち「氏名」「住所」は寄附日が最新のものを取得する */
                    For lngRowSubLoop = lngI To lngLastRow
                        
                        '「必要」の指定があり、同じ通し番号か？
                        If .Cells(lngRowSubLoop, intColSeqno).value = targetSeqNo _
                            And .Cells(lngRowSubLoop, intColZeigaku).value = "必要" Then
                            
                            '最新の日付より新しいか？(最新が複数の場合は最も下にあるものとする)
                            dateThisRow = CDate(.Cells(lngRowSubLoop, intColDt).value)
                            If dateNewest <= dateThisRow Then
                                
                                '最新の日付と、その行を保持
                                dateNewest = dateThisRow
                                lngRowNewst = lngRowSubLoop
                            End If
                        End If
                    Next lngRowSubLoop
                    
                    '/* 行のデータを格納 */
                    Kifusya(kifusyaCnt) = _
                        .Cells(lngRowNewst, intColNm).value _
                        & CStr(sumKingaku) _
                        & .Cells(lngRowNewst, intColAdr).value _
                        & .Cells(lngRowNewst, intColSyokugyo).value
                        
                End If

            End If
        
        Next lngI

    End With
    Set wsSelect = Nothing

    GetKoujyoKey = Kifusya
    
End Function

'**************************************************************'
'* 日付の妥当性チェック（日付項目でなければスルー）
'*------------------------------------------------------------*'
'* 　戻り値：チェック結果（エラー時:True、正常時:第二パラメータ）
'*  　※第二パラメータは、一行を考慮したエラー結果フラグであり
'*  　　該当項目の前の項目で既にエラーの場合は、今回正常であっても
'*  　　その結果を引き継いで返すものである
'**************************************************************'
Function DateErrorCheck(dtCol() As Integer, rngCell As Range, boolError As Boolean, _
    Optional isCheckThisYear As Boolean = True) As Boolean
    
    Dim intI As Integer
    Dim strThisYear As String
    Dim checkNormalDate As Boolean
    
    DateErrorCheck = boolError
    checkNormalDate = False
    
    '日付項目かのチェック
    If dtCol(0) > 0 Then
        For intI = 0 To UBound(dtCol)
            If rngCell.column = dtCol(intI) And Not (CellEmptyCheck(rngCell)) Then
                DateErrorCheck = True   '対象
            End If
        Next
    End If
    
    If DateErrorCheck Then
        'IsDateのみではコピー＆ペーストの文字がエラーにならなかったため。And以降 2004/07/12追加
        '形式の先頭が*なのは和暦記号に対応するため。
        If IsDate(rngCell.value) And CStr(rngCell.value) Like "**#*/#*/#*" Then
            DateErrorCheck = boolError  '正常
            checkNormalDate = True
        Else
            DateErrorCheck = True       'エラー
            Call setComment(rngCell.Worksheet, rngCell, MESSAGE_E123)
        End If
    End If
    
    If checkNormalDate And isCheckThisYear Then
    
        strThisYear = Worksheets("その1").Range("HOUKOKU_NEN")
     
        '年が報告年と一致しているかチェック
        If Format$(rngCell.value, "yyyy") = strThisYear Then

            DateErrorCheck = boolError
        Else
            DateErrorCheck = True 'エラー
            Call setComment(rngCell.Worksheet, rngCell, MESSAGE_E152)
        End If
        
    End If
End Function

'**************************************************************'
'* 対象シートの日付項目の列を返す
'*------------------------------------------------------------*'
'* 　戻り値：列番号の配列（存在しない場合はnull）
'**************************************************************'
Function GetDtCol(wsSelect As Worksheet) As Variant
    
    Dim intI As Integer
    Dim rtnCol() As Integer
    Dim rtnCol_UmuFlg As Boolean
    Dim nmsSelWS As Names
    
    Set nmsSelWS = wsSelect.Names

    ReDim rtnCol(0)
    
    For intI = 1 To nmsSelWS.Count
    
        '日付項目に該当するものを検索（セルの名前の末尾が「DT」のもの）
        If nmsSelWS(intI).name Like "*!*DT" Then

            If rtnCol_UmuFlg = False Then
                rtnCol_UmuFlg = True
            Else
                ReDim Preserve rtnCol(UBound(rtnCol) + 1)
            End If
            
            '情報格納
            rtnCol(UBound(rtnCol)) = wsSelect.Range(nmsSelWS(intI).name).column
        End If
    
    Next

    GetDtCol = rtnCol
End Function

'**************************************************************'
'* 対象シート支払い数・金額項目の列を返す
'*------------------------------------------------------------*'
'* 　戻り値：列番号の配列（存在しない場合はnull）
'**************************************************************'
Function GetShiharaiCol(wsSelect As Worksheet, shiharai_su As String, kingaku As String) As Variant
    
    Dim intI As Integer
    Dim rtnCol(1) As Integer
    Dim nmsSelWS As Names
    
    Set nmsSelWS = wsSelect.Names

    For intI = 1 To nmsSelWS.Count
    
        '該当するものを検索
        If nmsSelWS(intI).name Like "*!*" & shiharai_su Then
            '情報格納
            rtnCol(0) = wsSelect.Range(nmsSelWS(intI).name).column
        ElseIf nmsSelWS(intI).name Like "*!*" & kingaku Then
            '情報格納
            rtnCol(1) = wsSelect.Range(nmsSelWS(intI).name).column
        End If
    
    Next

    GetShiharaiCol = rtnCol
End Function

'-------------------------------------------------------------------
  ' 関数名 ： IsNGString
  ' 機  能 ： 指定文字列が、（その７）の寄附者の氏名として
  '           使用禁止の文字列であるかを返す。
  '           ※文字列のチェックは、文字列中の空白を除いて行う
  ' 引  数 ： (in) str   … 検査対象文字列
  ' 返り値 ：使用禁止の文字列に該当する   : True
  '          使用禁止の文字列に該当しない : False
'-------------------------------------------------------------------
Function IsNGString(str As String) As Boolean
    
    Dim strTrimmed As String
    
    '空白文字をカットする
    strTrimmed = CutSpace(str)
    
    '空白をカットした状態で、「同上」「〃」等の禁止文字列と一致するかチェック
    If strTrimmed = NG_STRING_01 Or _
        strTrimmed = NG_STRING_02 Or _
        strTrimmed = NG_STRING_03 Then
        
        IsNGString = True
    Else
        IsNGString = False
    End If
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： CheckSheet0720
  ' 機  能 ： 宣誓書シート（その20）の項目チェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (in)  dantai_kbn … 政治団体区分
  '        ： (in)  giin_dantai_kbn … 国会議員関係政治団体区分
  '        ： (out) boolError … シート全体のエラー有無を格納する変数
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
'-------------------------------------------------------------------
Private Sub CheckSheet0720(wsSelect As Worksheet, boolError As Boolean, boolAllEmpty As Boolean, dantai_kbn As String, giin_dantai_kbn As Integer)

    Dim boolErrorT As Boolean
    Dim date_umu As Boolean
    Dim wsS0701 As Worksheet
    Dim isExistsGiinSiteiKikan As Boolean
    
    '(その1)で、国会議員関係団体の指定期間（自・至）に指定があるか？を取得
    Set wsS0701 = Worksheets("その1")
    If IsEmptyString(wsS0701.Range("GIIN_KIKAN1").value) = False _
        And IsEmptyString(wsS0701.Range("GIIN_KIKAN2").value) = False Then
        isExistsGiinSiteiKikan = True
    Else
        isExistsGiinSiteiKikan = False
    End If
    

    With wsSelect
        '監査意見書の有無
        Select Case .Range("KANSA_IKEN_UMU").value
        
        Case True
            '政党本部、政治資金団体ならOK
            If dantai_kbn = "01" Or dantai_kbn = "03" Then
                boolErrorT = False
            Else
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("KANSA_IKEN_UMU"), MESSAGE_E175)
            End If
            
            Call CellColorChange(.Range("KANSA_IKEN_UMU"), boolErrorT)
            
        Case Else
            '政党本部、政治資金団体ならNG
            If dantai_kbn = "01" Or dantai_kbn = "03" Then
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("KANSA_IKEN_UMU"), MESSAGE_E175)
            Else
                boolErrorT = False
            End If
            
            Call CellColorChange(.Range("KANSA_IKEN_UMU"), boolErrorT)
        End Select
    
        '政治資金監査報告書の有無
        Select Case .Range("KANSA_HOUKOKU_UMU").value
        Case True
            

            '国会議員関係政治団体の区分にチェックがある
            'または国会議員関係団体の指定期間に入力がある場合はOK
            If giin_dantai_kbn >= 1 Or isExistsGiinSiteiKikan = True Then
                boolErrorT = False
            Else
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("KANSA_HOUKOKU_UMU"), MESSAGE_E018)
            End If
            
            Call CellColorChange(.Range("KANSA_HOUKOKU_UMU"), boolErrorT)
            
        Case Else
            '国会議員関係政治団体の区分にチェックがある
            'または国会議員関係団体の指定期間に入力がある場合はNG
            If giin_dantai_kbn >= 1 Or isExistsGiinSiteiKikan = True Then
                boolErrorT = True
                boolError = True
                Call setComment(wsSelect, .Range("KANSA_HOUKOKU_UMU"), MESSAGE_E018)
            Else
                boolErrorT = False
            End If
            
            Call CellColorChange(.Range("KANSA_HOUKOKU_UMU"), boolErrorT)
        End Select
        
        '宣誓日が空のときエラー
        boolError = boolError Or CheckSingleDate(.Range("SENSEI_DT"), 1, date_umu)
        If date_umu = True Then
            Call CellColorChange(.Range("SENSEI_DT"), True)
        End If
                
        '代表者名（姓・名）の片方のみの入力はエラー
        If (EmptyCheck(wsSelect, "DAI_NM1") = True And EmptyCheck(wsSelect, "DAI_NM2") = False) Then
            boolErrorT = True
            boolError = True
            Call setComment(wsSelect, .Range("DAI_NM1"), MESSAGE_E001)
        ElseIf (EmptyCheck(wsSelect, "DAI_NM1") = False And EmptyCheck(wsSelect, "DAI_NM2") = True) Then
            boolErrorT = True
            boolError = True
            Call setComment(wsSelect, .Range("DAI_NM2"), MESSAGE_E001)
        Else
            boolErrorT = False
        End If
        
        Call CellColorChange(.Range("DAI_NM1"), boolErrorT)
        Call CellColorChange(.Range("DAI_NM2"), boolErrorT)
                
    End With
    
    boolAllEmpty = False

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： CheckSheet0802
  ' 機  能 ： 振込明細書に係る支出目的書(8号様式の２）の項目チェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (out) boolError … シート全体のエラー有無を格納する変数
  '        ： (out) boolAllEmpty … 空のシートであればTrueが格納される
'-------------------------------------------------------------------
Sub CheckSheet0802(wsSelect As Worksheet, boolError As Boolean, boolAllEmpty As Boolean)
    
    Dim intRColumn As Integer
    Dim lngRCount As Long
    Dim lngNasiCCount As Long
    Dim lngUB1 As Long
    Dim lngUB2 As Long
    Dim strKNo As Integer
    Dim strSNo As Integer '（その14）、（その15）の切り分け
    Dim lngI As Long
    Dim str項目82() As String, str適用82() As String
    Dim str項目() As String, str適用() As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    Dim LoopMax As Integer
    Dim meisai_low As Long
    Dim meisai_cnt As Long
    
    'その14(1)～その14(3)、その15(1)～その15(9)から、該当データを取得
    For strSNo = 14 To 15
        'シート毎のループ回数設定
        If strSNo = 14 Then
            LoopMax = 3
        Else
            LoopMax = 9
        End If
    
        For strKNo = 1 To LoopMax 'その14(1)～その14(3)、その15(1)～その15(9)
        
            For Each wsSelect In Worksheets
            With wsSelect
        
                If .name Like "その" & strSNo & "(" & strKNo & ")*" Then
                
                    lngHRow = .Range("行頭").Row
                    lngFRow = .Range("行末").Row
                    lngRCount = lngFRow - lngHRow - 1
                
                    intRColumn = .Range("RYOUSYU").column '「領収書を徴し難かったもの」項目
                    
                    lngNasiCCount = 0
                    
                    For lngI = lngHRow + 1 To lngFRow - 1
                    
                        If .Cells(lngI, intRColumn).value = "振込明細書に係る支出目的書を作成する" Then
                            
                           lngNasiCCount = lngNasiCCount + 1
                        
                        End If
            
                    Next lngI
                    
                    If lngNasiCCount = 0 Then
                    Else
                    
                        ReDim Preserve str項目(1 To lngUB1 + lngNasiCCount) As String
                        ReDim Preserve str適用(1 To lngUB1 + lngNasiCCount) As String
                        
                        lngNasiCCount = 0
                        
                        For lngI = lngHRow + 1 To lngFRow - 1
                        
                            If .Cells(lngI, intRColumn).value = "振込明細書に係る支出目的書を作成する" Then
                                
                                lngNasiCCount = lngNasiCCount + 1
                            
                                str項目(lngNasiCCount + lngUB1) = Mid(.Range("区分").value, 3, Len(.Range("区分").value) - 2)
                                str適用(lngNasiCCount + lngUB1) = .Cells(lngI, .Range("MOKUTEKI").column).value
                            
                            End If
                
                        Next lngI
                    
                        lngUB1 = UBound(str項目) 'str項目の配列数の最大値
                    
                    End If
        
                End If
            
            End With
            Next wsSelect
        
        Next strKNo
    Next strSNo
    
    Set wsSelect = Nothing
    Set wsSelect = Worksheets("16号様式")
    With wsSelect
    
    '8号様式その２から該当データを取得
        meisai_low = 16
        Do Until .Cells(meisai_low, 7).value = ""
            meisai_low = meisai_low + 1
        Loop
        meisai_cnt = (meisai_low - 16) / 13 + 1
    
        ReDim Preserve str項目82(1 To meisai_cnt) As String
        ReDim Preserve str適用82(1 To meisai_cnt) As String
                        
        meisai_low = 9
        lngUB2 = 0
        For LoopMax = 1 To meisai_cnt
            
            str項目82(LoopMax) = .Cells(meisai_low, 2).value
            str適用82(LoopMax) = .Cells(meisai_low, 4).value
            
            If str項目82(LoopMax) <> "" Then
                lngUB2 = lngUB2 + 1
            End If
            
            meisai_low = meisai_low + 13
            
        Next LoopMax
    
    End With
        
    If lngUB1 <> lngUB2 Then
        boolError = True
    Else
        For LoopMax = 1 To lngUB2
            If str項目(LoopMax) <> str項目82(LoopMax) Or str適用(LoopMax) <> str適用82(LoopMax) Then
                boolError = True
            End If
        Next LoopMax
    End If
    
    If lngUB2 = 0 Then
        boolAllEmpty = True
    Else
        boolAllEmpty = False
    End If
    
    Set wsSelect = Worksheets("16号様式")
    With wsSelect
    
    '8号様式その２をエラー表示
        meisai_low = 16
        Do Until .Cells(meisai_low, 7).value = ""
            meisai_low = meisai_low + 1
        Loop
        meisai_cnt = (meisai_low - 16) / 13 + 1
                                
        meisai_low = 9
        For LoopMax = 1 To meisai_cnt
            
            If boolError Then
                Call setComment(wsSelect, .Cells(meisai_low, 2), MESSAGE_E176)
            End If
            Call CellColorChange(.Range(.Cells(meisai_low, 2), .Cells(meisai_low, 4)), boolError)
                           
            meisai_low = meisai_low + 13
            
        Next LoopMax
    
    End With
    
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： CheckLineSubtotal
  ' 機  能 ： 詳細行の小計行と通し番号の妥当性をチェックする
  '        ： 小計対象の明細が点在する場合、エラーとする
  ' 引  数 ： (in)  wsSelect        … 対象シート
  '        ： (in)  intAllItem      … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem    … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  lngLastRow      … 行末の行数                （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow     … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (in)  SubtotalColumn  … ROWKBNの列
  '        ： (in)  SeqColumn       … 通し番号の列
  '        ： (out) boolError       … エラーがあればTrueが格納される
'-------------------------------------------------------------------
Private Function CheckLineSubtotal(wsSelect As Worksheet, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        lngLastRow As Long, _
                        lngFirstRow As Long, _
                        SubtotalColumn As Long, _
                        SeqColumn As Long, _
                        boolError As Boolean)
                        
    Dim lngCurrentRow As Long
    Dim lngRow As Long
    Dim strCurrentSeqNo As String
    Dim lngRowBreak As Long
    Dim isFoundError As Boolean
    
    isFoundError = False
    CheckLineSubtotal = True
        
    With wsSelect
        For lngCurrentRow = lngFirstRow To lngLastRow
            If .Cells(lngCurrentRow, SubtotalColumn).value = True Then
                Call CellColorChange(.Range(.Cells(lngCurrentRow, 3), .Cells(lngCurrentRow, SeqColumn - 1)), False, True)
                
                strCurrentSeqNo = .Cells(lngCurrentRow, SeqColumn).value
        
                '対象小計行から上にたどっていき、通し番号がブレイクした(通し番号が初めて異なった)行を取得
                lngRowBreak = 0
                For lngRow = lngCurrentRow To lngFirstRow Step -1
                    If .Cells(lngRow, SeqColumn).value <> strCurrentSeqNo Then
                        lngRowBreak = lngRow
                        Exit For
                    End If
                Next lngRow
    
                'ブレイクしていれば
                If lngRowBreak <> 0 Then
                    '１つ前の行でブレイクした場合はエラー
                    If lngRowBreak = lngCurrentRow - 1 Then
'                        isFoundError = True
'                        Call setComment(.Cells(lngCurrentRow, 3).Worksheet, .Cells(lngCurrentRow, 3), MESSAGE_E172)
'                        Call CellColorChange(.Range(.Cells(lngCurrentRow, 3), .Cells(lngCurrentRow, SeqColumn)), isFoundError)
                    'ブレイクした行の上～先頭行　に該当通し番号が存在すればエラー
                    ElseIf Application.WorksheetFunction.CountIf( _
                            .Range(.Cells(lngFirstRow, SeqColumn), .Cells(lngRow, SeqColumn)), _
                            strCurrentSeqNo) > 0 Then
'                        isFoundError = True
'                        Call setComment(.Cells(lngCurrentRow, 3).Worksheet, .Cells(lngCurrentRow, 3), MESSAGE_E172)
'                        Call CellColorChange(.Range(.Cells(lngCurrentRow, 3), .Cells(lngCurrentRow, SeqColumn)), isFoundError)
                    End If
                End If
                
                '対象小計行が末尾の行でなければ
                If isFoundError = False And lngCurrentRow <> lngLastRow Then
                    '１つ下の行～末尾の行に　該当通し番号が存在すればエラー
                    If Application.WorksheetFunction.CountIf( _
                        .Range(.Cells(lngCurrentRow + 1, SeqColumn), .Cells(lngLastRow, SeqColumn)), _
                        strCurrentSeqNo) > 0 Then
'                        isFoundError = True
'                        Call setComment(.Cells(lngCurrentRow, 3).Worksheet, .Cells(lngCurrentRow, 3), MESSAGE_E172)
'                        Call CellColorChange(.Range(.Cells(lngCurrentRow, 3), .Cells(lngCurrentRow, SeqColumn)), isFoundError)
                    End If
                End If
    
            End If
        
        
        Next lngCurrentRow
    
    End With
    
    If isFoundError = True Then
        boolError = isFoundError
    End If
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： CheckLineSubtotalUmu
  ' 機  能 ： 詳細行の小計行と通し番号の妥当性をチェックする
  '        ： 同一の通し番号が複数あるのに、小計行が無い場合をエラーとする
  ' 引  数 ： (in)  wsSelect        … 対象シート
  '        ： (in)  intAllItem      … 右端の列数                （セルの名前「右端」を指定）
  '        ： (in)  intCheckItem    … チェック対象の右端の列数  （セルの名前「範囲右端」列を指定）
  '        ： (in)  lngLastRow      … 行末の行数                （セルの名前「行末」-1を指定）
  '        ： (in)  lngFirstRow     … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (in)  SubtotalColumn  … ROWKBNの列
  '        ： (in)  SeqColumn       … 通し番号の列
  '        ： (out) boolError       … エラーがあればTrueが格納される
'-------------------------------------------------------------------
Private Function CheckLineSubtotalUmu(wsSelect As Worksheet, _
                        intAllItem As Integer, _
                        intCheckItem As Integer, _
                        lngLastRow As Long, _
                        lngFirstRow As Long, _
                        SubtotalColumn As Long, _
                        SeqColumn As Long, _
                        boolError As Boolean)
                        
    Dim lngCurrentRow As Long
    Dim lngRow As Long
    Dim strCurrentSeqNo As String
    Dim lngRowBreak As Long
    Dim isFoundError As Boolean
    Dim mapsyoukei As New EasyHashMap
    Dim err_line As Variant
    Dim mapsyoukeiline As New EasyHashMap
    
    isFoundError = False
    CheckLineSubtotalUmu = True
        
    With wsSelect
        '小計行の情報を内部配列に退避
        For lngCurrentRow = lngFirstRow To lngLastRow
            If .Cells(lngCurrentRow, SubtotalColumn).value = True Then
                
                strCurrentSeqNo = .Cells(lngCurrentRow, SeqColumn).value
                Call mapsyoukeiline.AddItem(strCurrentSeqNo, lngCurrentRow)
    
            End If
        Next lngCurrentRow
        
        '通し番号が複数なのに、小計行が無ければエラー
        For lngCurrentRow = lngFirstRow To lngLastRow
            If .Cells(lngCurrentRow, SubtotalColumn).value <> True Then
                strCurrentSeqNo = .Cells(lngCurrentRow, SeqColumn).value
        
                If mapsyoukei.AddWithOverlapCheck(strCurrentSeqNo, lngCurrentRow) = True Then
                'ダブりが無いのでスルー
                Else
                'ダブりあり
                '小計行の配列に存在すればOK
                    err_line = mapsyoukeiline.GetItem(strCurrentSeqNo)
                    If IsNull(err_line) Then
                        err_line = mapsyoukei.GetItem(strCurrentSeqNo)
                        If IsNull(err_line) Then
                        Else
                            isFoundError = True
                            Call setComment(.Cells(lngCurrentRow, SeqColumn).Worksheet, .Cells(lngCurrentRow, SeqColumn), MESSAGE_E173)
                            Call setComment(.Cells(err_line, SeqColumn).Worksheet, .Cells(err_line, SeqColumn), MESSAGE_E173)
                            Call CellColorChange(.Range(.Cells(lngCurrentRow, SeqColumn), .Cells(lngCurrentRow, SeqColumn)), isFoundError)
                            Call CellColorChange(.Range(.Cells(err_line, SeqColumn), .Cells(err_line, SeqColumn)), isFoundError)
                        End If
                    End If
                End If
        
            End If
        
        
        Next lngCurrentRow
    
    End With
    
    If isFoundError = True Then
        boolError = isFoundError
    End If
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： ExceptionCellColorChange
  ' 機  能 ： 指定列のセル色が白以外の場合のセル色設定
  '        ：
  ' 引  数 ： (in)  wsSelect        … 対象シート
  '        ： (in)  lngFirstRow     … 行頭の行数                （セルの名前「行頭」+1を指定）
  '        ： (in)  lngLastRow      … 行末の行数                （セルの名前「行末」-1を指定）
'-------------------------------------------------------------------
Sub ExceptionCellColorChange(wsSelect As Worksheet, lngFirstRow As Long, lngLastRow As Long)

    Dim rngTemp As Range

    With wsSelect

        'その14とその15の「領収書等を徴し難かったもの」、「交付金に係る支出」を黄色とする
        If .name Like "その14*" Or .name Like "その15*" Then
        
            Set rngTemp = .Range(.Cells(lngFirstRow, .Range("RYOUSYU").column), .Cells(lngLastRow, .Range("KOUFUKIN").column))
            Call CellColorChange(rngTemp, False, True, , 10092543)
        
        Else
        End If
    
    End With

End Sub

'ADD 2016/11/01 H28政治資金 START
'2019/4/26 引数を追加
Sub setComment(wsSheet As Worksheet, rngTarget As Range, Message As String, Optional Args As String = "")

    '対象シートの保護解除(セルのコメントを操作するため)
    Call UnlockOneSheet(wsSheet)
    
    '引数が存在する場合、2019/4/26追加
    If Args <> "" Then
    
        Message = Replace(Message, "(%1)", Args)
    
    End If
    
    rngTarget.ClearComments
    rngTarget.AddComment (Message)
    rngTarget.Comment.Visible = False
    rngTarget.Comment.Shape.TextFrame.AutoSize = True
    rngTarget.Comment.Shape.TextFrame.Characters.Font.Size = 12
    '対象シートの保護
    Call LockOneSheet(wsSheet)
End Sub

Sub deleteComment(wsSheet As Worksheet, rngTarget As Range)

    Call UnlockOneSheet(wsSheet)
    rngTarget.ClearComments
    Call LockOneSheet(wsSheet)
    
End Sub

'----------------------------------------------------------------
' 関数名 ： senseiDtWarning
' 機　能 ： 宣誓日のワーニングメッセージを表示する
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------

Sub senseiDtWarning()
        
    Dim houkokuYear As Range
    Dim senseiDt As Range
    Set houkokuYear = Worksheets("その1").Range("HOUKOKU_NEN")
    Set senseiDt = Worksheets("その20").Range("SENSEI_DT")
        
    If houkokuYear.value = "" Or senseiDt.value = "" Then
        Exit Sub
    End If
        
    If houkokuYear.value >= Year(senseiDt.value) Then
        Call CellColorChange(senseiDt, False, True, , 10079487)
        Call setComment(Worksheets("その20"), senseiDt, MESSAGE_W191)
    End If
    
End Sub
'ADD 2016/11/01 H28政治資金 END

'----------------------------------------------------------------
' 関数名 ： checkTokuteiKifu
' 機　能 ： その7(1)に特定寄附が存在するか確認
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Function checkTokuteiKifu() As Boolean

    checkTokuteiKifu = False
    
    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その7(1)")
    
    With wsSelect
    
        Dim lngI As Long
        Dim lngFirstRow As Long
        Dim lngLastRow As Long
        lngFirstRow = .Range("行頭").Row + 1
        lngLastRow = .Range("行末").Row - 1
        
        For lngI = lngFirstRow To lngLastRow
            If .Cells(lngI, .Range("KIFUSYA_NM").column).value Like "(特)*" Or _
               .Cells(lngI, .Range("KIFUSYA_NM").column).value Like "（特）*" Then
                checkTokuteiKifu = True
                Exit For
            End If
        Next lngI
    
    End With
    Set wsSelect = Nothing
        
End Function
-------------------------------------------------------------------------------
VBA MACRO ModuleCheckFLG.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCheckFLG'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'strCellName … 様式・区分を表す文字列（例："その71", "その113"）
'mapMeetKubun … 処理済の様式・区分が格納されたマップ(2008/11/6 シートの並び順の依存をなくすために追加)
Sub MenuCheckFLG(AboolError As Boolean, _
                AboolAllEmpty As Boolean, _
                strCellName As String, _
                strSKNo As String, _
                mapMeetKubun As EasyHashMap, _
                Optional boolErrorOr As Boolean = Empty, _
                Optional boolErrorAnd As Boolean = Empty, _
                Optional boolAllEmptyAnd As Boolean = Empty)

    Dim nmCellNameE As name
    Dim nmCellNameM As name
    Dim strCellNameE As String
    Dim strCellNameM As String
    Dim wsSelect As Worksheet

    'イベントを無効にする
    Application.EnableEvents = False
    
    Set wsSelect = Worksheets("メニュー")
    
    With wsSelect
    
    'If strSKNo = 0 Or strSKNo = 1 Then
    If strSKNo = 0 Or mapMeetKubun.ExistsKey(strCellName) = False Then
    
        '枝番が無い様式、または枝番がある様式で初めて遭遇する区分の場合
        boolErrorOr = AboolError
        boolErrorAnd = AboolError
        boolAllEmptyAnd = AboolAllEmpty
        
        '様式・区分をマップに保存 (値は使用しないためダミー値""とする)
        mapMeetKubun.AddItem strCellName, ""
        
    Else
        '既に遭遇している様式・区分の場合、それらの結果と加算する
        boolErrorOr = boolErrorOr Or AboolError
        boolErrorAnd = boolErrorAnd And AboolError
        boolAllEmptyAnd = boolAllEmptyAnd And AboolAllEmpty
    End If
    
    'エラー有無フラグ
    strCellNameE = "E" & strCellName
    Set nmCellNameE = .Names(strCellNameE)
    
    '作成有無フラグ
    strCellNameM = "M" & strCellName
    Set nmCellNameM = .Names(strCellNameM)
    
    'エラーが1シートでもあったら、エラー有
    If boolErrorOr = True Then
        
        .Range(nmCellNameE).value = True
        .Range(nmCellNameM).value = False
    
    End If

    '全シートエラーがない
    If boolErrorAnd = False And boolErrorOr = False Then
    
        '全シートがカラ
        If boolAllEmptyAnd = True Then
    
            .Range(nmCellNameE).value = False
            .Range(nmCellNameM).value = False
        
        'シート作成有
        Else
            
            .Range(nmCellNameE).value = False
            .Range(nmCellNameM).value = True
        
        End If
    
    End If

    End With
    
    'イベントを有効にする
    Application.EnableEvents = True

End Sub

'その17とその18の整合性チェック、およびその17のメニューフラグ設定
Sub CheckFlgSet(strFLGName As String, _
                objWS As Object, _
                rngChkCell As Range, _
                rngChkCellN As Range, _
                boolError As Boolean, _
                boolAllEmpty As Boolean, _
                mapMeetKubun As EasyHashMap, _
                Optional lngHighlightColor As Long = 13408767)

    Dim boolErrorT As Boolean, boolErrorTN As Boolean

    Call ScreenRedraw(False)
    'Dim rngTemp As Range
    'With Worksheets("その4")
    'Set rngTemp = .Range( _
    '            .Cells(.Range("行頭").Row + 1, _
    '                .Range("KINGAKU").Column), _
    '            .Cells(.Range("行末").Row - 1, _
    '                .Range("KINGAKU").Column) _
    '                )
    'End With

    'どっちもtrue or どっちもfalse
    If (rngChkCell.value = True And rngChkCellN.value = True) Or _
        (rngChkCell.value = False And rngChkCellN.value = False) Then
        
        boolErrorT = True
        boolErrorTN = True
        GoSub ColorChange
        
        GoSub MenuFlg
        
        Set objWS = Nothing
        Exit Sub
    
    End If

    'カラ
    If boolError = False And boolAllEmpty = True Then
        'カラのくせに有にチェックが入っている
        If rngChkCell.value = True Then
            boolErrorT = True
        Else
            '借入先ごとの残高が100万円を超える借入金
            'その４にて100万を超える金額があった場合
            '無にチェックが入っていたらエラー
            'If strFLGName = "CHK12" And rngChkCellN.Value = True Then
            '    If ValueCheck(rngTemp, 0, 1000000) = True Then
            '        boolErrorTN = True
            '    Else
            '    End If
            'Else
            'End If
        End If
        
        GoSub ColorChange
    
    'カラ以外
    Else
        'カラでないくせに無にチェックが入っている
        If rngChkCellN.value = True Then
            boolErrorTN = True
        Else
            '借入先ごとの残高が100万円を超える借入金
            'その４にて100万を超える金額がなかった場合
            '有にチェックが入っていたらエラー
            'If strFLGName = "CHK12" And rngChkCell.Value = True Then
            '    If ValueCheck(rngTemp, 0, 1000000) = False Then
            '        boolErrorT = True
            '    Else
            '    End If
            'Else
            'End If
        End If
        
        GoSub ColorChange

    End If

    GoSub MenuFlg

    Set objWS = Nothing

Exit Sub

MenuFlg:
    
    'メニューフラグ付加
    If boolErrorT = True Or boolErrorTN = True Then
        Call MenuCheckFLG(True, False, "その17", 0, mapMeetKubun)
    End If

Return

ColorChange:
    
    If boolErrorT = True Then
        rngChkCell.Interior.Color = lngHighlightColor
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        If rngChkCell.Parent.name <> "" Then
            If (rngChkCell.value = True And rngChkCellN.value = True) Or _
                (rngChkCell.value = False And rngChkCellN.value = False) Then
                Call setComment(Worksheets(rngChkCell.Parent.name), Worksheets(rngChkCell.Parent.name).Range(rngChkCell.Address), MESSAGE_E002)
            Else
                Call setComment(Worksheets(rngChkCell.Parent.name), Worksheets(rngChkCell.Parent.name).Range(rngChkCell.Address), MESSAGE_E198)
            End If
                
                
            'エラー箇所のシート名が取得出来たら格納する
'            Call UnlockOneSheet(Worksheets(rngChkCell.Parent.name))
            Call setMovePoint(ErrMovePoint, rngChkCell.Parent.name, rngChkCell.Address)
        End If
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    ElseIf boolErrorT = False Then
        
        rngChkCell.Interior.ColorIndex = xlColorIndexNone
        Call UnlockOneSheet(Worksheets(rngChkCell.Parent.name))
        rngChkCell.ClearComments
    End If

    If boolErrorTN = True Then
        rngChkCellN.Interior.Color = lngHighlightColor
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        If rngChkCell.Parent.name <> "" Then
            'エラー箇所のシート名が取得出来たら格納する
            If (rngChkCell.value = True And rngChkCellN.value = True) Or _
                (rngChkCell.value = False And rngChkCellN.value = False) Then
                Call setComment(Worksheets(rngChkCell.Parent.name), Worksheets(rngChkCell.Parent.name).Range(rngChkCellN.Address), MESSAGE_E002)
            Else
                Call setComment(Worksheets(rngChkCell.Parent.name), Worksheets(rngChkCell.Parent.name).Range(rngChkCellN.Address), MESSAGE_E198)
            End If
            Call setMovePoint(ErrMovePoint, rngChkCell.Parent.name, rngChkCellN.Address)
        End If
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    ElseIf boolErrorTN = False Then
        
        rngChkCellN.Interior.ColorIndex = xlColorIndexNone
        Call UnlockOneSheet(Worksheets(rngChkCell.Parent.name))
        rngChkCellN.ClearComments

    End If

Return

End Sub

Function ValueCheck(rngToCheck As Range, _
                        lngLowValue As Long, _
                        lngHighValue As Long) As Boolean

    Dim rngTemp As Range
    Dim lngRowCounter As Long
    Dim lngColCounter As Long
    Dim boolFind As Boolean
    
    For lngColCounter = 1 To rngToCheck.Columns.Count
        For lngRowCounter = 1 To rngToCheck.Rows.Count
            Set rngTemp = rngToCheck.Cells(lngRowCounter, lngColCounter)
            If IsNumeric(rngTemp.value) Then
                If rngTemp.value < lngLowValue Or rngTemp.value > lngHighValue Then
                    boolFind = True
                    Exit For
                End If
            End If
        Next lngRowCounter
    Next lngColCounter
    
    ValueCheck = boolFind

End Function

'
' メニューの印刷チェックボックスをONにする
'
Function PrintFlgSet()
    
    Dim nmsSelWS As Names
    Dim lngI As Long
    Dim MakeUMU As Integer
    Dim wsSelect As Worksheet
    
    Set wsSelect = Worksheets("メニュー")
    Set nmsSelWS = wsSelect.Names
    MakeUMU = 0
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    For lngI = 1 To nmsSelWS.Count
        If nmsSelWS(lngI).name Like wsSelect.name & "!M*" Then
            If wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = True And _
                 wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column + 1).value = False Then
                wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column + 2).value = True
                MakeUMU = MakeUMU + 1
            Else
                wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column + 2).value = False
            End If
        ElseIf nmsSelWS(lngI).name Like wsSelect.name & "!P領収書一覧" Then
            If RyousyuUMU = True And gintCheckStatus >= CHECK_STATUS_OK Then
                wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = True
            Else
                wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = False
            End If
        End If
    Next
    
    'イベントを有効にする
    Application.EnableEvents = True
    
End Function

' メニューの印刷チェックボックスをOFFにする
'
Function PrintFlgOff()
    
    Dim nmsSelWS As Names
    Dim lngI As Long
    Dim wsSelect As Worksheet
    
    Set wsSelect = Worksheets("メニュー")
    Set nmsSelWS = wsSelect.Names
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    For lngI = 1 To nmsSelWS.Count
        If nmsSelWS(lngI).name Like wsSelect.name & "!P*" Then
            wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = False
        End If
    Next
    
    'イベントを有効にする
    Application.EnableEvents = True
    
End Function


' メニューの全チェックボックスをOFFにする
'
Function AllFlgOff()
    
    Dim nmsSelWS As Names
    Dim lngI As Long
    Dim wsSelect As Worksheet
    
    Set wsSelect = Worksheets("メニュー")
    Set nmsSelWS = wsSelect.Names
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    'Mその19とEその19はOFFにしない（他のセルを参照しているため）
    For lngI = 1 To nmsSelWS.Count
        If nmsSelWS(lngI).name Like wsSelect.name & "!M*" Or _
            nmsSelWS(lngI).name Like wsSelect.name & "!E*" Or _
            nmsSelWS(lngI).name Like wsSelect.name & "!P*" Then
            If nmsSelWS(lngI).name Like wsSelect.name & "!Mその19" Or _
                nmsSelWS(lngI).name Like wsSelect.name & "!Eその19" Or _
                nmsSelWS(lngI).name Like wsSelect.name & "!Print_Area" Then
            Else
                wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.column).value = False
            End If
        End If
    Next
    
    'イベントを有効にする
    Application.EnableEvents = True
    
End Function
-------------------------------------------------------------------------------
VBA MACRO ModuleCheckUtil.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCheckUtil'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
'-------------------------------------------------------------------
' 共通チェックモジュール
' 2006/3/2 追加
'-------------------------------------------------------------------
Option Explicit

'許可属性（文字列の属性チェックに使用する定数）
Public Const CHECKTYPE_ZEN As Integer = 1           '全角文字
Public Const CHECKTYPE_HAN As Integer = 2           '半角文字
Public Const CHECKTYPE_KANA As Integer = 3          '全角ひらがな
Public Const CHECKTYPE_NUM As Integer = 4           '半角数字
Public Const CHECKTYPE_ZIP As Integer = 5           '郵便番号
Public Const CHECKTYPE_TEL As Integer = 6           '電話番号
Public Const CHECKTYPE_MIX As Integer = 7           '全角半角混在
Public Const CHECKTYPE_EISU As Integer = 8          '半角英数字

'必須タイプ（必須チェックに使用する定数）
Public Const NONE As Integer = 0            'なし
Public Const REQUIRED As Integer = 1        '必須
Public Const NO_INPUT As Integer = 2        '入力禁止
Public Const ALL_NO_INPUT As Integer = 3    'グループ内全て選択・入力禁止
Public Const SELECT_ONE As Integer = 4      'グループ内で１つのみ選択・入力必須



'-------------------------------------------------------------------
' 関数名 ： CheckSingleString
' 機  能 ： 単項目の文字列チェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
'        ： (in) minLength … 最小桁数
'        ： (in) maxLength … 最大桁数
'        ： (in) checkType … 許可属性（定数で指定）
'        ： (in) requiredType … 必須タイプ（定数で指定）
'        ： (out) boolEmpty … 対象項目の未入力有無を格納する変数
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： ※対象項目が未入力でなければ、boolEmptyにTrueが設定される
'-------------------------------------------------------------------
Public Function CheckSingleString(rngTarget As Range, _
                            minLength As Integer, _
                            maxLength As Integer, _
                            checkType As Integer, _
                            RequiredType As Integer, _
                            ByRef boolEmpty As Boolean) As Boolean
                            
            
    Dim isErr As Boolean
    Dim strValue As String
    Dim length As Long
    Dim strGaijiChars As String
    Dim GaijiErrMsg As String
    Dim lngIndex As Long
    Dim checkChar As String
    Dim lngGaijiIndex As Long

    isErr = False
    strValue = rngTarget.value

    '必須チェック
    If IsErrorRequired(strValue, RequiredType, boolEmpty) Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E001)
    End If

    '桁数チェック
    If isErr = False And IsErrorLength(strValue, minLength, maxLength, checkType) Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E120, CStr(maxLength))
    End If

    '属性チェック
    If isErr = False And IsErrorAttribute(rngTarget, checkType) = True Then
        isErr = True
    End If

    '外字チェック
    If GaijiChkFlg = True Then
        strGaijiChars = GetGaijiChars(strValue)
        If isErr = False And Len(strGaijiChars) > 0 Then
            '外字エラーの場合、エラーメッセージ用に文字列を編集しておく
            isErr = True
            GaijiErrCnt = GaijiErrCnt + 1
            ReDim Preserve GaijiErrInf(GaijiErrCnt)
            GaijiErrMsg = "「" & rngTarget.Worksheet.name & "」シート　" & ConvertBracketOff(strGaijiChars)
            GaijiErrInf(GaijiErrCnt) = GaijiErrMsg

        End If
    End If

    'エラーの有無によって、対象セルを塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngTarget, isErr)
    CheckSingleString = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckSingleGaiji
' 機  能 ： 単項目の外字チェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： エラーあり時、エラーメッセージ用の文字列を編集する
'-------------------------------------------------------------------
Public Function CheckSingleGaiji(rngTarget As Range) As Boolean
    
    Dim isErr As Boolean
    Dim strValue As String
    Dim strGaijiChars As String
    Dim GaijiErrMsg As String
    Dim lngIndex As Long
    Dim checkChar As String
    
    isErr = False
    strValue = rngTarget.value

    '属性チェック(混在)
    If isErr = False And IsErrorAttribute(rngTarget, CHECKTYPE_MIX) = True Then
        isErr = True
    End If

    '外字チェック
    If GaijiChkFlg = True Then
        strGaijiChars = GetGaijiChars(strValue)
        If isErr = False And Len(strGaijiChars) > 0 Then
            '外字エラーの場合、エラーメッセージ用に文字列を編集しておく
            isErr = True
            GaijiErrCnt = GaijiErrCnt + 1
            ReDim Preserve GaijiErrInf(GaijiErrCnt)
            GaijiErrMsg = "「" & rngTarget.Worksheet.name & "」シート　" & ConvertBracketOff(strGaijiChars)
            GaijiErrInf(GaijiErrCnt) = GaijiErrMsg

        End If
    End If

    'エラーの有無によって、対象セルを塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngTarget, isErr)
    CheckSingleGaiji = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckSingleNumber
' 機  能 ： 単項目の数値チェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
'        ： (in) minValue … 最小値
'        ： (in) maxValue … 最大値
'        ： (in) requiredType … 必須タイプ（定数で指定）
'        ： (out) boolEmpty … 対象項目の未入力有無を格納する変数
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： ※対象項目が未入力でなければ、boolEmptyにTrueが設定される
'-------------------------------------------------------------------
Public Function CheckSingleNumber(rngTarget As Range, _
                            minValue As Currency, _
                            maxValue As Currency, _
                            RequiredType As Integer, _
                            ByRef boolEmpty As Boolean) As Boolean
                     
    Dim isErr As Boolean
    isErr = False

    '必須チェック
    If IsErrorRequired(rngTarget.value, RequiredType, boolEmpty) Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E001)
    End If

    '数値妥当チェック
    If isErr = False And IsValidNumber(rngTarget.value, minValue, maxValue) = False Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E121, Len(CStr(maxValue)))
    End If

    'エラーの有無によって、対象セルを塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngTarget, isErr)
    CheckSingleNumber = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckSingleDate
' 機  能 ： 単項目の日付チェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
'        ： (in) requiredType … 必須タイプ（定数で指定）
'        ： (out) boolEmpty … 対象項目の未入力有無を格納する変数
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： ※対象項目が未入力でなければ、boolEmptyにTrueが設定される
'-------------------------------------------------------------------
Public Function CheckSingleDate(rngTarget As Range, _
                            RequiredType As Integer, _
                            ByRef boolEmpty As Boolean) As Boolean
                                                   

    Dim isErr As Boolean
    isErr = False

    '必須チェック
    If IsErrorRequired(rngTarget.value, RequiredType, boolEmpty) Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E001)
    End If

    '日付妥当性チェック
    If isErr = False And IsEmptyString(rngTarget.value) = False Then
        '（ModuleCheckのDateErrorCheck関数のチェック方式を採用）
        'IsDateのみではコピー＆ペーストの文字がエラーにならない
        '形式の先頭が*なのは和暦記号に対応するため
        If Not (IsDate(rngTarget.value) And CStr(rngTarget.value) Like "**#*/#*/#*") Then
            isErr = True
            '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E123)
        End If
    End If

    'エラーの有無によって、対象セルを塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngTarget, isErr)
    CheckSingleDate = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckSingleList
' 機  能 ： リスト選択項目のチェックを行い、エラーの有無によってセルの色を変える。
'        ： 対象セルと入力先セルを指定し、エラー表示は入力先セルに行う。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
'        ： (in) rngInput … 入力先のセルオブジェクト
'        ： (in) requiredType … 必須タイプ（定数で指定）
'        ： (out) boolEmpty … 対象項目の未入力有無を格納する変数
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： ※対象項目が未入力でなければ、boolEmptyにTrueが設定される
'-------------------------------------------------------------------
Public Function CheckSingleList(rngTarget As Range, _
                            rngInput As Range, _
                            RequiredType As Integer, _
                            ByRef boolEmpty As Boolean) As Boolean
    
    Dim isErr As Boolean
    isErr = False

    '必須チェック
    If IsErrorRequired(rngTarget.value, RequiredType, boolEmpty) Then
        isErr = True
        '2019/4/26 追加
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E001)
    End If
    
    'リスト選択妥当性チェック
    '対象セルの計算式により、定義された選択項目以外が入力されると「INVALID」となる
    If rngTarget.value = "INVALID" Then
        isErr = True
        Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E013)
    End If

    'エラーの有無によって、対象セル(入力用のセル)を塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngInput, isErr)
    CheckSingleList = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckMultiDate
' 機  能 ： 資金管理団体、国会議員団体の期間の指定チェックを行なう。
' 引  数 ： (in) rngKikan1 … 期間の指定（自）のセルオブジェクト
'        ： (in) rngKikan2 … 期間の指定（至）のセルオブジェクト
'        ： (in) rngMulti  … 期間の指定（複数）のセルオブジェクト
'        ： (out) isError  … チェックのエラーがあった場合のみTrueを設定する
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function CheckMultiDate( _
                            rngKikan1 As Range, _
                            rngKikan2 As Range, _
                            rngMulti As Range, _
                            ByRef isError As Boolean, _
                            Optional strErrMsg As String = MESSAGE_E156) As Boolean
    
    Dim i As Long
    Dim isFoundErr As Boolean
    CheckMultiDate = False
    
    '自、至の２つの日付をチェック
    Call CheckDoubleDate(rngKikan1, rngKikan2, NONE, isFoundErr, strErrMsg)
    
    '複数の期間が空なら終了
    If IsEmptyString(rngMulti.Formula) Then
        isError = isError Or isFoundErr
        CheckMultiDate = isFoundErr
        Exit Function
    End If
    
    '複数の期間に指定があるが、自、至が空ならエラー
    If IsEmptyString(rngKikan1.Formula) And IsEmptyString(rngKikan2.Formula) Then
        isFoundErr = True
        Call CellColorChange(rngKikan1, True)
        '2019/4/26 追加
        Call setComment(rngKikan1.Worksheet, rngKikan1, strErrMsg)
    End If
    
    '複数の期間をパースして配列に格納する
    Dim dtmDateArray() As Date
    If ParseMultiDate(rngMulti.Formula, dtmDateArray) = True Then
    
        'パースに成功したら、日付の関係をチェック
        For i = 0 To UBound(dtmDateArray)
            If dtmDateArray(i, 0) > dtmDateArray(i, 1) Then
                isFoundErr = True
                Call CellColorChange(rngMulti, True)
                '2019/4/26 追加
                Call setComment(rngMulti.Worksheet, rngMulti, strErrMsg)
                Exit For
            End If
        Next i
    Else
        'パースに失敗した場合
        If rngMulti.HasFormula <> False Then
            '数式となっている場合は、その旨のエラーを表示
            Call CellColorChange(rngMulti, True)
        Else
            Call CellColorChange(rngMulti, True)
        End If
        isFoundErr = True
        '2019/4/26 追加
        Call setComment(rngMulti.Worksheet, rngMulti, strErrMsg)
    End If
    
    '期間に重複が無いかチェックする
    If isFoundErr = False Then
        If IsDuplicateMultiDate(rngKikan1.value, rngKikan2.value, dtmDateArray) Then
            isFoundErr = True
            Call CellColorChange(rngMulti, True)
            '2019/4/26 追加
        Call setComment(rngMulti.Worksheet, rngMulti, MESSAGE_E151)
        End If
    End If
    
    isError = isError Or isFoundErr
    CheckMultiDate = isFoundErr
    
End Function


'-------------------------------------------------------------------
' 関数名 ： CheckDoubleDate
' 機  能 ：
' 引  数 ： (in) rngTarget1 … 対象セルオブジェクト（自）
'　　　　： (in) rngTarget2 … 対象セルオブジェクト（至）
'        ： (in) requiredType … 必須タイプ（定数で指定）
'        ： (out) isError  … チェックのエラーがあった場合のみTrueを設定する
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function CheckDoubleDate(rngTarget1 As Range, _
                            rngTarget2 As Range, _
                            RequiredType As Integer, _
                            ByRef isError As Boolean, _
                            Optional strErrMsg As String = MESSAGE_E156) As Boolean
    
    '必須タイプが任意で、どちらも入力無しの場合、エラー無しで終了
    Dim isFoundErr As Boolean
    Dim isboolEmpty As Boolean
    
    If RequiredType = NONE Then
        If IsEmptyString(rngTarget1.Formula) And IsEmptyString(rngTarget2.Formula) Then
            CheckDoubleDate = False
            Exit Function
        End If
    End If
    
    '２つの日付の単項目チェック
    isFoundErr = CheckSingleDate(rngTarget1, REQUIRED, isboolEmpty)
    isFoundErr = CheckSingleDate(rngTarget2, REQUIRED, isboolEmpty) Or isFoundErr
    
    '期間の指定が正しいかチェック（rngTarget1 <= rngTarget2　であること）
    If isFoundErr = False Then
        If CDate(rngTarget1.value) > CDate(rngTarget2) Then
            Call CellColorChange(rngTarget1, True)
            Call CellColorChange(rngTarget2, True)
'            Call SetError(rngTarget1, MESSAGE_E003)
'            Call SetError(rngTarget2, MESSAGE_E003)
            isFoundErr = True
            isError = True
            '2019/4/26 追加
            Call setComment(rngTarget1.Worksheet, rngTarget1, strErrMsg)
        End If
    End If
    
    isError = isFoundErr
    CheckDoubleDate = isFoundErr
    
End Function

'-------------------------------------------------------------------
' 関数名 ： CheckSelects
' 機  能 ： 選択項目のチェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTargetsArray … 対象セルオブジェクトを格納した配列
'        ： (in) requiredType … 必須タイプ（定数で指定）
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function CheckSelects(ByVal rngTargetsArray As Variant, _
                        RequiredType As Integer, _
                        Optional rngCollorChangeArray As Variant) As Boolean
    
    Dim i As Integer
    Dim countSelectedCell As Integer    'Trueのセルの数
    Dim isErr As Boolean                'エラーがあるかどうか
    Dim isErrAllCell As Boolean         '全セルのエラー表示有無
    Dim rngTemp As Range
    Dim rngColorChangeCell As Range
    countSelectedCell = 0
    isErr = False
    isErrAllCell = False
    
    '選択されているセルの個数を数える
    For i = 0 To UBound(rngTargetsArray)
        If rngTargetsArray(i).value = True Then
            countSelectedCell = countSelectedCell + 1
        End If
    Next i
    
    'セルの選択数からエラーを判断
    If RequiredType = ALL_NO_INPUT And countSelectedCell <> 0 Then
        'グループ内全て選択・入力禁止で、選択されたセルがある
        isErr = True
        isErrAllCell = True
        '現在未使用のためエラーコメントなし
    
    ElseIf RequiredType = SELECT_ONE And countSelectedCell <> 1 Then
        'またはグループ内で１つのみ選択・入力必須で、選択されたセルが１つ以外はエラー
        isErr = True
        If countSelectedCell = 0 Then
            '１つも選択されていない場合、全セルをエラー表示する
            isErrAllCell = True
        End If
    End If
    
    'エラーの有無によって、セルを塗りつぶしまたは塗りつぶし解除
    For i = 0 To UBound(rngTargetsArray)
        
        Set rngTemp = rngTargetsArray(i)
        
        '引数が指定されている場合は、指定セルを塗りつぶす
        If IsMissing(rngCollorChangeArray) Then 'IsMissing関数は、引数が省略されていればTrueを返す
            Set rngColorChangeCell = rngTargetsArray(i)
        Else
            Set rngColorChangeCell = rngCollorChangeArray(i)
        End If
        '全セルエラー表示あり、またはエラー有りで選択されている場合、対象セルをエラー表示
        If isErrAllCell _
            Or isErr And rngTemp.value = True Then
            
            Call setComment(rngColorChangeCell.Worksheet, rngColorChangeCell, MESSAGE_E002)
            Call CellColorChange(rngColorChangeCell, True)
        Else
            Call CellColorChange(rngColorChangeCell, False)
        End If
    Next i
    
    CheckSelects = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckDoubleNumberEitherToZero
' 機  能 ： どちらか一方の値が0の時、他方の値も0となっているかを判定する。
' 引  数 ： (in) rngTarget1 … 対象セルオブジェクト1
'        ： (in) rngTarget2 … 対象セルオブジェクト2
'        ： (in) cellClearMode … 1:対象セル1を自動計算セルとしてクリア
'        ：                       2:対象セル2を自動計算セルとしてクリア
'        ：                       3:双方とも自動計算セルとしてクリア
'        ：                       0(1～3以外):双方とも通常セルとしてクリア
'        ： (in)  lngHighlightColor … エラーの場合の背景色
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ：
'-------------------------------------------------------------------
Public Function CheckDoubleNumberEitherToZero(rngTarget1 As Range, _
                            rngTarget2 As Range, _
                            ByRef isError As Boolean, _
                            Optional cellClearMode As Integer = 0, _
                            Optional lngHighlightColor As Long = 13408767 _
                            ) As Boolean
    
    Dim isFoundErr As Boolean
    isFoundErr = False
    
    'どちらか一方でも空白の場合、チェックしない
    If Not (IsEmptyString(rngTarget1.Formula) Or IsEmptyString(rngTarget2.Formula)) Then
        Select Case cellClearMode
            Case 1
                Call CellColorChange(rngTarget1, False, True)
                Call CellColorChange(rngTarget2, False)
            Case 2
                Call CellColorChange(rngTarget1, False)
                Call CellColorChange(rngTarget2, False, True)
            Case 3
                Call CellColorChange(rngTarget1, False, True)
                Call CellColorChange(rngTarget2, False, True)
            Case Else
                Call CellColorChange(rngTarget1, False)
                Call CellColorChange(rngTarget2, False)
        End Select
        
        'いずれか一方が0の時、双方が0であることの判定（積が0のとき、和が0となるか）
        If (CDbl(rngTarget1.value) * CDbl(rngTarget2.value) = 0) Then
            If Not (CDbl(rngTarget1.value) + CDbl(rngTarget2.value) = 0) Then
                isFoundErr = True
                Call CellColorChange(rngTarget1, True)
                Call CellColorChange(rngTarget2, True)
                Call setComment(rngTarget1.Worksheet, rngTarget1, MESSAGE_E171)
            End If
        End If
    End If
    
    isError = isError Or isFoundErr
    CheckDoubleNumberEitherToZero = isFoundErr
    
End Function

'-------------------------------------------------------------------
' 関数名 ： IsErrorLength
' 機  能 ： 対象文字列の文字長が正しいかを返す。
'        ： （入力属性が混在の場合、バイト数のチェックとなる）
' 引  数 ： (in) strValue … 対象文字列
'        ： (in) minLength … 最小桁数
'        ： (in) maxLength … 最大桁数
'        ： (in) checkType … 許可属性（定数で指定）
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function IsErrorLength(strValue As String, _
                            minLength As Integer, _
                            maxLength As Integer, _
                            checkType As Integer) As Boolean
    Dim length As Long
    IsErrorLength = False
    '空の値はチェック対象外
    If IsEmptyString(strValue) Then
        Exit Function
    End If
    
'バイト数のチェックは行なわない
'    '文字列の長さを求める
'    If checkType = CHECKTYPE_MIX Then
'        '入力属性が「混在」の場合はバイト数
'        length = LenB(StrConv(strValue, vbFromUnicode))
'    Else
        'それ以外は文字数
        length = Len(strValue)
'    End If
    
    '最小桁数と最大桁数との評価を行う
    If (length < minLength Or length > maxLength) Then
        IsErrorLength = True
    End If
    
End Function

'-------------------------------------------------------------------
' 関数名 ： IsErrorRequired
' 機  能 ： 文字列の必須チェックを行う。
'        ： 指定した必須タイプに合致しているかを評価する。
' 引  数 ： (in) strValue … 対象文字列
'        ： (in) checkType … 許可属性（定数で指定）
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function IsErrorRequired(strValue As String, RequiredType As Integer, ByRef boolEmpty As Boolean) As Boolean
    
    Dim isEmp As Boolean
    IsErrorRequired = False
    isEmp = IsEmptyString(strValue)
    
    '必須チェック
    If RequiredType = REQUIRED And isEmp = True _
        Or RequiredType = NO_INPUT And isEmp = False Then
        IsErrorRequired = True
    End If
    
    '値が空であるか保持する引数に結果をセット
    If Not isEmp Then
        boolEmpty = False
    End If
End Function

'-------------------------------------------------------------------
' 関数名 ： IsErrorAttribute
' 機  能 ： 文字列の属性チェックを行う。
'        ： 指定した許可属性に合致しているかを評価する。
' 引  数 ： (in) rngTarget … 対象セル
'        ： (in) checkType … 許可属性（定数で指定）
' 返り値 ： エラーあり:True, エラー無し:False
'-------------------------------------------------------------------
Public Function IsErrorAttribute(rngTarget As Range, checkType As Integer) As Boolean
    
    Dim strValue As String
    strValue = rngTarget.value
    
    IsErrorAttribute = False
    If IsEmptyString(strValue) = False Then
        Select Case checkType
        '全角文字
        Case CHECKTYPE_ZEN
            '全角チェック
            If WNCheck(strValue) <> "W" Then
                '外字チェック
                If hasProhibitedChar(rngTarget) <> 0 Then
                    Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E158, hasProhibitedChar(rngTarget))
                Else
                    Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E012)
                End If
                IsErrorAttribute = True
            End If
        '半角文字
        Case CHECKTYPE_HAN
            '半角チェック
            If WNCheck(strValue) <> "N" Then
                '現状未使用のためエラーコメントなし
                IsErrorAttribute = True
            End If
        '全角ふりがな
        Case CHECKTYPE_KANA
            '全て全角文字かつ、漢字が含まれていないかチェック
            If WNCheck(strValue) <> "W" Or IsKanjiCode(strValue) <> 0 Then
                Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E011)
                IsErrorAttribute = True
            End If
        '半角数字
        Case CHECKTYPE_NUM
            '半角数字のみかチェック
            If Not IsHankakuNumber(strValue) Then
                '現状未使用のためエラーコメントなし
                IsErrorAttribute = True
            End If
        '半角英数字
        Case CHECKTYPE_EISU
            '半角英数字のみかチェック
            If Not IsHankakuEisu(strValue) Then
                '現状未使用のためエラーコメントなし
                IsErrorAttribute = True
            End If
        '郵便番号形式
        Case CHECKTYPE_ZIP
            '正しい郵便番号形式かチェック
            If IsValidZipCode(strValue) = False Then
                '現状未使用のためエラーコメントなし
                IsErrorAttribute = True
            End If
        '電話番号形式
        Case CHECKTYPE_TEL
            '正しい電話番号形式かチェック
            If IsValidTel(strValue) = False Then
                Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E029)
                IsErrorAttribute = True
            End If
        '混在の場合
        Case Else
            '外字チェック
            If hasProhibitedChar(rngTarget) <> 0 Then
                Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E158, hasProhibitedChar(rngTarget))
                IsErrorAttribute = True
            End If
        End Select
    End If
    
End Function

'-------------------------------------------------------------------
' 関数名 ： IsHankakuNumber
' 機  能 ： 文字列が半角数字のみであるかを返す。
' 引  数 ： (in) strValue … 対象文字列
' 返り値 ： エラー無し:True, エラー有り:False
'-------------------------------------------------------------------
Public Function IsHankakuNumber(strValue As String) As Boolean
    
    If WNCheck(strValue) = "N" _
        And strValue Like String$(Len(strValue), "#") And IsNumeric(strValue) Then
        '例:"000123A"の場合、「If "000123A" like "#######"」の評価となり、Falseとなる
        IsHankakuNumber = True
    Else
        IsHankakuNumber = False
    End If

End Function

'-------------------------------------------------------------------
' 関数名 ： IsHankakuEisu
' 機  能 ： 文字列が半角英数字のみであるかを返す。
' 引  数 ： (in) strValue … 対象文字列
' 返り値 ： エラー無し:True, エラー有り:False
'-------------------------------------------------------------------
Public Function IsHankakuEisu(strValue As String) As Boolean
    
    Dim i As Long
    Dim checkChar As String
    IsHankakuEisu = True
    
    '1文字ずつ半角英数字であるか評価する
    For i = 1 To Len(strValue)
      checkChar = Mid(strValue, i, 1)
      If (checkChar < "0" Or checkChar > "9") And (checkChar < "A" Or checkChar > "Z") _
        And (checkChar < "a" Or checkChar > "z") Then
        IsHankakuEisu = False
        Exit Function
      End If
    Next

End Function

'-------------------------------------------------------------------
' 関数名 ： IsValidZipCode
' 機  能 ： 文字列が正しい郵便番号形式であるかを返す。
' 引  数 ： (in) strValue … 対象文字列
' 返り値 ： エラー無し:True, エラー有り:False
'-------------------------------------------------------------------
Public Function IsValidZipCode(strValue As String) As Boolean
    
    Dim strNumber As String
    Dim indexHyphen As Integer
    indexHyphen = InStr(1, strValue, "-")       'ハイフンの位置
    strNumber = SrchReplace(strValue, "-", "")  'ハイフンを抜いた文字列
    
    'ハイフンを1文字だけ含み(対象文字列の長さ - ハイフンを抜いた対象文字列の長さ = 1)、
    'それ以外は全て半角数字であるかチェック(ハイフンのみはNG)
    'また、ハイフンの左は３文字以内、ハイフンの右は４文字以内であること
    If strNumber <> "" _
        And Len(strValue) - Len(strNumber) = 1 _
        And IsHankakuNumber(strNumber) = True _
        And indexHyphen <= 4 _
        And Len(strValue) - indexHyphen <= 4 Then
        IsValidZipCode = True
    Else
        IsValidZipCode = False
    End If
    
End Function

'-------------------------------------------------------------------
' 関数名 ： IsValidTel
' 機  能 ： 文字列が正しい電話番号であるかを返す。
' 引  数 ： (in) strValue … 対象文字列
' 返り値 ： エラー無し:True, エラー有り:False
'-------------------------------------------------------------------
Public Function IsValidTel(strValue As String) As Boolean
    
    Dim strNumber As String
    strNumber = SrchReplace(strValue, "-", "")
    '半角数字または半角ハイフンのみであるかチェック
    If strNumber = "" Or IsHankakuNumber(strNumber) = True Then
        IsValidTel = True
    Else
        IsValidTel = False
    End If
End Function

'-------------------------------------------------------------------
' 関数名 ： CheckCellEmpty
' 機  能 ： セルの入力をチェックし、エラーがあればエラー表示を行う。
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
' 引  数 ： (in) requiredOrNoinput … チェックタイプ指定（True:必須, False:入力禁止）
' 引  数 ： (out) boolError … エラー格納変数（エラーがあればTrueをセット）
'-------------------------------------------------------------------
Public Sub CheckCellEmpty(rngTarget As Range, _
                        requiredOrNoinput As Boolean, _
                        ByRef boolError As Boolean, _
                        Optional strErrMsgOnNoInput As String = MESSAGE_E019)
    
    If IsEmptyString(rngTarget.value) = requiredOrNoinput Then
        Call CellColorChange(rngTarget, True)
        If requiredOrNoinput = True Then
            '2019/4/26 追加
            Call setComment(rngTarget.Worksheet, rngTarget, MESSAGE_E001)
        Else
            '2019/4/26 追加
            Call setComment(rngTarget.Worksheet, rngTarget, strErrMsgOnNoInput)
        
        End If
        boolError = True
    End If
    
End Sub

'-------------------------------------------------------------------
' 関数名 ： IsKanjiCode
' 機  能 ： 文字列に漢字が含まれるかを調べ、最初に見つけた位置を返す
' 引  数 ： (in) srcText … 対象文字列
' 返り値 ： 漢字が含まれる位置  含まれない時：０
'-------------------------------------------------------------------
Public Function IsKanjiCode(ByVal srcText As String) As Long

    Dim CharPos As Long
    Dim checkChar As String
    Dim WideCharByte() As Byte
    
    For CharPos = 1 To Len(srcText)
        'Shift Jis に変換
        checkChar = StrConv(Mid$(srcText, CharPos, 1), vbFromUnicode)
    
        '２バイト文字チェック
        If LenB(checkChar) = 2 Then
            WideCharByte = checkChar
    
            'ひらがな・カタカナ・記号・機種依存文字でもなければ漢字だろう…
            If Not (WideCharByte(0) = &H81 Or WideCharByte(0) = &H82 Or _
                    WideCharByte(0) = &H83 Or WideCharByte(0) = &H87) Then
                IsKanjiCode = CharPos
                Exit For
            End If
        End If
    Next CharPos

End Function

'-------------------------------------------------------------------
' 関数名 ： WNCheck
' 機  能 ： 文字列から「全て全角」「全て半角」「混在」「空白」を評価する。
' 引  数 ： (in) strUnicode … 対象文字列
' 返り値 ： 全て全角:"W", 全て半角:"N", 全角半角混在:"C", 空白:"E"
'-------------------------------------------------------------------
Public Function WNCheck(strUnicode As String) As String
    Dim strANSI    As String
    Dim myLen      As Integer
    Dim myLenB     As Integer

    If strUnicode = "" Then
        WNCheck = "E"
        Exit Function
    End If

    strANSI = StrConv(strUnicode, vbFromUnicode)
    
    myLen = Len(strUnicode)
    myLenB = LenB(strANSI)
    
    If myLen * 2 = myLenB Then
        WNCheck = "W"
    ElseIf myLen = myLenB Then
        WNCheck = "N"
    Else
        WNCheck = "C"
    End If

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckDateValidity
' 機  能 ： 二つの日付間の大小チェックを行い、エラーの有無によってセルの色を変える。
' 引  数 ： (in) rngTarget1 … 対象セルオブジェクト１（自）
' 　　　 ： (in) rngTarget2 … 対象セルオブジェクト２（至）
'        ： (in) requiredType1 … 必須タイプ（定数で指定）：対象セルオブジェクト１（自）用
'        ： (in) requiredType2 … 必須タイプ（定数で指定）：対象セルオブジェクト２（自）用
'        ： (out) boolEmpty … 対象項目の未入力有無を格納する変数
' 返り値 ： エラーあり:True, エラー無し:False
' 備　考 ： ※対象項目が未入力でなければ、boolEmptyにTrueが設定される
'-------------------------------------------------------------------
Public Function CheckDateValidity(rngTarget1 As Range, _
                            rngTarget2 As Range, _
                            requiredType1 As Integer, _
                            requiredType2 As Integer, _
                            ByRef boolEmpty As Boolean, _
                            Optional strErrMsg As String = MESSAGE_E156) As Boolean
                                                        
    Dim isErr As Boolean
    isErr = False

    '必須チェック（対象セルオブジェクト１（自））
    If IsErrorRequired(rngTarget1.value, requiredType1, boolEmpty) Then
        isErr = True
    End If
    '必須チェック（対象セルオブジェクト２（至））
    If IsErrorRequired(rngTarget2.value, requiredType2, boolEmpty) Then
        isErr = True
    End If
    
    '日付妥当性チェック（対象セルオブジェクト１（自））
    If isErr = False And IsEmptyString(rngTarget1.value) = False Then
        '（ModuleCheckのDateErrorCheck関数のチェック方式を採用）
        'IsDateのみではコピー＆ペーストの文字がエラーにならない
        '形式の先頭が*なのは和暦記号に対応するため
        If Not (IsDate(rngTarget1.value) And CStr(rngTarget1.value) Like "**#*/#*/#*") Then
            isErr = True
        End If
    End If
    '日付妥当性チェック（対象セルオブジェクト２（至））
    If isErr = False And IsEmptyString(rngTarget2.value) = False Then
        '（ModuleCheckのDateErrorCheck関数のチェック方式を採用）
        'IsDateのみではコピー＆ペーストの文字がエラーにならない
        '形式の先頭が*なのは和暦記号に対応するため
        If Not (IsDate(rngTarget2.value) And CStr(rngTarget2.value) Like "**#*/#*/#*") Then
            isErr = True
        End If
    End If

    '対象セルオブジェクト１（自）＞対象セルオブジェクト２（至）はエラー
    If isErr = False And IsEmptyString(rngTarget1.value) = False And IsEmptyString(rngTarget2.value) = False Then
        If rngTarget1.value <= rngTarget2.value Then
        Else
            isErr = True
            '2019/4/26 追加
            Call setComment(rngTarget1.Worksheet, rngTarget1, strErrMsg)
        End If
    End If

    'エラーの有無によって、対象セルを塗りつぶしまたは塗りつぶし解除
    Call CellColorChange(rngTarget1, isErr)
    Call CellColorChange(rngTarget2, isErr)
    CheckDateValidity = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： CheckRangeGaiji
' 機  能 ： 単項目の文字列チェックを行い、外字の有無によってセルの色を変える。
'　　　　： （その３、その４等の一覧形式のシート用）
' 引  数 ： (in) rngTarget … 対象セルオブジェクト
' 返り値 ： 外字あり:True, 外字無し:False
'-------------------------------------------------------------------
Public Function CheckRangeGaiji(rngTarget As Range, ChkLine As Variant) As Boolean
    
    Dim isErr As Boolean
    Dim strValue As String
    Dim length As Long
    Dim strGaijiChars As String
    Dim GaijiErrMsg As String
    Dim lngIndex As Long
    Dim checkChar As String
    isErr = False
    strValue = rngTarget.value

    '属性チェック(混在)
    If isErr = False And IsErrorAttribute(rngTarget, CHECKTYPE_MIX) = True Then
        isErr = True
    End If

    '外字チェック
    If GaijiChkFlg = True Then
        strGaijiChars = GetGaijiChars(strValue)
        If isErr = False And Len(strGaijiChars) > 0 Then
            '外字エラーの場合、エラーメッセージ用に文字列を編集しておく
            isErr = True
            GaijiErrCnt = GaijiErrCnt + 1
            ReDim Preserve GaijiErrInf(GaijiErrCnt)
            GaijiErrMsg = "「" & rngTarget.Worksheet.name & "」シート　行番号：" & ChkLine & ConvertBracketOff(strGaijiChars)
            GaijiErrInf(GaijiErrCnt) = GaijiErrMsg
        End If

    End If
    
    'エラーがあれば対象セルを塗りつぶし
    'その14とその15の「領収書等を徴し難かったもの」、「交付金に係る支出」を黄色とする
    If rngTarget.Worksheet.name Like "その14*" Or rngTarget.Worksheet.name Like "その15*" Then
        If rngTarget.column = rngTarget.Worksheet.Range("RYOUSYU").column Or _
            rngTarget.column = rngTarget.Worksheet.Range("KOUFUKIN").column Then
            
            Call CellColorChange(rngTarget, isErr, True)
'2020/12/11 条件設定もれの修正
        Else
            Call CellColorChange(rngTarget, isErr)
'2020/12/11 ここまで
        End If
    Else
        Call CellColorChange(rngTarget, isErr)
    End If
    CheckRangeGaiji = isErr

End Function

'-------------------------------------------------------------------
' 関数名 ： GetGaijiChars
' 機  能 ： 文字列に外字が含まれるかを調べ、見つけた外字を返す
' 引  数 ： (in) strText … 対象文字列
' 返り値 ： 外字が存在した場合、全ての外字を返却
'-------------------------------------------------------------------
Public Function GetGaijiChars(strText As String) As String

    Dim lngIndex As Long
    Dim checkChar As String
    Dim byteCheckChar() As Byte
    GetGaijiChars = ""
    
    For lngIndex = 1 To Len(strText)
        '１文字ずつ取得して、バイト配列に変換
        byteCheckChar = Mid$(strText, lngIndex, 1)
        If byteCheckChar(1) >= &HE0 And byteCheckChar(1) <= &HF8 Then
            GetGaijiChars = GetGaijiChars & Mid$(strText, lngIndex, 1)
        End If
    Next lngIndex

End Function
'-------------------------------------------------------------------
' 関数名 ： DispGaijiError
' 機  能 ： XML出力時の外字有無チェック結果のエラーメッセージを出力
'-------------------------------------------------------------------
Public Function DispGaijiError()
    Dim strMsg As String
    Dim lngI As Long
    
    strMsg = "項目チェックでエラーが見つかりました。エラーを修正したのち、XMLデータ作成を行ってください。" & vbCrLf & vbCrLf _
        & "※以下の箇所に入力された文字は、他のコンピュータで正しく表示できない文字（外字）であるため使用できません。"
        
    For lngI = 1 To GaijiErrCnt
        strMsg = strMsg & vbCrLf & GaijiErrInf(lngI)
        If lngI > 10 Then
            strMsg = strMsg & vbCrLf & "　　・"
            strMsg = strMsg & vbCrLf & "　　・"
            strMsg = strMsg & vbCrLf & "　　・"
            Exit For
        End If
    Next lngI
    
    strMsg = strMsg & vbCrLf & vbCrLf & "なお、収支報告書のオンライン提出を行う場合には、上記の文字は使用できないため、代替文字に置き換えてから提出してください。"
    
    MsgBox strMsg, vbCritical, "XMLデータ作成"

End Function

'1文字ずつ括弧でくくった文字列を返す
'例；"あいう"→"「あ」「い」「う」"にする
'LimitCharsに最大文字数を指定すると、その文字数以降を省略する
Public Function ConvertBracketOff(str As String, Optional LimitChars As Long = 10)
    
    Dim strRet As String
    Dim i As Long
    strRet = ""
    
    For i = 1 To Len(str)
        strRet = strRet & "「" & Mid$(str, i, 1) & "」"
        
        If LimitChars > 0 And i >= LimitChars Then
            strRet = strRet & "..."
            Exit For
        End If
    Next i
    
    ConvertBracketOff = strRet
    
End Function


'複数の日付指定を配列にする
'正しい日付出なければfalseを返す
Public Function ParseMultiDate(strDates As String, ByRef dtmParsedArray() As Date) As Boolean
    
    Dim strSplitArray() As String
    Dim strDivArray() As String
    Dim dtmArray() As Date
    Dim strParse As String
    Dim i As Long
    ParseMultiDate = False
    
    On Error GoTo ErrorTrap:
    
    
'    '全角を半角に変換
'    strParse = StrConv(strDates, vbNarrow)
    '空白を除去
    strParse = Replace$(strDates, " ", "")
    strParse = Replace$(strParse, "　", "")
    
    '末尾に「,」があれば除去
    Do While Right$(strParse, 1) = ","
        strParse = Left$(strParse, Len(strParse) - 1)
    Loop
    
    '「,」で分割する
    strSplitArray = Split(strParse, ",")
    ReDim dtmArray(UBound(strSplitArray), 1) As Date
    
    '分割後の２つの日付毎に処理
    For i = 0 To UBound(strSplitArray)
        '「～」で分割し、２つに分割できなければ終了
        strDivArray = Split(strSplitArray(i), "～")
        If UBound(strDivArray) <> 1 Then
            Exit Function
        End If
        '自、至を日付型に変換して配列に格納（日付型でない場合は例外となり、終了される）
        dtmArray(i, 0) = CDate(strDivArray(0))
        dtmArray(i, 1) = CDate(strDivArray(1))
    Next i
    
    'エラーでなければ、引数にパースした日付の配列をセット
    dtmParsedArray = dtmArray
    ParseMultiDate = True
    Exit Function

ErrorTrap:
    'パースに失敗した場合：エラーのまま終了する

End Function

'strKikan1,2はDate型に変換可能なことをチェック済みであること
Private Function IsDuplicateMultiDate(strKikan1 As String, strKikan2 As String, ByRef dtmParsedArray() As Date) As Boolean
    
    Dim i As Long, j As Long
    Dim lngMaxIndex As Long
    Dim dtmDateArray() As Date
    
    '自、至の日付が空でなければ、受け取った複数日付の配列と合わせて１つの配列にする
    If Len(strKikan1 & strKikan2) > 0 Then
        lngMaxIndex = UBound(dtmParsedArray, 1) + 1
        ReDim dtmDateArray(lngMaxIndex, 1) As Date
        For i = 0 To UBound(dtmParsedArray, 1)
            dtmDateArray(i, 0) = dtmParsedArray(i, 0)
            dtmDateArray(i, 1) = dtmParsedArray(i, 1)
        Next i
        dtmDateArray(lngMaxIndex, 0) = CDate(strKikan1)
        dtmDateArray(lngMaxIndex, 1) = CDate(strKikan2)
    Else
        dtmDateArray = dtmParsedArray
    End If
    
    IsDuplicateMultiDate = False
    
    '複数の日付を総当りでチェックする
    For i = 0 To lngMaxIndex
        For j = 0 To lngMaxIndex
            
            If i <> j Then
                '期間の(自)が、別の期間の(自)～(至)の範囲内にあればエラー
                If dtmDateArray(i, 0) >= dtmDateArray(j, 0) _
                    And dtmDateArray(i, 0) <= dtmDateArray(j, 1) Then
                    IsDuplicateMultiDate = True
                    Exit Function
                End If
                
                '期間の(至)が、別の期間の(自)～(至)の範囲内にあればエラー
                If dtmDateArray(i, 1) >= dtmDateArray(j, 0) _
                    And dtmDateArray(i, 1) <= dtmDateArray(j, 1) Then
                    IsDuplicateMultiDate = True
                    Exit Function
                End If
                
            End If
        Next j
    Next i
    
End Function

'"?"に変換されてしまうunicode文字が入っているか調べる
'戻り値：何文字目に入っているか。入っていない場合は0
Public Function hasProhibitedChar(rngTarget As Range) As Long

    Dim lngIndex As Long
    Dim checkChar As String
    
    hasProhibitedChar = 0
    
    For lngIndex = 1 To Len(rngTarget.value)
        checkChar = Mid(rngTarget.value, lngIndex, 1)
        If WNCheck(checkChar) = "N" And StrConv(checkChar, vbWide) = "？" Then
            If AscW(checkChar) <> 63 Then
                hasProhibitedChar = lngIndex
                Exit Function
            End If
        End If
    Next lngIndex
    
End Function

-------------------------------------------------------------------------------
VBA MACRO ModuleCommon.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCommon'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'ステータスバーに処理の進捗を表示するかどうか
Public gblnIsEnableStatusBar As Boolean

'テンプレートフォルダの名称
Public Const TEMPLATE_FOLDER_NAME As String = "templates"

'一部の機能で、時間計測結果をVBEのイミディエイトウィンドウに出力するかどうか
Public Const IS_COUNT_TIME As Boolean = False

'Officeのバージョン(CInt(Application.Version) の返却値)
Public Const EXCEL_VERSION_2000 As Integer = 9       'Excel 2000
'Public Const EXCEL_VERSION_2002 As Integer = 10
'Public Const EXCEL_VERSION_2003 As Integer = 11
'Public Const EXCEL_VERSION_2007 As Integer = 12

'ステータスバー操作用
Private mlngCountTotal As Long
Private mlngCountNow As Long
Private mstrCountMessage As String

Private mdblTimeStart As Double


'Excel97ではReplaceが使えない
'1文字ずつ確認する例

'-------------------------------------------------------------------
  ' 関数名 ： SrchReplace
  ' 機  能 ： 文字列の置換を行う
  ' 引  数 ： (in) strStringToFix   … 処理対象文字列
  '        ： (in) strCharToReplace … 検索文字列
  '        ： (in) strReplaceWith   … 置換する文字列
  '        ： (in) intReplaceSize   … 置換を行う文字列の長さ（省略時:1）
  ' 返り値 ：置換後の文字列
  '（2004.06.07 コメント追加）
'-------------------------------------------------------------------
Function SrchReplace(strStringToFix As String, strCharToReplace As String, strReplaceWith As String, Optional intReplaceSize As Integer = 1) As String
         
    Dim intPosition As Integer        '問題のある文字の位置
    'Dim strCharToReplace As String    '探す文字
    'Dim strReplaceWith As String      '置き換える文字
    Dim strTempChar As String         '検査する文字
    Dim strTempString As String       '加工後の文字列
 
    'strCharToReplace = "'"
    'strReplaceWith = "''"

    If intReplaceSize <= 0 Then SrchReplace = strStringToFix: Exit Function

    For intPosition = 1 To Len(strStringToFix)
                
        strTempChar = ""
        strTempChar = strTempChar & Mid(strStringToFix, intPosition, intReplaceSize)
        
        If strTempChar = strCharToReplace Then
            strTempString = strTempString & strReplaceWith
            intPosition = intPosition + intReplaceSize - 1
        Else
            strTempString = strTempString & Mid(strStringToFix, intPosition, 1)
        End If
        
    Next intPosition
     
    SrchReplace = strTempString

End Function

'-------------------------------------------------------------------
  ' 関数名 ： CutSpace
  ' 機  能 ： 指定文字列に存在する全ての空白文字（半角・全角両方）
  '        ： を除いた文字列を返す
  ' 引  数 ： (in) str  … 処理対象文字列
  ' 返り値 ： 全角・半角空白文字をを除いた文字列（例：「 同　　上 」→「同上」）
  '        ：（指定文字列がNull, Emptyの場合は""を返す）
'-------------------------------------------------------------------
Function CutSpace(str As String) As String
    
    Dim lngI As Long
    Dim strCurrent As String
    Dim strRet As String
    
    '無効な値をはじく
    If IsNull(str) Or IsEmpty(str) Then
        CutSpace = ""
        Exit Function
    End If
    
    '１文字ずつ空白であるかチェックし、空白以外の文字列を結合
    strRet = ""
    For lngI = 1 To Len(str)
    
        strCurrent = Mid$(str, lngI, 1)
        If strCurrent <> "　" And strCurrent <> " " Then
            strRet = strRet & strCurrent
        End If
    Next lngI
    
    CutSpace = strRet
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： SheetNo
  ' 機  能 ： 指定されたシート名から、「区分」「枝版」を取得する
  ' 引  数 ： (in)  strSName … 処理ワークシート名
  '        ： (out) strKNo   … 対象ワークシートの区分(String)
  '        ： (out) strSKNo  … 対象ワークシートの枝版(String)
  ' 使用例 ： (in)strSName="その○(1)(2)" → (out)strKNo="1", strSKNo="2"
  '        ： (in)strSName="その○(1)"    → (out)strKNo="1", strSKNo="0"
  '        ： (in)strSName="その○"       → (out)strKNo="0", strSKNo="0"
  '（2004.06.15 コメント追加）
'-------------------------------------------------------------------
Sub SheetNo(strsname As String, strKNo As String, strSKNo As String)

    Dim lng1LK As Long, lng1RK As Long, lng2LK As Long, lng2RK As Long
    'Dim strKNo As String, strSKNo As String
    
    lng1LK = InStr(strsname, "(")
    lng1RK = InStr(strsname, ")")
    
    If lng1LK = 0 Then strKNo = 0: strSKNo = 0: Exit Sub
    
    strKNo = Mid(strsname, lng1LK + 1, lng1RK - lng1LK - 1)
    
    lng2LK = InStr(lng1RK + 1, strsname, "(")
    lng2RK = InStr(lng1RK + 1, strsname, ")")
    
    If lng2LK = 0 Then strSKNo = 0: Exit Sub
    
    strSKNo = Mid(strsname, lng2LK + 1, lng2RK - lng2LK - 1)

End Sub

'Sheet最後尾枝番取得
'「hoge(1)(1) ～ hoge(1)(3)」「hoge(2)(1) ～ hoge(2)(4)」
'strSName in 「hoge(2)(1)」
'strKNo out 「2」
'strSKNo out 「4」
'strSKNoO in 「2」
'-------------------------------------------------------------------
  ' 関数名 ： SheetLastNo
  ' 機  能 ： 指定されたシート名から、末尾にある「枝版」を取得する
  ' 引  数 ： (in)  strSName … 末尾の区分・枝版を取得する対象のワークシート名
  '        ： (out) strKNo   … 末尾の区分（String)
  '        ： (out) strSKNo  … 指定された区分の末尾の枝版(String)
  '        ： (out) strSKNoO … 末尾の枝版を取得する対象の区分(String)
  '（2004.06.15 コメント追加）
'-------------------------------------------------------------------
Sub SheetLastNo(strsname As String, strKNo As String, strSKNo As String, strKNoO As String)

    Dim wsSelect As Worksheet
    Dim strKNoT As String, strSKNoT As String
    Dim strSRName As String
    
    strSRName = Left(strsname, InStr(strsname, "(") - 1) 'カッコより右側を削除
    
    If strSRName = "" Then strSRName = strsname
    
    For Each wsSelect In Worksheets
    
        If wsSelect.name Like strSRName & "*" Then
            Call SheetNo(wsSelect.name, strKNoT, strSKNoT)
            strKNo = strKNoT
            If strKNoT = strKNoO Then
                strSKNo = strSKNoT
            End If
        End If
    
    Next wsSelect

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： NormalizeSheets
  ' 機  能 ： XML取込時を行なうために、シートの連番体系を整える
  '        ：
  '        ： （指定したシートの同一区分のシートの枝版が、連番と
  '        ：   なっているかを調べ、連番でないシート以降を削除する）
  ' 引  数 ： (in)  strSRName … 対象のワークシート名（枝版を削った文字列）
  ' 返り値 ： 連番になっている枝版のうち、末尾の値（Long）
  '        ：（枝版が1のみの場合は1を返す）
  ' 備　考 ： その11, 12, 14シート取込時に使用
  ' 使用例 ： 「その11(1)(1), その11(1)(2), その11(1)(4), その11(1)(3)」
  '        ： の順でシートが存在する場合、その11(1)(4), その11(1)(3)
  '        ： シートが削除され、「その11(1)(1), その11(1)(2)」のみ
  '        ： が残る。戻り値は「2」となる。
'-------------------------------------------------------------------
Function NormalizeSheets(strSRName As String) As Long

    Dim wsSelect As Worksheet
    Dim strKNoT As String, strSKNoT As String
    Dim lngI As Long
    Dim intNumber As Integer
    Dim lngEndSheetNum As Integer   'この枝版までは正しい連番であるという値
    Dim isRenban As Boolean         'True:連番である,  False:連番でない
    
    intNumber = 1
    lngEndSheetNum = 1
    isRenban = True
    
    '引数のシートと、同一区分のシートを対象にループする
    For Each wsSelect In Worksheets
        If wsSelect.name Like strSRName & "*" Then
        
            Call SheetNo(wsSelect.name, strKNoT, strSKNoT)
            
            '枝版が1からの連番であるかチェックを行なう
            If isRenban = True Then
                If strSRName Like "その19*" Then
                    If CLng(strKNoT) <> intNumber Then
                        '連番でなければ、以降の追加分シートは削除する
                        isRenban = False
                    Else
                        lngEndSheetNum = CLng(strKNoT)
                    End If
                Else
                    If CLng(strSKNoT) <> intNumber Then
                        '連番でなければ、以降の追加分シートは削除する
                        isRenban = False
                    Else
                        lngEndSheetNum = CLng(strSKNoT)
                    End If
                End If
            End If

            '連番でない場合、そのシートを削除する。
            If isRenban = False Then
                Call bUnlock
                Application.DisplayAlerts = False
                wsSelect.Activate
                wsSelect.Delete
                Application.DisplayAlerts = True
                Set wsSelect = Nothing
                Call bLock
            End If
            
            intNumber = intNumber + 1
        End If
    
    Next wsSelect
    
    NormalizeSheets = lngEndSheetNum

End Function

'全Sheetロック解除
Function zUnlock()

Dim wsSelect As Worksheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    Dim actSheet As Worksheet
    Set actSheet = ActiveSheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
'For Each wsSelect In Worksheets
For Each wsSelect In ThisWorkbook.Worksheets
wsSelect.Unprotect Password:=ProtectPass
Next wsSelect
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    actSheet.Activate
    Set actSheet = Nothing
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END

End Function

'全Sheetロック
Function zLock()

Dim wsSelect As Worksheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    Dim actSheet As Worksheet
    Set actSheet = ActiveSheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
'For Each wsSelect In Worksheets
For Each wsSelect In ThisWorkbook.Worksheets
wsSelect.Protect Password:=ProtectPass, UserInterfaceOnly:=True
Next wsSelect
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    actSheet.Activate
    Set actSheet = Nothing
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END

End Function

'Bookロック解除
Function bUnlock()

'ActiveWorkbook.Unprotect Password:=ProtectPass
ThisWorkbook.Unprotect Password:=ProtectPass

End Function

'Bookロック
Function bLock()

'ActiveWorkbook.Protect Password:=ProtectPass, Structure:=True, Windows:=False
ThisWorkbook.Protect Password:=ProtectPass, Structure:=True, Windows:=False

End Function

'Bookオープン時処理
Function Auto_Open()
    
    '画面描画
    Call ScreenRedraw(False)

    Call bUnlock
    Call zUnlock

'    Select Case DantaiKubun
'    Case 0
'        Call SetZenkoku
'    Case 1
'        Call SetTokyo
'    End Select

    Call bLock
    Call zLock

    '画面描画
    Call ScreenRedraw(True)
    
    Application.EnableEvents = True

End Function

'画面描画
Function ScreenRedraw(boolFlg As Boolean)

    'マクロ実行中に EscキーやCtrl+Pauseでマクロを中断できないようにする
    If boolFlg = False Then
        Application.EnableCancelKey = xlDisabled
    End If
    
    'マクロの速度を向上させるため、画面を更新しないようにします。
    Application.ScreenUpdating = boolFlg
'    'キーボードやマウスからの入力を受け付けなくなります。ただし、表示されたダイアログ ボックスへの入力は可能です。
'    Application.Interactive = boolFlg

End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： IsEmptyString
  ' 機  能 ： 指定された文字列が、0文字以上の文字列であるかを返す
  ' 引  数 ： (in) str … 対象文字列
  ' 返り値 ： True : 0文字以上の文字列である
  '           False: 0文字以上の文字列でない（「""」もしくはNullもしくはEmptyである）
'-----------------------------------------------------------------------------------
Public Function IsEmptyString(str As String) As Boolean
    
    IsEmptyString = False
    If str = "" Or IsNull(str) Or IsEmpty(str) Then
        IsEmptyString = True
    End If
    
End Function


'-----------------------------------------------------------------------------------
  ' 関数名 ： IsValidNumber
  ' 機  能 ： 指定された文字列が正しい数値であるかを返す
  '        ： チェック内容：数値として解釈できるか、指定範囲内の整数であるか
  ' 引  数 ： (in) strValue … チェック対象文字列
  ' 返り値 ： True:妥当な金額である, False:妥当な金額でない
  '        ： なお、空の文字列は、Trueを返却する
'-----------------------------------------------------------------------------------
Public Function IsValidNumber(strValue As String, curMinimum As Currency, curMaximum As Currency) As Boolean
    
    IsValidNumber = False
    
    '値が空ならエラー無し
    If IsEmptyString(strValue) Then
        IsValidNumber = True
        Exit Function
    End If
    
    On Error GoTo ErrorHandler
    '数字として解釈出来るかチェック
    If IsNumeric(strValue) Then
        '正の整数であるかチェック
        If strValue = CStr(Int(CCur(strValue))) Then
            '最小値 ～ 最大値の値であるかチェック
            If val(strValue) >= curMinimum And curMaximum >= val(strValue) Then
                IsValidNumber = True
            End If
        End If
    End If
    Exit Function

'エラー処理ルーチン
ErrorHandler:
    Select Case Err.Number
        Case 6  'オーバーフローした場合は正しくない金額とする
            IsValidNumber = False
            Exit Function
    End Select
End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： BubbleSortDate
  ' 機  能 ： 配列で渡された日付項目を昇順に並び替える
  ' 引  数 ： (in) vArray … 日付項目の配列
'-----------------------------------------------------------------------------------
Public Function BubbleSortDate(iArray As Variant)
    Dim lLoop1 As Long
    Dim lLoop2 As Long
    Dim lTemp As Date
    
    For lLoop1 = UBound(iArray) To LBound(iArray) Step -1
      For lLoop2 = LBound(iArray) + 1 To lLoop1
    
        If iArray(lLoop2 - 1) > iArray(lLoop2) Then
          lTemp = iArray(lLoop2 - 1)
          iArray(lLoop2 - 1) = iArray(lLoop2)
          iArray(lLoop2) = lTemp
        End If
      Next lLoop2
    Next lLoop1
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： SetCalcMode
  ' 機  能 ： 自動計算のON/OFFを切り替える（処理速度向上のため）
  '        ：
  ' 引  数 ： (in)  isOn … True:自動計算ON, False:自動計算OFF
'-------------------------------------------------------------------
Public Sub SetCalcMode(isOn As Boolean)
    '（シートに値を設定するような処理が多い場合、セルの自動計算をオフにすると速度向上につながる）
    
    If isOn Then
        Application.Calculation = xlCalculationAutomatic
    Else
        Application.Calculation = xlCalculationManual
    End If

End Sub


'ステータスバーに進捗を表示する
Public Sub CountStatusbar(Optional strMessage As String = "", Optional lngTotal As Long = 0)
    
    'ステータスバー表示モードでなければ何もしない
    If Not gblnIsEnableStatusBar Then
        Exit Sub
    End If
    
    If lngTotal <> 0 Then
        mstrCountMessage = strMessage
        mlngCountTotal = lngTotal
        mlngCountNow = 1
    Else
        If mlngCountTotal > mlngCountNow Then
            mlngCountNow = mlngCountNow + 1
        End If
    End If
    
    Application.StatusBar = mstrCountMessage & " [" & mlngCountNow & "/" & mlngCountTotal & "]"
    
End Sub

'ファイルパスとファイル名を結合したフルパスを返す
Public Function UnionFilePathAndName(strFilePath As String, strFileName As String) As String
    
    If Right$(strFilePath, 1) = "\" Then
        UnionFilePathAndName = strFilePath & strFileName
    Else
        UnionFilePathAndName = strFilePath & "\" & strFileName
    End If
    
End Function

'共通のエラー処理
'エラーメッセージと、変更されている設定を元に戻す
Public Sub DispException(Optional strActionName As String = "処理")
    
    'イミディエイトウィンドウにエラーを出力
    Debug.Print "Exception: Date=[" & Format$(Now, "YYYY/MM/DD hh:mm:ss") & "], Number=[" & Err.Number & "], Description:=[" & Err.Description _
        & "], LastDllError=[" & Err.LastDllError & "], Source=[" & Err.Source & "]"
    
    Call ScreenRedraw(True)             '画面描画ON

    'エラーメッセージを出力
    MsgBox "次のエラーにより、" & strActionName & "に失敗しました。" & vbCrLf & vbCrLf _
        & "エラー番号：" & Err.Number & vbCrLf _
        & "エラー説明：" & Err.Description & vbCrLf _
        , vbCritical, strActionName

    
    '/* 一時的に設定変更している可能性があるものを元に戻す */
    
    'パーティーが複数ある場合、シートをパーティー順にソートする
    If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        Call ScreenRedraw(False)        '画面描画OFF
        Call bUnlock                    'ブックの保護を解除
        Call SortPartySheetsByNormal    '一旦、通常の順にする（パーティー順のソートは、通常の順が前提であるため）
        Call SortPartySheetsByParty     'パーティー順にする
        Call ScreenRedraw(True)         '画面描画ON
    End If
    
    Call SetCalcMode(True)              '自動計算ON
    Application.StatusBar = False       'ステータスバーを元に戻す
    Application.EnableEvents = True     'イベントを有効にする
    Application.DisplayAlerts = True    'Excelのアラートを有効にする
    Call bLock                          'ブックを保護
    Call zLock                          '全シートを保護

End Sub


'-------------------------------------------------------------------
  ' 関数名 ： CheckTemplateFile
  ' 機  能 ： 指定されたテンプレートファイルが使用可能かチェックする
  ' 引  数 ： (in) strTemplateFile … テンプレートファイル名
  '        ： (in) strMessageTitle … エラー時のダイアログのタイトル
  ' 返り値 ： 正常：テンプレートファイルのフルパス
  '        ： エラー：空文字("")
'-------------------------------------------------------------------
Public Function CheckTemplateFile(strTemplateFile As String, strMessageTitle As String) As String
    
    Dim strTemplateFilePath As String
    Dim strTemplateFolderPath As String
    Dim strMessage As String
    Dim wkbTemp As Workbook
    Dim isNoSave As Boolean     '会計帳簿作成ソフトの収支報告書作成で出力されてから未保存の場合:True
    
    CheckTemplateFile = ""
    
    
    'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
    If ThisWorkbook.pATH = "" Then
        '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
        '会計帳簿から渡されたパスをこのブックのパスとする
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value, TEMPLATE_FOLDER_NAME)
        isNoSave = True
    Else
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.pATH, TEMPLATE_FOLDER_NAME)
        isNoSave = False
    End If
    
    
    'テンプレートフォルダが存在するか
    'B-CCL-047
'    If Dir(strTemplateFolderPath, vbDirectory) = "" Then
    If isFolderExists(strTemplateFolderPath) = False Then
        If isNoSave Then
            '会計帳簿から渡されたパスの場合（メッセージを区別）
            strMessage = "このブックを出力した会計帳簿作成ソフトと同じフォルダに""" & TEMPLATE_FOLDER_NAME & """フォルダが存在しないため、実行できません。" & vbCrLf & _
                    "詳細な対応方法は「FAQ」シートを参照してください。"
        Else
            '収支報告書作成ソフトを同じパスの場合
            strMessage = "このブックと同じフォルダに""" & TEMPLATE_FOLDER_NAME & """フォルダが存在しないため、実行できません。" & vbCrLf _
                        & vbCrLf _
                        & "この操作を行うには、このブックを収支報告書作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。" & vbCrLf & _
                    "詳細な対応方法は「FAQ」シートを参照してください。"
        End If
        MsgBox strMessage, vbCritical, strMessageTitle
        Exit Function
    End If
    
    'テンプレートのファイルパス
    strTemplateFilePath = UnionFilePathAndName(strTemplateFolderPath, strTemplateFile)
    
    'テンプレートファイルが存在するか
    'B-CCL-047
'    If Dir(strTemplateFilePath) = "" Then
    If isFileExists(strTemplateFilePath) = False Then
        strMessage = "この操作に必要なテンプレートファイルが存在しないため、実行できません。" & vbCrLf _
                    & vbCrLf _
                    & "この操作を行うには、""" & TEMPLATE_FOLDER_NAME & """フォルダ内に「" & strTemplateFile & "」が必要です。" & vbCrLf & _
                    "詳細な対応方法は「FAQ」シートを参照してください。"
        
        MsgBox strMessage, vbCritical, strMessageTitle
        Exit Function
    End If
    
    'テンプレートファイルが使用中でないか？または同じ名前のブックを開いていないか？
    For Each wkbTemp In Workbooks
        
        If strTemplateFile = wkbTemp.name Then
            
            strMessage = "この操作に必要なテンプレートファイル「" & strTemplateFile & "」と同じ名前のブックが" & vbCrLf _
                        & "開かれているため、実行できません。" & vbCrLf _
                        & vbCrLf _
                        & "上記のブックを閉じてから再度実行してください。"
            
            MsgBox strMessage, vbCritical, strMessageTitle
            Exit Function
        End If
    Next
    
    CheckTemplateFile = strTemplateFilePath
    
End Function


'処理時間計測 開始( IS_COUNT_TIMEフラグが trueの場合のみ)
Public Sub CountTimeStart(strProcess As String)
    
    '時間計測を行うかどうかのフラグがTrueでなければ、計測しない
    If IS_COUNT_TIME = False Then
        Exit Sub
    End If
        
    mdblTimeStart = Timer
    
    Debug.Print Format$(Now, "yyyy/mm/dd hh:mm:ss") & " [" & strProcess & "] 開始"
    
End Sub

'処理時間計測 終了( IS_COUNT_TIMEフラグが trueの場合のみ)
Public Sub CountTimeStop(strProcess As String, Optional ByVal dblTimeStart As Double = -1)
    
    '時間計測を行うかどうかのフラグがTrueでなければ、計測しない
    If IS_COUNT_TIME = False Then
        Exit Sub
    End If
    
    Dim dblTime As Double
    Dim lngMin As Long
    Dim dblSec As Double
    
    If dblTimeStart < 0 Then
        dblTimeStart = mdblTimeStart
    End If
    
    dblTime = Timer - dblTimeStart
    lngMin = Int(dblTime / 60)
    dblSec = dblTime - (lngMin * 60)
    
    Debug.Print Format$(Now, "yyyy/mm/dd hh:mm:ss") & " [" & strProcess & "] 終了" _
        & " (経過時間: " & lngMin & "分 " & Format$(dblSec, "#.00") & "秒)"
    
End Sub

'Dir関数の代わりにFileExistsを使用する
'B-CCL-047
Public Function isFileExists(strFilePath As String) As Boolean
    
    Dim objFSO As Object
    Set objFSO = CreateObject("Scripting.FileSystemObject")
        
    isFileExists = objFSO.FileExists(strFilePath)
    
    Set objFSO = Nothing

End Function

'Dir関数の代わりにFolderExistsを使用する
'B-CCL-047
Public Function isFolderExists(strFolderPath As String) As Boolean
    
    Dim objFSO As Object
    Set objFSO = CreateObject("Scripting.FileSystemObject")
        
    isFolderExists = objFSO.FolderExists(strFolderPath)
    
    Set objFSO = Nothing

End Function

Sub FAQLink_Click()
    Worksheets("FAQ").Activate
End Sub

'SelcetA1
Function SelcetA1()

Dim wsSelect As Worksheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    Dim actSheet As Worksheet
    Set actSheet = ActiveSheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
'For Each wsSelect In Worksheets
For Each wsSelect In ThisWorkbook.Worksheets
wsSelect.Activate
wsSelect.Range("A1").Select
ActiveWindow.Zoom = 70

Next wsSelect
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    actSheet.Activate
    Set actSheet = Nothing
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END

End Function

'一部シートクリア
Sub clearselect()

    Dim strsname As String
    Dim wsSelect As Worksheet
    

    For Each wsSelect In ThisWorkbook.Worksheets
            

            
            strsname = wsSelect.name
    If strsname = "その3" Then
    Call SheetClear(wsSelect)

    ElseIf strsname = "その4" Then
    Call SheetClear(wsSelect)

    ElseIf strsname = "その5" Then
    Call SheetClear(wsSelect)
    
    ElseIf strsname = "その6" Then
    Call SheetClear(wsSelect)

    ElseIf strsname Like "その7*" Then
        
    Call SheetClear(wsSelect)

    ElseIf strsname Like "その8*" Then
        
    Call SheetClear(wsSelect)
   
    ElseIf strsname = "その9" Or _
            strsname = "その10" Then
    Call SheetClear(wsSelect)

    ElseIf strsname Like "その11*" Or _
            strsname Like "その12*" Then
    Call SheetClear(wsSelect)
        
    ElseIf strsname Like "その14*" Then
    Call SheetClear(wsSelect)
    
    ElseIf strsname Like "その15*" Then
    Call SheetClear(wsSelect)
    
    ElseIf strsname = "その16" Then
    Call SheetClear(wsSelect)

    ElseIf strsname Like "その18*" Then
    Call SheetClear(wsSelect)

    ElseIf strsname Like "その19*" Then
    Call SheetClear(wsSelect)

    ElseIf strsname = "15号様式" Then
    Call SheetClear(wsSelect)

    End If
    
    Next wsSelect

End Sub

-------------------------------------------------------------------------------
VBA MACRO ModuleCreateKifukin.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCreateKifukin'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'Private Const FILENAME_KIFUKIN As String = "寄附金控除のための書類.xls"
Private Const FILENAME_KIFUKIN As String = "寄附金控除のための書類.xlsx"
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
Private Const template_const As Integer = 50
Private Const NULL_SEQ_NO_HEADER As String = "E-"


'-----------------------------------------------------------------------------------
  ' 関数名 ： CommandCreatekifukin
  ' 機  能 ： 寄附金控除のための書類を作成する。
  ' 備　考 ： 入力チェックを行い、エラーが無い場合に、対象データを抽出し、
  '        ： 別Bookとして「寄附金控除のための書類」をOPENし編集する。
'-----------------------------------------------------------------------------------
Public Sub CommandCreatekifukin()
    
    On Error GoTo ErrorTrap:
    
    Dim nmsSelWS As Names, wsSelect As Worksheet
    Dim lngI As Long
    Dim Datacnt As Long
    Dim DantaiNM As String   '政治団体名称
    Dim DantaiADR As String  '所在地
    Dim DantaiKBN1 As String '団体区分（政党または政治資金団体の場合）
    Dim DantaiKBN2 As String '団体区分（上記以外の場合）
    Dim GiinNM As String     '国会議員氏名
    Dim SijiNM As String     '支持する者の氏名
    Dim Senkyo As String     '選挙名
    Dim YMD As Variant       '立候補年月日
    Dim LoopCnt As Long
    Dim intResponse As Integer
    Dim strTemplateFilePath As String
    Dim wkbNew As Workbook
    Dim wksSheet As Worksheet
    
    Set wsSelect = ActiveSheet
    Set nmsSelWS = wsSelect.Names
    
    'テンプレートファイルをチェックする
    If CheckTemplateFile(FILENAME_KIFUKIN, "寄附金控除書類印刷") = "" Then
        Exit Sub
    End If
    
    If gintCheckStatus = CHECK_STATUS_OK Then
        intResponse = MsgBox("寄附金（税額）控除のための書類を作成します。" & vbCrLf & "よろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "寄附金控除書類印刷")
        If intResponse <> vbYes Then
            Exit Sub
        End If
    Else
        'エラーチェックを行ない、エラーがあれば警告する
        intResponse = MsgBox("寄附金控除書類印刷の前に、「申請者一覧」シートの作成および項目チェックを行います。", vbInformation + vbOKCancel, "寄附金控除書類印刷")
        If intResponse <> vbOK Then
            Exit Sub
        End If
        
        '「申請者一覧」シートの更新を行う
        Call ScreenRedraw(False)                '画面描画OFF
        Call IMP7
        Worksheets("メニュー").Activate         '「メニュー」シートをアクティブにする
        Call ScreenRedraw(True)                 '画面描画ON
        
        
'        Dim isSortedPartySheets As Boolean
'        isSortedPartySheets = False
'        '項目チェックのため、シートの順番を通常のシート順に戻す（パーティー順の場合）
'        If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
'            Call bUnlock                    'ブックの保護を解除
'            Call SortPartySheetsByNormal    '通常の順にする
'            isSortedPartySheets = True
'        End If
        
        '項目チェックを行う
        GaijiChkFlg = False
        Call ValidationCheck_All
        
        '「報告年 >= 宣誓日の年号」の場合ワーニングを表示
        Call senseiDtWarning
        
'        'パーティーが複数ある場合、シートをパーティー順に戻す
'        If isSortedPartySheets = True Then
'            Call SortPartySheetsByParty     'パーティー順にする
'            Call bLock                      'ブックを保護状態に戻す
'        End If
        
        If gintCheckStatus = CHECK_STATUS_OK Then
        Else
            Exit Sub
        End If
    
'        For lngI = 1 To nmsSelWS.Count
'            If nmsSelWS(lngI).Name Like wsSelect.Name & "!E*" Then
'                If wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.Column).Value = True Then
'                    MsgBox "項目チェックでエラーが見つかりました。エラーを修正したのち、寄附金控除書類印刷を行ってください。", vbCritical, "寄附金控除書類印刷"
'                    Exit Sub
'                End If
'            End If
'        Next
    End If
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStart("寄附金控除書類印刷")
    
    DantaiNM = ThisWorkbook.Worksheets("その1").Range("DANTAI_NM").value
    DantaiADR = ThisWorkbook.Worksheets("その1").Range("JIM_ADR").value & "　" & ThisWorkbook.Worksheets("その1").Range("JIM_APA_ADR").value
'    If ThisWorkbook.Worksheets("その1").Range("DANTAI_KBN").value = "01" Or "02" Or "03" Then
    If ThisWorkbook.Worksheets("寄附金").Range("KUBUN").value = 1 Then
        DantaiKBN1 = "①"
        DantaiKBN2 = "2"
    Else
        DantaiKBN1 = "1"
        DantaiKBN2 = "②"
    End If
    GiinNM = ThisWorkbook.Worksheets("寄附金").Range("GIIN_NM").value
    SijiNM = ThisWorkbook.Worksheets("寄附金").Range("NM").value
    Senkyo = ThisWorkbook.Worksheets("寄附金").Range("SENKYO_INP").value
    If ThisWorkbook.Worksheets("寄附金").Range("DT").value = "" Then
        YMD = Null
    Else
        YMD = ThisWorkbook.Worksheets("寄附金").Range("DT").value
    End If
    
    Dim colIndexArray As Collection
    
    '出力データ用のブックを新規作成（様式が準備されたテンプレートを使用）
    strTemplateFilePath = CheckTemplateFile(FILENAME_KIFUKIN, "寄附金控除書類印刷") '再度チェック
    If strTemplateFilePath <> "" Then
        Set wkbNew = Workbooks.Add(strTemplateFilePath)
    Else
        Exit Sub
    End If
    
    Call ScreenRedraw(False)    '画面描画OFF
    Call SetCalcMode(False)     '自動計算OFF
    
    Set wksSheet = Worksheets.Add
    wksSheet.name = "Data"

    '*** 印刷対象データを抽出する ***
    Call KifukinDataGet(wksSheet, Datacnt, DantaiNM, DantaiADR, DantaiKBN1, DantaiKBN2, GiinNM, SijiNM, Senkyo, YMD)
    
    If Datacnt > 0 Then
    Else
        Call ScreenRedraw(True)     '画面描画ON
        Call SetCalcMode(True)      '自動計算ON
        
        MsgBox "「寄附金（税額）控除のための書類」を印刷するデータが存在しません。" & vbCrLf & "処理を終了します。", vbInformation, "寄附金控除書類印刷"
        wkbNew.Close SaveChanges:=False
        Exit Sub
    End If
    
    
    With wksSheet
        For LoopCnt = 1 To Datacnt
            If LoopCnt > template_const Then
                wkbNew.Worksheets(LoopCnt).Select
                wkbNew.Worksheets(LoopCnt).Copy after:=Sheets(LoopCnt)
            End If
            wkbNew.Worksheets(LoopCnt + 1).name = wkbNew.Worksheets("Data").Cells(LoopCnt, 1)
            Call ListEdit(wkbNew, wksSheet, LoopCnt)
        Next LoopCnt
                
        'シート削除時の警告メッセージを抑止
        Application.DisplayAlerts = False
        wkbNew.Worksheets("Data").Delete
        '警告メッセージ抑止解除
        Application.DisplayAlerts = True
        
        If LoopCnt - 1 < template_const Then
            For LoopCnt = template_const To Datacnt + 1 Step -1
                'シート削除時の警告メッセージを抑止
                Application.DisplayAlerts = False
                wkbNew.Worksheets(LoopCnt).Delete
                '警告メッセージ抑止解除
                Application.DisplayAlerts = True
            Next LoopCnt
        End If
    End With
    
    
    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStop("寄附金控除書類印刷")
    
ExitProcedure:

    Call ScreenRedraw(True)     '画面描画ON
    Call SetCalcMode(True)      '自動計算ON
    Worksheets(1).Activate
    
    Exit Sub
    
ErrorTrap:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("寄附金控除書類印刷")
    GoTo ExitProcedure:
    
End Sub

'-----------------------------------------------------------------------------------
  ' 関数名 ： KifukinDataGet
  ' 機  能 ： 寄附金控除のための書類用のデータを抽出する。
  ' 引  数 ： (in)  wkbNew … 対象ブックオブジェクト
  '        ： (in)  wksSheet … 対象シートオブジェクト
  '        ： (out) Datacnt … 抽出した件数
'-----------------------------------------------------------------------------------
Public Sub KifukinDataGet(wksSheet, Datacnt, DantaiNM, DantaiADR, DantaiKBN1, DantaiKBN2, GiinNM, SijiNM, Senkyo, YMD)

    Dim wsSelect As Worksheet
    
    Dim intColNm As Integer
    Dim intColKingaku As Integer
    Dim intColDt As Integer
    Dim intColAdr As Integer
    Dim intColZeigaku As Integer
    Dim intColSeqno As Integer
    
    Dim lngRCount As Long
    Dim lngZCount As Long
    Dim KifuDateCount As Long
    Dim KifuDateCell As Long
    Dim lngUB As Long
    Dim lngI As Long
    Dim TargetNo As String
    Dim kifuDataSeq As New EasyHashMap
    Dim NullSeqNoCnt As Long

    Dim TargetLine As Long
    Dim str氏名 As String, str住所 As String, cur金額計 As Currency, cur金額() As Currency, date寄附日() As Date
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    
    Dim dateNewest As Date  '同一通し番号間において、最も新しい寄附日
    
    ReDim cur金額(0)
    ReDim date寄附日(0)
    Datacnt = 0
    
    Set wsSelect = ThisWorkbook.Worksheets("その7(1)")
    With wsSelect
    
        lngHRow = .Range("行頭").Row
        lngFRow = .Range("行末").Row
        lngRCount = lngFRow - lngHRow - 1
        
        '列を取得
        intColNm = .Range("KIFUSYA_NM").column          '寄附者の氏名
        intColKingaku = .Range("KINGAKU").column        '金額
        intColAdr = .Range("ADR").column                '住所
        intColDt = .Range("DT").column                  '年月日
        intColZeigaku = .Range("ZEIGAKUKOUJYO").column  '寄附金（税額）控除
        intColSeqno = .Range("SEQ_NO").column           '通し番号
                
        For lngI = lngHRow + 1 To lngFRow - 1
            
            '寄附金（税額）控除が「必要」の場合
            If .Cells(lngI, intColZeigaku).value = "必要" Then
                
                '通し番号が空欄の場合
                If .Cells(lngI, intColSeqno).value = "" Then
                    
                    NullSeqNoCnt = NullSeqNoCnt + 1
                    TargetNo = NULL_SEQ_NO_HEADER & CStr(NullSeqNoCnt)  '仮の通し番号を設定
                
                '通し番号が空欄でない場合
                Else
                    
                    TargetNo = CStr(.Cells(lngI, intColSeqno).value) '通し番号を設定
                
                End If
                
                '通し番号が既に処理されていない場合
                If kifuDataSeq.AddWithOverlapCheck(TargetNo, lngI) = True Then
                    
                    Datacnt = Datacnt + 1
                    str氏名 = .Cells(lngI, intColNm).value
                    str住所 = .Cells(lngI, intColAdr).value
                    cur金額計 = 0
                    lngZCount = 0
                    
                    '通し番号が空欄の場合
                    If .Cells(lngI, intColSeqno).value = "" Then
                        
                        lngZCount = lngZCount + 1
                        ReDim Preserve cur金額(lngZCount) As Currency
                        ReDim Preserve date寄附日(lngZCount) As Date
                        
                        cur金額計 = cur金額計 + .Cells(lngI, intColKingaku).value
                        cur金額(lngZCount) = .Cells(lngI, intColKingaku).value
                        date寄附日(lngZCount) = .Cells(lngI, intColDt).value
                    
                    '通し番号が空欄でない場合
                    Else
                        
                        '最新の寄附日 に初期値をセット（どんな日付よりも古い日付）
                        dateNewest = #1/1/1900#
                        
                        '行ループ
                        For TargetLine = lngHRow + 1 To lngFRow - 1     '開始行はLngI(カレント行)として効率化を検討すること
            
                            '通し番号と前回通し番号が同一で、寄附金（税額）控除が「必要」の場合
                            If CStr(.Cells(TargetLine, intColSeqno).value) = TargetNo And _
                                .Cells(TargetLine, intColZeigaku).value = "必要" Then
                                
                                lngZCount = lngZCount + 1
                                ReDim Preserve cur金額(lngZCount) As Currency
                                ReDim Preserve date寄附日(lngZCount) As Date
                                
                                cur金額計 = cur金額計 + .Cells(TargetLine, intColKingaku).value
                                cur金額(lngZCount) = .Cells(TargetLine, intColKingaku).value
                                date寄附日(lngZCount) = .Cells(TargetLine, intColDt).value
                                
                                '同一通し番号が複数ある場合、「氏名」「住所」は寄附日が最新のものを印字する(最新が複数の場合は最も下にあるものとする)
                                If dateNewest <= date寄附日(lngZCount) Then
                                    dateNewest = date寄附日(lngZCount)
                                    
                                    str氏名 = .Cells(TargetLine, intColNm).value
                                    str住所 = .Cells(TargetLine, intColAdr).value
                                    
                                End If
                                
                            End If
                        
                        Next TargetLine
                    
                    End If
                    
                    '日付を昇順にソート
                    Call BubbleSortDate(date寄附日)
                    
                    lngUB = UBound(date寄附日)
                    
                    With wksSheet
                        .Cells(Datacnt, 1) = TargetNo
                        .Cells(Datacnt, 2) = str氏名
                        .Cells(Datacnt, 3) = str住所
                        .Cells(Datacnt, 4) = cur金額計
                        .Cells(Datacnt, 6) = DantaiNM
                        .Cells(Datacnt, 7) = DantaiADR
                        .Cells(Datacnt, 8) = DantaiKBN1
                        .Cells(Datacnt, 9) = DantaiKBN2
                        .Cells(Datacnt, 10) = GiinNM
                        .Cells(Datacnt, 11) = SijiNM
                        .Cells(Datacnt, 12) = Senkyo
                        .Cells(Datacnt, 13) = YMD
                        
                        If lngUB > 1 Then
                            KifuDateCell = 14
                            For KifuDateCount = 1 To lngUB
                                .Cells(Datacnt, KifuDateCell) = date寄附日(KifuDateCount)
                                .Cells(Datacnt, KifuDateCell + 1) = cur金額(KifuDateCount)
                                KifuDateCell = KifuDateCell + 2
                            Next KifuDateCount
                        Else
                            .Cells(Datacnt, 5) = date寄附日(1)
                        End If
                        
                    End With
                End If

            End If
        Next lngI
    End With

End Sub

Public Sub ListEdit(wkbNew, wksSheet, LoopCnt)

'
' ListEdit
' マクロ記録日 : 2004/6/17  ユーザー名 : Administrator
'
    Dim wsSelect As Worksheet
    Dim cnt_1 As Double
    Dim cnt_2 As Double
    Dim cnt_3 As Double
    Dim cnt_4 As Double
    
    Set wsSelect = wkbNew.Worksheets(LoopCnt + 1)
    With wsSelect
    .Activate
        
        .Range("NM") = Worksheets("Data").Cells(LoopCnt, 2)
        .Range("ADR") = Worksheets("Data").Cells(LoopCnt, 3)

        .Range("KINGAKU_GK_10") = ""
        .Range("KINGAKU_GK_9") = ""
        .Range("KINGAKU_GK_8") = ""
        .Range("KINGAKU_GK_7") = ""
        .Range("KINGAKU_GK_6") = ""
        .Range("KINGAKU_GK_5") = ""
        .Range("KINGAKU_GK_4") = ""
        .Range("KINGAKU_GK_3") = ""
        .Range("KINGAKU_GK_2") = ""
        .Range("KINGAKU_GK_1") = ""
        cnt_2 = Len(Worksheets("Data").Cells(LoopCnt, 4))
        If cnt_2 > 0 Then
            cnt_3 = 1
            Do Until cnt_2 < 0
                Select Case cnt_3
                    Case 1
                        cnt_4 = 15
                    Case 2
                        cnt_4 = 14
                    Case 3
                        cnt_4 = 12
                    Case 4
                        cnt_4 = 11
                    Case 5
                        cnt_4 = 9
                    Case 6
                        cnt_4 = 7
                    Case 7
                        cnt_4 = 6
                    Case 8
                        cnt_4 = 5
                    Case 9
                        cnt_4 = 4
                    Case Else
                        cnt_4 = 3
                End Select
                If cnt_2 < 1 Then
                    .Cells(15, cnt_4) = "\"
                Else
                    .Cells(15, cnt_4) = Mid(Worksheets("Data").Cells(LoopCnt, 4), cnt_2, 1)
                End If

                cnt_2 = cnt_2 - 1
                cnt_3 = cnt_3 + 1
            Loop
        End If

        If Worksheets("Data").Cells(LoopCnt, 5) = "" Then
            .Range("DT") = "　　 　年 　　　月　 　　日"
        Else
            .Range("DT") = Worksheets("Data").Cells(LoopCnt, 5)
        End If

        .Range("DANTAI_NM") = Worksheets("Data").Cells(LoopCnt, 6)
        .Range("DANTAI_ADR") = Worksheets("Data").Cells(LoopCnt, 7)
        .Range("DANTAI_KBN1") = Worksheets("Data").Cells(LoopCnt, 8)
        .Range("DANTAI_KBN2") = Worksheets("Data").Cells(LoopCnt, 9)
        .Range("GIIN_NM1") = Worksheets("Data").Cells(LoopCnt, 10)
        .Range("GIIN_NM2") = Worksheets("Data").Cells(LoopCnt, 11)
        .Range("SENKYO") = Worksheets("Data").Cells(LoopCnt, 12)
        
        If Worksheets("Data").Cells(LoopCnt, 13) = "" Then
            .Range("SENKYO_DT") = "　　年　　月　　日"
        Else
            .Range("SENKYO_DT") = Worksheets("Data").Cells(LoopCnt, 13)
        End If

        '寄附の内訳欄の1明細目
        If Worksheets("Data").Cells(LoopCnt, 14) = "" Then
            .Range("DT_1") = "・　　・"
            .Range("KINGAKU_1") = "円"
        Else
            .Range("DT_1") = Worksheets("Data").Cells(LoopCnt, 14)
            .Range("KINGAKU_1") = Worksheets("Data").Cells(LoopCnt, 15)
        End If
        '寄附の内訳欄の2明細目
        If Worksheets("Data").Cells(LoopCnt, 16) = "" Then
            .Range("DT_2") = "・　　・"
            .Range("KINGAKU_2") = "円"
        Else
            .Range("DT_2") = Worksheets("Data").Cells(LoopCnt, 16)
            .Range("KINGAKU_2") = Worksheets("Data").Cells(LoopCnt, 17)
        End If
        '寄附の内訳欄の3明細目
        If Worksheets("Data").Cells(LoopCnt, 18) = "" Then
            .Range("DT_3") = "・　　・"
            .Range("KINGAKU_3") = "円"
        Else
            .Range("DT_3") = Worksheets("Data").Cells(LoopCnt, 18)
            .Range("KINGAKU_3") = Worksheets("Data").Cells(LoopCnt, 19)
        End If
        '寄附の内訳欄の4明細目
        If Worksheets("Data").Cells(LoopCnt, 20) = "" Then
            .Range("DT_4") = "・　　・"
            .Range("KINGAKU_4") = "円"
        Else
            .Range("DT_4") = Worksheets("Data").Cells(LoopCnt, 20)
            .Range("KINGAKU_4") = Worksheets("Data").Cells(LoopCnt, 21)
        End If
        '寄附の内訳欄の5明細目
        If Worksheets("Data").Cells(LoopCnt, 22) = "" Then
            .Range("DT_5") = "・　　・"
            .Range("KINGAKU_5") = "円"
        Else
            .Range("DT_5") = Worksheets("Data").Cells(LoopCnt, 22)
            .Range("KINGAKU_5") = Worksheets("Data").Cells(LoopCnt, 23)
        End If
        '寄附の内訳欄の6明細目
        If Worksheets("Data").Cells(LoopCnt, 24) = "" Then
            .Range("DT_6") = "・　　・"
            .Range("KINGAKU_6") = "円"
        Else
            .Range("DT_6") = Worksheets("Data").Cells(LoopCnt, 24)
            .Range("KINGAKU_6") = Worksheets("Data").Cells(LoopCnt, 25)
        End If
        '寄附の内訳欄の7明細目
        If Worksheets("Data").Cells(LoopCnt, 26) = "" Then
            .Range("DT_7") = "・　　・"
            .Range("KINGAKU_7") = "円"
        Else
            .Range("DT_7") = Worksheets("Data").Cells(LoopCnt, 26)
            .Range("KINGAKU_7") = Worksheets("Data").Cells(LoopCnt, 27)
        End If
        '寄附の内訳欄の8明細目
        If Worksheets("Data").Cells(LoopCnt, 28) = "" Then
            .Range("DT_8") = "・　　・"
            .Range("KINGAKU_8") = "円"
        Else
            .Range("DT_8") = Worksheets("Data").Cells(LoopCnt, 28)
            .Range("KINGAKU_8") = Worksheets("Data").Cells(LoopCnt, 29)
        End If
        '寄附の内訳欄の9明細目
        If Worksheets("Data").Cells(LoopCnt, 30) = "" Then
            .Range("DT_9") = "・　　・"
            .Range("KINGAKU_9") = "円"
        Else
            .Range("DT_9") = Worksheets("Data").Cells(LoopCnt, 30)
            .Range("KINGAKU_9") = Worksheets("Data").Cells(LoopCnt, 31)
        End If
        '寄附の内訳欄の10明細目
        If Worksheets("Data").Cells(LoopCnt, 32) = "" Then
            .Range("DT_10") = "・　　・"
            .Range("KINGAKU_10") = "円"
        Else
            .Range("DT_10") = Worksheets("Data").Cells(LoopCnt, 32)
            .Range("KINGAKU_10") = Worksheets("Data").Cells(LoopCnt, 33)
        End If
        '寄附の内訳欄の11明細目
        If Worksheets("Data").Cells(LoopCnt, 34) = "" Then
            .Range("DT_11") = "・　　・"
            .Range("KINGAKU_11") = "円"
        Else
            .Range("DT_11") = Worksheets("Data").Cells(LoopCnt, 34)
            .Range("KINGAKU_11") = Worksheets("Data").Cells(LoopCnt, 35)
        End If
        '寄附の内訳欄の12明細目
        If Worksheets("Data").Cells(LoopCnt, 36) = "" Then
            .Range("DT_12") = "・　　・"
            .Range("KINGAKU_12") = "円"
        Else
            .Range("DT_12") = Worksheets("Data").Cells(LoopCnt, 36)
            .Range("KINGAKU_12") = Worksheets("Data").Cells(LoopCnt, 37)
        End If
        '寄附の内訳欄の13明細目
        If Worksheets("Data").Cells(LoopCnt, 38) = "" Then
            .Range("DT_13") = "・　　・"
            .Range("KINGAKU_13") = "円"
        Else
            .Range("DT_13") = Worksheets("Data").Cells(LoopCnt, 38)
            .Range("KINGAKU_13") = Worksheets("Data").Cells(LoopCnt, 39)
        End If
        '寄附の内訳欄の14明細目
        If Worksheets("Data").Cells(LoopCnt, 40) = "" Then
            .Range("DT_14") = "・　　・"
            .Range("KINGAKU_14") = "円"
        Else
            .Range("DT_14") = Worksheets("Data").Cells(LoopCnt, 40)
            .Range("KINGAKU_14") = Worksheets("Data").Cells(LoopCnt, 41)
        End If
        '寄附の内訳欄の15明細目
        If Worksheets("Data").Cells(LoopCnt, 42) = "" Then
            .Range("DT_15") = "・　　・"
            .Range("KINGAKU_15") = "円"
        Else
            .Range("DT_15") = Worksheets("Data").Cells(LoopCnt, 42)
            .Range("KINGAKU_15") = Worksheets("Data").Cells(LoopCnt, 43)
        End If
    
    End With

End Sub


'templates\寄附金控除のための書類.xls の作成用マクロ
'アクティブシートを支出項目の分コピーする
'例：「t」シートをアクティブにして実行すると、「t1」「t2」「t3」・・・という名前でコピーする
Private Sub SetupKifukinTemplate()
    
    Dim intCopyNumStart As Integer
    Dim intCopyNumEnd   As Integer
    
    Dim wksOrigin As Worksheet
    Dim wksNextSheet As Worksheet
    Set wksOrigin = ActiveSheet
    Set wksNextSheet = ActiveSheet.Next
    Dim i As Integer

    '-------------------------------
    ' 開始番号
    intCopyNumStart = 1
    ' 終了番号
    intCopyNumEnd = 50
    '-------------------------------
    
    For i = intCopyNumStart To intCopyNumEnd
        wksOrigin.Copy before:=wksNextSheet '必ず右隣のシートがある状態で実行すること
        ActiveSheet.name = "t" & CStr(i)
    Next i

End Sub

    
-------------------------------------------------------------------------------
VBA MACRO ModuleIMP7.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleIMP7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
'申請者一覧シート.その７内容取得ボタンより起動
'メニューシート.XMLデータ取込ボタンより起動（ModuleXMLAccess.XML_Import）
Sub IMP7()

    On Error GoTo ErrorTrap:

    Dim wsSelect As Worksheet
    
    Dim intColZeigaku As Integer
    Dim intColSeqno As Integer
    Dim intColNm As Integer
    Dim intColDt As Integer
    Dim intColAdr As Integer
    Dim intColSyokugyo As Integer
    Dim intColKoujoDetail As Integer
    
    Dim lngRCount As Long
    Dim lngZCount As Long
    Dim lngUB As Long
    Dim lngI As Long
    Dim sumKingaku As Currency
    
    Dim targetSeqNo As String
    Dim str氏名() As String, str住所() As String, cur金額() As Currency, str職業() As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    
    Dim lngRowSubLoop As Long
    Dim dateNewest As Date      '同一通し番号間において、最も新しい寄附日
    Dim lngRowNewst As Long     '同一通し番号間において、最も新しい寄附日がある行
    Dim dateThisRow As Date     'ループ中の行の日付
    Dim kifuDataSeq As New EasyHashMap  'ループ中、同一通し番号が既に出現したかどうかを格納するためのマップ
    
    ReDim str氏名(0)
    ReDim str住所(0)
    ReDim cur金額(0)
    ReDim str職業(0)
    
    Set wsSelect = Worksheets("その7(1)")
    With wsSelect
        
        'シートを再計算する
        .Calculate
        
        lngHRow = .Range("行頭").Row
        lngFRow = .Range("行末").Row
        lngRCount = lngFRow - lngHRow - 1
        
        '列を取得する
        intColNm = .Range("KIFUSYA_NM").column
        intColAdr = .Range("ADR").column
        intColDt = .Range("DT").column
        intColSyokugyo = .Range("SYOKUGYO").column
        intColKoujoDetail = .Range("KOUJOGAKU_DETAIL_ONLY").column    '小計行を0とした金額(隠し列)
        intColSeqno = .Range("SEQ_NO").column
        intColZeigaku = .Range("ZEIGAKUKOUJYO").column
        
        lngZCount = 0
        
        For lngI = lngHRow + 1 To lngFRow - 1
        
            '寄附金（税額）控除が「必要」の場合
            If .Cells(lngI, intColZeigaku).value = "必要" Then
                
                '通し番号が空欄の場合
                If .Cells(lngI, intColSeqno).value = "" Then
                
                    lngZCount = lngZCount + 1
                    '適当な頭文字を付けて前回通し番号を生成
                    targetSeqNo = "E-" & lngZCount
                
                    ReDim Preserve str氏名(lngZCount) As String
                    ReDim Preserve str住所(lngZCount) As String
                    ReDim Preserve cur金額(lngZCount) As Currency
                    ReDim Preserve str職業(lngZCount) As String
                
                    '金額は該当行の金額のみを出力
                    sumKingaku = .Cells(lngI, intColKoujoDetail).value
                    
                    str氏名(lngZCount + lngUB) = .Cells(lngI, intColNm).value
                    str住所(lngZCount + lngUB) = .Cells(lngI, intColAdr).value
                    cur金額(lngZCount + lngUB) = sumKingaku
                    str職業(lngZCount + lngUB) = .Cells(lngI, intColSyokugyo).value
                
                'まだ処理していない通し番号の場合(処理済の通し番号行は無視する)
                ElseIf kifuDataSeq.AddWithOverlapCheck(.Cells(lngI, intColSeqno).value, lngI) = True Then
                '通し番号が空欄でなく、前回通し番号と異なる場合
                'ElseIf .Cells(LngI, intColSeqno).value <> targetSeqNo Then
                
                    lngZCount = lngZCount + 1
                    targetSeqNo = .Cells(lngI, intColSeqno).value

                    ReDim Preserve str氏名(lngZCount) As String
                    ReDim Preserve str住所(lngZCount) As String
                    ReDim Preserve cur金額(lngZCount) As Currency
                    ReDim Preserve str職業(lngZCount) As String

                    '金額は同一通し番号の合計を出力
                    sumKingaku = Application.WorksheetFunction.SumIf( _
                            .Range(.Cells(lngHRow + 1, intColSeqno), .Cells(lngFRow - 1, intColSeqno)), _
                            targetSeqNo, .Range(.Cells(lngHRow + 1, intColKoujoDetail), .Cells(lngFRow - 1, intColKoujoDetail)))
                        
                    dateNewest = CDate(.Cells(lngI, intColDt).value)      '最新の寄附日 に初期値をセット
                    lngRowNewst = lngI
                    
                    '/* 対象行～最終行までのデータを検索し、同一通し番号のうち「氏名」「住所」は寄附日が最新のものを取得する */
                    For lngRowSubLoop = lngI To lngFRow - 1
                        
                        '「必要」の指定があり、同じ通し番号か？
                        If .Cells(lngRowSubLoop, intColSeqno).value = targetSeqNo _
                            And .Cells(lngRowSubLoop, intColZeigaku).value = "必要" Then
                            
                            '最新の日付より新しいか？((最新が複数の場合は最も下にあるものとする))
                            dateThisRow = CDate(.Cells(lngRowSubLoop, intColDt).value)
                            If dateNewest <= dateThisRow Then
                                
                                '最新の日付と、その行を保持
                                dateNewest = dateThisRow
                                lngRowNewst = lngRowSubLoop
                            End If
                        End If
                    Next lngRowSubLoop
                    
                    '/* 氏名、金額等をセット */
                    str氏名(lngZCount + lngUB) = .Cells(lngRowNewst, intColNm).value
                    str住所(lngZCount + lngUB) = .Cells(lngRowNewst, intColAdr).value
                    str職業(lngZCount + lngUB) = .Cells(lngRowNewst, intColSyokugyo).value
                    cur金額(lngZCount + lngUB) = sumKingaku
                
                End If
            
            End If

        Next lngI
        
        lngUB = UBound(str氏名)
    
    End With

    Set wsSelect = Nothing
    Set wsSelect = Worksheets("申請者一覧")
    With wsSelect
    .Activate

    'ActiveSheet.Unprotect Password:=ProtectPass
    
    intLeftCol = .Range("左端").column
    intRightCol = .Range("右端").column
    lngHRow = .Range("行頭").Row
    lngFRow = .Range("行末").Row
    lngRCount = lngFRow - lngHRow - 1
    
    '前もって全セル色クリア
    Call CellColorChange(.Range(.Cells(lngHRow + 1, intLeftCol), .Cells(lngFRow - 1, .Range("KEY").column)), False)

    '既入力内容削除
    Set rngContents = .Range(lngHRow + 1 & ":" & lngFRow - 1)
    rngContents.ClearContents
    Set rngContents = Nothing
    
    '行数が足りない場合、行追加する
    If lngUB >= lngRCount Then

        .Range("行末").Cells(0, 1).Activate '行末よりひとつ前の行のセルをアクティブ
    
        .Rows(ActiveCell.Row).Select
            
        For lngI = lngRCount To lngUB
    
            Selection.Insert Shift:=xlShiftDown
    
        Next lngI
        '枠線引きなおし
        Call LineReDraw(wsSelect, lngHRow + 1, lngFRow + (lngUB - lngRCount), intLeftCol - 1, intRightCol)
    Else
    End If
    
    Call RowNoRebuild '行番号振りなおし
    
    For lngI = 1 To lngUB
    
        .Cells(lngHRow + lngI, .Range("KIFUSYA_NM").column).value = str氏名(lngI)
        .Cells(lngHRow + lngI, .Range("ADR").column).value = str住所(lngI)
        .Cells(lngHRow + lngI, .Range("KINGAKU").column).value = cur金額(lngI)
        .Cells(lngHRow + lngI, .Range("KEY").column).value = _
            str氏名(lngI) + CStr(cur金額(lngI)) + str住所(lngI) + str職業(lngI)
    
    Next lngI

    End With

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("その７内容取得")

End Sub
'申請者一覧シート.その７内容取得ボタンより起動
Sub IMP7W()

    Dim intResponse As Integer
    
    intResponse = MsgBox("「その7(1)」シートから「寄附金（税額）控除：必要」のデータを「申請者一覧」に取り込みます。" & vbCrLf & "「申請者一覧」のデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その7内容取得")
    If intResponse = vbYes Then
        '画面描画
        Call ScreenRedraw(False)
    
        '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
        Call CountTimeStart("その7内容取得")
        
        Call IMP7
        
        '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
        Call CountTimeStop("その7内容取得")
        
        '画面描画
        Call ScreenRedraw(True)
    End If

End Sub
-------------------------------------------------------------------------------
VBA MACRO ModuleIMP14.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleIMP14'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit


'8号様式（領収書等を徴し難かった支出の明細書）　「その14・15内容取得」ボタン押下処理
Public Sub IMP_14()
    
    On Error GoTo ErrorTrap:
    
    Dim intResponse As Integer
    
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    intResponse = MsgBox("「その14」及び「その15」の各シートから「領収書等を徴し難かったもの：領収書等を徴し難かった支出の明細書を作成する」のデータを「8号様式」に取り込みます。" & vbCrLf & "「8号様式」のデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
    intResponse = MsgBox("「その14」の各シート(経常経費（人件費を除く。）の内訳)及び「その15」の各シート(政治活動費の内訳)から「領収書等を徴し難かったもの：領収書等を徴し難かった支出の明細書を作成する」のデータを「15号様式」シート(領収書等を徴し難かった支出の明細書)に取り込みます。" & vbCrLf & "「15号様式」シートのデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    If intResponse = vbNo Then
        Exit Sub
    End If
    
    '画面描画オフ
    Call ScreenRedraw(False)
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    Call CountTimeStart("その14・15内容取得(8号様式)")
    Call CountTimeStart("その14・15内容取得(15号様式)")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    '作成実行
    Call MakeSyuushi08(False)
    
    '画面描画オン
    Call ScreenRedraw(True)
    
    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    Call CountTimeStop("その14・15内容取得(8号様式)")
    Call CountTimeStop("その14・15内容取得(15号様式)")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("その14・15内容取得")
    
End Sub



'その14・15シートから、領収書等を徴し難かった支出の明細書を作成する
Public Sub MakeSyuushi08(isSetJijyou As Boolean)


    'セル最大65536  long

    Dim wsSelect As Worksheet
    Dim intRColumn As Integer
    Dim lngRCount As Long
    Dim lngNasiCCount As Long
    Dim lngUB As Long
    Dim strKNo As Integer
    Dim strSNo As Integer '（その14）、（その15）の切り分け
    Dim lngI As Long
    Dim str項目() As String, str適用() As String, dbl金額() As Double, str年月日() As String
    Dim str事情() As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    Dim LoopMax As Integer
    
    For strSNo = 14 To 15
        'シート毎のループ回数設定
        If strSNo = 14 Then
            LoopMax = 3
        Else
            LoopMax = 9
        End If
    
        For strKNo = 1 To LoopMax 'その14(1)～その14(3)、その15(1)～その15(9)
        
            For Each wsSelect In Worksheets
            With wsSelect
        
                If .name Like "その" & strSNo & "(" & strKNo & ")*" Then
                
                    lngHRow = .Range("行頭").Row
                    lngFRow = .Range("行末").Row
                    lngRCount = lngFRow - lngHRow - 1
                
                    intRColumn = .Range("RYOUSYU").column '「領収書を徴し難かったもの」項目
                    
                    lngNasiCCount = 0
                    
                    For lngI = lngHRow + 1 To lngFRow - 1
                    
                        If .Cells(lngI, intRColumn).value = "領収書等を徴し難かった支出の明細書を作成する" Then
                            
                           lngNasiCCount = lngNasiCCount + 1
                        
                        End If
            
                    Next lngI
                    
                    If lngNasiCCount = 0 Then
                    Else
                    
                        ReDim Preserve str項目(1 To lngUB + lngNasiCCount) As String
                        ReDim Preserve str適用(1 To lngUB + lngNasiCCount) As String
                        ReDim Preserve dbl金額(1 To lngUB + lngNasiCCount) As Double
                        ReDim Preserve str年月日(1 To lngUB + lngNasiCCount) As String
                        If isSetJijyou Then
                            ReDim Preserve str事情(1 To lngUB + lngNasiCCount) As String
                        End If
                        
                        lngNasiCCount = 0
                        
                        For lngI = lngHRow + 1 To lngFRow - 1
                        
                            If .Cells(lngI, intRColumn).value = "領収書等を徴し難かった支出の明細書を作成する" Then
                                
                                lngNasiCCount = lngNasiCCount + 1
                            
                                str項目(lngNasiCCount + lngUB) = Mid(.Range("区分").value, 3, Len(.Range("区分").value) - 2)
                                str適用(lngNasiCCount + lngUB) = .Cells(lngI, .Range("MOKUTEKI").column).value
                                dbl金額(lngNasiCCount + lngUB) = .Cells(lngI, .Range("KINGAKU").column).value
                                str年月日(lngNasiCCount + lngUB) = Format(.Cells(lngI, .Range("DT").column).value, "yyyy/mm/dd")
                                '事情は、会計帳簿連携時のみ設定された状態になる(非表示項目)
                                If isSetJijyou Then
                                    str事情(lngNasiCCount + lngUB) = .Cells(lngI, .Range("KAIKEI_JIJYOU").column).value
                                End If
                            
                            End If
                
                        Next lngI
                    
                        lngUB = UBound(str項目) 'str項目の配列数の最大値
                    
                    End If
        
                End If
            
            End With
            Next wsSelect
        
        Next strKNo
    Next strSNo
    
    Set wsSelect = Nothing

'@@01MOD START
'    Set wsSelect = Worksheets("8号様式")
'    With wsSelect
'    .Activate
'    'ActiveSheet.Unprotect Password:=ProtectPass
'    intLeftCol = .Range("左端").Column
'    intRightCol = .Range("右端").Column
'    lngHRow = .Range("行頭").Row
'    lngFRow = .Range("行末").Row
'    lngRCount = lngFRow - lngHRow - 1
'
'    '前もって全セル色クリア
'    Call CellColorChange(.Range(.Cells(lngHRow + 1, intLeftCol), .Cells(lngFRow - 1, intRightCol)), False)

'    '既入力内容削除
'    Set rngContents = .Range(lngHRow + 1 & ":" & lngFRow - 1)
'    rngContents.ClearContents
'    Set rngContents = Nothing
'
'    '行数が足りない場合、行追加する
'    If lngUB > lngRCount Then
'
'        .Range("行末").Cells(0, 1).Activate '行末よりひとつ前の行のセルをアクティブ
'
'        .Rows(ActiveCell.Row).Select
'
'        For LngI = lngRCount To lngUB
'
'            Selection.Insert Shift:=xlShiftDown
'
'        Next LngI
'        '枠線引きなおし
'        Call LineReDraw(wsSelect, lngHRow + 1, lngFRow + (lngUB - lngRCount), intLeftCol - 1, intRightCol)
'    Else
'    End If
'
'    Call RowNoRebuild '行番号振りなおし
'
'    For LngI = 1 To lngUB
'
'        .Cells(lngHRow + LngI, .Range("KOMOKU").Column).value = str項目(LngI)
'        .Cells(lngHRow + LngI, .Range("TEKIYOU").Column).value = str適用(LngI)
'        .Cells(lngHRow + LngI, .Range("KINGAKU").Column).value = dbl金額(LngI)
'        .Cells(lngHRow + LngI, .Range("DT").Column).value = str年月日(LngI)
'        '事情は、会計帳簿連携時のみ設定
'        If isSetJijyou Then
'            .Cells(lngHRow + LngI, .Range("JIJYOU").Column).value = str事情(LngI)
'        End If
'
'    Next LngI
'
'    End With

    Dim str金額() As String
    Dim i As Long
    
    ReDim str金額(lngUB)
    For i = 1 To lngUB
        str金額(i) = dbl金額(i) & ""
    Next

    Call SetYousiki08(lngUB, str項目, str適用, str金額, str年月日, str事情, isSetJijyou)
'@@01MOD END

End Sub

'@@01MOD START
'-------------------------------------------------------------------
' 関数名 ： SetYousiki08
' 機  能 ： 8号様式の明細にデータをセット
' 引  数 ： lngUB       要素数
' 　　　 ： koumoku     項目（配列）
' 　　　 ： tekiyou     摘要（配列）
' 　　　 ： kingaku     金額（配列）
' 　　　 ： dt          日付（配列）
' 　　　 ： jijyou      事情（配列）
' 　　　 ： isSetJijyou 事情出力フラグ
' 　　　 ：
' 戻り値 ： 無し
'-------------------------------------------------------------------
Sub SetYousiki08(lngUB As Long, koumoku() As String, tekiyou() As String, _
                    kingaku() As String, dt() As String, jijyou() As String, isSetJijyou As Boolean)

    Const HEADDER_ROWCNT As Integer = 7     'ヘッダー行数
    Const MIDDLE_ROWCNT As Integer = 15     '一覧表行数
    Const FOOTER_ROWCNT As Integer = 4      'フッター行数
    
    Dim wsSelect As Worksheet
    Dim cursolRow As Long                   'データ差込み位置（行）
    Dim pageCnt As Long                     '操作ページ
    Dim cursolPageCnt As Long               '行追加による最下行ページ
   
    Dim lngI As Long
    Dim kaiPageArray() As Long              '全改ページ行保持用
    Dim page1RowCnt As Integer              '1ページ目の一覧表行数
    Dim page1AddRowCnt As Integer           '1ページ目の一覧表追加必要行数
    Dim i As Integer
    Dim k As Long
    
    Dim leftCol As Integer
    Dim rightCol As Integer
    Dim lngHRow As Long
    Dim lngFRow As Long
        
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Set wsSelect = Worksheets("8号様式")
    Set wsSelect = Worksheets("15号様式")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    With wsSelect
    .Activate
    
        '■1ページ目初期化（テンプレート作成）
        leftCol = .Range("左端").column
        rightCol = .Range("右端").column
        lngHRow = .Range("行頭").Row
        lngFRow = .Range("GYOUMATSU").Row
        
        '一覧表の入力内容クリア
        Call CellColorChange(.Range(.Cells(lngHRow + 1, leftCol), .Cells(lngFRow - 1, rightCol)), False)
        
        '一覧表の色クリア
        .Range(lngHRow + 1 & ":" & lngFRow - 1).ClearContents
        
        '一覧表を15行に設定
        '現在の1ページ目の明細行数
        page1RowCnt = (.Range("GYOUMATSU").Row - 1) - (.Range("ICHIREN_NO").Row)
        
        '1ページ目の明細行に追加必要な行数
        page1AddRowCnt = MIDDLE_ROWCNT - page1RowCnt
        
        '1ページ目の明細行2行目をコピー＆必要行数を挿入処理
        If page1AddRowCnt > 0 Then
            Rows(HEADDER_ROWCNT + 2 & ":" & HEADDER_ROWCNT + 2).Copy
            Rows(HEADDER_ROWCNT + 2 & ":" & HEADDER_ROWCNT + 2 + (page1AddRowCnt - 1)).Insert Shift:=xlDown
        End If
        
        '２ページ目以降削除
'2021/01/28 障害　備考追加に基づく削除範囲修正
        'Rows((HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT) + 1 & ":65536").Delete Shift:=xlUp
        If .Range("行末").Row + 4 > (HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT) + 1 Then
            Rows((HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT) + 1 & ":" & .Range("行末").Row + 3).Delete Shift:=xlUp
        End If
'2021/01/28 ここまで
        
        '操作ページ、カーソル位置ページ、カーソル位置の行を初期化
        pageCnt = 1
        cursolPageCnt = 2
        cursolRow = HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT
        
        'データが無い場合処理終了
        If lngUB = 0 Then
            '左上にカーソルを設定
            Range("A1").Select
            
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
            '定義名設定
            'ActiveWorkbook.Names.Add name:="行末", RefersToR1C1:="='8号様式'!R" & (HEADDER_ROWCNT + MIDDLE_ROWCNT + 1) & "C3"
            ActiveWorkbook.Names.Add name:="行末", RefersToR1C1:="='15号様式'!R" & (HEADDER_ROWCNT + MIDDLE_ROWCNT + 1) & "C3"
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
            
            Exit Sub
        End If
        
        'ウインドウ枠の固定解除
        ActiveWindow.FreezePanes = False
'2021/01/28 障害　環境によって会計責任者行が2ページ目になって処理が動かないため印刷倍率調整
        If .PageSetup.Pages.Count > 1 Then
            Do Until .PageSetup.Pages.Count = 1
                .PageSetup.Zoom = .PageSetup.Zoom - 1
                .PageSetup.PrintArea = "A1:G" & .Range("行末").Row + 3
            Loop
        End If
'2021/01/28 ここまで
        
        'データ数分ループ
        For lngI = 1 To lngUB
    
            '処理対象ページカウントとカーソル位置ページが異なる場合の処理
            If pageCnt <> cursolPageCnt Then
            
                '改ページ設定
                ReDim Preserve kaiPageArray(pageCnt)
                kaiPageArray(pageCnt) = cursolRow + 1
                .HPageBreaks.Add before:=Range("A" & kaiPageArray(pageCnt))
            
                '雛形（1ページ目）からフッターをコピー＆挿入処理
                Rows(HEADDER_ROWCNT + MIDDLE_ROWCNT + 1 & ":" & HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT).Copy
                Rows(cursolRow + 1 & ":" & cursolRow + 1).Insert Shift:=xlDown
                
                '雛形（1ページ目）からヘッダーをコピー＆挿入処理
                Rows("1:" & HEADDER_ROWCNT).Copy
                Rows(cursolRow + 1 & ":" & cursolRow + 1).Insert Shift:=xlDown
                
                'カーソル行をヘッダー下の一覧位置に設定
                cursolRow = cursolRow + HEADDER_ROWCNT
                            
                '２ページ目のみに定義名設定
                If cursolPageCnt = 2 Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                    'ActiveWorkbook.Names.Add name:="GYOUMATSU", RefersToR1C1:="='8号様式'!R" & cursolRow + 1 & "C3"
                    ActiveWorkbook.Names.Add name:="GYOUMATSU", RefersToR1C1:="='15号様式'!R" & cursolRow + 1 & "C3"
'2021/01/28 障害　備考追加に基づく印刷範囲指定を一度リセット
                    .PageSetup.PrintArea = ""
'2021/01/28 ここまで
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                End If
                            
                '処理対象ページ数をカーソル位置ページ数に設定
                pageCnt = cursolPageCnt
                
                '全改ページ再設定
                For k = 1 To UBound(kaiPageArray)
                    .HPageBreaks.Add before:=Range("A" & kaiPageArray(k))
                Next
                
            End If
            
            '■データ設定
            '雛形（1ページ目の2行目）から明細行をコピー＆ペースト処理
            Rows(HEADDER_ROWCNT + 2 & ":" & HEADDER_ROWCNT + 2).Copy
            Rows(cursolRow + 1 & ":" & cursolRow + 1).Insert Shift:=xlDown
            
            '一覧にデータ設定
            Cells(cursolRow + 1, Range("ICHIREN_NO").column) = lngI
            Cells(cursolRow + 1, Range("KOMOKU").column) = koumoku(lngI)
            Cells(cursolRow + 1, Range("TEKIYOU").column) = tekiyou(lngI)
            Cells(cursolRow + 1, Range("KINGAKU").column) = kingaku(lngI)
            Cells(cursolRow + 1, Range("DT").column) = dt(lngI)
            
            If isSetJijyou Then
                Cells(cursolRow + 1, Range("JIJYOU").column) = jijyou(lngI)
            End If
            
            
            '■行を追加したことで改ページが必要かどうかの確認処理
            '現在のMAXページを取得
            cursolPageCnt = GetMaxPage()
            
            'ページが変わる場合、追加行を削除し次ページで追加する
            If pageCnt <> cursolPageCnt Then
                
                '追加した行を削除
                Rows(cursolRow + 1 & ":" & cursolRow + 1).Delete
                
                'カーソル行を次ページに設定
                cursolRow = cursolRow + FOOTER_ROWCNT
                
                'ループカウンタ -１インクリメント
                lngI = lngI - 1
            Else
                
                'カーソル行を次行に設定
                cursolRow = cursolRow + 1
            
            End If
            
            DoEvents
        
        Next lngI
    
        '空行追加処理（最大14行追加）
        For lngI = 1 To 14
        
            '■空行設定
            '雛形（1ページ目）から明細行をコピー＆ペースト処理
            Rows(HEADDER_ROWCNT + 2 & ":" & HEADDER_ROWCNT + 2).Copy
            Rows(cursolRow + 1 & ":" & cursolRow + 1).Insert Shift:=xlDown
            Cells(cursolRow + 1, Range("ICHIREN_NO").column) = ""
                    
            
            '■行を追加したことで改ページが必要かどうかの確認処理
            '現在のMAXページを取得
            cursolPageCnt = GetMaxPage()
            
            'ページが変わる場合、追加行を削除し空行追加処理終了
            If pageCnt <> cursolPageCnt Then
                '追加した行を削除
                Rows(cursolRow + 1 & ":" & cursolRow + 1).Delete
                Exit For
                
            Else
                'カーソル行を次行に設定
                cursolRow = cursolRow + 1
            
            End If
                
            DoEvents
        Next
        
        'テンプレートページ削除（※ボタンより下）
        Rows("4:" & HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT + 3).Delete Shift:=xlUp
    
        '１ページ目に定義名設定
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'        ActiveWorkbook.Names.Add name:="DISP_CHECK_STATUS", RefersToR1C1:="='8号様式'!R1C7"
'        ActiveWorkbook.Names.Add name:="DT", RefersToR1C1:="='8号様式'!R7C6"
'        ActiveWorkbook.Names.Add name:="ICHIREN_NO", RefersToR1C1:="='8号様式'!R7C2"
'        ActiveWorkbook.Names.Add name:="JIJYOU", RefersToR1C1:="='8号様式'!R7C7"
'        ActiveWorkbook.Names.Add name:="KINGAKU", RefersToR1C1:="='8号様式'!R7C5"
'        ActiveWorkbook.Names.Add name:="KOMOKU", RefersToR1C1:="='8号様式'!R7C3"
'        ActiveWorkbook.Names.Add name:="STATUS_ERR_CHECK", RefersToR1C1:="=メニュー!R65C10"
'        ActiveWorkbook.Names.Add name:="TEKIYOU", RefersToR1C1:="='8号様式'!R7C4"
'        ActiveWorkbook.Names.Add name:="右端", RefersToR1C1:="='8号様式'!R7C7"
'        ActiveWorkbook.Names.Add name:="行頭", RefersToR1C1:="='8号様式'!R7C3"
'        ActiveWorkbook.Names.Add name:="左端", RefersToR1C1:="='8号様式'!R7C3"
'        ActiveWorkbook.Names.Add name:="範囲右端", RefersToR1C1:="='8号様式'!R7C7"
'        ActiveWorkbook.Names.Add name:="行末", RefersToR1C1:="='8号様式'!R" & cursolRow + 1 - (HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT) & "C3"
        ActiveWorkbook.Names.Add name:="DISP_CHECK_STATUS", RefersToR1C1:="='15号様式'!R1C7"
        ActiveWorkbook.Names.Add name:="DT", RefersToR1C1:="='15号様式'!R7C6"
        ActiveWorkbook.Names.Add name:="ICHIREN_NO", RefersToR1C1:="='15号様式'!R7C2"
        ActiveWorkbook.Names.Add name:="JIJYOU", RefersToR1C1:="='15号様式'!R7C7"
        ActiveWorkbook.Names.Add name:="KINGAKU", RefersToR1C1:="='15号様式'!R7C5"
        ActiveWorkbook.Names.Add name:="KOMOKU", RefersToR1C1:="='15号様式'!R7C3"
        ActiveWorkbook.Names.Add name:="STATUS_ERR_CHECK", RefersToR1C1:="=メニュー!R65C10"
        ActiveWorkbook.Names.Add name:="TEKIYOU", RefersToR1C1:="='15号様式'!R7C4"
        ActiveWorkbook.Names.Add name:="右端", RefersToR1C1:="='15号様式'!R7C7"
        ActiveWorkbook.Names.Add name:="行頭", RefersToR1C1:="='15号様式'!R7C3"
        ActiveWorkbook.Names.Add name:="左端", RefersToR1C1:="='15号様式'!R7C3"
        ActiveWorkbook.Names.Add name:="範囲右端", RefersToR1C1:="='15号様式'!R7C7"
        ActiveWorkbook.Names.Add name:="行末", RefersToR1C1:="='15号様式'!R" & cursolRow + 1 - (HEADDER_ROWCNT + MIDDLE_ROWCNT + FOOTER_ROWCNT) & "C3"
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        'ウインドウ枠の固定（ボタン位置固定）
        Rows("3:3").Select
        ActiveWindow.FreezePanes = True
        
        '左上にカーソルを設定
        Range("A1").Select

'2021/01/28 障害　備考を印刷範囲から外す
        .PageSetup.PrintArea = "A1:G" & (.Range("行末").Row + FOOTER_ROWCNT - 1)
'2021/01/28 ここまで
    
    End With

End Sub
'@@01MOD ENDEND


Sub IMP14EPre()
    
    On Error GoTo ErrorTrap:
    
    Dim intResponse As Integer
    
    intResponse = MsgBox("「その14」の各シート(経常経費（人件費を除く。）の内訳)及び「その15」の各シート(政治活動費の内訳)から全てのデータを「領収書一覧」シート(領収書等が添付されるべき支出の一覧)に取り込みます。" & vbCrLf & "「領収書一覧」シートのデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
    If intResponse = vbNo Then
        Exit Sub
    End If
    
    Worksheets("領収書一覧").Activate
    
    Call ScreenRedraw(False)    '画面描画OFF
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStart("その14・15内容取得(領収書一覧)")
    
    Call IMP14E

    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStop("その14・15内容取得(領収書一覧)")

    Call ScreenRedraw(True)     '画面描画ON

    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("その14・15内容取得")


End Sub


'領収書一覧シートの　「その14・15内容取得」ボタン押下処理
Sub IMP14E()

    
    '「その14」及び「その15」の各シートから、全ての支出明細を抽出するように変更　2008/06/26

    Dim wsSelect As Worksheet
    Dim intRColumn As Integer
    Dim lngRCount As Long
    Dim lngNasiCCount As Long
    Dim lngUB As Long
    Dim strKNo As Integer
    Dim strSNo As Integer
    Dim lngI As Long
    Dim lng項番() As Long, str項目() As String, str費目() As String, str支出の目的() As String, dbl金額() As Double, str年月日() As String, str氏名() As String, str住所() As String, str徴難明細() As String, str支出目的書() As String
    Dim str支出の目的T As String, dbl金額T As Double, str年月日T As String, str氏名T As String, str住所T As String, str徴難明細T As String, str支出目的書T As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    Dim intResponse As Integer
    Dim LoopMax As Integer
    
    RyousyuUMU = False
    
'    intResponse = MsgBox("「その14」及び「その15」の各シートから全てのデータを「領収書一覧」に取り込みます。" & vbCrLf & "「領収書一覧」のデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
'    If intResponse = vbNo Then
'        Exit Sub
'    End If

    For strSNo = 14 To 15 'その14～その15
        'シート毎のループ回数設定
        If strSNo = 14 Then
            LoopMax = 3
        Else
            LoopMax = 9
        End If

        For strKNo = 1 To LoopMax 'その14(1)～その14(3)、その15(1)～その15(9)
        
            For Each wsSelect In Worksheets
            With wsSelect
        
                If .name Like "その" & strSNo & "(" & strKNo & ")*" Then
                
                    lngHRow = .Range("行頭").Row
                    lngFRow = .Range("行末").Row
                    lngRCount = lngFRow - lngHRow - 1
                
                    intRColumn = .Range("RYOUSYU").column '「領収書を徴し難かったもの」項目
                    
                    lngNasiCCount = 0
                    
                    For lngI = lngHRow + 1 To lngFRow - 1
                    
                        '全ての支出明細を抽出するように変更　2008/06/26
                        'If .Cells(lngI, intRColumn).Value = "" Then
    
                            str支出の目的T = .Cells(lngI, .Range("MOKUTEKI").column).value
                            dbl金額T = .Cells(lngI, .Range("KINGAKU").column).value
                            str年月日T = Format(.Cells(lngI, .Range("DT").column).value, "yyyy/mm/dd")
                            str氏名T = .Cells(lngI, .Range("NM").column).value
                            str住所T = .Cells(lngI, .Range("ADR").column).value
                            If .Cells(lngI, intRColumn).value = "領収書等を徴し難かった支出の明細書を作成する" Then
                                str徴難明細T = "○"
                            Else
                                str徴難明細T = ""
                            End If
                            If .Cells(lngI, intRColumn).value = "振込明細書に係る支出目的書を作成する" Then
                                str支出目的書T = "○"
                            Else
                                str支出目的書T = ""
                            End If
                            
                            If str支出の目的T = "" And dbl金額T = 0 And str年月日T = "" And str氏名T = "" And str住所T = "" And str徴難明細T = "" And str支出目的書T = "" Then
                            Else
                                
                                '全ての支出明細を抽出するように変更　2008/06/26
                                'If dbl金額T >= 50000 Then
                                    lngNasiCCount = lngNasiCCount + 1
                                    ReDim Preserve lng項番(1 To lngUB + lngNasiCCount) As Long
                                    ReDim Preserve str項目(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str費目(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str支出の目的(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve dbl金額(1 To lngUB + lngNasiCCount) As Double
                                    ReDim Preserve str年月日(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str氏名(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str住所(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str徴難明細(1 To lngUB + lngNasiCCount) As String
                                    ReDim Preserve str支出目的書(1 To lngUB + lngNasiCCount) As String
                                    
                                    lng項番(lngUB + lngNasiCCount) = lngUB + lngNasiCCount
                                    str項目(lngUB + lngNasiCCount) = Mid(.Range("区分").value, 3, Len(.Range("区分").value) - 2)
                                    If strSNo = 14 Then
                                        'その14の場合、費目は空欄
                                    Else
                                        str費目(lngUB + lngNasiCCount) = .Range("HIMOKU").value
                                    End If
                                    str支出の目的(lngUB + lngNasiCCount) = str支出の目的T
                                    dbl金額(lngUB + lngNasiCCount) = dbl金額T
                                    str年月日(lngUB + lngNasiCCount) = str年月日T
                                    str氏名(lngUB + lngNasiCCount) = str氏名T
                                    str住所(lngUB + lngNasiCCount) = str住所T
                                    str徴難明細(lngUB + lngNasiCCount) = str徴難明細T
                                    str支出目的書(lngUB + lngNasiCCount) = str支出目的書T
'                                End If
                            
                            End If
    
'                        End If
            
                    Next lngI
    
    
                    If lngNasiCCount = 0 Then
                    Else
                        lngUB = UBound(str項目) 'str項目の配列数の最大値
                    End If
    
                End If
            
            End With
            Next wsSelect
        
        Next strKNo
    Next strSNo

    Set wsSelect = Nothing
    Set wsSelect = Worksheets("領収書一覧")
    With wsSelect
    .Activate

    'ActiveSheet.Unprotect Password:=ProtectPass
    
    intLeftCol = .Range("左端").column
    intRightCol = .Range("右端").column
    lngHRow = .Range("行頭").Row
    lngFRow = .Range("行末").Row
    lngRCount = lngFRow - lngHRow - 1
    
    '既入力内容削除
    Set rngContents = .Range(lngHRow + 1 & ":" & lngFRow - 1)
    rngContents.ClearContents
    Set rngContents = Nothing
    
    '行数が足りない場合、行追加する
    If lngUB > lngRCount Then

        .Range("行末").Cells(0, 1).Activate '行末よりひとつ前の行のセルをアクティブ
    
        .Rows(ActiveCell.Row).Select
            
        For lngI = lngRCount To lngUB - 1
    
            Selection.Insert Shift:=xlShiftDown
    
        Next lngI
        '枠線引きなおし
        Call LineReDraw(wsSelect, lngHRow + 1, lngFRow + (lngUB - lngRCount) - 1, intLeftCol - 1, intRightCol)

    '行数が多い場合、行削除する
    ElseIf lngUB < lngRCount Then

        For lngI = lngUB + 2 To lngRCount - 1 '2は残る行数
        
            .Range("行末").Cells(-1, 1).Activate '行末よりひとつ前の前の行のセルをアクティブ
        
            .Rows(ActiveCell.Row).Select
            
            Selection.Delete
    
        Next lngI

    Else
    End If
    
    For lngI = 1 To lngUB
    
        .Cells(lngHRow + lngI, .Range("KOUBAN").column).value = lng項番(lngI)
        .Cells(lngHRow + lngI, .Range("KOMOKU").column).value = str項目(lngI)
        .Cells(lngHRow + lngI, .Range("HIMOKU").column).value = str費目(lngI)
        .Cells(lngHRow + lngI, .Range("MOKUTEKI").column).value = str支出の目的(lngI)
        .Cells(lngHRow + lngI, .Range("KINGAKU").column).value = dbl金額(lngI)
        .Cells(lngHRow + lngI, .Range("DT").column).value = str年月日(lngI)
        .Cells(lngHRow + lngI, .Range("NM").column).value = str氏名(lngI)
        .Cells(lngHRow + lngI, .Range("ADR").column).value = str住所(lngI)
        .Cells(lngHRow + lngI, .Range("RYOUSYU_1").column).value = str徴難明細(lngI)
        .Cells(lngHRow + lngI, .Range("RYOUSYU_2").column).value = str支出目的書(lngI)

    Next lngI

    End With
    
    '明細行が設定された場合、領収書一覧作成フラグをONにする：メニューの印刷チェックボックス操作用
    If lngUB > 0 Then
        RyousyuUMU = True
    End If
    

End Sub

Sub IMP14to13EPre()
    
'    Dim nmsSelWS As Names, wsSelect As Worksheet
'    Dim LngI As Long
'    Set wsSelect = Worksheets("メニュー")
'    Set nmsSelWS = wsSelect.Names
    
'    If gintCheckStatus = CHECK_STATUS_OK Then
'    Else
'        MsgBox "その14内容取得の前に、項目チェックを行います。", vbInformation, "その14内容取得"
'
'        GaijiChkFlg = False
'        Call ValidationCheck_All
'
'        If gintCheckStatus = CHECK_STATUS_OK Then
'        Else
'            Exit Sub
'        End If
'    End If
    
'    For lngI = 1 To nmsSelWS.Count
'        If nmsSelWS(lngI).Name Like wsSelect.Name & "!Eその14*" Then
'            If wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.Column).Value = True Then
'                MsgBox "項目チェックでその14にエラーが見つかりました。エラーを修正したのち、実行してください。", vbCritical, "その14内容取得"
'                Exit Sub
'            End If
'        ElseIf nmsSelWS(lngI).Name Like wsSelect.Name & "!Eその1" Then
'            If wsSelect.Cells(nmsSelWS(lngI).RefersToRange.Row, nmsSelWS(lngI).RefersToRange.Column).Value = True Then
'                MsgBox "項目チェックでその1にエラーが見つかりました。エラーを修正したのち、実行してください。", vbCritical, "その14内容取得"
'                Exit Sub
'            End If
'        End If
'    Next
    
    Worksheets("その13").Activate
    
    Call IMP14to13

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： IMP14to13
  ' 機  能 ： （その１４）シートから（その１３）の経常経費を設定
'-------------------------------------------------------------------
Sub IMP14to13()

    'セル最大65536  long

    Dim wsSelect As Worksheet
    Dim strKNo As Integer
    Dim dbl金額(1 To 3) As Double
    Dim intResponse As Integer
    
    Dim ThruYear_kbn As Boolean

    '資金管理団体あるいは国会議員関係団体の通年判定
    Set wsSelect = Worksheets("その1")
    ThruYear_kbn = IsGiinSikinFullYear(wsSelect)
    Set wsSelect = Nothing
    
    If ThruYear_kbn = True Then
    Else
        'B-CCL-S007
        MsgBox "この機能は、通年で国会議員関係政治団体又は資金管理団体に該当している団体のみ実行できます。" & vbCrLf & vbCrLf & "よって、年の途中で国会議員関係政治団体や資金管理団体に該当しなくなった団体など、上記以外の設定となっている団体は実行できません。", vbCritical, "その14内容取得"
        Exit Sub
    End If

    intResponse = MsgBox("「その14」のシートから「２．光熱水費」「３．備品・消耗品費」「４．事務所費」の各合計を取り込みます。" & vbCrLf & "入力済みの「(2)光熱水費」「(3)備品・消耗品費」「(4)事務所費」の金額は更新されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14内容取得")
    If intResponse = vbNo Then
        Exit Sub
    End If
    
    For strKNo = 1 To 3 'その14(1)～その14(3)
    
        For Each wsSelect In Worksheets
        With wsSelect
    
            If .name Like "その14(" & strKNo & ")*" Then
                        
                dbl金額(strKNo) = .Range("KINGAKU_GK_HIDE").value
    
            End If
        
        End With
        Next wsSelect
    
    Next strKNo

    Set wsSelect = Nothing
    Set wsSelect = Worksheets("その13")
    With wsSelect
    .Activate

        .Range("KOUNETU_GK").value = dbl金額(1)
        .Range("BIHIN_GK").value = dbl金額(2)
        .Range("JIMUSYO_GK").value = dbl金額(3)

    End With

End Sub
'@@01MOD START
'-------------------------------------------------------------------
' 関数名 ： GetMaxPage
' 機  能 ： 最大ページを取得
' 引  数 ： 無し
' 　　　 ：
' 戻り値 ： 移動ページ（数値）
'-------------------------------------------------------------------
Public Function GetMaxPage()
    
    Dim lastpage As Long
    
    '縦方向最終改ページ数取得
    lastpage = ActiveSheet.HPageBreaks.Count
    
    GetMaxPage = lastpage
    
End Function
'@@01MOD END








-------------------------------------------------------------------------------
VBA MACRO ModuleIMP14to82.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleIMP14to82'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'8号様式の2シートの右端の隠し列（番号を振って、どこまでデータがあるかを示したもの..）
Private Const COL_GUIDE As Long = 7

'8号様式の2（振込明細書に係る支出目的書）「その14・15内容取得」ボタン押下処理
Public Sub IMP14to82()

    On Error GoTo ErrorTrap:

    Dim intResponse As Integer
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'intResponse = MsgBox("「その14」及び「その15」の各シートから「領収書等を徴し難かったもの：振込明細書に係る支出目的書を作成する」" & vbCrLf & "のデータを「8号様式の2」に取り込みます。" & vbCrLf & "「8号様式の2」のデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
    intResponse = MsgBox("「その14」の各シート(経常経費（人件費を除く。）の内訳)及び「その15」の各シート(政治活動費の内訳)から「領収書等を徴し難かったもの：振込明細書に係る支出目的書を作成する」" & vbCrLf & "のデータを「16号様式」シートに取り込みます。" & vbCrLf & "「16号様式」シートのデータはすべて削除されますがよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    If intResponse = vbNo Then
        Exit Sub
    End If
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Call CountTimeStart("その14・15内容取得(8号様式の2)")
    Call CountTimeStart("その14・15内容取得(16号様式)")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    '画面描画オフ
    Call ScreenRedraw(False)
    
    '作成実行
    Call MakeSyuushi0802
    
    '画面描画オン
    Call ScreenRedraw(True)

    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Call CountTimeStop("その14・15内容取得(8号様式の2)")
    Call CountTimeStop("その14・15内容取得(16号様式)")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("その14・15内容取得")
    
End Sub

'8号様式の2（振込明細書に係る支出目的書）を作成する
Public Sub MakeSyuushi0802()

    'セル最大65536  long

    Dim wsSelect As Worksheet
    Dim intRColumn As Integer
    Dim lngRCount As Long
    Dim lngNasiCCount As Long
    Dim lngUB As Long
    Dim strKNo As Integer
    Dim strSNo As Integer '（その14）、（その15）の切り分け
    Dim lngI As Long
    Dim str項目() As String, str適用() As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    Dim LoopMax As Integer
    Dim meisai_low As Long
    Dim inst_low As Long
    lngUB = 0
    
    For strSNo = 14 To 15
        'シート毎のループ回数設定
        If strSNo = 14 Then
            LoopMax = 3
        Else
            LoopMax = 9
        End If
    
        For strKNo = 1 To LoopMax 'その14(1)～その14(3)、その15(1)～その15(9)
        
            For Each wsSelect In Worksheets
            With wsSelect
        
                If .name Like "その" & strSNo & "(" & strKNo & ")*" Then
                
                    lngHRow = .Range("行頭").Row
                    lngFRow = .Range("行末").Row
                    lngRCount = lngFRow - lngHRow - 1
                
                    intRColumn = .Range("RYOUSYU").column '「領収書を徴し難かったもの」項目
                    
                    lngNasiCCount = 0
                    
                    For lngI = lngHRow + 1 To lngFRow - 1
                    
                        If .Cells(lngI, intRColumn).value = "振込明細書に係る支出目的書を作成する" Then
                            
                           lngNasiCCount = lngNasiCCount + 1
                        
                        End If
            
                    Next lngI
                    
                    If lngNasiCCount = 0 Then
                    Else
                    
                        ReDim Preserve str項目(1 To lngUB + lngNasiCCount) As String
                        ReDim Preserve str適用(1 To lngUB + lngNasiCCount) As String
                        
                        lngNasiCCount = 0
                        
                        For lngI = lngHRow + 1 To lngFRow - 1
                        
                            If .Cells(lngI, intRColumn).value = "振込明細書に係る支出目的書を作成する" Then
                                
                                lngNasiCCount = lngNasiCCount + 1
                            
                                str項目(lngNasiCCount + lngUB) = Mid(.Range("区分").value, 3, Len(.Range("区分").value) - 2)
                                str適用(lngNasiCCount + lngUB) = .Cells(lngI, .Range("MOKUTEKI").column).value
                            
                            End If
                
                        Next lngI
                    
                        lngUB = UBound(str項目) 'str項目の配列数の最大値
                    
                    End If
        
                End If
            
            End With
            Next wsSelect
        
        Next strKNo
    Next strSNo
    
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Set wsSelect = Worksheets("8号様式の2")
    Set wsSelect = Worksheets("16号様式")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
'    With wsSelect
    wsSelect.Activate

    ' *** 様式のページを増減し、データを設定する ***
    Call PutSelectedDataFurikomi(wsSelect, lngUB, str項目, str適用)


' 2008/9/6 性能向上のため修正
'    '既存のデータをクリア
'    'G列に行番号が設定されてない行を削除する
'    meisai_low = 16
'    Do Until .Cells(meisai_low, 7).value = ""
'        meisai_low = meisai_low + 1
'    Loop
'    .Range(.Cells(16, 1), .Cells(meisai_low, 1)).EntireRow.Delete
'    .Cells(9, 2).value = ""
'    .Cells(9, 4).value = ""
'
'    '背景色をリセット
'    Call CellColorChange(.Range("KOMOKU"), False)
'    Call CellColorChange(.Range("TEKIYOU"), False)
'
'
'    '様式を複写しながら、データをセット
'    meisai_low = 9
'    inst_low = 16
'    For LngI = 1 To lngUB
'
'        .Cells(meisai_low, 2).value = str項目(LngI)
'        .Cells(meisai_low, 4).value = str適用(LngI)
'
'        If lngUB > LngI Then
'            Rows("3:15").Select
'            Application.CutCopyMode = False
'            Selection.Copy
'            Rows(inst_low).Select
'            Selection.PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
'                False, Transpose:=False
'            inst_low = inst_low + 13
'        End If
'        meisai_low = meisai_low + 13
'    Next LngI
'
'    .Cells(1, 1).Select
'
'    End With
'
'    ActiveSheet.PageSetup.PrintArea = "$B$3:$F$" & inst_low - 1
    
    Application.CutCopyMode = False
    
End Sub

'８号様式の２にデータを設定する
'lngCountData … データの数(0の場合は、クリアする)
Public Sub PutSelectedDataFurikomi(wksTarget As Worksheet, lngCountData As Long, str項目() As String, str適用() As String)
    
    Dim i As Long
    Dim rngKomoku As Range          '先頭ページの「項目」セル
    Dim rngTekiyou As Range         '先頭ページの「摘要」セル
    Dim lngRowPageFirst As Long     '先頭ページの開始行
    Dim lngRowPageLast  As Long     '先頭ページの終了行
    Dim lngRowsOnePage As Long      '1ページあたりの行数
    Dim lngPages As Long            '初期状態のページ数
    Dim lngCountPage As Long        'ループ中のページ数
    Dim strDantaiNm As String       '団体情報のシートの「政治団体の名称」に記載されている値
    Dim lngMakePages As Long        '作成するページ数
    
    Dim lngColLeft As Long          'シートの左端の列
    Dim lngColRight As Long         'シートの右端の列
    Dim lngRowCurrentStart As Long  '新たに作成するページの最初の行
    Dim lngRowNewEnd As Long        'データ設定後の「右下」セルの行
    Dim dblHeightArray() As Double      '１ページの各行の高さを格納する配列
    Dim lngRowIndexForHeight As Long    '上記配列使用時のインデックス
    Dim rngTemp As Range
    Dim rngFill As Range
    
    With wksTarget
        
        '行、列を取得
        Set rngKomoku = .Range("KOMOKU")
        Set rngTekiyou = .Range("TEKIYOU")
        
        lngColLeft = .Range("左上").column
        lngColRight = .Range("右下").column
        
        '作成するページ数を取得
        lngMakePages = lngCountData
        
        '１ページあたりの行数を数える
        lngRowPageFirst = .Range("先頭ページ開始行").Row
        lngRowPageLast = .Range("先頭ページ終了行").Row
        lngRowsOnePage = lngRowPageLast - lngRowPageFirst + 1
        '現在のページ数を数える（全ページの行数÷１ページあたりの行数）
        lngPages = (.Range("右下").Row - .Range("左上").Row - 1) / lngRowsOnePage
        
        '現存ページ数が0の場合、不要ページを削除し、クリアする
        If lngMakePages = 0 Then
            
            '現存ページが２枚以上の場合、１ページ目の最終行＋１～「右下」セルの上までの行を削除
            If lngPages > 1 Then
                .Rows(CStr(lngRowPageLast + 1) & ":" & CStr(.Range("右下").Row - 1)).Delete
            End If
            
            '１ページ目の「摘要」「項目」をクリア
            rngKomoku.value = ""
            rngTekiyou.value = ""
            Call CellColorChange(rngKomoku, False)
            Call CellColorChange(rngTekiyou, False)
        
        '現存ページ数が少ない場合、追加する
        ElseIf lngPages < lngMakePages Then
            
            lngRowCurrentStart = .Range("右下").Row
            
            'データ設定後の「右下」セルの行を設定  ※現在の「右下」行 ＋ (作成ページ数 - 現存ページ数) × １ページあたりの行数
            lngRowNewEnd = lngRowCurrentStart + ((lngMakePages - lngPages) * lngRowsOnePage)
            
            '「右下」セルを新しい位置に移動する
            .Range("右下").Cut
            wksTarget.Paste .Cells(lngRowNewEnd, lngColRight)
            
            ' /** オートフィルで必要な様式分をコピーする **/
            'コピーする元の範囲（現存する最後のページ）
            Set rngTemp = .Range(.Cells(lngRowCurrentStart - lngRowsOnePage, lngColLeft), .Cells(lngRowCurrentStart - 1, lngColRight))
            'コピーする元の範囲 ～ コピーする範囲全体
            Set rngFill = .Range(.Cells(lngRowCurrentStart - lngRowsOnePage, lngColLeft), .Cells(lngRowNewEnd - 1, lngColRight))
            'オートフィル実行（行自体のコピーや、セルのコピーより高速）
            rngTemp.AutoFill Destination:=rngFill, Type:=xlFillCopy
            
            ' /** コピーした範囲に、行幅を設定する **/
            '１枚目のシートの全行の行幅を配列に保存する
            ReDim dblHeightArray(lngRowsOnePage - 1) As Double
            For i = 0 To lngRowsOnePage - 1
                dblHeightArray(i) = .Rows(lngRowPageFirst + i).RowHeight
            Next i
            
            'コピーした行に対し、配列から行幅を設定する
            lngRowIndexForHeight = 0
            For i = lngRowCurrentStart To lngRowNewEnd - 1
                
                .Rows(i).RowHeight = dblHeightArray(lngRowIndexForHeight)
                
                '行幅の配列のインデックスを進める（最終行まできたらリセットする）
                If lngRowIndexForHeight < lngRowsOnePage - 1 Then
                    lngRowIndexForHeight = lngRowIndexForHeight + 1
                Else
                    lngRowIndexForHeight = 0
                End If
                
            Next i
            
            'G列の隠し列(番号を振って、どこまでデータがあるかを示したもの)を設定
            .Cells(lngRowCurrentStart - 1, COL_GUIDE).AutoFill Destination:=.Range(.Cells(lngRowCurrentStart - 1, COL_GUIDE), .Cells(lngRowNewEnd - 1, COL_GUIDE)), Type:=xlFillSeries
            
        '現存ページ数が多ければ削除する
        ElseIf lngPages > lngMakePages Then
        
            '削除対象範囲
            '・開始行＝先頭ページの開始行を「必要なページ数×１ページあたりの行数」分 下にオフセットした行
            '・終了行＝「右下」セルの一つ上の行
            .Rows(CStr(lngRowPageFirst + lngMakePages * lngRowsOnePage) & ":" & CStr(.Range("右下").Row - 1)).Delete
            
        End If
        
        '対象行の数分、値を設定する（背景色も一応クリアしておく）
        For i = 1 To lngMakePages
            
            '対象ページのセルの指定は、先頭ページのセルにオフセット（下に○行シフト）する
            With rngKomoku.Offset((i - 1) * lngRowsOnePage, 0)  '(１件目はオフセットしない(0行オフセット))
                .value = str項目(i)
                .Interior.ColorIndex = xlColorIndexNone
            End With
            
            With rngTekiyou.Offset((i - 1) * lngRowsOnePage, 0)
                .value = str適用(i)
                .Interior.ColorIndex = xlColorIndexNone
            End With
        Next i
        
        '印刷範囲を設定する
        .PageSetup.PrintArea = .Range(.Range("左上").Offset(1, 0), .Range("右下").Offset(-1, 0)).Address
    End With
    
    
End Sub

'作成処理速度向上のため、8号様式の2のシート数を増やした状態にする
'（会計帳簿で使用するテンプレート用）
'※製造時のみ使用するプロシージャ
Private Sub Setup0802SheetForTemplate()
    
    Dim lngCountSheets As Long
    Dim strDummyArray() As String
    
    '----シートの枚数-------
    lngCountSheets = 30
    '-----------------------
    
    'データの配列（初期状態の空のままとする）
    ReDim strDummyArray(1 To lngCountSheets) As String
    
    '空のデータで作成実行
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Call PutSelectedDataFurikomi(Worksheets("8号様式の2"), lngCountSheets, strDummyArray, strDummyArray)
    Call PutSelectedDataFurikomi(Worksheets("16号様式"), lngCountSheets, strDummyArray, strDummyArray)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    
End Sub
-------------------------------------------------------------------------------
VBA MACRO ModuleKaikei.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleKaikei'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit


'-------------------------------------------------------------------------------
' @(f)
'
' 機能      : 会計帳簿の「収支報告書作成」ボタン実行時の処理
'           : 会計帳簿で連携用XMLを作成した後、呼び出される
'
' 返り値    :   0:正常
'           :  -1:異常（XMLオープンエラー）
'           :  -2:異常（XML取込みエラー）
'           :  -3:異常（シートの追加エラー）
'           :  -9:異常（不明なエラー）
'
' 引き数    :
'
' 機能説明  :
'
' 備考      :
'-------------------------------------------------------------------------------

Public Function ImportXmlFromKaikei(strXmlFilePath As String) As Integer

    On Error GoTo ErrorTrap:
    
    Dim isSuccessOpen As Boolean
    Dim xdcDoc As MSXML2.DOMDocument
    Dim intXML_Import As Integer
    Dim isSuccessImport As Boolean
    ImportXmlFromKaikei = -9
    

    '会計帳簿から出力した連携用のXMLファイルを開く
    isSuccessOpen = XML_Open(strXmlFilePath, xdcDoc)
        
    If isSuccessOpen = False Then
        'Open失敗時、戻り値を設定し処理をぬける
        ImportXmlFromKaikei = -1
        Exit Function
    End If
    
    'イベントを無効にする
    Application.EnableEvents = False
    '画面描画、自動計算OFF、ブックの保護解除
    Call ScreenRedraw(False)
    Call SetCalcMode(False)
    Call bUnlock
    
    'ステータスバーへの進捗表示を有効にする
    gblnIsEnableStatusBar = True
    
    'XMLのデータを読込み、各シートに設定する
    isSuccessImport = ImportXmlData(xdcDoc, isKaikeiXml:=True)
    
    
    If isSuccessImport = True Then
        
        '各シートを並び替えまたは名寄せする（会計帳簿連携の収支報告書XMLは、ソート・小計行追加はしていないため）
        Call SortAllSheet
        
        'ステータスバーに進捗の表示をする(進捗の母数は処理数）
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
        'Call CountStatusbar("8号様式およびチェック用の様式を作成しています...", 4)
        Call CountStatusbar("15号様式およびチェック用の様式を作成しています...", 4)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        
        '8号様式（領収書等を徴し難かった支出の明細書）の取得
        Call MakeSyuushi08(True)
        Call CountStatusbar
        
        '8号様式の2（振込明細書に係る支出目的書）の取得
        Call MakeSyuushi0802
        Call CountStatusbar
        
        '申請者一覧シートの取得
        Call IMP7
        Call CountStatusbar
        
        '領収書一覧シートの取得
        Call IMP14E
        Call CountStatusbar
        Application.StatusBar = False
        
        ImportXmlFromKaikei = 0
        
    Else
        'XMLの取り込みに失敗
        ImportXmlFromKaikei = -2
    End If

ExitProcedure:

    'ステータスバーへの進捗表示を無効にする
    gblnIsEnableStatusBar = False

    'XMLドキュメントのClose
    Call XML_Close(xdcDoc)
    
    '全シートロック
    Call zLock
    
    'メニューをアクティブ
    Worksheets("メニュー").Activate
    
    'ブックの保護、画面描画、自動計算ON
    Call bLock
    Call ScreenRedraw(True)
    Call SetCalcMode(True)
    
    'イベントを有効にする
    Application.EnableEvents = True
    
    
    Exit Function
    
ErrorTrap:
    'エラー処理
    
    Call ScreenRedraw(True)
    Application.StatusBar = False
    
    'イミディエイトウィンドウにエラーを出力
    Debug.Print "Exception [ImportXmlFromKaikei]: Date=[" & Format$(Now, "YYYY/MM/DD hh:mm:ss") & "], Number=[" _
        & Err.Number & "], Description:=[" & Err.Description _
        & "], LastDllError=[" & Err.LastDllError & "], Source=[" & Err.Source & "]"
    
    Select Case Err.Number
    'ユーザ定義のエラー：シートの追加(Worksheet.Copyに失敗)の場合
    Case vbObjectError + CUSTOM_ERRORNUM_SHEETCOPY
        ImportXmlFromKaikei = -3
    
    Case Else
        ImportXmlFromKaikei = -9
        
    End Select
    
    Resume ExitProcedure:

End Function


'
'　全シートをソートする
'
Public Sub SortAllSheet()

    Dim wsSelect As Worksheet
    Dim lngColSortKey1 As Long
    Dim lngColSortKey2 As Long
    Dim lngColSortKey3 As Long
    Dim isOrderByAscKey1 As Boolean
    Dim isOrderByAscKey2 As Boolean
    Dim isOrderByAscKey3 As Boolean
    Dim isIgnore As Boolean
    Dim isNayose As Boolean
    
    isOrderByAscKey1 = True
    isOrderByAscKey2 = True
    isOrderByAscKey3 = True
    
    'ステータスバーに進捗の表示をする(進捗の母数はシート数）
    Call CountStatusbar("ソート処理をしています...", Worksheets.Count)
    
    'シートごとにループする
    For Each wsSelect In Worksheets
        With wsSelect
            
            isIgnore = False
            isNayose = False
            
            If .name = "その3" Then
                lngColSortKey1 = .Range("KAIKEI_YOUSIKI_NO").column
                lngColSortKey2 = .Range("KAIKEI_DT").column
                lngColSortKey3 = .Range("KAIKEI_HEADLINE_NO").column
                
            ElseIf .name = "その4" Then
            
                lngColSortKey1 = .Range("KAIKEI_DT").column
                lngColSortKey2 = 0
                lngColSortKey3 = 0
            
            ElseIf .name = "その5" Then
                lngColSortKey1 = .Range("HONSIBU_NM").column
                lngColSortKey2 = .Range("DT").column
                lngColSortKey3 = 0
            
            ElseIf .name = "その6" Then
                lngColSortKey1 = .Range("KAIKEI_SEQ_NO").column
                lngColSortKey2 = .Range("KAIKEI_DT").column
                lngColSortKey3 = 0
            
            ElseIf .name Like "その7*" Then
                isNayose = True
            
            ElseIf .name Like "その8*" Then
                isNayose = True
            
            ElseIf .name = "その9" Then
                lngColSortKey1 = .Range("DT").column
                lngColSortKey2 = 0
                lngColSortKey3 = 0
            
            ElseIf .name = "その10" Then
                lngColSortKey1 = .Range("KAISAI_DT").column
                lngColSortKey2 = 0
                lngColSortKey3 = 0
            
            ElseIf .name Like "その11*" Then
                isNayose = True
            
            ElseIf .name Like "その12*" Then
                isNayose = True
            
            ElseIf .name Like "その14*" Then
                lngColSortKey1 = .Range("KAIKEI_HEADLINE_NO").column
                lngColSortKey2 = .Range("KAIKEI_SEQ_NO").column
                lngColSortKey3 = .Range("DT").column
            
            ElseIf .name Like "その15*" Then
                lngColSortKey1 = .Range("KAIKEI_SEQ_NO").column
                lngColSortKey2 = .Range("DT").column
                lngColSortKey3 = 0
            
            ElseIf .name = "その16" Then
                lngColSortKey1 = .Range("KAIKEI_SHISYUTU_KMK_NO").column
                lngColSortKey2 = .Range("DT").column
                lngColSortKey3 = 0
            
            ElseIf .name Like "その18*" Then
                lngColSortKey1 = .Range("DT").column
                lngColSortKey2 = 0
                lngColSortKey3 = 0
            
            ElseIf .name Like "その19*" Then
                isIgnore = True
                
            Else
                isIgnore = True
            End If
            
            'その7, 8, 11, 12 シートの場合
            If isNayose = True Then
                
                '「通し番号で名寄せ」ボタンの処理を実行する
                Call DoSummarySheet(wsSelect, True, isCreateSyushi:=True)
                
                '行番号振りなおし
                Call RowNoRebuild(wsSelect)
                
            ElseIf isIgnore = False Then
                
                'Excelの「並び替え」機能を呼び出し、指定した項目でソートする
                Call SortOneSheet(wsSelect, lngColSortKey1, isOrderByAscKey1, _
                    lngColSortKey2, isOrderByAscKey2, lngColSortKey3, isOrderByAscKey3)
                
                '行番号振りなおし
                Call RowNoRebuild(wsSelect)
                
            End If
        End With
        
        Call CountStatusbar     'ステータスバーの進捗をカウントアップ
    Next
    
    Application.StatusBar = False
End Sub

Private Sub SortOneSheet(wsSelect As Worksheet, _
                        lngColSortKey1 As Long, _
                        isOrderByAscKey1 As Boolean, _
                        Optional lngColSortKey2 As Long = 0, _
                        Optional isOrderByAscKey2 As Boolean, _
                        Optional lngColSortKey3 As Long = 0, _
                        Optional isOrderByAscKey3 As Boolean)
    
    Dim rngSortArea As Range
    Dim lngOrder1 As Long
    Dim lngOrder2 As Long
    Dim lngOrder3 As Long
    Dim lngRowFirst As Long
    
    'キーの昇順・降順を設定
    lngOrder1 = xlAscending     '昇順
    lngOrder2 = xlAscending
    lngOrder3 = xlAscending
    If isOrderByAscKey1 = False Then lngOrder1 = xlDescending    '降順
    If isOrderByAscKey2 = False Then lngOrder2 = xlDescending
    If isOrderByAscKey3 = False Then lngOrder3 = xlDescending
    
    '１つの範囲をソートする
    With wsSelect
        
        
        '明細行全ての列全体を取得（１行目の１列目～最終行の１列目　を含む行）
        lngRowFirst = .Range("行頭").Row + 1
        Set rngSortArea = .Range(.Cells(lngRowFirst, 1), .Cells(.Range("行末").Row - 1, 1)).EntireRow
        
        'キーが３つ指定されている場合
        If lngColSortKey3 <> 0 Then
            
            rngSortArea.Sort _
                Key1:=.Cells(lngRowFirst, lngColSortKey1), Order1:=lngOrder1, _
                Key2:=.Cells(lngRowFirst, lngColSortKey2), Order2:=lngOrder2, _
                Key3:=.Cells(lngRowFirst, lngColSortKey3), Order3:=lngOrder3, _
                Header:=xlNo, MatchCase:=True, Orientation:=xlTopToBottom
            
        'キーが２つ指定されている場合
        ElseIf lngColSortKey2 <> 0 Then
        
            rngSortArea.Sort _
                Key1:=.Cells(lngRowFirst, lngColSortKey1), Order1:=lngOrder1, _
                Key2:=.Cells(lngRowFirst, lngColSortKey2), Order2:=lngOrder2, _
                Header:=xlNo, MatchCase:=True, Orientation:=xlTopToBottom
        
        'キーが１つ指定されている場合
        Else
            rngSortArea.Sort _
                Key1:=.Cells(lngRowFirst, lngColSortKey1), Order1:=lngOrder1, _
                Header:=xlNo, MatchCase:=True, Orientation:=xlTopToBottom
        End If
    End With
    
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ValidationCheckFromKaikei
  ' 機  能 ： 項目チェックを行なう
  '        ： （会計帳簿の収支報告書作成処理から呼び出す）
  ' 返り値 ：   0:正常（項目チェックでエラーなし）
  '        ：   1:正常（項目チェックでエラーあり）
  '        ：  -1:異常
  '-------------------------------------------------------------------
Public Function ValidationCheckFromKaikei() As Integer
    
    On Error GoTo ErrorTrap:
    
    '外字チェックは行わない
    GaijiChkFlg = False
    
'    '外字チェック用の変数準備
'    GaijiChkFlg = True
'    GaijiErrCnt = 0
'    ReDim GaijiErrInf(0)
    
    'ステータスバーへの進捗表示を有効にする
    gblnIsEnableStatusBar = True
    
    '再計算
    Application.Calculate
    
    '項目チェック（ダイアログメッセージは表示しないモードで実行）
    Call ValidationCheck_All(isSilentMode:=True)
    
    '項目チェック結果の判定
    Select Case gintCheckStatus
    Case CHECK_STATUS_OK
        ValidationCheckFromKaikei = 0
    Case CHECK_STATUS_NG
        ValidationCheckFromKaikei = 1
'    Case CHECK_STATUS_OK_GAIJI
'        ValidationCheckFromKaikei = 2
    End Select
    
    'ステータスバーへの進捗表示を無効にする
    gblnIsEnableStatusBar = False
    
    Exit Function
    
ErrorTrap:
    
    ValidationCheckFromKaikei = -1
    
    'ステータスバーへの進捗表示を無効にする
    gblnIsEnableStatusBar = False
    
End Function

'-------------------------------------------------------------------
  ' 関数名 ： SetKaikeiFilePath
  ' 機  能 ： 会計帳簿から渡されたブックのパスを保存する
  '        ： ※寄附金書類作成のテンプレート使用時に必要であるため
  '        ： （会計帳簿の収支報告書作成処理から呼び出す）
  ' 引　数 ： 会計帳簿作成ソフトのパス(ThisWorkbook.Path)
  ' 返り値 ：
  '-------------------------------------------------------------------
Public Sub SetKaikeiFilePath(strFilePath)
    
    Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value = strFilePath
    
End Sub


'-------------------------------------------------------------------
  ' 関数名 ： SetKaikeiFilePath
  ' 機  能 ： パーティーが複数ある場合、シートをパーティー順に並び替える
  ' 返り値 ： パーティー順に並び替えたかどうか(使用していない)
  '        ： True:並び替えた , False:並び替えていない
  '-------------------------------------------------------------------
Public Function SortPartySheetsFromKaikei() As Boolean
    
    SortPartySheetsFromKaikei = False
    
    If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        
        
        Application.EnableEvents = False    'イベントを無効にする
        Call ScreenRedraw(False)            '画面描画OFF
        Call bUnlock                        'ブックを保護を解除
        
        
        'シートをパーティーの順にソートする
        Call SortPartySheetsByParty
        
        
        Call bLock                          'ブックを保護状態に戻す
        Call ScreenRedraw(True)             '画面描画ON
        Application.EnableEvents = True     'イベントを有効にする
        
        SortPartySheetsFromKaikei = True
        
    End If
    
End Function
-------------------------------------------------------------------------------
VBA MACRO ModulePrint.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModulePrint'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Public Sub CommandPrint()
    
    Dim strTitleOnError As String
    Dim blnResultCheck As Boolean
    
    On Error GoTo ErrorTrap:
    
    '入力内容の確認メッセージを出力
    Dim intCheck As Integer
    intCheck = MsgBox(MESSAGE_I050, vbQuestion + vbOKCancel, "入力内容確認")
    'キャンセルなら終了
    If intCheck = 2 Then
        Exit Sub
    End If
    
    '項目チェック時にエラーとなった場合は「項目チェックに失敗しました」と表示する
    strTitleOnError = "項目チェック"
    
    ' *** 項目チェック済みでなければ、項目チェックを行ない、処理の続行を判断する ***
    blnResultCheck = ValidateCheckForPrint
    If blnResultCheck = False Then
        Exit Sub
    End If
    
    strTitleOnError = "印刷"
    
    'イベントを無効にする
    Application.EnableEvents = False
    'マクロ実行中に EscキーやCtrl+Pauseでマクロを中断できないようにする(印刷ダイアログをESCキャンセルで、マクロが中断されないよう対策)
    Application.EnableCancelKey = xlDisabled

    Dim wksSheet As Worksheet
    Dim strSheetNameArray() As String
    Dim lngArrayIndex As Long

    '存在するワークシートの数分、要素数を確保しておく
    ReDim strSheetNameArray(Worksheets.Count) As String
    lngArrayIndex = -1
    
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 START
    '件数初期化
    sumPageCountPrint = 0
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 END
    
    Call PrintInfSet(wksSheet, strSheetNameArray(), lngArrayIndex)

'ADD 2015/01/21 Fujitsu)Ito H27政治資金 START
    '印刷対象の明細件数が指定ラインを超えた場合、印刷前に確認メッセージを表示する。
    If sumPageCountPrint > MSG_VIEW_COUNT Then
        '表示する時間取得
        Dim viewTime As Long
        Dim msgViewTime As String   'メッセージに表示する文言（例：１分）
        viewTime = Application.RoundDown((sumPageCountPrint / MSG_VIEW_COUNT_T), 0) + 1
        'メッセージダイアログを表示させる
        If viewTime > 0 Then
            '計算した数字に「分」を追加
            msgViewTime = viewTime & "分"
            '確認ダイアログ表示
            If (GetMessageBox(MESSAGE_G086, strTitleOnError, msgViewTime) = False) Then
                GoTo ExitProcedure
            End If
        End If
    End If
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 END

    If lngArrayIndex >= 0 Then
        
        '配列のサイズを、データの数に合わせる
        ReDim Preserve strSheetNameArray(lngArrayIndex) As String
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        'ワーク用シート名格納用の初期化
        ReDim wkSheetNameArray(lngArrayIndex) As String
        Application.ScreenUpdating = False
        Call CreateWKSheet(strSheetNameArray)
        '頁の小計行を追加する
        Dim i As Long
        'ワークシートの変更イベントをOFFに
        StopSheetChangeEvent = True
        For i = LBound(strSheetNameArray) To UBound(strSheetNameArray)
            Call ModuleChangeRow.ChkSheet(Worksheets(strSheetNameArray(i)))
        Next
        Application.ScreenUpdating = True
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
'ADD 2016/11/01 H28政治資金 START
        MsgBox "印刷した際に文字切れが発生することがありますので、" & vbCrLf & "印刷した収支報告書を確認してください。", vbInformation, "印刷"
'ADD 2016/11/01 H28政治資金 END
        '印刷対象シートを選択状態にする
        Worksheets(strSheetNameArray).Select

        '印刷ダイアログを表示する（印刷自体はユーザの判断にゆだねる）
        Call ShowPrintDialog
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        Application.ScreenUpdating = False
        '頁の小計行を削除する
        Call ModuleChangeRow.ChkDelSheet
        Application.ScreenUpdating = True
        'ワークシートの変更イベントをONに戻す
        StopSheetChangeEvent = False
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

    Else
        MsgBox "印刷するシートが１つも指定されていないため、実行できません。" & vbCrLf & vbCrLf _
            & "印刷するシートの「印刷有無」にチェックしてください。" & vbCrLf _
            & "※「項目チェック」を行うと、入力のあるシート（エラーが無いもののみ）が自動的にチェックされます。", vbExclamation, "印刷"
    End If

ExitProcedure:
    
    Worksheets("メニュー").Select

    'イベントを有効にする
    Application.EnableEvents = True

    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(strTitleOnError)
    GoTo ExitProcedure:
    
End Sub
Public Sub CommandPrintOne()
    
    Dim strTitleOnError As String
    Dim blnResultCheck As Boolean
    
    On Error GoTo ErrorTrap:
    
    Dim wksSheet As Worksheet
    
    Set wksSheet = ActiveSheet

    '入力内容の確認メッセージを出力
    Dim intCheck As Integer
    intCheck = MsgBox(MESSAGE_I050, vbQuestion + vbOKCancel, "入力内容確認")
    'キャンセルなら終了
    If intCheck = 2 Then
        Exit Sub
    End If
    
    '項目チェック時にエラーとなった場合は「項目チェックに失敗しました」と表示する
    strTitleOnError = "項目チェック"
    
    ' *** 項目チェック済みでなければ、項目チェックを行ない、処理の続行を判断する ***
    blnResultCheck = ValidateCheckForPrint
    If blnResultCheck = False Then
        Exit Sub
    End If
    
    strTitleOnError = "印刷"
    
    'イベントを無効にする
    Application.EnableEvents = False
    'マクロ実行中に EscキーやCtrl+Pauseでマクロを中断できないようにする(印刷ダイアログをESCキャンセルで、マクロが中断されないよう対策)
    Application.EnableCancelKey = xlDisabled

    '件数初期化
    sumPageCountPrint = 0
    
    Call ModuleChangeRow.CountPageSum(wksSheet)

    '印刷対象の明細件数が指定ラインを超えた場合、印刷前に確認メッセージを表示する。
    If sumPageCountPrint > MSG_VIEW_COUNT Then
        '表示する時間取得
        Dim viewTime As Long
        Dim msgViewTime As String   'メッセージに表示する文言（例：１分）
        viewTime = Application.RoundDown((sumPageCountPrint / MSG_VIEW_COUNT_T), 0) + 1
        'メッセージダイアログを表示させる
        If viewTime > 0 Then
            '計算した数字に「分」を追加
            msgViewTime = viewTime & "分"
            '確認ダイアログ表示
            If (GetMessageBox(MESSAGE_G086, strTitleOnError, msgViewTime) = False) Then
                GoTo ExitProcedure
            End If
        End If
    End If
        
    Application.ScreenUpdating = False
    Call CreateWKSheetOne(wksSheet.name)
    '頁の小計行を追加する
    Dim i As Long
    'ワークシートの変更イベントをOFFに
    StopSheetChangeEvent = True
    
    Dim wksSheetWk As Object
    Dim wsCheckExt As Object
    Dim boolCheckExt As Boolean
    boolCheckExt = False
    
    For Each wsCheckExt In Worksheets
        If wsCheckExt.name = "WK_" & wksSheet.name Then
            boolCheckExt = True
            Exit For
        End If
    Next wsCheckExt
    
    If boolCheckExt Then
        Set wksSheetWk = Worksheets("WK_" & wksSheet.name)
    Else
        Set wksSheetWk = wksSheet
    End If
    
    Call ModuleChangeRow.ChkSheet(wksSheetWk)
    Application.ScreenUpdating = True
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
'ADD 2016/11/01 H28政治資金 START
    MsgBox "印刷した際に文字切れが発生することがありますので、" & vbCrLf & "印刷した収支報告書を確認してください。", vbInformation, "印刷"
'ADD 2016/11/01 H28政治資金 END
    '印刷対象シートを選択状態にする
    wksSheetWk.Select

    '印刷ダイアログを表示する（印刷自体はユーザの判断にゆだねる）
    Call ShowPrintDialog
    Application.ScreenUpdating = False
    
    wksSheet.Select
    
    Call bUnlock
    Application.DisplayAlerts = False
    If wksSheetWk.name <> wksSheet.name Then
        wksSheetWk.Delete
    End If
    Application.DisplayAlerts = True
    Call bLock
    
    Application.ScreenUpdating = True
    'ワークシートの変更イベントをONに戻す
    StopSheetChangeEvent = False


ExitProcedure:
    
    wksSheet.Select

    'イベントを有効にする
    Application.EnableEvents = True

    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(strTitleOnError)
    GoTo ExitProcedure:
    
End Sub

'印刷のダイアログを呼び出す
'「印刷」ボタンを押した後「キャンセル」を押すなどで例外になるため、トラップするために別プロシージャとしている
'戻り値：True: 正常終了, False：失敗（キャンセルしたなど）
Private Function ShowPrintDialog() As Boolean
    
    On Error GoTo ErrorTrap:
    
    'Excelの印刷ダイアログを表示する
    Application.Dialogs(xlDialogPrint).Show
    
    ShowPrintDialog = True
    Exit Function
    
ErrorTrap:
    ShowPrintDialog = False
    
End Function

'項目チェックを行なう （印刷用）
'戻り値    True:印刷続行, False:処理終了
Private Function ValidateCheckForPrint() As Boolean
    
    Dim isContinue As Boolean
    Dim intResponse As Integer
    
    If gintCheckStatus = CHECK_STATUS_OK_GAIJI Or gintCheckStatus = CHECK_STATUS_OK Then
        
        'エラーチェック済 → 印刷実行
        isContinue = True
    Else
        
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'        intResponse = MsgBox("印刷を行う前に、項目チェックを実行しますか？" & vbCrLf & vbCrLf _
'                        & "（項目チェックでエラーが無ければ、様式右上に「エラーチェック済」が印字されます）" & vbCrLf & vbCrLf _
'                        & "※項目チェックを行うと、「印刷有無」のチェックボックスは再設定されます" _
'                        , vbInformation + vbYesNoCancel, "印刷")
        intResponse = MsgBox("印刷を行う前に、項目チェックを実行しますか？" & vbCrLf & vbCrLf _
                        & "※項目チェックを行うと、「印刷有無」のチェックボックスは再設定され、" & vbCrLf & _
                        "入力のあるシート（エラーが無いもののみ）が自動的にチェックされます。" _
                        , vbInformation + vbYesNoCancel, "印刷")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        
        '「はい」を選択→項目チェック
        If intResponse = vbYes Then
            
            '外字チェックは行わない
            GaijiChkFlg = False
            
'            Dim isSortedPartySheets As Boolean
'            isSortedPartySheets = False
'            '項目チェックのため、シートの順番を通常のシート順に戻す（パーティー順の場合）
'            If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
'                Call bUnlock                    'ブックの保護を解除
'                Call SortPartySheetsByNormal    '通常の順にする
'                isSortedPartySheets = True
'            End If
            
            'チェック処理
            Call ValidationCheck_All
            
            '「報告年 >= 宣誓日の年号」の場合ワーニングを表示
            Call senseiDtWarning
            
'            'パーティーが複数ある場合、シートをパーティー順に戻す
'            If isSortedPartySheets = True Then
'                Call SortPartySheetsByParty     'パーティー順にする
'                Call bLock                      'ブックを保護状態に戻す
'            End If
            
            '項目チェックの結果
'            If gintCheckStatus = CHECK_STATUS_OK Then
            If gintCheckStatus <> CHECK_STATUS_NG Then
                'エラーなし、ワーニングあり → 印刷実行
                isContinue = True
            Else
                'エラーあり → 処理を終了
                isContinue = False
            End If
            
        '「いいえ」を選択→印刷実行
        ElseIf intResponse = vbNo Then
            isContinue = True
            
        '「キャンセル」を選択→処理を終了
        Else
            isContinue = False
        End If
    
    End If
    
    ValidateCheckForPrint = isContinue
    
End Function



'
'　印刷チェックボックスがONのシート名称を配列に退避する
'
Sub PrintInfSet(wksSheet As Worksheet, strSheetNameArray() As String, ByRef lngArrayIndex As Long)

    Dim isIgnore As Boolean
    Dim strSheetName As String

    'メニューの「印刷有無」が指定されているシート名の配列を作成する
    With Worksheets("メニュー")
    
        'シートごとにループする
        For Each wksSheet In Worksheets
            isIgnore = False
            
            If wksSheet.name = "その1" Then
                If .Range("Pその1").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その2" Then
                If .Range("Pその2").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その3" Then
                If .Range("Pその3").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その4" Then
                If .Range("Pその4").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その5" Then
                If .Range("Pその5").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その6" Then
                If .Range("Pその6").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その7(1)" Then
                If .Range("Pその71").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その7(2)" Then
                If .Range("Pその72").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その7(3)" Then
                If .Range("Pその73").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その8(1)" Then
                If .Range("Pその81").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その8(2)" Then
                If .Range("Pその82").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その8(3)" Then
                If .Range("Pその83").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その9" Then
                If .Range("Pその9").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その10" Then
                If .Range("Pその10").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その11(1)*" Then
                If .Range("Pその111").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その11(2)*" Then
                If .Range("Pその112").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その11(3)*" Then
                If .Range("Pその113").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その12(1)*" Then
                If .Range("Pその121").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その12(2)*" Then
                If .Range("Pその122").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その12(3)*" Then
                If .Range("Pその123").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その13" Then
                If .Range("Pその13").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その14(1)" Then
                If .Range("Pその141").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その14(2)" Then
                If .Range("Pその142").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その14(3)" Then
                If .Range("Pその143").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(1)*" Then
                If .Range("Pその151").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(2)*" Then
                If .Range("Pその152").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(3)*" Then
                If .Range("Pその153").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(4)*" Then
                If .Range("Pその154").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(5)*" Then
                If .Range("Pその155").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(6)*" Then
                If .Range("Pその156").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(7)*" Then
                If .Range("Pその157").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(8)*" Then
                If .Range("Pその158").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その15(9)*" Then
                If .Range("Pその159").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その16" Then
                If .Range("Pその16").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その17" Then
                If .Range("Pその17").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(1)" Then
                If .Range("Pその181").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(2)" Then
                If .Range("Pその182").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(3)" Then
                If .Range("Pその183").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(4)" Then
                If .Range("Pその184").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(5)" Then
                If .Range("Pその185").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(6)" Then
                If .Range("Pその186").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(7)" Then
                If .Range("Pその187").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(8)" Then
                If .Range("Pその188").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(9)" Then
                If .Range("Pその189").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(10)" Then
                If .Range("Pその1810").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(11)" Then
                If .Range("Pその1811").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その18(12)" Then
                If .Range("Pその1812").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name Like "その19*" Then
                If .Range("Pその19").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "その20" Then
                If .Range("Pその20").value = True Then
                Else
                    isIgnore = True
                End If
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'            ElseIf wksSheet.name = "8号様式" Then
'                If .Range("P8号様式").value = True Then
            ElseIf wksSheet.name = "15号様式" Then
                If .Range("P15号様式").value = True Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                Else
                    isIgnore = True
                End If
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'            ElseIf wksSheet.name = "8号様式の2" Then
'                If .Range("P8号様式の2").value = True Then
            ElseIf wksSheet.name = "16号様式" Then
                If .Range("P16号様式").value = True Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "領収書一覧" Then
                If .Range("P領収書一覧").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "寄附金" Then
                If .Range("P寄附金").value = True Then
                Else
                    isIgnore = True
                End If
            ElseIf wksSheet.name = "申請者一覧" Then
                If .Range("P申請者一覧").value = True Then
                Else
                    isIgnore = True
                End If
            Else
                isIgnore = True
            End If
        
            '該当シートの印刷有無がONなら、そのシート名を配列に格納
            If isIgnore = False Then
                lngArrayIndex = lngArrayIndex + 1
                strSheetNameArray(lngArrayIndex) = wksSheet.name
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 START
                Call ModuleChangeRow.CountPageSum(wksSheet)
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 END

                
            End If
        
        Next
        
    End With

End Sub

-------------------------------------------------------------------------------
VBA MACRO ModuleSheet0701.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleSheet0701'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'-----------------------------------------------------------------------------------
  ' 関数名 ： CheckSheet0701
  ' 機  能 ： その1シートのエラーチェックを行う。
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
  '        ： (out) boolError … その1シート全体のエラー有無を格納する変数
  '        ： (out) boolAllEmpty … その1シート全体の未入力有無を格納する変数
  '        ： (out) dantai_kbn … 団体区分
  '        ： (out) giin_dantai_kbn … 国会議員関係政治団体区分
'-----------------------------------------------------------------------------------
Public Sub CheckSheet0701(wsSelect As Worksheet, ByRef boolError As Boolean, ByRef boolAllEmpty As Boolean, dantai_kbn As String, giin_dantai_kbn As Integer)
    
    Dim isUseDaicho As Boolean
    Dim arrayRanges As Variant
    Dim isErrDantaiKbn As Boolean       '政治団体の区分指定にエラーがあるかどうか（相関チェックの前提で使用）
    Dim isErrSikinUmu As Boolean        '資金管理団体の指定にエラーがあるかどうか（相関チェックの前提で使用）
    Dim SikinDateUmu As Boolean         '資金管理団体の指定の期間の入力有無
    Dim GiinDateUmu As Boolean          '国会議員関係政治団体の特例の適用期間の入力有無
    Dim GaijiErrStr As String           '外字チェックでエラーとなった文字列
    Dim GaijiErr As Boolean             '外字エラーの有無
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    Dim ChkNM1 As String
    Dim ChkNM2 As String
    Dim ChkNM3 As String
    'コメントのフォントサイズ指定
    dblMessageFontSize = 12
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    With wsSelect
        
        '/* 1.単項目チェック */
        
        'ふりがな
        boolError = boolError Or CheckSingleString(.Range("DANTAI_KANA"), 0, 60, CHECKTYPE_KANA, GetReauiredType("DANTAI_KANA"), boolAllEmpty)
        '政治団体の名称
        boolError = boolError Or CheckSingleString(.Range("DANTAI_NM"), 0, 60, CHECKTYPE_ZEN, GetReauiredType("DANTAI_NM"), boolAllEmpty)
        '主たる事務所の所在地　住所
        boolError = boolError Or CheckSingleString(.Range("JIM_ADR"), 0, 40, CHECKTYPE_MIX, GetReauiredType("JIM_ADR"), boolAllEmpty)
        '主たる事務所の所在地　アパート・マンション名
        boolError = boolError Or CheckSingleString(.Range("JIM_APA_ADR"), 0, 30, CHECKTYPE_MIX, GetReauiredType("JIM_APA_ADR"), boolAllEmpty)
        '代表者の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("DAI_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("DAI_NM1"), boolAllEmpty)
        '代表者の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("DAI_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("DAI_NM2"), boolAllEmpty)
        '会計責任者の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("KAI_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("KAI_NM1"), boolAllEmpty)
        '会計責任者の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("KAI_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("KAI_NM2"), boolAllEmpty)
        '報告年
        boolError = boolError Or CheckSingleNumber(.Range("HOUKOKU_NEN"), 1900, 2117, GetReauiredType("HOUKOKU_NEN"), boolAllEmpty)
        'パーティー開催日
        boolError = boolError Or CheckSingleDate(.Range("KAISAI_DT"), GetReauiredType("KAISAI_DT"), boolAllEmpty)
        '事務担当者1の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("TANTOU1_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU1_NM1"), boolAllEmpty)
        '事務担当者1の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("TANTOU1_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU1_NM2"), boolAllEmpty)
        '事務担当者1の電話番号
        boolError = boolError Or CheckSingleString(.Range("TANTOU1_TEL"), 0, 20, CHECKTYPE_TEL, GetReauiredType("TANTOU1_TEL"), boolAllEmpty)
        '事務担当者2の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("TANTOU2_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU2_NM1"), boolAllEmpty)
        '事務担当者2の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("TANTOU2_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU2_NM2"), boolAllEmpty)
        '事務担当者2の電話番号
        boolError = boolError Or CheckSingleString(.Range("TANTOU2_TEL"), 0, 20, CHECKTYPE_TEL, GetReauiredType("TANTOU2_TEL"), boolAllEmpty)
        '事務担当者3の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("TANTOU3_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU3_NM1"), boolAllEmpty)
        '事務担当者3の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("TANTOU3_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("TANTOU3_NM2"), boolAllEmpty)
        '事務担当者3の電話番号
        boolError = boolError Or CheckSingleString(.Range("TANTOU3_TEL"), 0, 20, CHECKTYPE_TEL, GetReauiredType("TANTOU3_TEL"), boolAllEmpty)
        '政治団体の区分
        arrayRanges = Array(.Range("DANTAI_KBN_1"), .Range("DANTAI_KBN_2"), .Range("DANTAI_KBN_3"), .Range("DANTAI_KBN_4"), .Range("DANTAI_KBN_5"), .Range("DANTAI_KBN_6"))
        isErrDantaiKbn = CheckSelects(arrayRanges, GetReauiredType("DANTAI_KBN"))
        boolError = boolError Or isErrDantaiKbn
        dantai_kbn = .Range("DANTAI_KBN")
        'If IsEmptyString(.Range("DANTAI_KBN")) = False Then boolAllEmpty = True    'どれか選択されていれば、その1シート全体は未入力でない
        '活動区域の区分
        arrayRanges = Array(.Range("KATU_KUKI_1"), .Range("KATU_KUKI_2"))
        boolError = boolError Or CheckSelects(arrayRanges, GetReauiredType("KATU_KUKI"))
        'If IsEmptyString(.Range("KATU_KUKI")) = False Then boolAllEmpty = True     'どれか選択されていれば、その1シート全体は未入力でない
        '資金管理団体の指定有無
        arrayRanges = Array(.Range("SIKIN_UMU_0"), .Range("SIKIN_UMU_1"))
        isErrSikinUmu = CheckSelects(arrayRanges, GetReauiredType("SIKIN_UMU"))
        boolError = boolError Or isErrSikinUmu
        'If .Range("SIKIN_UMU") = True Then boolAllEmpty = True    '「有」が選択されていれば、その1シート全体は未入力でない
        '公職の種類
        boolError = boolError Or CheckSingleString(.Range("KOSYOKU_NM"), 0, 25, CHECKTYPE_ZEN, GetReauiredType("KOSYOKU_NM"), boolAllEmpty)
        '（現職・候補者別）
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 START
        'boolError = boolError Or CheckSingleList(.Range("KOSYOKU_KBN_NAME"), .Range("KOSYOKU_KBN_NAME"), GetReauiredType("KOSYOKU_KBN_NAME"), boolAllEmpty)
        boolError = boolError Or CheckSingleList(.Range("KOSYOKU_KBN"), .Range("KOSYOKU_KBN_NAME"), GetReauiredType("KOSYOKU_KBN"), boolAllEmpty)
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 END
        '資金管理団体の届出をした者の氏名（姓）
        boolError = boolError Or CheckSingleString(.Range("SIKIN_TODOKE_NM1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("SIKIN_TODOKE_NM1"), boolAllEmpty)
        '資金管理団体の届出をした者の氏名（名）
        boolError = boolError Or CheckSingleString(.Range("SIKIN_TODOKE_NM2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("SIKIN_TODOKE_NM2"), boolAllEmpty)
        '国会議員関係政治団体の区分
        giin_dantai_kbn = .Range("GIIN_DANTAI_KBN")
        '資金管理団体の指定の期間（自）
        boolError = boolError Or CheckSingleDate(.Range("SIKIN_KIKAN1"), GetReauiredType("SIKIN_KIKAN1"), boolAllEmpty)
        '資金管理団体の指定の期間（至）
        boolError = boolError Or CheckSingleDate(.Range("SIKIN_KIKAN2"), GetReauiredType("SIKIN_KIKAN2"), boolAllEmpty)
        '特例の適用期間（自）
        boolError = boolError Or CheckSingleDate(.Range("GIIN_KIKAN1"), GetReauiredType("GIIN_KIKAN1"), boolAllEmpty)
        '特例の適用期間（至）
        boolError = boolError Or CheckSingleDate(.Range("GIIN_KIKAN2"), GetReauiredType("GIIN_KIKAN2"), boolAllEmpty)
        '資金管理団体の指定の期間が複数ある場合２つめ以降の期間
        boolError = boolError Or CheckSingleString(.Range("SIKIN_KIKAN_FUKUSU"), 0, 200, CHECKTYPE_MIX, GetReauiredType("SIKIN_KIKAN_FUKUSU"), boolAllEmpty)
        '特例の適用期間が複数ある場合２つめ以降の期間
        boolError = boolError Or CheckSingleString(.Range("GIIN_KIKAN_FUKUSU"), 0, 200, CHECKTYPE_MIX, GetReauiredType("GIIN_KIKAN_FUKUSU"), boolAllEmpty)
        '国会議員関係の公職の候補者の氏名等 (姓)1
        boolError = boolError Or CheckSingleString(.Range("GIIN1_KOSYOKU_NM_1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN1_KOSYOKU_NM_1"), boolAllEmpty)
        '国会議員関係の公職の候補者の氏名等（名）1
        boolError = boolError Or CheckSingleString(.Range("GIIN1_KOSYOKU_NM_2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN1_KOSYOKU_NM_2"), boolAllEmpty)
        '国会議員関係の公職の種類等1
        boolError = boolError Or CheckSingleString(.Range("GIIN1_KOSYOKU_NAME"), 0, 25, CHECKTYPE_ZEN, GetReauiredType("GIIN1_KOSYOKU_NAME"), boolAllEmpty)
        '国会議員関係の（現職・候補者別）1
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 START
        'boolError = boolError Or CheckSingleList(.Range("GIIN1_KOSYOKU_KBN_NAME"), .Range("GIIN1_KOSYOKU_KBN_NAME"), GetReauiredType("KOSYOKU_KBN_NAME"), boolAllEmpty)
        boolError = boolError Or CheckSingleList(.Range("GIIN1_KOSYOKU_KBN"), .Range("GIIN1_KOSYOKU_KBN_NAME"), GetReauiredType("GIIN1_KOSYOKU_KBN"), boolAllEmpty)
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 END
        '国会議員関係の公職の候補者の氏名等 (姓)2
        boolError = boolError Or CheckSingleString(.Range("GIIN2_KOSYOKU_NM_1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN2_KOSYOKU_NM_1"), boolAllEmpty)
        '国会議員関係の公職の候補者の氏名等（名）2
        boolError = boolError Or CheckSingleString(.Range("GIIN2_KOSYOKU_NM_2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN2_KOSYOKU_NM_2"), boolAllEmpty)
        '国会議員関係の公職の種類等2
        boolError = boolError Or CheckSingleString(.Range("GIIN2_KOSYOKU_NAME"), 0, 25, CHECKTYPE_ZEN, GetReauiredType("GIIN2_KOSYOKU_NAME"), boolAllEmpty)
        '国会議員関係の（現職・候補者別）2
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 START
        'boolError = boolError Or CheckSingleList(.Range("GIIN2_KOSYOKU_KBN_NAME"), .Range("GIIN2_KOSYOKU_KBN_NAME"), GetReauiredType("KOSYOKU_KBN_NAME"), boolAllEmpty)
        boolError = boolError Or CheckSingleList(.Range("GIIN2_KOSYOKU_KBN"), .Range("GIIN2_KOSYOKU_KBN_NAME"), GetReauiredType("GIIN2_KOSYOKU_KBN"), boolAllEmpty)
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 END
        '国会議員関係の公職の候補者の氏名等 (姓)3
        boolError = boolError Or CheckSingleString(.Range("GIIN3_KOSYOKU_NM_1"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN3_KOSYOKU_NM_1"), boolAllEmpty)
        '国会議員関係の公職の候補者の氏名等（名）3
        boolError = boolError Or CheckSingleString(.Range("GIIN3_KOSYOKU_NM_2"), 0, 15, CHECKTYPE_ZEN, GetReauiredType("GIIN3_KOSYOKU_NM_2"), boolAllEmpty)
        '国会議員関係の公職の種類等3
        boolError = boolError Or CheckSingleString(.Range("GIIN3_KOSYOKU_NAME"), 0, 25, CHECKTYPE_ZEN, GetReauiredType("GIIN3_KOSYOKU_NAME"), boolAllEmpty)
        '国会議員関係の（現職・候補者別）3
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 START
        'boolError = boolError Or CheckSingleList(.Range("GIIN3_KOSYOKU_KBN_NAME"), .Range("GIIN3_KOSYOKU_KBN_NAME"), GetReauiredType("KOSYOKU_KBN_NAME"), boolAllEmpty)
        boolError = boolError Or CheckSingleList(.Range("GIIN3_KOSYOKU_KBN"), .Range("GIIN3_KOSYOKU_KBN_NAME"), GetReauiredType("GIIN3_KOSYOKU_KBN"), boolAllEmpty)
'EDIT 2015/01/19 Fujitsu)Ito H27政治資金 END
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        '事務担当者チェック(1～3に同一の名前はNG)
        '対象シートの保護解除(セルのコメントを操作するため)
        Call UnlockOneSheet(wsSelect)
        .Range("TANTOU2_NM1").ClearComments
        .Range("TANTOU2_NM2").ClearComments
        .Range("TANTOU3_NM1").ClearComments
        .Range("TANTOU3_NM2").ClearComments
        .Range("GIIN2_KOSYOKU_NM_1").ClearComments
        .Range("GIIN2_KOSYOKU_NM_2").ClearComments
        .Range("GIIN3_KOSYOKU_NM_1").ClearComments
        .Range("GIIN3_KOSYOKU_NM_2").ClearComments
        
        If boolError = False Then
            '一旦初期化する
            '事務担当者1と同じ名前は不可
            ChkNM1 = .Range("TANTOU1_NM1") & .Range("TANTOU1_NM2")
            ChkNM2 = .Range("TANTOU2_NM1") & .Range("TANTOU2_NM2")
            ChkNM3 = .Range("TANTOU3_NM1") & .Range("TANTOU3_NM2")
            If ChkNM2 <> "" Then
                If ChkNM1 = ChkNM2 Then
                    boolError = True
                    Call SetError(.Range("TANTOU2_NM1"), MESSAGE_E147, "1つ目の事務担当者の氏名")
                    Call SetError(.Range("TANTOU2_NM2"), MESSAGE_E147, "1つ目の事務担当者の氏名")
                End If
            End If
            If ChkNM3 <> "" Then
                If ChkNM1 = ChkNM3 Then
                    boolError = True
                    Call SetError(.Range("TANTOU3_NM1"), MESSAGE_E147, "1つ目の事務担当者の氏名")
                    Call SetError(.Range("TANTOU3_NM2"), MESSAGE_E147, "1つ目の事務担当者の氏名")
                End If
                If ChkNM2 = ChkNM3 Then
                    boolError = True
                    Call SetError(.Range("TANTOU3_NM1"), MESSAGE_E147, "2つ目の事務担当者の氏名")
                    Call SetError(.Range("TANTOU3_NM2"), MESSAGE_E147, "2つ目の事務担当者の氏名")
                End If
            End If

            '国会議員関係の公職の候補者の氏名等と同じ名前は不可
            ChkNM1 = .Range("GIIN1_KOSYOKU_NM_1") & .Range("GIIN1_KOSYOKU_NM_2")
            ChkNM2 = .Range("GIIN2_KOSYOKU_NM_1") & .Range("GIIN2_KOSYOKU_NM_2")
            ChkNM3 = .Range("GIIN3_KOSYOKU_NM_1") & .Range("GIIN3_KOSYOKU_NM_2")
            If ChkNM2 <> "" Then
                If ChkNM1 = ChkNM2 Then
                    boolError = True
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
                    Call SetError(.Range("GIIN2_KOSYOKU_NM_1"), MESSAGE_E147, "1つ目の公職の候補者の氏名等")
                    Call SetError(.Range("GIIN2_KOSYOKU_NM_2"), MESSAGE_E147, "1つ目の公職の候補者の氏名等")
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
                End If
            End If
            If ChkNM3 <> "" Then
                If ChkNM1 = ChkNM3 Then
                    boolError = True
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
                    Call SetError(.Range("GIIN3_KOSYOKU_NM_1"), MESSAGE_E147, "1つ目の公職の候補者の氏名等")
                    Call SetError(.Range("GIIN3_KOSYOKU_NM_2"), MESSAGE_E147, "1つ目の公職の候補者の氏名等")
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
                End If
                If ChkNM2 = ChkNM3 Then
                    boolError = True
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
                    Call SetError(.Range("GIIN3_KOSYOKU_NM_1"), MESSAGE_E147, "2つ目の公職の候補者の氏名等")
                    Call SetError(.Range("GIIN3_KOSYOKU_NM_2"), MESSAGE_E147, "2つ目の公職の候補者の氏名等")
                    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
                End If
            End If
        
        End If
        '対象シートの保護解除(セルのコメントを操作するため)
        Call LockOneSheet(wsSelect)

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

        'エラー無しなら
        If boolError Then
        Else
        
        '/* 2.項目関連チェック */
                            
            '資金管理団体の指定有無が「有」の場合、公職の種類、資金管理団体の届出者氏名は必須
            If isErrSikinUmu = False And .Range("SIKIN_UMU").value = True Then
                Call CheckCellEmpty(.Range("KOSYOKU_NM"), True, boolError)
                Call CheckCellEmpty(.Range("KOSYOKU_KBN_NAME"), True, boolError)
                Call CheckCellEmpty(.Range("SIKIN_TODOKE_NM1"), True, boolError)
                Call CheckCellEmpty(.Range("SIKIN_TODOKE_NM2"), True, boolError)
            '同項目が「無」の場合、公職の種類、現職・候補者の別、資金管理団体の届出者氏名、指定の期間は未入力
            ElseIf isErrSikinUmu = False And .Range("SIKIN_UMU").value = False Then
                Call CheckCellEmpty(.Range("KOSYOKU_NM"), False, boolError, MESSAGE_E017)
                Call CheckCellEmpty(.Range("KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E017)
                Call CheckCellEmpty(.Range("SIKIN_TODOKE_NM1"), False, boolError, MESSAGE_E017)
                Call CheckCellEmpty(.Range("SIKIN_TODOKE_NM2"), False, boolError, MESSAGE_E017)
'                Call CheckCellEmpty(.Range("SIKIN_KIKAN1"), False, boolError)
'                Call CheckCellEmpty(.Range("SIKIN_KIKAN2"), False, boolError)
'                Call CheckCellEmpty(.Range("SIKIN_KIKAN_FUKUSU"), False, boolError)
            End If
            
            '国会議員関係政治団体の区分が「有」の場合、公職の候補者名等、公職の種類等は必須
            If .Range("GIIN_DANTAI_KBN").value <> 0 Then
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NM_1"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NM_2"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NAME"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_KBN_NAME"), True, boolError)
            Else
            '国会議員関係政治団体の区分が「無」の場合、公職の候補者名等、公職の種類等、特例の期間は未入力
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NM_1"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NM_2"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_NAME"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN1_KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E018)
'                Call CheckCellEmpty(.Range("GIIN_KIKAN1"), False, boolError)
'                Call CheckCellEmpty(.Range("GIIN_KIKAN2"), False, boolError)
'                Call CheckCellEmpty(.Range("GIIN_KIKAN_FUKUSU"), False, boolError)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_1"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_2"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NAME"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_1"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_2"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NAME"), False, boolError, MESSAGE_E018)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E018)
            End If
    
            '国会議員関係政治団体の区分が１（1号団体）の場合、二人目以降の公職の候補者名等、公職の種類等は未入力
            If .Range("GIIN_DANTAI_KBN").value = 1 Then
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_1"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_2"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NAME"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_1"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_2"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NAME"), False, boolError, MESSAGE_E150)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_KBN_NAME"), False, boolError, MESSAGE_E150)

'2008/9/17 USER-013 チェックを取り除いた
'            ElseIf .Range("GIIN_DANTAI_KBN").value = 3 Then
'            '国会議員関係政治団体の区分が３（1号団体かつ2号団体）の場合、二人目以降の公職の候補者名、公職の種類の未入力はエラー
'                If EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NM_1") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NM_2") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NAME") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_KBN_NAME") And _
'                    EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NM_1") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NM_2") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NAME") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_KBN_NAME") Then
'                    Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_1"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_2"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NAME"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_KBN_NAME"), True, boolError)
'
'                    Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_1"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_2"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NAME"), True, boolError)
'                    Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_KBN_NAME"), True, boolError)
'                End If
            End If
            
            '政治団体の区分が「04」の場合、パーティー開催日は必須
            If isErrDantaiKbn = False And dantai_kbn = "04" Then
                Call CheckCellEmpty(.Range("KAISAI_DT"), True, boolError)
            '政治団体の区分が「04」以外の場合、パーティー開催日は未入力
            ElseIf isErrDantaiKbn = False And dantai_kbn <> "04" Then
                Call CheckCellEmpty(.Range("KAISAI_DT"), False, boolError)
            End If
            
            '資金管理団体の指定有無が「有」の場合、指定の期間の自～至の妥当性
            If isErrSikinUmu = False And .Range("SIKIN_UMU").value = True Then
                boolError = boolError Or CheckDateValidity(.Range("SIKIN_KIKAN1"), .Range("SIKIN_KIKAN2"), NONE, NONE, SikinDateUmu, MESSAGE_E153)
            End If
            
            '国会議員関係政治団体区分が「有」の場合、特例の適用期間の自～至の妥当性
            If .Range("GIIN_DANTAI_KBN").value <> 0 Then
                boolError = boolError Or CheckDateValidity(.Range("GIIN_KIKAN1"), .Range("GIIN_KIKAN2"), NONE, NONE, GiinDateUmu, MESSAGE_E154)
            End If
            
            '事務担当者２の入力チェック：部分的な入力はエラー
            If EmptyCheck(wsSelect, "TANTOU2_NM1") And EmptyCheck(wsSelect, "TANTOU2_NM2") And EmptyCheck(wsSelect, "TANTOU2_TEL") Then
            Else
                Call CheckCellEmpty(.Range("TANTOU2_NM1"), True, boolError)
                Call CheckCellEmpty(.Range("TANTOU2_NM2"), True, boolError)
                Call CheckCellEmpty(.Range("TANTOU2_TEL"), True, boolError)
            End If
            
            '事務担当者３の入力チェック：部分的な入力はエラー
            If EmptyCheck(wsSelect, "TANTOU3_NM1") And EmptyCheck(wsSelect, "TANTOU3_NM2") And EmptyCheck(wsSelect, "TANTOU3_TEL") Then
            Else
                Call CheckCellEmpty(.Range("TANTOU3_NM1"), True, boolError)
                Call CheckCellEmpty(.Range("TANTOU3_NM2"), True, boolError)
                Call CheckCellEmpty(.Range("TANTOU3_TEL"), True, boolError)
            End If
            
            '公職の候補者２の入力チェック：部分的な入力はエラー
            If EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NM_1") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NM_2") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_NAME") And EmptyCheck(wsSelect, "GIIN2_KOSYOKU_KBN_NAME") Then
            Else
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_1"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NM_2"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_NAME"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN2_KOSYOKU_KBN_NAME"), True, boolError)
            End If
            
            '公職の候補者３の入力チェック：部分的な入力はエラー
            If EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NM_1") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NM_2") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_NAME") And EmptyCheck(wsSelect, "GIIN3_KOSYOKU_KBN_NAME") Then
            Else
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_1"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NM_2"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_NAME"), True, boolError)
                Call CheckCellEmpty(.Range("GIIN3_KOSYOKU_KBN_NAME"), True, boolError)
            End If
            
            'エラー無しなら
            If boolError Then
            Else
                'シート内の全ての日付の妥当性をチェック
                boolError = boolError Or CheckDate0701(wsSelect)
            End If
    
            'エラー無しなら
            If boolError Then
            Else
                '資金管理団体の指定の期間（複数）のチェック
                Call CheckMultiDate(.Range("SIKIN_KIKAN1"), .Range("SIKIN_KIKAN2"), .Range("SIKIN_KIKAN_FUKUSU"), boolError, MESSAGE_E153)
                '国会議員関係政治団体に関する特例の適用期間（複数）のチェック
                Call CheckMultiDate(.Range("GIIN_KIKAN1"), .Range("GIIN_KIKAN2"), .Range("GIIN_KIKAN_FUKUSU"), boolError, MESSAGE_E155)
            End If
            
'            'エラー無しなら
'            If boolError Then
'            Else
'                '資金管理団体あるいは国会議員関係団体の通年判定
'                ThruYear_kbn = IsGiinSikinFullYear(wsSelect)
'            End If
        End If
        
    End With
        
End Sub

'-------------------------------------------------------------------
' 関数名 ： GetReauiredType
' 機  能 ： その1の単項目のチェックのために使用する、各項目の必須タイプを返す。
' 引  数 ： (in) strCellName … 対象セルの名称
' 返り値 ： 必須タイプ
' 備　考 ： 都道府県用のみで使用
'-------------------------------------------------------------------
Private Function GetReauiredType(strCellName As String) As Integer
        
    Select Case strCellName
    Case "DANTAI_KANA"          'ふりがな
        GetReauiredType = REQUIRED
    Case "DANTAI_NM"            '政治団体の名称
        GetReauiredType = REQUIRED
    Case "JIM_ADR"              '主たる事務所の所在地　住所
        GetReauiredType = REQUIRED
    Case "JIM_APA_ADR"          '主たる事務所の所在地　アパート・マンション名
        GetReauiredType = NONE
    Case "DAI_NM1"              '代表者の氏名（姓）
        GetReauiredType = REQUIRED
    Case "DAI_NM2"              '代表者の氏名（名）
        GetReauiredType = REQUIRED
    Case "KAI_NM1"              '会計責任者の氏名（姓）
        GetReauiredType = REQUIRED
    Case "KAI_NM2"              '会計責任者の氏名（名）
        GetReauiredType = REQUIRED
    Case "HOUKOKU_NEN"          '報告年
        GetReauiredType = REQUIRED
    Case "KAISAI_DT"          'パーティー開催日
        GetReauiredType = NONE
    Case "TANTOU1_NM1"           '事務担当者の氏名（姓）
        GetReauiredType = REQUIRED
    Case "TANTOU1_NM2"           '事務担当者の氏名（名）
        GetReauiredType = REQUIRED
    Case "TANTOU1_TEL"           '電話番号
        GetReauiredType = REQUIRED
    Case "DANTAI_KBN"           '政治団体の区分
        GetReauiredType = SELECT_ONE
    Case "KATU_KUKI"            '活動区域の区分
        GetReauiredType = SELECT_ONE
    Case "SIKIN_UMU"            '資金管理団体の指定有無
        GetReauiredType = SELECT_ONE
    Case "KOSYOKU_NM"           '公職の種類
        GetReauiredType = NONE
    Case "KOSYOKU_KBN_NAME"     '（現職・候補者別）
        GetReauiredType = NONE
    Case "SIKIN_TODOKE_NM1"     '資金管理団体の届出をした者の氏名（姓）
        GetReauiredType = NONE
    Case "SIKIN_TODOKE_NM2"     '資金管理団体の届出をした者の氏名（名）
        GetReauiredType = NONE
    Case "KAISAI_DT"            'パーティー開催日
        GetReauiredType = NONE
    Case Else
        GetReauiredType = NONE
    End Select
    
End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： makeXMLSheet0701
  ' 機  能 ： その1シートのXMLデータ作成を行う。
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
  ' 引  数 ： (in) strSName … 対象シート名
  ' 引  数 ： (in) intFileNum … 出力ファイル番号
'-----------------------------------------------------------------------------------
Public Sub makeXMLSheet0701(wsSelect As Worksheet, strsname As String, nodeBook As MSXML2.IXMLDOMNode)
    
    Dim nodeRoot   As MSXML2.IXMLDOMNode    'ループ中のシートの最上位ノードのオブジェクト
    Dim nodeSheet  As MSXML2.IXMLDOMNode    'ループ中のシートのSHEETノードのオブジェクト
    Dim strSRName As String
    strSRName = "SYUUSHI07_01"

    '/* True/Falseをそのまま出力する項目は、空の場合Falseを設定する */
    '（値を直接Deleteキーで消された場合、"0"でなく""で出力されるため）

    '/* XMLの出力 */
    strSRName = GetSRName(strsname)
    Set nodeRoot = AppendNode(nodeBook, strSRName)
    Set nodeSheet = AppendNode(nodeRoot, "SHEET")
    
    '報告年
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HOUKOKU_NEN")
    '特定パーティー開催日
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAISAI_DT")
    '政治団体名称
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DANTAI_NM")
    '政治団体ふりがな
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DANTAI_KANA")
    '事務所住所
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JIM_ADR")
    '事務所アパート
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JIM_APA_ADR")
    '代表者氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DAI_NM1")
    '代表者氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DAI_NM2")
    '会計責任者氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAI_NM1")
    '会計責任者氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAI_NM2")
    '事務担当者１氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU1_NM1")
    '事務担当者１氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU1_NM2")
    '事務担当１電話番号
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU1_TEL")
    '事務担当者２氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU2_NM1")
    '事務担当者２氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU2_NM2")
    '事務担当２電話番号
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU2_TEL")
    '事務担当者３氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU3_NM1")
    '事務担当者３氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU3_NM2")
    '事務担当３電話番号
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TANTOU3_TEL")
    '政治団体区分
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DANTAI_KBN")
    '活動区域
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KATU_KUKI")
    '資金管理団体の指定の有無
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_UMU")
    '公職の種類
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOSYOKU_NM")
    '公職の種類の区分（現職・候補者の別）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOSYOKU_KBN")
    '資金管理団体の届出をした者の氏名（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_TODOKE_NM1")
    '資金管理団体の届出をした者の氏名（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_TODOKE_NM2")
    '資金管理団体の指定の期間（自）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_KIKAN1")
    '資金管理団体の指定の期間（至）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_KIKAN2")
    '資金管理団体の指定の期間（複数の場合の２つめ以降）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIN_KIKAN_FUKUSU")
    '国会議員関係政治団体の区分
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN_DANTAI_KBN")
    '国会議員団体の公職の候補者の氏名等（姓）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN1_KOSYOKU_NM_1")
    '国会議員団体の公職の候補者の氏名等（名）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN1_KOSYOKU_NM_2")
    '議員団体の公職の種類の名称等
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN1_KOSYOKU_NM")
    '議員団体の公職の種類の区分
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN1_KOSYOKU_KBN")
    '議員団体の指定の期間（自）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN_KIKAN1")
    '議員団体の指定の期間（至）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN_KIKAN2")
    '国会議員団体の指定の期間（複数の場合の２つめ以降）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN_KIKAN_FUKUSU")
    '国会議員団体の公職の候補者の氏名等（姓）（２人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN2_KOSYOKU_NM_1")
    '国会議員団体の公職の候補者の氏名等（名）（２人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN2_KOSYOKU_NM_2")
    '議員団体の公職の種類の名称等（２人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN2_KOSYOKU_NM")
    '議員団体の公職の種類の区分（２人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN2_KOSYOKU_KBN")
    '国会議員団体の公職の候補者の氏名等（姓）（３人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN3_KOSYOKU_NM_1")
    '国会議員団体の公職の候補者の氏名等（名）（３人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN3_KOSYOKU_NM_2")
    '議員団体の公職の種類の名称等（３人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN3_KOSYOKU_NM")
    '議員団体の公職の種類の区分（３人目）
    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GIIN3_KOSYOKU_KBN")
    
    Call PutCloseTag(nodeSheet)
    Call PutCloseTag(nodeRoot)
    
End Sub

'-----------------------------------------------------------------------------------
  ' 関数名 ： XMLtoWS_0701
  ' 機  能 ： その1シートのXMLデータ取込を行う。
  ' 引  数 ： (in) xdcDoc … 取込対象XMLオブジェクト
'-----------------------------------------------------------------------------------
Public Function XMLtoWS_0701(nodeBook As MSXML2.IXMLDOMNode) As Integer

    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その1")
    
    'SHEETノードを取得する
    Dim nodeSheet   As MSXML2.IXMLDOMNode       'SHEETタグ
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_01/SHEET")
    
    'ノードを取得できない（＝必要タグが無い）場合
    If nodeSheet Is Nothing Then
        'その１は必須タグだが、その１が無い古いバージョン(ver.20050802以前）のXMLにも対応するためエラーとしない
        XMLtoWS_0701 = 0
        '値、色付けをクリアし、初期状態にする
        Call InitSheet0701(wsSelect)
        
        Exit Function
    End If

    '値、色付けをクリアし、初期状態にする
    Call InitSheet0701(wsSelect)
    
    ''''XMLTagデータの取得処理（XML_GetData）を行う
    '（１）総務省用・都道府県用共通項目
    
    '（３．１）XMLタグから対象セルにそのまま設定する項目
    Call XMLtoRange(wsSelect, nodeSheet, "HOUKOKU_NEN")             '報告年
    Call XMLtoRange(wsSelect, nodeSheet, "KAISAI_DT")               '特定パーティー開催日
    Call XMLtoRange(wsSelect, nodeSheet, "DANTAI_NM")               '政治団体名称
    Call XMLtoRange(wsSelect, nodeSheet, "DANTAI_KANA")             '政治団体ふりがな
    Call XMLtoRange(wsSelect, nodeSheet, "JIM_ADR")                 '事務所住所
    Call XMLtoRange(wsSelect, nodeSheet, "JIM_APA_ADR")             '事務所アパート
    Call XMLtoRange(wsSelect, nodeSheet, "DAI_NM1")                 '代表者氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "DAI_NM2")                 '代表者氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "KAI_NM1")                 '会計責任者氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "KAI_NM2")                 '会計責任者氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU1_NM1")             '事務担当者1氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU1_NM2")             '事務担当者1氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU1_TEL")             '事務担当1電話番号
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU2_NM1")             '事務担当者2氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU2_NM2")             '事務担当者2氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU2_TEL")             '事務担当2電話番号
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU3_NM1")             '事務担当者3氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU3_NM2")             '事務担当者3氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "TANTOU3_TEL")             '事務担当3電話番号
    Call XMLtoRange(wsSelect, nodeSheet, "KOSYOKU_NM")              '公職の種類の名称
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIN_TODOKE_NM1")        '資金管理団体の届出をした者の氏名（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIN_TODOKE_NM2")        '資金管理団体の届出をした者の氏名（名）
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIN_KIKAN1")            '資金管理団体の指定の期間（自）
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIN_KIKAN2")            '資金管理団体の指定の期間（至）
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIN_KIKAN_FUKUSU")      '資金管理団体の指定の期間（複数の場合の２つめ以降）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN1_KOSYOKU_NM_1")      '国会議員団体の公職の候補者等（姓）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN1_KOSYOKU_NM_2")      '国会議員団体の公職の候補者等（名）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN_KIKAN1")             '議員団体の指定の期間（自）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN_KIKAN2")             '議員団体の指定の期間（至）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN_KIKAN_FUKUSU")       '国会議員団体の指定の期間（複数の場合の２つめ以降）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN2_KOSYOKU_NM_1")      '国会議員団体の公職の候補者等（姓）（２人目）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN2_KOSYOKU_NM_2")      '国会議員団体の公職の候補者等（名）（２人目）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN3_KOSYOKU_NM_1")      '国会議員団体の公職の候補者等（姓）（３人目）
    Call XMLtoRange(wsSelect, nodeSheet, "GIIN3_KOSYOKU_NM_2")      '国会議員団体の公職の候補者等（名）（３人目）
    
    '（３．２）XMLタグ値に応じて編集処理等を行う項目
    '政治団体区分 (コードに対応するチェックボックスに設定)
    Select Case GetNodeText(nodeSheet, "DANTAI_KBN")
    Case "01"
        wsSelect.Range("DANTAI_KBN_1").value = True
    Case "02"
        wsSelect.Range("DANTAI_KBN_2").value = True
    Case "03"
        wsSelect.Range("DANTAI_KBN_3").value = True
    Case "04"
        wsSelect.Range("DANTAI_KBN_4").value = True
    Case "05"
        wsSelect.Range("DANTAI_KBN_5").value = True
    Case "06"
        wsSelect.Range("DANTAI_KBN_6").value = True
    End Select
    
    '活動区域  (コードに対応する文言を定義セルから取得し、設定する)
    Select Case GetNodeText(nodeSheet, "KATU_KUKI")
    Case "1"
        wsSelect.Range("KATU_KUKI_1").value = True
    Case "2"
        wsSelect.Range("KATU_KUKI_2").value = True
    End Select
        
    '資金管理団体の指定の有無 (コードに対応するチェックボックスに設定)
    Select Case GetNodeText(nodeSheet, "SIKIN_UMU")
    Case "0"
        wsSelect.Range("SIKIN_UMU_0").value = True
        wsSelect.Range("SIKIN_UMU_1").value = False
    Case "1"
        wsSelect.Range("SIKIN_UMU_0").value = False
        wsSelect.Range("SIKIN_UMU_1").value = True
    End Select
    
    '公職の種類 (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "KOSYOKU_KBN")
    Case "1"
        wsSelect.Range("KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(1, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    '（現職・候補者の別）は2と3がなくなり代わりに4を追加。（コンボボックスの選択肢が2つになる）
    Case "2"
'        wsSelect.Range("KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
        wsSelect.Range("KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN2_KOUHO
    Case "3"
        'wsSelect.Range("KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(3, 1)
        wsSelect.Range("KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN3_NAROU
    Case "4"
        wsSelect.Range("KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    End Select
    
    '国会議員関係政治団体の区分 (コードに対応するチェックボックスに設定)
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
    Select Case GetNodeText(nodeSheet, "GIIN_DANTAI_KBN")
    Case "0"    ' 未指定
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = False
    Case "1"    ' 1号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = False
    Case "2"    ' 2号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = False
    Case "3"    ' 1号団体かつ2号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = False
    Case "4"    ' 3号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = True
    Case "5"    ' 1号団体かつ3号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = True
    Case "6"    ' 2号団体かつ3号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = False
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = True
    Case "7"    ' 1号団体かつ2号団体かつ3号団体
        wsSelect.Range("GIIN_DANTAI_KBN_1").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_2").value = True
        wsSelect.Range("GIIN_DANTAI_KBN_3").value = True
    End Select
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END

    '議員団体の公職の種類の名称 (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN1_KOSYOKU_NM")
    Case "1"
        wsSelect.Range("GIIN1_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(1, 1)
    Case "2"
        wsSelect.Range("GIIN1_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(2, 1)
    End Select
    
    '議員団体の公職の種類の区分 (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN1_KOSYOKU_KBN")
    Case "1"
        wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(1, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    '（現職・候補者の別）は2と3がなくなり代わりに4を追加。（コンボボックスの選択肢が2つになる）
    Case "2"
        'wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
        wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN2_KOUHO
    Case "3"
        'wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(3, 1)
        wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN3_NAROU
    Case "4"
        wsSelect.Range("GIIN1_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    End Select

    '議員団体の公職の種類の名称（２人目） (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN2_KOSYOKU_NM")
    Case "1"
        wsSelect.Range("GIIN2_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(1, 1)
    Case "2"
        wsSelect.Range("GIIN2_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(2, 1)
    End Select
    
    '議員団体の公職の種類の区分（２人目） (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN2_KOSYOKU_KBN")
    Case "1"
        wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(1, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    '（現職・候補者の別）は2と3がなくなり代わりに4を追加。（コンボボックスの選択肢が2つになる）
    Case "2"
        'wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
        wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN2_KOUHO
    Case "3"
        'wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(3, 1)
        wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN3_NAROU
    Case "4"
        wsSelect.Range("GIIN2_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    End Select

    '議員団体の公職の種類の名称（３人目） (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN3_KOSYOKU_NM")
    Case "1"
        wsSelect.Range("GIIN3_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(1, 1)
    Case "2"
        wsSelect.Range("GIIN3_KOSYOKU_NAME").value = wsSelect.Range("KOSYOKU_NAME_LIST").Cells(2, 1)
    End Select
    
    '議員団体の公職の種類の区分（３人目） (コードに対応する設定)
    Select Case GetNodeText(nodeSheet, "GIIN3_KOSYOKU_KBN")
    Case "1"
        wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(1, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    '（現職・候補者の別）は2と3がなくなり代わりに4を追加。（コンボボックスの選択肢が2つになる）
    Case "2"
        'wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
        wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN2_KOUHO
    Case "3"
        'wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(3, 1)
        wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = LIST_KOSYOKU_KBN3_NAROU
    Case "4"
        wsSelect.Range("GIIN3_KOSYOKU_KBN_NAME").value = wsSelect.Range("KOSYOKU_KBN_LIST").Cells(2, 1)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    End Select
            
    XMLtoWS_0701 = 0

End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： SetLayoutSheet0701
  ' 機  能 ： その1シートのレイアウト切り替え処理を行う。
  '        ： 総務省用と都道府県用によって異なるレイアウトを切り替える。
'-----------------------------------------------------------------------------------
Public Sub SetLayoutSheet0701()
    
    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その1")
    
    '※総務省用では告示用団体コードのみ、都道府県用では台帳リンク情報を表示する
    With wsSelect
        If .Range("ROWS_SOUMUSHOU").EntireRow.Hidden = False Then
            '台帳リンク情報の記入欄エリアを表示、告示用団体コードの記入欄エリアを非表示
            .Range("ROWS_SOUMUSHOU").EntireRow.Hidden = True
            .Range("ROWS_DAICHO_LINK").EntireRow.Hidden = False
            .Range("ROWS_DAICHO_LINK").EntireRow.Hidden = False
            .Range("ROWS_DAICHO_LINK").EntireRow.Hidden = False
            
            'セルのロックを解除
            Call ChangeCellLockSheet0701(wsSelect)
            
            '報告年のセルの下線を解除
            .Range("HOUKOKU_NEN_WAREKI").Borders(xlEdgeBottom).LineStyle = xlNone
            
            'チェックボックスを表示
            .Shapes("CHK_DAI_UMU_1").Visible = True
            .Shapes("CHK_DAI_UMU_2").Visible = True
            .Shapes("CHK_USE_DAICHO_UMU").Visible = True
            .Shapes("CHK_USE_DAICHO_UMU").Locked = False
            .Shapes("CHK_GOJITU_UMU").Visible = True
        
            '画面右側欄のチェックボックスの前面に透明のシェイプを解除し、クリック可能に設定
            .Shapes("SHAPE_PROTECT_CHECKBOX").Visible = False
        End If
    End With
End Sub

'-----------------------------------------------------------------------------------
  ' 関数名 ： InitSheet0701
  ' 機  能 ： その1シートをクリアする。
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
'-----------------------------------------------------------------------------------
Public Sub InitSheet0701(wsSelect As Worksheet)

    '項目の値、色づけをクリア
    Call RangeClear(wsSelect, "HOUKOKU_NEN") '報告年
    
    '都道府県用のみ
    Call RangeClear(wsSelect, "KAISAI_DT")               '特定パーティー開催日
    Call RangeClear(wsSelect, "DANTAI_NM")               '政治団体名称
    Call RangeClear(wsSelect, "DANTAI_KANA")             '政治団体ふりがな
    Call RangeClear(wsSelect, "JIM_ADR")                 '事務所住所
    Call RangeClear(wsSelect, "JIM_APA_ADR")             '事務所アパート
    Call RangeClear(wsSelect, "DAI_NM1")                 '代表者氏名（姓）
    Call RangeClear(wsSelect, "DAI_NM2")                 '代表者氏名（名）
    Call RangeClear(wsSelect, "KAI_NM1")                 '会計責任者氏名（姓）
    Call RangeClear(wsSelect, "KAI_NM2")                 '会計責任者氏名（名）
    Call RangeClear(wsSelect, "TANTOU1_NM1")             '事務担当者氏名（姓）
    Call RangeClear(wsSelect, "TANTOU1_NM2")             '事務担当者氏名（名）
    Call RangeClear(wsSelect, "TANTOU1_TEL")             '事務担当電話番号
    Call RangeClear(wsSelect, "TANTOU2_NM1")             '事務担当者氏名（姓）
    Call RangeClear(wsSelect, "TANTOU2_NM2")             '事務担当者氏名（名）
    Call RangeClear(wsSelect, "TANTOU2_TEL")             '事務担当電話番号
    Call RangeClear(wsSelect, "TANTOU3_NM1")             '事務担当者氏名（姓）
    Call RangeClear(wsSelect, "TANTOU3_NM2")             '事務担当者氏名（名）
    Call RangeClear(wsSelect, "TANTOU3_TEL")             '事務担当電話番号
    Call RangeClear(wsSelect, "DANTAI_KBN_1")            '政治団体区分
    Call RangeClear(wsSelect, "DANTAI_KBN_2")
    Call RangeClear(wsSelect, "DANTAI_KBN_3")
    Call RangeClear(wsSelect, "DANTAI_KBN_4")
    Call RangeClear(wsSelect, "DANTAI_KBN_5")
    Call RangeClear(wsSelect, "DANTAI_KBN_6")
    Call RangeClear(wsSelect, "KATU_KUKI_1")             '活動区域
    Call RangeClear(wsSelect, "KATU_KUKI_2")
    Call RangeClear(wsSelect, "SIKIN_UMU_0")             '資金管理団体の指定の有無
    Call RangeClear(wsSelect, "SIKIN_UMU_1")
    Call RangeClear(wsSelect, "KOSYOKU_NM")              '公職の種類の名称
    Call RangeClear(wsSelect, "KOSYOKU_KBN_NAME")        '公職の種類の区分
    Call RangeClear(wsSelect, "SIKIN_TODOKE_NM1")        '資金管理団体の届出をした者の氏名（姓）
    Call RangeClear(wsSelect, "SIKIN_TODOKE_NM2")        '資金管理団体の届出をした者の氏名（名）
    Call RangeClear(wsSelect, "SIKIN_KIKAN1")            '資金管理団体の指定の期間
    Call RangeClear(wsSelect, "SIKIN_KIKAN2")            '
    Call RangeClear(wsSelect, "SIKIN_KIKAN_FUKUSU")      '資金管理団体の指定の期間（複数の場合の２つめ以降）
    Call RangeClear(wsSelect, "GIIN_DANTAI_KBN_1")       '国会議員関係政治団体の区分
    Call RangeClear(wsSelect, "GIIN_DANTAI_KBN_2")       '
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
    Call RangeClear(wsSelect, "GIIN_DANTAI_KBN_3")       '
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
    Call RangeClear(wsSelect, "GIIN1_KOSYOKU_NM_1")      '国会議員団体の公職の候補者（姓）
    Call RangeClear(wsSelect, "GIIN1_KOSYOKU_NM_2")      '国会議員団体の公職の候補者（名）
    Call RangeClear(wsSelect, "GIIN1_KOSYOKU_NAME")      '議員団体の公職の種類の名称
    Call RangeClear(wsSelect, "GIIN1_KOSYOKU_KBN_NAME")  '議員団体の公職の種類の区分
    Call RangeClear(wsSelect, "GIIN_KIKAN1")             '議員団体の指定の期間
    Call RangeClear(wsSelect, "GIIN_KIKAN2")             '
    Call RangeClear(wsSelect, "GIIN_KIKAN_FUKUSU")       '国会議員団体の指定の期間（複数の場合の２つめ以降）
    Call RangeClear(wsSelect, "GIIN2_KOSYOKU_NM_1")      '国会議員団体の公職の候補者（姓）（２人目）
    Call RangeClear(wsSelect, "GIIN2_KOSYOKU_NM_2")      '国会議員団体の公職の候補者（名）（２人目）
    Call RangeClear(wsSelect, "GIIN2_KOSYOKU_NAME")      '議員団体の公職の種類の名称（２人目）
    Call RangeClear(wsSelect, "GIIN2_KOSYOKU_KBN_NAME")  '議員団体の公職の種類の区分（２人目）
    Call RangeClear(wsSelect, "GIIN3_KOSYOKU_NM_1")      '国会議員団体の公職の候補者（姓）（３人目）
    Call RangeClear(wsSelect, "GIIN3_KOSYOKU_NM_2")      '国会議員団体の公職の候補者（名）（３人目）
    Call RangeClear(wsSelect, "GIIN3_KOSYOKU_NAME")      '議員団体の公職の種類の名称（３人目）
    Call RangeClear(wsSelect, "GIIN3_KOSYOKU_KBN_NAME")  '議員団体の公職の種類の区分（３人目）
                                                
    'TRUE/FALSEの項目はFALSEをセット
    '政治団体区分
    wsSelect.Range("DANTAI_KBN_1").value = False
    wsSelect.Range("DANTAI_KBN_2").value = False
    wsSelect.Range("DANTAI_KBN_3").value = False
    wsSelect.Range("DANTAI_KBN_4").value = False
    wsSelect.Range("DANTAI_KBN_5").value = False
    wsSelect.Range("DANTAI_KBN_6").value = False
    '活動区域
    wsSelect.Range("KATU_KUKI_1").value = False
    wsSelect.Range("KATU_KUKI_2").value = False
    '資金管理団体の指定の有無
    wsSelect.Range("SIKIN_UMU_0").value = False
    wsSelect.Range("SIKIN_UMU_1").value = False
    '国会議員関係政治団体の区分
    wsSelect.Range("GIIN_DANTAI_KBN_1").value = False
    wsSelect.Range("GIIN_DANTAI_KBN_2").value = False
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
    wsSelect.Range("GIIN_DANTAI_KBN_3").value = False
    ' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
End Sub

'-----------------------------------------------------------------------------------
  ' 関数名 ： ChangeCellLockSheet0701
  ' 機  能 ： セルのロック／ロック解除を行う。
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
'-----------------------------------------------------------------------------------
Public Sub ChangeCellLockSheet0701(wsSelect As Worksheet)

    Dim isLock As Boolean
        
    isLock = False  '都道府県用はロックしない
    
    With wsSelect
        .Range("KAISAI_DT").MergeArea.Locked = isLock           '特定パーティー開催日
        .Range("DANTAI_NM").MergeArea.Locked = isLock           '政治団体名称
        .Range("DANTAI_KANA").MergeArea.Locked = isLock         '政治団体ふりがな
        .Range("JIM_NO").MergeArea.Locked = isLock              '事務所郵便番号
        .Range("JIM_ADR").MergeArea.Locked = isLock             '事務所住所
        .Range("JIM_APA_ADR").MergeArea.Locked = isLock         '事務所アパート
        .Range("DAI_NM1").MergeArea.Locked = isLock             '代表者氏名（姓）
        .Range("DAI_NM2").MergeArea.Locked = isLock             '代表者氏名（名）
        .Range("KAI_NM1").MergeArea.Locked = isLock             '会計責任者氏名（姓）
        .Range("KAI_NM2").MergeArea.Locked = isLock             '会計責任者氏名（名）
        .Range("TANTOU1_NM1").MergeArea.Locked = isLock         '事務担当者氏名（姓）
        .Range("TANTOU1_NM2").MergeArea.Locked = isLock         '事務担当者氏名（名）
        .Range("TANTOU1_TEL").MergeArea.Locked = isLock         '事務担当電話番号
        .Range("TANTOU2_NM1").MergeArea.Locked = isLock         '事務担当者氏名（姓）
        .Range("TANTOU2_NM2").MergeArea.Locked = isLock         '事務担当者氏名（名）
        .Range("TANTOU2_TEL").MergeArea.Locked = isLock         '事務担当電話番号
        .Range("TANTOU3_NM1").MergeArea.Locked = isLock         '事務担当者氏名（姓）
        .Range("TANTOU3_NM2").MergeArea.Locked = isLock         '事務担当者氏名（名）
        .Range("TANTOU3_TEL").MergeArea.Locked = isLock         '事務担当電話番号
        .Range("KOSYOKU_NM").MergeArea.Locked = isLock          '公職の種類の名称
        .Range("SIKIN_TODOKE_NM1").MergeArea.Locked = isLock    '資金管理団体の届出をした者の氏名（姓）
        .Range("SIKIN_TODOKE_NM2").MergeArea.Locked = isLock    '資金管理団体の届出をした者の氏名（名）
        .Range("DANTAI_KBN_1").Locked = isLock                  '政治団体区分
        .Range("DANTAI_KBN_2").Locked = isLock
        .Range("DANTAI_KBN_3").Locked = isLock
        .Range("DANTAI_KBN_4").Locked = isLock
        .Range("DANTAI_KBN_5").Locked = isLock
        .Range("DANTAI_KBN_6").Locked = isLock
        .Range("KATU_KUKI_1").Locked = isLock                   '活動区域
        .Range("KATU_KUKI_2").Locked = isLock
        .Range("SIKIN_UMU_0").Locked = isLock                   '資金管理団体の指定の有無
        .Range("SIKIN_UMU_1").Locked = isLock
        .Range("KOSYOKU_KBN_NAME").MergeArea.Locked = isLock    '公職の種類
    End With
    
End Sub

'-----------------------------------------------------------------------------------
  ' 関数名 ： IsGiinSikinFullYear
  ' 機  能 ： 資金管理団体あるいは国会議員関係団体の通年判定
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
  ' 返り値 ： 通年か否か
'-----------------------------------------------------------------------------------
Public Function IsGiinSikinFullYear(wsSelect As Worksheet) As Boolean

    Dim isApply As Boolean  '通年の判定に該当するかどうか
    isApply = False
    
    With wsSelect
        '資金管理団体の場合
        If .Range("SIKIN_UMU").value = True Then
            '期間の設定がなければ”通年”
            If EmptyCheck(wsSelect, "SIKIN_KIKAN1") And EmptyCheck(wsSelect, "SIKIN_KIKAN2") Then
                isApply = True
            Else
                '指定「無」で、1/1～12/31の指定があるか（複数の期間までは判定しない）
                If IsApplyFullYear(.Range("SIKIN_KIKAN1"), .Range("SIKIN_KIKAN2")) = True Then
                    isApply = True
                End If
            End If
        End If
        
        
        '国会議員関係政治団体の場合 (上記チェックで該当していればスルー)
        If .Range("GIIN_DANTAI_KBN").value <> 0 And isApply = False Then
            '期間の設定がなければ”通年”
            If EmptyCheck(wsSelect, "GIIN_KIKAN1") And EmptyCheck(wsSelect, "GIIN_KIKAN2") Then
                isApply = True
            Else
                '指定なしで、1/1～12/31の指定があるか（複数の期間までは判定しない）
                If IsApplyFullYear(.Range("GIIN_KIKAN1"), .Range("GIIN_KIKAN2")) = True Then
                    isApply = True
                End If
            End If
        End If
    End With
    
    IsGiinSikinFullYear = isApply
    
End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： IsApplyFullYear
  ' 機  能 ： 通年判定（1/1から12/31）
  ' 引  数 ： (in) rngTarget1 … 対象セルオブジェクト１（自）
  ' 　　　 ： (in) rngTarget2 … 対象セルオブジェクト２（至）
  ' 返り値 ： 通年か否か
'-----------------------------------------------------------------------------------
Public Function IsApplyFullYear(rngTarget1 As Range, rngTarget2 As Range) As Boolean

    Dim IsThruYeark As Boolean
    Dim strDate1 As String
    Dim strDate2 As String
    Dim ChkDate1 As Date
    Dim ChkDate2 As Date
    Dim FromDate As Date
    Dim ToDate As Date
                
    IsThruYeark = False
        
    If IsEmptyString(rngTarget1.value) = False And IsEmptyString(rngTarget2.value) = False Then
        strDate1 = Year(rngTarget1.value) & "/" & Month(rngTarget1.value) & "/" & Day(rngTarget1.value)
        ChkDate1 = DateValue(Format(strDate1, "yyyy/mm/dd"))
        FromDate = Year(ChkDate1) & "/1/1"
        strDate2 = Year(rngTarget2.value) & "/" & Month(rngTarget2.value) & "/" & Day(rngTarget2.value)
        ChkDate2 = DateValue(Format(strDate2, "yyyy/mm/dd"))
        ToDate = Year(ChkDate1) & "/12/31"
        
        If ChkDate1 = FromDate And ChkDate2 = ToDate Then
            IsThruYeark = True
        End If
    End If
        
    IsApplyFullYear = IsThruYeark
    
End Function

'-----------------------------------------------------------------------------------
  ' 関数名 ： CheckDate0701
  ' 機  能 ： その１シート内の全ての日付の妥当性をチェックする
  ' 引  数 ： (in) wsSelect … 対象シートオブジェクト
  ' 返り値 ： エラーか否か
'-----------------------------------------------------------------------------------
Public Function CheckDate0701(wsSelect As Worksheet) As Boolean

    Dim IsAllDateOK As Boolean
    Dim strDate As String
    Dim ChkDate As Date
    Dim FromDate As Date
    Dim ToDate As Date
                
    IsAllDateOK = False
        
    With wsSelect
    
        FromDate = .Range("HOUKOKU_NEN") & "/1/1"
        ToDate = .Range("HOUKOKU_NEN") & "/12/31"
        'パーティー開催日
        If IsEmptyString(.Range("KAISAI_DT")) = False Then
            strDate = .Range("KAISAI_DT").value
            ChkDate = Year(strDate) & "/" & Month(strDate) & "/" & Day(strDate)
        
            If ChkDate >= FromDate And ChkDate <= ToDate Then
            Else
                IsAllDateOK = True
                Call CellColorChange(.Range("KAISAI_DT"), True)
            End If
        End If
        '資金管理団体の指定の期間（自）
        If IsEmptyString(.Range("SIKIN_KIKAN1")) = False Then
            strDate = .Range("SIKIN_KIKAN1").value
            ChkDate = Year(strDate) & "/" & Month(strDate) & "/" & Day(strDate)
        
            If ChkDate >= FromDate And ChkDate <= ToDate Then
            Else
                IsAllDateOK = True
                Call setComment(wsSelect, .Range("SIKIN_KIKAN1"), MESSAGE_E152)
                Call CellColorChange(.Range("SIKIN_KIKAN1"), True)
            End If
        End If
        '資金管理団体の指定の期間（至）
        If IsEmptyString(.Range("SIKIN_KIKAN2")) = False Then
            strDate = .Range("SIKIN_KIKAN2").value
            ChkDate = Year(strDate) & "/" & Month(strDate) & "/" & Day(strDate)
        
            If ChkDate >= FromDate And ChkDate <= ToDate Then
            Else
                IsAllDateOK = True
                Call setComment(wsSelect, .Range("SIKIN_KIKAN2"), MESSAGE_E152)
                Call CellColorChange(.Range("SIKIN_KIKAN2"), True)
            End If
        End If
        '特例の適用期間（自）
        If IsEmptyString(.Range("GIIN_KIKAN1")) = False Then
            strDate = .Range("GIIN_KIKAN1").value
            ChkDate = Year(strDate) & "/" & Month(strDate) & "/" & Day(strDate)
        
            If ChkDate >= FromDate And ChkDate <= ToDate Then
            Else
                IsAllDateOK = True
                Call setComment(wsSelect, .Range("GIIN_KIKAN1"), MESSAGE_E152)
                Call CellColorChange(.Range("GIIN_KIKAN1"), True)
            End If
        End If
        '特例の適用期間（至）
        If IsEmptyString(.Range("GIIN_KIKAN2")) = False Then
            strDate = .Range("GIIN_KIKAN2").value
            ChkDate = Year(strDate) & "/" & Month(strDate) & "/" & Day(strDate)
        
            If ChkDate >= FromDate And ChkDate <= ToDate Then
            Else
                IsAllDateOK = True
                Call setComment(wsSelect, .Range("GIIN_KIKAN2"), MESSAGE_E152)
                Call CellColorChange(.Range("GIIN_KIKAN2"), True)
            End If
        End If
    
    End With
            
    CheckDate0701 = IsAllDateOK
    
End Function





-------------------------------------------------------------------------------
VBA MACRO ModuleSheet.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'<HEAD>タグの<APP_FLG>に出力するフラグ："0"固定
Public Const APP_FLG As String = "0"
'告示用収支報告書XMLの<APP_FLG>
Public Const APP_FLG_KOKUJI As String = "1"

'EDIT 2015/01/22 Fujitsu)Ito H27政治資金 START
Public Const ProtectPass As String = "Shuushihoukokusho4MICiYD"
'EDIT 2015/01/22 Fujitsu)Ito H27政治資金 END
Public Const APP_NAME_ZENKOKU As String = "収支報告書作成ソフト〔収支報告書作成ソフト〕"

'アプリケーションの全国団体用フラグ
Public Const DantaiKubun As Integer = 0     '全国団体用

'領収書一覧の作成有無フラグ：印刷時に使用する
Public RyousyuUMU As Boolean

'外字をチェックする／しないフラグ
'XML出力時のチェック時のみ、外字をチェックする
Public GaijiChkFlg As Boolean    '外字チェックするかどうかを保持する
Public GaijiErrInf() As String   '外字チェックでエラーがあったシート等の情報を保持する
Public GaijiErrCnt As Long       '外字エラーの個数を保持する

'エラーチェックの状態を
'（エラー無しで項目チェック終了後、ブックを変更していなければ、チェックをスキップさせるために使用する）
Public gintCheckStatus As Integer       'エラーチェック済かどうかを保持する
Public Const CHECK_STATUS_NO_CHECK   As Integer = 1  'gintCheckStatusの値：エラーチェックしていない、またはエラーチェック後変更した
Public Const CHECK_STATUS_NG         As Integer = 2  'gintCheckStatusの値：エラーチェックでエラーあり(エラーチェックして変更していない)
Public Const CHECK_STATUS_WARN       As Integer = 3  'gintCheckStatusの値：エラーチェックでワーニングのみ(エラーチェックして変更していない)
Public Const CHECK_STATUS_OK         As Integer = 4  'gintCheckStatusの値：エラーチェックでエラー、ワーニングなし(エラーチェックして変更していない)
Public Const CHECK_STATUS_OK_GAIJI   As Integer = 5  'gintCheckStatusの値：エラーチェックでエラー、ワーニングなし(エラーチェックして変更していない)

'20091027
'Public Const CHECKED_MESSAGE_OK    As String = "[[エラーチェック済]]"
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 START
'Public Const CHECKED_MESSAGE_OK    As String = "【エラーチェック済】"
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 END
'20091027

Public Const CHECKED_MESSAGE_NG    As String = " "
Public mrngLastChange As Range  '前回変更されたセル

'ユーザ定義のエラー番号 （シートの追加に失敗した場合）
Public Const CUSTOM_ERRORNUM_SHEETCOPY As Long = 513

'通し番号の最大値
Public Const MAX_NUMBER_SEQNO As Currency = 999999@
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
Public blnNoChkAdr As Boolean
Private rowNumAdd As Long
Private Const LINK_TEBIKI As String = "https://kyoudou.soumu.go.jp/kyoudou/Download?cid=MANU_M0001"       '手引を開くクリック時の遷移先URL
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END


'「メニューに戻る」ボタン押下時処理
Sub BackMENU()

    Worksheets("メニュー").Activate
'    Range("A1").Activate

End Sub

'「その17に戻る」ボタン押下時処理
Sub BackNo17()

    Worksheets("その17").Activate
    Range("E7").Activate

End Sub

'「5行追加」ボタン押下時処理
Public Sub RowInsert_Common()

    On Error GoTo ErrorTrap:
    
    Dim rngStart As Range
    Dim strSheetName As String
    
    With ActiveSheet
        strSheetName = .name
        
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
        '行の追加処理
        rowNumAdd = 0
        'フォームを表示し、ユーザから追加行数を受け取る
        Load frmInsertRow
        frmInsertRow.Show
    
        '指定行数未入力の場合はフォームを閉じて処理終了
        If frmInsertRow.Tag = "" Then
            Unload frmInsertRow
            Exit Sub
        End If
        rowNumAdd = CInt(frmInsertRow.Tag)
        'Excelの最大数を超えないかチェック(右下+10まで)
        If Rows.Count <= rowNumAdd + .Range("行末").Row + 9 Then
            Call GetMessageBox(MESSAGE_W161, MESSAGE_TITLE_ROW_INSERT)
            Unload frmInsertRow
            Exit Sub
        End If

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

        Call RowInsert(.Range("行頭").Row, .Range("行末").Row, .Range("左端").column, .Range("右端").column)

        If strSheetName Like "その7*" Or strSheetName Like "その8*" Or strSheetName Like "その11*" Or strSheetName Like "その12*" Then
            Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KINGAKU_DETAIL_ONLY").column)

            '小計行以外のみの金額(KINGAKU_DETAIL_ONLY)列を設定する（オートフィルを使用）
            rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").column)), Type:=xlFillSeries

        End If

        If strSheetName = "その7(1)" Then
        
            '寄附金書類が「必要」とした行のみの金額(KOUJOGAKU_DETAIL_ONLY)列を設定する（オートフィルを使用）
            Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KOUJOGAKU_DETAIL_ONLY").column)
            rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KOUJOGAKU_DETAIL_ONLY").column)), Type:=xlFillSeries
        End If
    
    End With
    
    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("行追加")

End Sub

'「選択位置の行を削除」ボタン押下時処理
Sub RowDelete_Common()

    On Error GoTo ErrorTrap:
    
    With ActiveSheet

        Call RowDelete(.Range("行頭").Row, .Range("行末").Row, .Range("左端").column, .Range("右端").column)

    End With

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("行削除")

End Sub

'その7(1)の「選択位置の行を削除」ボタン押下時処理
Sub RowDelete_Common14071()

    On Error GoTo ErrorTrap:
    
    With ActiveSheet

        Call RowDelete(.Range("行頭").Row, .Range("行末").Row, .Range("左端").column, .Range("右端").column)

    End With
    
    Call changeTokuteiKifu

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("行削除")

End Sub

'行追加処理test
Sub RowInsert(lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)

    Dim intResponse As Integer
    Dim rngChkCellN As Range
    
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'intResponse = MsgBox("カーソルのある場所から５行追加します。よろしいですか？", vbYesNo + vbQuestion, "行追加")
    intResponse = vbYes
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    '①カーソル位置の1つ下から行追加
    '②カーソル位置から行追加
    If intResponse = vbYes Then
        
        '①カーソルが行頭より下 行末-1より上 ActiveCell.Row > lngFirstRow And ActiveCell.Row < (lngLastRow - 1)
        '②カーソルが行頭+1より下 行末より上 ActiveCell.Row > (lngFirstRow + 1) And ActiveCell.Row < lngLastRow
        If ActiveCell.Row > (lngFirstRow + 1) And ActiveCell.Row < lngLastRow Then
            
            '画面描画OFF
            Call ScreenRedraw(False)
            Call SetCalcMode(False)
            
            With ActiveSheet
                
                'コピー＆切り取り 状態を解除
                Application.CutCopyMode = False
                
                Dim intI As Integer
                '①カーソルのひとつ下の行を選択 Rows(ActiveCell.Row + 1).Select
                '②カーソルの行を選択 Rows(ActiveCell.Row).Select
                '.Rows(ActiveCell.Row).Select
                '.Unprotect Password:=ProtectPass
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                '5行ではなく変動する
                'For intI = 1 To 5
                'For intI = 1 To rowNumAdd
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                 '   Selection.Insert Shift:=xlShiftDown
                'Next intI
                
                '2019/05/01追加　処理高速化のためワークシートの値変更イベントの起動を最小限にする
                '再起動は行番号振り直しメソッドの最後の1行の値更新時
                 Application.EnableEvents = False
                
                'コピー用行をコピー
                .Rows(ActiveCell.Row).Copy

                '指定行数ペースト
                Range(ActiveCell.Row & ":" & (ActiveCell.Row + (rowNumAdd - 1))).Insert
    
                
                
                '背景色、ロック状態をクリア、デフォルト値をセット
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                'For intI = 0 To 4
                For intI = 0 To rowNumAdd - 1
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                    Call SheetClear(ActiveSheet, ActiveCell.Row + intI)
                Next intI
                
'                Set rngChkCellN = .Range(.Cells(ActiveCell.Row, intLeftCol), .Cells(ActiveCell.Row + 4, intRightCol))
'                '背景色リセット
'                rngChkCellN.Interior.ColorIndex = xlColorIndexNone
'                'ロック解除
'                rngChkCellN.Locked = False

    
                Call RowNoRebuild '行番号振りなおし
                '枠線引きなおし
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
                'Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow + 5 - 1, intLeftCol - 1, intRightCol)
                Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow + rowNumAdd - 1, intLeftCol - 1, intRightCol)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                '.Protect Password:=ProtectPass, UserInterfaceOnly:=True
            
            End With
            
            '画面描画ON
            Call ScreenRedraw(True)
            Call SetCalcMode(True)
        
        Else
            MsgBox "その位置からの追加はできません。", vbCritical, "行追加"
        End If
    
    End If

End Sub


'行削除処理
Sub RowDelete(lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
    
    Dim intResponse As Integer
    '2019/5/1　複数行削除機能　START
    Dim selectRowCount  As Long
    Dim lngRowStart As Long
    Dim lngRowEnd As Long
    Dim targetRowPostion As Long
    Dim targetColPostion As Long
    '2019/5/1　複数行削除機能　END
    
    intResponse = MsgBox("選択した行を削除します。よろしいですか？", vbYesNo + vbDefaultButton2 + vbQuestion, "行削除")
    
    If intResponse = vbYes Then
    
    '2019/5/1 削除
    'intResponse = MsgBox("カーソルのある場所の１行を削除します。よろしいですか？", vbYesNo + vbQuestion, "行削除")
    '2019/5/1 削除
    'If intResponse = vbYes Then
        
        'カーソルが行頭より下 行末より上
        '行は2行まで制限
        If ActiveCell.Row > lngFirstRow And ActiveCell.Row < lngLastRow _
            And (lngLastRow - 1) - (lngFirstRow + 1) >= 2 Then
            Call ScreenRedraw(False)    '画面描画オフ
            Call SetCalcMode(False)
            With ActiveSheet
            
                '2019/5/1　複数行削除機能　START
                targetRowPostion = ActiveCell.Row
                selectRowCount = Selection.Rows.Count
                targetColPostion = ActiveCell.column
                
                With ActiveWindow.RangeSelection.Areas(1)
                    lngRowStart = .Row
                    lngRowEnd = lngRowStart + selectRowCount - 1
                End With
                
                If lngRowStart <= lngFirstRow Or lngRowEnd >= lngLastRow Or _
                    (lngLastRow - lngFirstRow - 1) - selectRowCount < 2 Then        '#10 2017/1/5 池田 選択行削除機能の実装
                    GoTo Warn_RowDelete                                             '#11
                End If                                                              '#12

                '処理速度高速化のためワークシートチェンジイベントを止める
                '再起動は行番号振り直しメソッドの最終行の値更新時
                Application.EnableEvents = False
                
                '削除の実施
                .Rows(lngRowStart & ":" & lngRowEnd).Select

                '2019/5/1　複数行削除機能　END
                '2019/5/1 削除
                '.Rows(ActiveCell.Row).Select
                '.Unprotect Password:=ProtectPass
                Selection.Delete Shift:=xlShiftUp
                Call RowNoRebuild '行番号振りなおし
                '枠線引きなおし
                '2019/5/1　修正
                'Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow - 1 - 1, intLeftCol - 1, intRightCol)
                '.Protect Password:=ProtectPass, UserInterfaceOnly:=True
                 Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow - selectRowCount - 1, intLeftCol - 1, intRightCol)

                
            End With
           
            Call ScreenRedraw(True)     '画面描画オン
            Call SetCalcMode(True)
        Else
            MsgBox "その位置の削除はできません。", vbCritical, "行削除"
        End If
    
    End If
    
    Exit Sub
    
Warn_RowDelete:         '2019/5/1　追加

        MsgBox "その位置の削除はできません。", vbCritical, "行削除"
            

        ' 画面描画 ＯＮ
        Call ScreenRedraw(True)
        Application.EnableEvents = True
    Exit Sub

End Sub

'シート追加処理
Sub sheetCopy()

    On Error GoTo ErrorTrap:

    Dim wsSelectOrg As Worksheet
    Set wsSelectOrg = ActiveSheet
    Dim isSuccessCopy As Boolean
    Dim intResponse As Integer
    Dim isNormalizeSheets As Boolean
    isNormalizeSheets = False
        
    '対象がその11, 12の場合、シートがパーティー順に並んでいるかどうかチェックする
    If (wsSelectOrg.name Like "その11*" Or wsSelectOrg.name Like "その12*") _
        And Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        
        intResponse = MsgBox("この操作を実行すると、「その11」及び「その12」のシートの並び順がリセットされます。" _
                             & vbCrLf & "実行してよろしいですか？", vbQuestion + vbYesNo, "シート追加")
        
        If intResponse = vbYes Then
            isNormalizeSheets = True
        Else
            Exit Sub
        End If
    End If
    
    'シートの追加数初期化
    Dim SheetNumAdd As Long
    SheetNumAdd = 0
    
    'フォームを表示し、ユーザから追加シート数を受け取る
    Load frmInsertSheet
    frmInsertSheet.Show
        
    'キャンセル（指定行数未入力）の場合はフォームを閉じて処理終了
    If frmInsertSheet.Tag = "" Then
        Unload frmInsertSheet
        Exit Sub
    End If
    'シートの追加数反映
    SheetNumAdd = CInt(frmInsertSheet.Tag)
    
    'フォームを閉じる
    Unload frmInsertSheet
    
    '画面描画
    Call ScreenRedraw(False)
    
    'BOOKロック解除
    Call bUnlock
   
    '追加シート数分、シート追加を繰り返す
    Dim intI As Integer
    For intI = 1 To SheetNumAdd
    
        Set wsSelectOrg = ActiveSheet
    
        'その11, 12で、シートのソート順を元に戻す場合
        '※各シートのソート番号のクリアは行わない（ステータス解除によって、XMLには出力されなくなるため）
        If isNormalizeSheets = True Then
        
            'シートを通常の順にソートする
            Call SortPartySheetsByNormal
        
            'パーティー順にソートすべきかどうかのステータスを解除する
            Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = False
        
            'メニューの その11,12のリンクの遷移先を通常のものにする
            Call SetLinkPartySheets(False)
        End If
    
        'シートをコピー
        isSuccessCopy = CopySheetSimple(wsSelectOrg, isRaiseException:=False)
    
        If isSuccessCopy = False Then
            'シートのコピーに失敗した場合
            Call ScreenRedraw(True)
            MsgBox "シート追加ができませんでした。" & vbCrLf _
                & "一度 Excel を終了してから、やり直してください。", vbCritical, "シート追加"
            
            'BOOKロック
            Call bLock
    
            Exit Sub
        End If
    
        With ActiveSheet
        
            Dim strKNo As String, strSKNo As String
            Call SheetNo(.name, strKNo, strSKNo)
    
            '行番号振りなおし
            Call RowNoRebuild
    
            'シート全体のセルのクリア
            Call SheetClear(ActiveSheet)
    
            'その13シートの数式を再設定する
            If wsSelectOrg.name Like "その15*" Then
                Call SNo15SumRebuild(wsSelectOrg.name, strKNo)
            End If
    
            '新規追加されたシートはロックされていないのでロックする
            '全SHEETロック
            Call zLock
    
        End With

    Next intI
    
    '画面描画
    Call ScreenRedraw(True)
    
    'BOOKロック
    Call bLock

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("シート追加")


End Sub

'ワークシートをコピーする（Copyメソッドのエラーを検知）
'※Copyメソッドでエラーになった場合
'   (1) isRaiseExption = False の場合は、戻り値にFalseを返す
'   (2) isRaiseExption = True(または省略)の場合、独自の例外を発生させる
Public Function CopySheetSimple(wsSelect As Worksheet, Optional isRaiseException As Boolean = True) As Boolean
    
    wsSelect.Activate
    
    On Error GoTo ErrorTrap:
    wsSelect.Copy after:=wsSelect
    On Error GoTo 0
    
    CopySheetSimple = True
    Exit Function
    
ErrorTrap:
        
    CopySheetSimple = False
    
    If isRaiseException Then
        '独自のエラーを投げる
        '※独自のエラー番号は、標準のエラー番号と重複しないようにvbObjectError（定数）を加算した値とする
        Err.Raise (vbObjectError + CUSTOM_ERRORNUM_SHEETCOPY), Err.Source, _
        "シート追加に失敗しました。一度Excelを終了した後、再試行してください。"
    Else
        'エラーを抑止するオプションがあれば、返却値=Falseで戻る
        Exit Function
    End If
    
End Function

'シート削除処理
Sub SheetDel()

    On Error GoTo ErrorTrap:

    Dim intResponse As Integer
    Dim isNormalizeSheets As Boolean
    isNormalizeSheets = False
    
    '対象がその11, 12の場合、シートがパーティー順に並んでいるかどうかチェックする
    If (ActiveSheet.name Like "その11*" Or ActiveSheet.name Like "その12*") _
        And Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        
        intResponse = MsgBox("この操作を実行すると、「その11」シート(政治資金パーティーの対価に係る収入の内訳)及び" & _
                             "「その12」シート(政治資金パーティーの対価に係る収入のうち対価の支払いのあっせんによる" & _
                             "ものの内訳)の並び順がリセットされます。" _
                             & vbCrLf & vbCrLf & "本当に削除してもよろしいですか？", vbYesNo + vbDefaultButton2 + vbQuestion, "シート削除")
        
        If intResponse = vbYes Then
            isNormalizeSheets = True
        End If
    Else
        intResponse = MsgBox("本当に削除してもよろしいですか？", vbYesNo + vbDefaultButton2 + vbQuestion, "シート削除")
    End If

    If intResponse = vbYes Then

        Dim strKNo As String, strSKNo As String, strsname As String

        strsname = ActiveSheet.name

        Call SheetNo(strsname, strKNo, strSKNo)

        If strSKNo = 1 Or (strsname Like "その19*" And strKNo = 1) Then
            MsgBox "このシートは削除できません。", vbCritical, "シート削除"
        Else
            
            Application.DisplayAlerts = False
            'BOOKロック解除
            Call bUnlock
            
            'その11, 12で、シートのソート順を元に戻す場合
            '※各シートのソート番号のクリアは行わない（ステータス解除によって、XMLには出力されなくなるため）
            If isNormalizeSheets = True Then
                
                Call ScreenRedraw(False)    '画面描画OFF
                
                'シートを通常の順にソートする
                Call SortPartySheetsByNormal
                
                'パーティー順にソートすべきかどうかのステータスを解除する
                Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = False
                
                'メニューの その11,12のリンクの遷移先を通常のものにする
                Call SetLinkPartySheets(False)
            
                Call ScreenRedraw(True)     '画面描画ON
            End If
            
            
            'シートを削除
            ActiveSheet.Activate
            ActiveSheet.Delete
            
            'BOOKロック
            Call bLock
            Application.DisplayAlerts = True
            
            'その13シートの数式を再設定する
            If strsname Like "その15*" Then
                Call SNo15SumRebuild(strsname, strKNo)
            End If
                        
        End If

    End If

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("シート追加")

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： SNo14SumRebuild
  ' 機  能 ： その13シートに、指定したその15シートの区分内合計を求める数式を設定する。
  ' 引  数 ： (in) strSheetName … 対象ワークシート名
  '        ： (in) strKNo       … 対象ワークシートの区分番号(String)
  ' 返り値 ：なし
'-------------------------------------------------------------------
Sub SNo15SumRebuild(strSheetName As String, strKNo As String)

    Dim strFormula As String
    Dim rngSNo13 As Range
    Dim strLastEdaban As String
    Dim strLastKbn As String
    Dim strCellAddress As String
    Dim strSheetNameLeft As String
    Dim strSheetNameFirst As String
    Dim strSheetNameLast As String
    
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Set rngSNo13 = Worksheets("その13").Range("SNo15" & strKNo)
    Set rngSNo13 = Worksheets("その13").Range("_SNo15" & strKNo)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 EMD
    
    '最後の枝版を取得
    Call SheetLastNo(strSheetName, strLastKbn, strLastEdaban, strKNo)

    strSheetNameLeft = Left(strSheetName, InStrRev(strSheetName, "(") - 1) '末尾の(x)を取り除く

    'その13合計の数式を生成
    If CInt(strLastEdaban) > 1 Then

        '合計計算対象の１番目と末尾のシート名を取得
        strSheetNameFirst = strSheetNameLeft & "(1)"
        strSheetNameLast = strSheetNameLeft & "(" & strLastEdaban & ")"

        '複数シート間で合計する式（串刺し計算　例「'その15(1)(1):その15(1)(5)'!$A$1」）
        '（セルのアドレス指定する必要があるため、セル名からアドレスを取得して指定する）
        strCellAddress = Worksheets(strSheetNameFirst).Range("KINGAKU_GK_HIDE").Address
        strFormula = "=SUM('" & strSheetNameFirst & ":" & strSheetNameLast & "'!" & strCellAddress & ")"

    Else
        'シートが１つのみであれば、１番目のシートの合計を参照する数式に設定
        strFormula = "='" & strSheetNameLeft & "(1)'!KINGAKU_GK"
    End If

    '数式を設定
    rngSNo13.Formula = strFormula

    Set rngSNo13 = Nothing

End Sub

'行番号振りなおし
Sub RowNoRebuild(Optional wsSelect As Worksheet = Nothing)

    Dim lngCount As Long
    Dim lngLastRow As Long, lngFirstRow As Long, lngLeftCol As Long
    Dim rngRowNo As Range
    
    If wsSelect Is Nothing Then Set wsSelect = ActiveSheet
    
    With wsSelect
        
        lngLastRow = .Range("行末").Row
        lngFirstRow = .Range("行頭").Row
        lngLeftCol = .Range("左端").column
    
        For Each rngRowNo In .Range(.Cells(lngFirstRow + 1, lngLeftCol - 1), .Cells(lngLastRow - 1, lngLeftCol - 1))
            '最終行の行番号を更新する際にワークシートチェンジイベントを起動
            If lngCount = lngLastRow - lngFirstRow - 2 Then
                Application.EnableEvents = True
            End If
            
            rngRowNo.value = lngCount + 1
            lngCount = rngRowNo.value
        
        Next rngRowNo
    
    End With

End Sub

'枠線引きなおし
Sub LineReDraw(wsSelect As Worksheet, lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)

    Dim rngLineReDraw As Range
    
    '太枠外の罫線を設定（様式独自のもの：その7,8,14,15）を実行
    '2008/9/18 Excel2007でその7,8,14,15で右の罫線が印刷されない問題を対応
    '　　　　　最後に太枠外を引きなおすと上記現象が発生するため、最初に引きなおす
    Call ExceptionLineReDraw(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol)
    
    
    '太枠内の罫線を設定
    With wsSelect
        Set rngLineReDraw = .Range(.Cells(lngFirstRow, intLeftCol), .Cells(lngLastRow, intRightCol))
    End With
    
    With rngLineReDraw
    
        With .Borders(xlEdgeLeft)
            .LineStyle = xlContinuous
            .Weight = xlMedium
            .ColorIndex = xlAutomatic
        End With
        With .Borders(xlEdgeTop)
            .LineStyle = xlContinuous
            If wsSelect.name Like "その18*" Then
                .Weight = xlThin
            Else
                .Weight = xlMedium
            End If
            .ColorIndex = xlAutomatic
        End With
        With .Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .Weight = xlMedium
            .ColorIndex = xlAutomatic
        End With
        With .Borders(xlEdgeRight)
            .LineStyle = xlContinuous
            .Weight = xlMedium
            .ColorIndex = xlAutomatic
        End With
        With .Borders(xlInsideVertical)
            .LineStyle = xlContinuous
            .Weight = xlMedium
            .ColorIndex = xlAutomatic
        End With
        With .Borders(xlInsideHorizontal)
            .LineStyle = xlContinuous
            .Weight = xlThin
            .ColorIndex = xlAutomatic
        End With
    
    End With
    
    '太枠の上(ヘッダ)の罫線を設定: Excel 2007の場合、ヘッダの下の罫線が印字されないため、下部分のみ再設定する
    With wsSelect
        Set rngLineReDraw = .Range(.Cells(lngFirstRow - 1, intLeftCol), .Cells(lngFirstRow - 1, intRightCol))
    End With
    
    With rngLineReDraw
    
        With .Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .Weight = xlMedium
            .ColorIndex = xlAutomatic
        End With
    
    End With


End Sub

'枠線引きなおし（例外）
Sub ExceptionLineReDraw(wsSelect As Worksheet, lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)

    Dim rngLineReDraw As Range
    Dim strsname As String
    Dim intTargetCol As Integer
    Dim intLeftTargetCol As Integer
    Dim intRightTargetCol As Integer
    
    strsname = wsSelect.name
    
    If strsname = "その7(1)" Then
    
        With wsSelect
            intLeftTargetCol = .Range("SEQ_NO").column
            intRightTargetCol = .Range("ZEIGAKUKOUJYO").column
            Set rngLineReDraw = .Range(.Cells(lngFirstRow, intLeftTargetCol), .Cells(lngLastRow, intRightTargetCol))
        End With
    
        With rngLineReDraw
        
'            With .Borders(xlEdgeLeft)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlEdgeTop)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
            With .Borders(xlEdgeBottom)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
'            With .Borders(xlEdgeRight)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlInsideVertical)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
            With .Borders(xlInsideHorizontal)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
        
        End With
    
    ElseIf strsname = "その7(2)" Or _
        strsname = "その7(3)" Or _
        strsname Like "その8*" Or _
        strsname Like "その11*" Or _
        strsname Like "その12*" Then
    
        With wsSelect
            intTargetCol = .Range("SEQ_NO").column
            Set rngLineReDraw = .Range(.Cells(lngFirstRow, intTargetCol), .Cells(lngLastRow, intTargetCol))
        End With
    
        With rngLineReDraw
        
'            With .Borders(xlEdgeLeft)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlEdgeTop)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
            With .Borders(xlEdgeBottom)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
'            With .Borders(xlEdgeRight)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
'            With .Borders(xlInsideVertical)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlInsideHorizontal)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
        
        End With
    
    ElseIf strsname Like "その14*" Or _
        strsname Like "その15*" Then
        
        With wsSelect
            intTargetCol = .Range("RYOUSYU").column
            Set rngLineReDraw = .Range(.Cells(lngFirstRow, intTargetCol), .Cells(lngLastRow, intTargetCol))
        End With
    
        With rngLineReDraw
        
'            With .Borders(xlEdgeLeft)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlEdgeTop)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
            With .Borders(xlEdgeBottom)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
'            With .Borders(xlEdgeRight)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
'            With .Borders(xlInsideVertical)
'                .LineStyle = xlDot
'                .Weight = xlThin
'                .ColorIndex = xlAutomatic
'            End With
            With .Borders(xlInsideHorizontal)
                .LineStyle = xlDot
                .Weight = xlThin
                .ColorIndex = xlAutomatic
            End With
        
        End With
    
    End If

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： RowInsertBase
  ' 機  能 ： 指定された行位置から、書式を維持して行を追加する
  ' 引  数 ： (in) Worksheet     … 対象ワークシートオブジェクト
  '        ： (in) lngSelectRow  … 行の追加を行う行数
  '        ： (in) lngFirstRow   … 行頭の行数  （セルの名前「行頭」+1を指定）
  '        ： (in) lngLastRow    … 行末の行数  （セルの名前「行末」-1を指定）
  '        ： (in) intLeftCol    … 左端の列数  （セルの名前「左端」-1を指定）
  '        ： (in) intRightCol   … 右端の列数  （セルの名前「右端」-1を指定）
  '        ： (in) lngInsertRows … 追加する行数（省略時:1）
  '        ： (in) isInsertDown  … True :指定位置(lngSelectRow)の下に行を追加する
  '                              … False:指定位置(lngSelectRow)に行を追加する（省略時:False）
  ' 返り値 ：なし
  ' 備　考 ：新規で追加された行については、セルの背景色を保証しない。
  '        ：TRUE/FALSEが設定される列がある場合でも、新規で追加された行は空の値が設定される
  '
'-------------------------------------------------------------------
Sub RowInsertBase(wsSelect As Worksheet, lngSelectRow As Long, _
                    lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer, _
                     Optional lngInsertRows As Integer = 1, Optional isInsertDown As Boolean = False)

    Dim lngI As Long
    Dim i As Integer
    Dim rngBase As Range
    
    Dim lngInsertRowsCurrent As Long    '追加する行数
    Dim lngSelectRowCurrent As Long     '行を追加する位置
    
    With wsSelect
        
        'コピー＆切り取り 状態を解除
        Application.CutCopyMode = False
        
        '行頭に行を追加する場合の事前処理
        '（事前処理を行わないで行を挿入した場合、書式が維持されないため）
        If isInsertDown = False And lngSelectRow = lngFirstRow Then
            
            lngSelectRowCurrent = lngSelectRow + 1
            lngInsertRowsCurrent = lngInsertRows - 1
            
            '行頭の下に行を挿入する
            Set rngBase = .Rows(lngSelectRowCurrent)
            rngBase.Insert Shift:=xlShiftDown
            
            '挿入した行から、行頭へデータを移動する
            For i = intLeftCol To intRightCol
                
                '値（数式がある場合は数式）をコピーする
                If .Cells(lngSelectRow, i).HasFormula Then
                    .Cells(lngSelectRowCurrent, i).Formula = .Cells(lngSelectRow, i).Formula
                Else
                    .Cells(lngSelectRowCurrent, i).value = .Cells(lngSelectRow, i).value
                End If
                'セルの背景色をコピー
                .Cells(lngSelectRowCurrent, i).Interior.Color = .Cells(lngSelectRow, i).Interior.Color
                'コピー元の行のデータをクリア
                .Cells(lngSelectRow, i).ClearContents
                'ロック状態をコピー   2008/9/20 小計行の最下行を同一者の追加した場合、ロックされている問題を修正
                .Cells(lngSelectRowCurrent, i).Locked = .Cells(lngSelectRow, i).Locked
                
            Next i
        
        '行末の下に行を追加する場合の事前処理
        '（事前処理を行わないで行を挿入した場合、書式が維持されないため）
        ElseIf isInsertDown = True And lngSelectRow = lngLastRow Then
            
            lngInsertRowsCurrent = lngInsertRows - 1
            
            '行末から行を挿入する
            Set rngBase = .Rows(lngSelectRow)
            rngBase.Insert Shift:=xlShiftDown
            
            lngSelectRowCurrent = lngSelectRow + 1
            
            '行末から、挿入した行へデータを移動する
            For i = intLeftCol To intRightCol
                
                '値（数式がある場合は数式）をコピーする
                If .Cells(lngSelectRowCurrent, i).HasFormula Then
                    .Cells(lngSelectRow, i).Formula = .Cells(lngSelectRowCurrent, i).Formula
                Else
                    .Cells(lngSelectRow, i).value = .Cells(lngSelectRowCurrent, i).value
                End If
                'セルの背景色をコピー
                .Cells(lngSelectRow, i).Interior.Color = .Cells(lngSelectRowCurrent, i).Interior.Color
                'コピー元の行のデータをクリア
                .Cells(lngSelectRowCurrent, i).ClearContents
                'ロック状態をコピー   2008/9/20 小計行の最下行を同一者の追加した場合、ロックされている問題を修正
                .Cells(lngSelectRow, i).Locked = .Cells(lngSelectRowCurrent, i).Locked
            
            Next i
        
        '対象行の下から行を追加する場合
        ElseIf isInsertDown = True Then
            lngSelectRowCurrent = lngSelectRow + 1
            lngInsertRowsCurrent = lngInsertRows
            
        '対象行から行を追加する場合
        Else
            lngSelectRowCurrent = lngSelectRow
            lngInsertRowsCurrent = lngInsertRows
        End If
        
        
        '残りの行を指定位置から挿入
        Set rngBase = .Rows(lngSelectRowCurrent)
        For lngI = 1 To lngInsertRowsCurrent
            rngBase.Insert Shift:=xlShiftDown
        Next lngI
        
    End With

End Sub

'その19シート追加前処理
Sub SheetCopy19Before()

    Dim wsSelect As Worksheet
    Dim strSheetName As String
    Dim sheet19cnt As Long
    
    'その19シートのシート数算出
    sheet19cnt = 0
    For Each wsSelect In Worksheets
    
        With wsSelect
    
        strSheetName = .name
        
        If strSheetName Like "その19*" Then
            
            sheet19cnt = sheet19cnt + 1

        End If
            
        End With
    
    Next wsSelect

    If sheet19cnt > 2 Then
        MsgBox "「その19」シート（不動産の利用の現況）は、これ以上の追加はできません。", vbCritical, "シート追加"
    Else
        Call sheetCopy
    End If

End Sub

'その19シート削除前処理
Sub SheetDel19Before()

    Dim wsSelect As Worksheet
    Dim strSheetName As String
    Dim sheet19cnt As Long
    
    'その19シートのシート数算出
    sheet19cnt = 0
    For Each wsSelect In Worksheets
    
        With wsSelect
    
        strSheetName = .name
        
        If strSheetName Like "その19*" Then
            
            sheet19cnt = sheet19cnt + 1

        End If
            
        End With
    
    Next wsSelect

    If sheet19cnt = 1 Then
        MsgBox "このシートは削除できません。", vbCritical, "シート削除"
    Else
        Call SheetDel
    End If

End Sub

'チェックステータスにチェック済みでない旨を設定する
Public Sub SetChangeStatusAsNoCheck()
    
    If gintCheckStatus <> CHECK_STATUS_NO_CHECK Then
    
        gintCheckStatus = CHECK_STATUS_NO_CHECK
        '空にすると参照先が「0」になるので、空白を設定
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 START
        'Range("STATUS_ERR_CHECK").value = CHECKED_MESSAGE_NG
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 END
        '各シートの右上のセルが確実に更新されるよう、再計算
        Application.Calculate
        
    End If
    
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： OnClickCheckbox
  ' 機  能 ： その1や寄附金のチェックボックスをクリックしたときの処理
  '        ： （シートが変更されたことを感知する）
  '        ：
'-------------------------------------------------------------------
Public Sub OnClickCheckbox()
    
    'XMLデータ作成時、項目チェックが必要かどうかを保持する変数を設定
    '（チェックボックスがクリックされたら、次回XMLデータ作成時は、チェック必要となる）
    gintCheckStatus = CHECK_STATUS_NO_CHECK
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 START
    'Range("STATUS_ERR_CHECK").value = CHECKED_MESSAGE_NG
'DEL 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    Dim wsSelect As Worksheet
    Set wsSelect = ActiveSheet
    
    With wsSelect
        '「その1」の政治団体の区分が「政党の支部」の場合、資金管理団体の指定の有無の「有」を選択不可にする
        If .name = "その1" Then
            If .Range("DANTAI_KBN_2").value = True Then
                .CheckBoxes("CHK_SIKIN_UMU_1").value = False
                .CheckBoxes("CHK_SIKIN_UMU_1").Enabled = False
            Else
                .CheckBoxes("CHK_SIKIN_UMU_1").Enabled = True
            End If
        End If
    End With
    
End Sub

'「通し番号で名寄せ」ボタン押下時の処理
Public Sub CommandSummary()
    
    On Error GoTo ErrorTrap:
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    Dim lngRowCurrent As Long
    Dim isRebuildSeqNo As Boolean
    Dim wsSelect As Worksheet
    Dim strSheetName As String

    '確認ダイアログを表示、通し番号の振りなおしを行うかどうかを選択させる
    frmNayose.Show
    If frmNayose.Tag = "Run_Checked" Then
        'フォームで"「通し番号」を1から振りなおす"指定
        isRebuildSeqNo = True
    ElseIf frmNayose.Tag = "Run" Then
        '上記指定はなし
        isRebuildSeqNo = False
    Else
        'キャンセルされた
        GoTo ExitProcedure:
    End If
        
    'シートの自動計算、画面描画をOFF(処理速度向上のため)
    Call SetCalcMode(False)
    Call ScreenRedraw(False)
    Set wsSelect = ActiveSheet
    
    '名寄せ実行
    Call DoSummarySheet(wsSelect, isRebuildSeqNo, isCreateSyushi:=True)
    
ExitProcedure:
    'フォームを解放
    Unload frmNayose
    
    Call SetChangeStatusAsNoCheck
    'イベントを有効にする
    Application.EnableEvents = True
    
    'シートの自動計算、画面描画をON
    Call SetCalcMode(True)
    Call ScreenRedraw(True)
    
    Exit Sub
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("通し番号で名寄せ")
    GoTo ExitProcedure:
        
    
End Sub

'通し番号で名寄せを行う
'isCreateSyushi … True:会計帳簿の収支報告書作成時, False:それ以外(通し番号で名寄せ) (2008/9/11 使用していない)
Public Sub DoSummarySheet(wsSelect As Worksheet, isRebuildSeqNo As Boolean, isCreateSyushi As Boolean)
    
    Dim lngRowNextHeadlineRow As Long   '次の見出し行
    Dim lngRowGroupFirst As Long        'グループ範囲の開始行
    Dim lngRowGroupLast As Long         'グループ範囲の終了行

    With wsSelect
        
        '小計行を全て削除する
        Call DeleteSubtotalRows(wsSelect)

        '1行目の行を取得
        lngRowGroupFirst = .Range("行頭").Row + 1
            

        lngRowGroupLast = .Range("行末").Row - 1

        'ソートする
        Call SortGroup(wsSelect, lngRowGroupFirst, lngRowGroupLast, isCreateSyushi)

        '小計行を追加、通し番号の振りなおし（指定されている場合のみ）を行う
        Call AddSubtotalRows(wsSelect, lngRowGroupFirst, lngRowGroupLast, isRebuildSeqNo)
    
        'その11,12の場合、合計セルの計算式を再設定(2009/1/10 追加：末尾に小計行が挿入されるケースで必要なため)
        If .name Like "その11*" Or .name Like "その12*" Then
            
            Call SetFormulaKingakuGk(wsSelect)
            
        End If
        
        '行番号を振りなおす
        Call RowNoRebuild(wsSelect)
    
        '罫線を引きなおす
        Call LineReDraw(wsSelect, .Range("行頭").Row + 1, .Range("行末").Row - 1, .Range("左端").column - 1, .Range("右端").column)
    End With

End Sub

'「通し番号自動採番」ボタン押下時の処理
Public Sub CommandAutoNumbering()
    
    On Error GoTo ErrorTrap:
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    Dim lngRowCurrent As Long
    Dim wsSelect As Worksheet
    Dim strSheetName As String
    Dim strRepMsg As String
    
    Set wsSelect = ActiveSheet
    
    If wsSelect.name Like "その7*" Then
        strRepMsg = "寄附者の氏名(団体にあっては、その名称)"
    ElseIf wsSelect.name Like "その8*" Then
        strRepMsg = "寄附のあっせん者の氏名(団体にあっては、その名称)"
    Else
        'その11、その12の場合
        strRepMsg = "対価の支払をした者の氏名(団体にあっては、その名称)"
    End If

    '確認ダイアログを表示
    If (GetMessageBox(MESSAGE_G089, "通し番号自動採番", strRepMsg) = False) Then
        'キャンセルされた
        GoTo ExitProcedure:
    End If
    
    'シートの自動計算、画面描画をOFF(処理速度向上のため)
    Call SetCalcMode(False)
    Call ScreenRedraw(False)
    Set wsSelect = ActiveSheet
    
    '自動採番実行
    Call DoAutoNumbering(wsSelect)
    
ExitProcedure:
    
    Call SetChangeStatusAsNoCheck
    'イベントを有効にする
    Application.EnableEvents = True
    
    'シートの自動計算、画面描画をON
    Call SetCalcMode(True)
    Call ScreenRedraw(True)
    
    Exit Sub
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("通し番号自動採番")
    GoTo ExitProcedure:
        
    
End Sub

'通し番号自動採番
Public Sub DoAutoNumbering(wsSelect As Worksheet)
    
    Dim lngSeqNo As Long

    With wsSelect
        
        '小計行を全て削除する
        Call DeleteSubtotalRows(wsSelect)

        Dim lngRowFirst As Long
        Dim lngRowLast As Long
        Dim lngColLeft As Long
        Dim lngColRight As Long
        Dim lngColKoujyo As Long
        Dim lngColName As Long
        Dim lngColSeq As Long
        Dim lngColNotEmpty As Long
        
        'シート情報取得
        lngRowFirst = .Range("行頭").Row + 1
        lngRowLast = .Range("行末").Row - 1
        lngColLeft = .Range("左端").column
        lngColRight = .Range("右端").column
        If .name Like "その7*" Then
            lngColName = .Range("KIFUSYA_NM").column
        Else
            lngColName = .Range("NM").column
        End If
        lngColSeq = .Range("SEQ_NO").column
        lngColNotEmpty = .Range("NOT_EMPTY").column
        
        Dim lngRow As Long
        Dim strName As String
        Dim mapName As New EasyHashMap      'Map(通し番号, 氏名)
        Dim boolExistMap As Boolean
        Dim lngCountMap As Long
        Dim lngKeyMap As Long
        lngKeyMap = 1
        
        Dim lngCountA As Long
        
        '氏名情報の取得
        For lngRow = lngRowFirst To lngRowLast
            lngCountA = 0
            If .name = "その7(1)" Then
                lngCountA = Application.WorksheetFunction.CountA( _
                    .Range(.Cells(lngRow, lngColLeft), .Cells(lngRow, lngColRight)), _
                    .Cells(lngRow, .Range("ZEIGAKUKOUJYO").column))
            Else
                lngCountA = Application.WorksheetFunction.CountA( _
                    .Range(.Cells(lngRow, lngColLeft), .Cells(lngRow, lngColRight)))
            End If
            
            '空白行はスキップ
            If lngCountA > 0 Then
            
                '氏名を取得
                strName = .Cells(lngRow, lngColName).value
                
                'Mapに通し番号と氏名を追加
                If mapName.CountItem = 0 Then
                
                    Call mapName.AddItem(CStr(lngKeyMap), strName)
                    
                    lngKeyMap = lngKeyMap + 1
                Else
                
                    boolExistMap = False
                    
                    'Mapに登録済みか確認
                    For lngCountMap = 1 To mapName.CountItem
                        If mapName.GetItem(CStr(lngCountMap)) = strName Then
                            boolExistMap = True
                            Exit For
                        End If
                    Next lngCountMap
                    
                    '未登録ならMapに追加
                    If Not boolExistMap Then
                        
                        Call mapName.AddItem(CStr(lngKeyMap), strName)
                        
                        lngKeyMap = lngKeyMap + 1
                    End If
                End If
            End If
            
        Next lngRow
        
        '通し番号の付与
        For lngCountMap = 1 To mapName.CountItem
            For lngRow = lngRowFirst To lngRowLast
                lngCountA = 0
                If .name = "その7(1)" Then
                    lngCountA = Application.WorksheetFunction.CountA( _
                        .Range(.Cells(lngRow, lngColLeft), .Cells(lngRow, lngColRight)), _
                        .Cells(lngRow, .Range("ZEIGAKUKOUJYO").column))
                Else
                    lngCountA = Application.WorksheetFunction.CountA( _
                        .Range(.Cells(lngRow, lngColLeft), .Cells(lngRow, lngColRight)))
                End If
                '空白行はスキップ
                If lngCountA > 0 Then
                    
                    'Mapと合致する氏名がいたら通し番号を付与（最大の999999を超える場合は設定しない）
                    If mapName.GetItem(CStr(lngCountMap)) = .Cells(lngRow, lngColName).value Then
                        If lngCountMap <= MAX_NUMBER_SEQNO Then
                            .Cells(lngRow, lngColSeq).Formula = lngCountMap
                        End If
                    End If
                    
                    '行のデータ存在フラグをONにする
                    .Cells(lngRow, lngColNotEmpty).Formula = "1"
                Else
                    '空白行の通し番号は外す
                    .Cells(lngRow, lngColSeq).ClearContents
                    
                    '行のデータ存在フラグをOFFにする
                    .Cells(lngRow, lngColNotEmpty).ClearContents
                End If
            Next lngRow
        Next lngCountMap

        '行番号を振りなおす
        Call RowNoRebuild(wsSelect)
    
        '罫線を引きなおす
        Call LineReDraw(wsSelect, .Range("行頭").Row + 1, .Range("行末").Row - 1, .Range("左端").column - 1, .Range("右端").column)
    End With

End Sub


'対象シートの小計行を全て削除する
'行番号は行番号は振りなおさない
Public Sub DeleteSubtotalRows(wsSelect As Worksheet)
    
    Dim lngRow As Long
    Dim lngRowEnd As Long
    Dim lngRowStart As Long
    Dim lngColLeft As Long
    Dim lngColRight As Long
    Dim rngTemp As Range
    Dim rngTempAll As Range
    
    
    With wsSelect
        
        lngRow = .Range("行頭").Row + 1
        lngRowStart = lngRow
        lngRowEnd = .Range("行末").Row - 1
        
        Do While (lngRow <= lngRowEnd)
            If .Cells(lngRow, .Range("ROWKBN").column).value = True Then
                
                If lngRowEnd - lngRowStart < 2 Then
                    
                    'クリア、初期値設定処理
                    Call SheetClear(wsSelect, lngRow)
                    
                    lngRow = lngRow + 1
                Else
                    '対象行を削除
                    .Rows(lngRow).Delete Shift:=xlShiftUp
                    '1行削除したことにより、終了行も1行上になる
                    lngRowEnd = lngRowEnd - 1
                End If
            Else
                lngRow = lngRow + 1
            End If
        Loop
    End With
    
End Sub

'指定した範囲をソートする
'isCreateSyushi … True:会計帳簿の収支報告書作成時, False:それ以外(通し番号で名寄せ) (2008/9/11 使用していない)
Private Function SortGroup(wsSelect As Worksheet, lngRowGroupFirst As Long, lngRowGroupLast As Long, isCreateSyushi As Boolean)

    Dim lngRow As Long
    Dim rngSortArea As Range
    
    Dim intColSeqno As Integer
    Dim intColSortkey As Integer
    Dim intColLeft As Integer
    Dim intColRight As Integer
    
    With wsSelect
        
        '列を取得
        intColSeqno = .Range("SEQ_NO").column
        intColSortkey = .Range("SORT_KEY").column
        intColLeft = .Range("左端").column
        If .name = "その7(1)" Then
            intColRight = .Range("ZEIGAKUKOUJYO").column
        Else
            intColRight = .Range("右端").column
        End If
        
        'ソート用のキー列を設定する（2008/11/7 通し番号をそのまま使用するよう修正）
        For lngRow = lngRowGroupFirst To lngRowGroupLast
            
            .Cells(lngRow, intColSortkey).value = .Cells(lngRow, intColSeqno).value
            
        Next lngRow
        
        '１つの範囲をソートする
        Set rngSortArea = .Range(.Cells(.Range("行頭").Row + 1, .Range("左端").column), .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").column))
        rngSortArea.Sort _
            Key1:=.Cells(lngRowGroupFirst, .Range("SORT_KEY").column), Order1:=xlAscending, _
            Key2:=.Cells(lngRowGroupFirst, .Range("DT").column), Order2:=xlAscending, _
            Header:=xlNo, MatchCase:=True, Orientation:=xlTopToBottom
    
    End With
    
End Function

Private Sub AddSubtotalRows(wsSelect As Worksheet, lngRowGroupFirst As Long, lngRowGroupLast As Long, isRebuildSeqNo As Boolean)
    
    Dim lngRow As Long                  'カレント行
    Dim lngRowEnd As Long
    Dim strSeqNo As String              '通し番号
    Dim strSeqNoPrev As String          '前の通し番号
    Dim lngSeqNoIndex As Long           '通し番号を振りなおす場合のインデックス
    Dim lngRowStartSum As Long          'SUMの開始行
    Dim strNewSeqNo As String
    Dim strTekiyo As String
    Dim strSheetName As String
    
    lngRow = lngRowGroupFirst
    lngRowEnd = lngRowGroupLast
    lngSeqNoIndex = 0
    strSeqNoPrev = "DUMMY"
    lngRowStartSum = lngRowGroupFirst
    
    With wsSelect
        strSheetName = .name
        If strSheetName Like "その7*" Then
            strTekiyo = "KIFUSYA_NM"
        Else
            strTekiyo = "NM"
        End If
        
        Do While (lngRow <= lngRowEnd)
            
            strSeqNo = .Cells(lngRow, .Range("SEQ_NO").column).value
            
            '通し番号が変わったか？
            If strSeqNo <> strSeqNoPrev Then
                
                '同じ番号が複数ある場合、小計行を挿入
                If lngRow - lngRowStartSum > 1 And IsEmptyString(strSeqNoPrev) = False Then
                    
                    '追加する小計行の通し番号を判定
                    If isRebuildSeqNo Then
                        strNewSeqNo = CStr(lngSeqNoIndex)
                    Else
                        strNewSeqNo = strSeqNoPrev
                    End If
                    
                    '小計行を追加する
                    Call InsertSubtotalRow(wsSelect, lngRow, lngRowStartSum, strNewSeqNo, strTekiyo)
                    '行が増えたため、最終行・カレント行を1行下にする
                    lngRowEnd = lngRowEnd + 1
                    lngRow = lngRow + 1
                End If
                
                '通し番号を振りなおす場合のインデックスをカウントアップ
                lngSeqNoIndex = lngSeqNoIndex + 1
                strSeqNoPrev = strSeqNo
                
                'SUMの開始行をカレント行に設定
                lngRowStartSum = lngRow
            
            End If
            
            '通し番号を振りなおす
            If isRebuildSeqNo Then
                If Not IsEmptyString(.Cells(lngRow, .Range("SEQ_NO").column).value) Then
                    .Cells(lngRow, .Range("SEQ_NO").column).value = CStr(lngSeqNoIndex)
                End If
            End If
            
            'カレント行を次の行へ
            lngRow = lngRow + 1
        Loop
        
        '最後の行に小計行が必要であれば設定する
        If lngRow - lngRowStartSum > 1 And IsEmptyString(strSeqNoPrev) = False Then
        
            '追加する小計行の通し番号を判定
            If isRebuildSeqNo Then
                strNewSeqNo = CStr(lngSeqNoIndex)
            Else
                strNewSeqNo = strSeqNoPrev
            End If
            
            '小計行を追加する
            Call InsertSubtotalRow(wsSelect, lngRow, lngRowStartSum, strNewSeqNo, strTekiyo)
            lngRowEnd = lngRowEnd + 1
        End If
        
        '小計行の数式を設定する（全ての小計行追加が完了した時点で、数式が確定するため）
        For lngRow = lngRowGroupFirst To lngRowEnd
            If .Cells(lngRow, .Range("ROWKBN").column).value = True Then
                Call SetFormulaSubtotalRow(wsSelect, lngRow, lngRowGroupFirst, lngRowEnd)
            End If
        Next lngRow
    
    End With
    
End Sub

'行番号振りなおし
Public Sub RebuildIchirenNo(wsSelect As Worksheet)
    
    Dim rngStart As Range
    
    With wsSelect

        Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("左端").column - 1)
        rngStart.Formula = "1"
    
        'オートフィル（セルを下方向にドラッグする）に任せる
'        rngStart.AutoFill Destination:=.Range(rngStart, .cells(.Range("行末").Row - 1, .Range("左端").Column - 1), Type:=xlFillSeries
        rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("左端").column - 1)), Type:=xlFillSeries
    
    End With
    
End Sub

'小計行を追加する
Private Sub InsertSubtotalRow(wsSelect As Worksheet, lngSelectRow As Long, lngRowStartSum As Long, strSeqNo As String, tekiyo As String)
    
    Call InsertRowBase(wsSelect, lngSelectRow)
    
    With wsSelect
        .Cells(lngSelectRow, .Range(tekiyo).column).value = "（小計）"
    
    
'    shl.Kingaku(lngSelectRow).Formula = _
'                "=SUM(" _
'                & shl.GetWorksheet.Range(shl.Kingaku(lngRowStartSum), shl.Kingaku(lngSelectRow - 1)).Address(RowAbsolute:=False, ColumnAbsolute:=False) _
'                & ")"
    .Cells(lngSelectRow, .Range("SEQ_NO").column).value = strSeqNo
    .Cells(lngSelectRow, .Range("ROWKBN").column).value = True
    .Cells(lngSelectRow, .Range("NOT_EMPTY").column).value = "1"
    Call CellColorChange(.Range(.Cells(lngSelectRow, .Range("左端").column), .Cells(lngSelectRow, .Range("右端").column)), False, True)
    .Range(.Cells(lngSelectRow, .Range("左端").column - 1), .Cells(lngSelectRow, .Range("右端").column + 2)).Locked = True

    End With
    
End Sub

Public Sub SetFormulaSubtotalRow(wsSelect As Worksheet, lngTargetRow As Long, lngRowStartSum As Long, lngRowEndSum As Long)
    
    With wsSelect
        '例： "=SUMIF(J8:J16,J10,O8:O16)" (通し番号が同じ明細行の金額を合計する関数)
        .Cells(lngTargetRow, .Range("KINGAKU").column).Formula = _
                    "=SUMIF(" _
                    & .Range(.Cells(lngRowStartSum, .Range("SEQ_NO").column), .Cells(lngRowEndSum, .Range("SEQ_NO").column)).Address(False, False) _
                    & "," & .Cells(lngTargetRow, .Range("SEQ_NO").column).Address(False, False) _
                    & "," & .Range(.Cells(lngRowStartSum, .Range("KINGAKU_DETAIL_ONLY").column), .Cells(lngRowEndSum, .Range("KINGAKU_DETAIL_ONLY").column)).Address(False, False) _
                    & ")"
    End With
    
End Sub

'その11, 12の金額合計セルの数式を再設定する
Private Sub SetFormulaKingakuGk(wsSelect As Worksheet)
    
    Dim intColKingaku As Integer
    Dim intColRowKbn As Integer
    Dim lngRowHeader As Long
    Dim lngRowLast As Long
    
    With wsSelect
        
        lngRowHeader = .Range("行頭").Row
        lngRowLast = .Range("行末").Row - 1
        intColKingaku = .Range("KINGAKU").column
        intColRowKbn = .Range("ROWKBN").column
        
        '金額合計の計算式を設定 [例：=SUMIF(K6:K21,"<>TRUE",D6:D21) ]
        .Range("KINGAKU_GK").Formula = _
            "=SUMIF(" _
            & .Range(.Cells(lngRowHeader, intColRowKbn), .Cells(lngRowLast, intColRowKbn)).Address(False, False) _
            & ",""<>TRUE""," _
            & .Range(.Cells(lngRowHeader, intColKingaku), .Cells(lngRowLast, intColKingaku)).Address(False, False) _
            & ")"
    End With
    
End Sub


'-------------------------------------------------------------------
  ' 関数名 ： InsertRowBase
  ' 機  能 ： 指定された行位置から、書式を維持して行を追加する
  ' 引  数 ： (in) Worksheet     … 対象ワークシートオブジェクト
  '        ： (in) lngSelectRow  … 行の追加を行う行数
  '        ： (in) lngRowGroupFirst   … 行を追加する位置のグループの先頭行（見出し行は含まない）
  '        ： (in) lngRowGroupLast    … 行を追加する位置のグループの最終行
  '        ： (in) lngInsertRows … 追加する行数（省略時:1）
  ' 返り値 ：なし
  ' 備　考 ：新規で追加された行については、セルの背景色を保証しない。
  '        ：TRUE/FALSEが設定される列がある場合でも、新規で追加された行は空の値が設定される
'-------------------------------------------------------------------
'※lngRowGroupFirst, lngRowGroupLastを指定することにより、合計金額などの計算範囲を維持して行を追加する（行のコピー＆挿入が入るため、ちょっと遅くなる）
Sub InsertRowBase(wksSheet As Worksheet, lngSelectRow As Long, _
                    Optional lngRowGroupFirst As Long = 0, _
                    Optional lngRowGroupLast As Long = 0, _
                    Optional lngInsertRows As Integer = 1)

    Dim lngI As Long
    Dim i As Integer
    Dim rngBase As Range
    Dim lngInsertRowsCurrent As Long    '追加する行数
    Dim lngSelectRowCurrent As Long     '行を追加する位置
    
    With wksSheet
        
        '行頭に行を追加する場合の事前処理
        '（事前処理を行わないで行を挿入した場合、書式が維持されないため）
        If lngSelectRow = lngRowGroupFirst Then
            
            '対象行をコピーして、対象行位置に挿入
            .Rows(lngSelectRow).Copy
            .Rows(lngSelectRow + 1).Insert Shift:=xlDown
            .Rows(lngSelectRow).ClearContents
            
            lngSelectRowCurrent = lngSelectRow + 1
            lngInsertRowsCurrent = lngInsertRows - 1
            
        '行末の下に行を追加する場合の事前処理
        '（事前処理を行わないで行を挿入した場合、追加行が金額合計などのの計算範囲から外れるため）
        ElseIf lngSelectRow = lngRowGroupLast + 1 Then

            '対象行をコピーして、対象行位置に挿入
            .Rows(lngSelectRow - 1).Copy
            .Rows(lngSelectRow - 1).Insert Shift:=xlDown
            .Rows(lngSelectRow).ClearContents
            
            lngSelectRowCurrent = lngSelectRow
            lngInsertRowsCurrent = lngInsertRows - 1
        
        '対象行から行を追加する場合
        Else
            lngSelectRowCurrent = lngSelectRow
            lngInsertRowsCurrent = lngInsertRows
        End If
        
        '残りの行を指定位置から挿入
        If lngInsertRowsCurrent > 0 Then
            Set rngBase = .Rows(CStr(lngSelectRowCurrent) & ":" & CStr(lngSelectRowCurrent) + lngInsertRowsCurrent - 1)
            rngBase.Insert Shift:=xlShiftDown
        End If
    End With

End Sub

Public Sub PutSeqNo(wksSheet As Worksheet, rngTartget As Range)
    
    With wksSheet
        
        '通し番号列があるかどうかを判定する（セルの名称の取得でエラーとなるか）
        Dim lngColSeq As Long       '通し番号の列
        On Error GoTo ErrorTrapSheetType:
            lngColSeq = .Range("SEQ_NO").column
        On Error GoTo 0
        
        On Error GoTo ErrorTrap:
        Dim lngRowHeader As Long    '行頭
        Dim lngRowFooter As Long    '行末
        Dim lngColLeft As Long      '左端の列
        Dim lngColRight As Long     '右端の列
        Dim lngColRowkbn As Long    '行区分の列
        Dim rngArea As Range
        Dim lngColNotEmpty As Long       '通し番号の列
        Dim i As Long
        Dim lngCurrentRow As Long
        Dim lngNewSeqNo As Long     '新しい通し番号
        
        'Undo設定の判断に使用するフラグ
        Dim isChangeData As Boolean         '変更された行のうち、Changeイベント前に入力があった行が含まれるかどうか
        Dim isSetSeqNo As Boolean      '通し番号を設定したかどうか
        isChangeData = False
        isSetSeqNo = False
    
        'イベントを無効にする
        Application.EnableEvents = False
        
        '列の取得（処理速度の観点から、シートハンドラは使わない）
        lngRowHeader = .Range("行頭").Row
        lngColLeft = .Range("左端").column
            
        lngRowFooter = .Range("行末").Row
        If wksSheet.name = "その7(1)" Then
            lngColRight = .Range("ZEIGAKUKOUJYO").column
        Else
            lngColRight = .Range("右端").column
        End If
            
        lngColRowkbn = .Range("ROWKBN").column
        lngColNotEmpty = .Range("NOT_EMPTY").column

        If rngTartget.Row <= lngRowHeader Or rngTartget.Row >= lngRowFooter Then
            GoTo ExitProcedure
        End If

        For Each rngArea In rngTartget.Areas
            
            For i = 1 To rngArea.Rows.Count
                lngCurrentRow = rngArea.Cells(i, 1).Row
                
                'Changeイベントの前は、入力があった行
                If Len(.Cells(lngCurrentRow, lngColNotEmpty).Formula) > 0 Then
                    'Changeイベント後に空になった場合
                    If Application.WorksheetFunction.CountA(.Range(.Cells(lngCurrentRow, lngColLeft), .Cells(lngCurrentRow, lngColRight))) = 0 Then
                        '行のデータ存在フラグをOFFにする
                        .Cells(lngCurrentRow, lngColNotEmpty).ClearContents
                    End If
                    isChangeData = True
                
                'Changeイベントの前は、空であった行
                Else
                    
                    'Changeイベント後に入力がある場合（＝空の行に入力された）
                    If Application.WorksheetFunction.CountA(.Range(.Cells(lngCurrentRow, lngColLeft), .Cells(lngCurrentRow, lngColRight))) > 0 Then
                        '行のデータ存在フラグをONにする
                        .Cells(lngCurrentRow, lngColNotEmpty).Formula = "1"
                        
                        '通し番号を設定する(通し番号を直接入力された場合を除く)
                        If Len(.Cells(lngCurrentRow, lngColSeq).Formula) = 0 Then
                        
                            '新しい通し番号を取得
                            lngNewSeqNo = GetNewSeqNo(wksSheet, lngCurrentRow, lngRowHeader, _
                                            lngRowFooter, lngColLeft, lngColRight, lngColSeq, lngColRowkbn)
                            
                            '通し番号を設定 （最大の999999を超える場合は設定しない）
                            If lngNewSeqNo <= MAX_NUMBER_SEQNO Then
                                .Cells(lngCurrentRow, lngColSeq).Formula = lngNewSeqNo
                            End If
                            
                            isSetSeqNo = True
                        End If
                    End If
                End If
                
            Next i
            
        Next
    End With
    
    'Undo用
    If isSetSeqNo = True And isChangeData = False Then
        Set mrngLastChange = rngTartget
        Application.OnUndo "空白行へ入力（マクロ）", "UndoBeforeRunMacro"
    End If
    
ExitProcedure:

    'イベントを有効にする
    Application.EnableEvents = True
    
    Exit Sub
ErrorTrap:
    Debug.Print "通し番号設定処理で例外発生：" & Err.Description
    GoTo ExitProcedure:
        
ErrorTrapSheetType:
    Exit Sub
    
End Sub

Private Function GetNewSeqNo( _
                            wksSheet As Worksheet, _
                            lngCurrentRow As Long, _
                            lngRowHeader As Long, _
                            lngRowFooter As Long, _
                            lngColLeft As Long, _
                            lngColRight As Long, _
                            lngColSeq As Long, _
                            lngColRowkbn As Long) As Long
    
    Dim lngRow As Long
    Dim lngRowFirst As Long
    Dim lngRowLast As Long
    
    With wksSheet
        
        '次の見出し行、または最終行を取得する
        lngRowLast = .Range("行末").Row - 1
        lngRowFirst = .Range("行頭").Row + 1
        
        '対象となる見出し範囲から、通し番号の最大を求め、その＋１の値を新しい通し番号とする
        GetNewSeqNo = Application.WorksheetFunction.Max(.Range(.Cells(lngRowFirst, lngColSeq), .Cells(lngRowLast, lngColSeq))) + 1
        
    End With
    
End Function

Public Sub UndoBeforeRunMacro()
    
    On Error GoTo ErrorTrap:
    
    Dim lngRowHeader As Long    '行頭
    Dim lngRowFooter As Long    '行末
    Dim lngColLeft As Long      '左端の列
    Dim lngColRight As Long     '右端の列
    Dim rngArea As Range
    Dim lngColSeq As Long       '通し番号の列
    Dim lngColRowkbn As Long    '行区分の列
    Dim lngColNotEmpty As Long       '通し番号の列
    Dim lngColZEIGAKUKOUJYO As Long  '寄附金控除の列
    Dim i As Long
    Dim lngCurrentRow As Long
    
    'イベントを無効にする
    Application.EnableEvents = False
    
    '行
    With mrngLastChange.Worksheet
        
        lngRowHeader = .Range("行頭").Row
        lngColLeft = .Range("左端").column
        lngRowFooter = .Range("行末").Row
        lngColRight = .Range("右端").column
        
        lngColSeq = .Range("SEQ_NO").column
        lngColRowkbn = .Range("ROWKBN").column
        lngColNotEmpty = .Range("NOT_EMPTY").column
        
        For Each rngArea In mrngLastChange.Areas
            For i = 1 To rngArea.Rows.Count
                lngCurrentRow = rngArea.Cells(i, 1).Row
                
                .Range(.Cells(lngCurrentRow, lngColLeft), .Cells(lngCurrentRow, lngColRight)).ClearContents
                .Cells(lngCurrentRow, lngColSeq).ClearContents
                .Cells(lngCurrentRow, lngColNotEmpty).ClearContents
                If ActiveSheet.name = "その7(1)" Then
                    lngColZEIGAKUKOUJYO = .Range("ZEIGAKUKOUJYO").column
                    .Cells(lngCurrentRow, lngColZEIGAKUKOUJYO).ClearContents
                End If
            Next i
        Next
    End With
    
ExitProcedure:

    'イベントを有効にする
    Application.EnableEvents = True
    
    Exit Sub
ErrorTrap:
    Debug.Print "Undo処理で例外発生：" & Err.Description
    GoTo ExitProcedure:
    
End Sub

'指定シートの背景色、値、ロックをクリアする（デフォルト値の設定が必要なものは行う）
'lngCurrentRow … クリア対象行、省略時はシート全体を対象とする
Sub SheetClear(wsSelect As Worksheet, Optional lngCurrentRow As Long = 0)

    Dim intLeftCol As Integer, intRightCol As Integer, lngFirstRow As Long, lngLastRow As Long
    Dim intSortkeyCol As Integer
    Dim rngDelete As Range
    Dim intDeleteCol As Integer
    Dim strsname As String
    Dim blnSingleRow As Boolean

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    
    If lngCurrentRow <> 0 Then
        lngFirstRow = lngCurrentRow - 1 '+1されるので-1しておく
        lngLastRow = lngCurrentRow + 1  '-1されるので+1しておく
        blnSingleRow = True
    Else
        lngFirstRow = wsSelect.Range("行頭").Row
        lngLastRow = wsSelect.Range("行末").Row
    End If

    With wsSelect

    strsname = wsSelect.name


    If strsname = "その3" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KINGAKU_GK")
        End If
        
        intRightCol = .Range("KAIKEI_HEADLINE_NO").column
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア(非表示列を含めてクリア)

    ElseIf strsname = "その4" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KINGAKU_GK")
        End If
        
        intRightCol = .Range("KAIKEI_DT").column
    
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア(非表示列を含めてクリア)

    ElseIf strsname = "その5" Then
    
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KINGAKU_GK")
        End If
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア
    
    ElseIf strsname = "その6" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "MIMAN_GK") 'MIMAN_GK セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        intRightCol = .Range("KAIKEI_DT").column
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol)    'セル色クリア 内容クリア(非表示列を含めてクリア)

    ElseIf strsname Like "その7*" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        intRightCol = .Range("ZEIGAKUKOUJYO").column
        
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("ROWKBN").column, "FALSE") 'ROWKBNをFALSEにセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("NOT_EMPTY").column, "") 'NOT_EMPTYを空文字列にセット

        ''''注意！「寄附金（税額）控除」クリアのため 「ZEIGAKUKOUJYO」 指定
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア
        
        'SORT_KEY列（通し番号で名寄せ、会計帳簿からの作成で使用）をクリアする
        intSortkeyCol = .Range("SORT_KEY").column
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intSortkeyCol, intSortkeyCol) '(1列のみ) セル色クリア 内容クリア
        
        '2008/08/04 FIX 小計以外の行がロックのまま
        Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'ロッククリア

    ElseIf strsname Like "その8*" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        '2008/08/04 FIX クリア右端を右端XMLに再設定（ROWKBNまで）
        intRightCol = .Range("右端XML").column
        
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("ROWKBN").column, "FALSE") 'ROWKBNをFALSEにセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("NOT_EMPTY").column, "") 'NOT_EMPTYを空文字列にセット
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア '2008/08/04 FIX 右端XMLまで削除
        
        'SORT_KEY列（通し番号で名寄せ、会計帳簿からの作成で使用）をクリアする
        intSortkeyCol = .Range("SORT_KEY").column
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intSortkeyCol, intSortkeyCol) '(1列のみ) セル色クリア 内容クリア
        
        '2008/08/04 FIX 小計以外の行がロックのまま
        Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol - 1) 'セルロッククリア
    
    ElseIf strsname = "その9" Or _
            strsname = "その10" Then
    
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア

    ElseIf strsname Like "その11*" Or _
            strsname Like "その12*" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "PATYI_NM")   'PATYI_NM セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
            .Range("SORT_NO").ClearContents         'SORT_NO 内容クリア、セル色は変更不要
        End If
        
        '2008/08/04 FIX クリア右端を右端XMLに再設定（ROWKBNまで）
        intRightCol = .Range("右端XML").column
        
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("ROWKBN").column, "FALSE") 'ROWKBNをFALSEにセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("NOT_EMPTY").column, "") 'NOT_EMPTYを空文字列にセット
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア
        
        'SORT_KEY列（通し番号で名寄せ、会計帳簿からの作成で使用）をクリアする
        intSortkeyCol = .Range("SORT_KEY").column
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intSortkeyCol, intSortkeyCol) '(1列のみ) セル色クリア 内容クリア
        
        '2008/08/04 FIX 小計以外の行がロックのまま
        Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol - 1) 'セルロッククリア
        
    ElseIf strsname Like "その14*" Then

        '「領収書を徴し難かったもの」列の内容をクリア（セル色は変更しない）
        intDeleteCol = .Range("RYOUSYU").column
        GoSub DeleteColumn
        
        '「交付金に係る支出」列の内容をクリア（セル色は変更しない）
        intDeleteCol = .Range("KOUFUKIN").column
        GoSub DeleteColumn
        
        '「領収書を徴し難かったもの」列のセル色を黄色に変更
        Call ExceptionCellColorChange(wsSelect, lngFirstRow + 1, lngLastRow - 1)
        
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("KAIKEI_HEADLINE_NO").column, "")    'KAIKEI_HEADLINE_NOを空文字列にセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("KAIKEI_SEQ_NO").column, "")         'KAIKEI_SEQ_NOを空文字列にセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("KAIKEI_JIJYOU").column, "")         'KAIKEI_JIJYOUを空文字列にセット
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If

        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア（右端まで）
    
    ElseIf strsname Like "その15*" Then
    
        '「領収書を徴し難かったもの」列の内容をクリア（セル色は変更しない）
        intDeleteCol = .Range("RYOUSYU").column
        GoSub DeleteColumn
        
        '「交付金に係る支出」列の内容をクリア（セル色は変更しない）
        intDeleteCol = .Range("KOUFUKIN").column
        GoSub DeleteColumn
        
        '「領収書を徴し難かったもの」列のセル色を黄色に変更
        Call ExceptionCellColorChange(wsSelect, lngFirstRow + 1, lngLastRow - 1)
        
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("KAIKEI_SEQ_NO").column, "") 'KAIKEI_SEQ_NOを空文字列にセット
        Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, .Range("KAIKEI_JIJYOU").column, "") 'KAIKEI_JIJYOUを空文字列にセット

        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "HIMOKU") 'HIMOKU セル色クリア 内容クリア
            Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア（右端まで）
    
    ElseIf strsname = "その16" Then
    
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
        End If
        
        intRightCol = .Range("KAIKEI_SHISYUTU_KMK_NO").column
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア

    ElseIf strsname Like "その18*" Then
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア

    ElseIf strsname Like "その19*" Then
        
        If blnSingleRow = False Then
            Call RangeClear(wsSelect, "KBN_1") '項目別区分 内容クリア
            Call RangeClear(wsSelect, "KBN_2") '項目別区分 内容クリア
            Call RangeClear(wsSelect, "KBN_3") '項目別区分 内容クリア
            Call CellColorChange(.Range("KOMOKU_KBN_1"), False)
            Call CellColorChange(.Range("KOMOKU_KBN_2"), False)
            Call CellColorChange(.Range("KOMOKU_KBN_3"), False)
        End If
    
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    ElseIf strSName = "8号様式" Then
    ElseIf strsname = "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        
        Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア

    End If

    End With

Exit Sub

DeleteColumn:

    Set rngDelete = wsSelect.Range(wsSelect.Cells(lngFirstRow + 1, intDeleteCol), wsSelect.Cells(lngLastRow - 1, intDeleteCol))
    '注意、RangeDeleteValueはLockセルはスルーする
    Call RangeDeleteValue(wsSelect, "", rngDelete)

    Return

End Sub

'その11,12のシートの並び順を、パーティー順にする
'※ブックの保護が解除されていること
'※通常のシート順であることが前提
Public Sub SortPartySheetsByParty()
    
    Dim wksActive As Worksheet
    Set wksActive = ActiveSheet
    
    'その11シートの並び順を変更
    Call SortOneYousikiPartySheets("その11")
    
    'その12シートの並び順を変更
    Call SortOneYousikiPartySheets("その12")
    
    'ブック全体の再計算（これを行わないと、他シートを参照する数式セルが更新されない）
    Call ResetFormulasToOtherSheet
    
    'アクティブシートが変わってしまうので、元に戻す
    wksActive.Activate

End Sub



'その11,12のうち指定した様式について、シートの並び順をパーティー順にする
'※通常のシート順であることが前提
'　（パーティー順の場合、動作するはずだが、十分なテストはしていない）
'※ブックの保護が解除されていること
'strTargetYousiki … "その11" or "その12"
Public Sub SortOneYousikiPartySheets(strTargetYousiki As String)
    
    Dim strSheetNameArray() As String
    Dim strSortNoArray() As String
    Dim lngSheetCount As Long
    Dim wsSelect As Worksheet
    Dim lngFirstSheetIndex As Long
    Dim i As Long
    Dim lngSortNoMax As Long
    Dim lngSortNoMin As Long
    Dim lngSortNoThis As Long
    
    '配列のサイズをシート数で設定する
    If strTargetYousiki = "その11" Then
        'その11の場合
        lngFirstSheetIndex = Worksheets("その10").Index + 1
        lngSheetCount = Worksheets("その12(1)(1)").Index - lngFirstSheetIndex
    Else
        'その12の場合
        lngFirstSheetIndex = Worksheets("その12(1)(1)").Index
        lngSheetCount = Worksheets("その13").Index - lngFirstSheetIndex
    End If
    ReDim strSheetNameArray(lngSheetCount) As String
    ReDim strSortNoArray(lngSheetCount) As String
    
    lngSortNoMax = 0&       '最大値の初期値
    lngSortNoMin = 1000000  '最小値の初期値（パーティー番号の最大値999999より多い値）
    
    '(1)シート名とソート番号の２つの配列を作成し、存在するソート番号の最大値・最小値を取得する
    For i = 0 To lngSheetCount - 1
    
        With Worksheets(lngFirstSheetIndex + i)
            
            strSheetNameArray(i) = .name
            strSortNoArray(i) = .Range("SORT_NO").value
            
            'ソート番号が空欄でなければ、ソート番号の最大値・最小値を更新
            If IsEmptyString(strSortNoArray(i)) = False And IsNumeric(strSortNoArray(i)) = True Then
                lngSortNoThis = CLng(strSortNoArray(i))
                
                'ソート番号の最大値を更新
                If lngSortNoThis > lngSortNoMax Then
                    lngSortNoMax = lngSortNoThis
                End If
                'ソート番号の最小値を更新
                If lngSortNoThis < lngSortNoMin Then
                    lngSortNoMin = lngSortNoThis
                End If
            End If
            
        End With
    Next i
    
    Dim wksMoveBase As Worksheet   'シートを並び替える際、このシートの後ろに並べる
    Dim strSortNoThis As String
    Dim lngIndexArrays As Long
    Dim wksCurrentSheet As Worksheet
    
    '開始シートのひとつ前のシートを取得
    Set wksMoveBase = Worksheets(lngFirstSheetIndex - 1)
    
    '(2)ソート番号が設定されているシートを、ソート番号の小さい順かつ現状の並び順に左側に並べていく
    For i = lngSortNoMin To lngSortNoMax
        
        strSortNoThis = CStr(i)
        
        'シート名およびソート番号の配列をループ
        For lngIndexArrays = 0 To UBound(strSheetNameArray)
            
            '現在ループ中のソート番号か？　かつ処理済のシート名でないか？ その11・12の別は、対象様式であるか？
            If strSortNoArray(lngIndexArrays) = strSortNoThis _
                And Len(strSheetNameArray(lngIndexArrays)) > 0 _
                And strSheetNameArray(lngIndexArrays) Like strTargetYousiki & "*" Then
                
                '現在のシートを保持
                Set wksCurrentSheet = Worksheets(strSheetNameArray(lngIndexArrays))
                
                '現在のシートを、ベースのシートの後ろに並べる(既にそのように並んでいる場合は何もしない)
                If wksCurrentSheet.Index - wksMoveBase.Index <> 1 Then
                    wksCurrentSheet.Move after:=wksMoveBase     '(参考)ブックの保護が解除されていないとこの行で失敗する
                End If
                
                '現在のシートを、ベースのシートとする
                Set wksMoveBase = wksCurrentSheet
                
                'シート名の配列から、このシートを除外する（クリアする）
                strSheetNameArray(lngIndexArrays) = ""
                
            End If
            
        Next lngIndexArrays
        
    Next i
    
    
End Sub

'その11,12のシートの並び順を、通常の順にする
'※ブックの保護が解除されていること
Public Sub SortPartySheetsByNormal()

    Dim strCurrentSheet As String
    Dim wksMoveBase As Worksheet   'シートを並び替える際、このシートの後ろに並べる
    Dim wksCurrentSheet As Worksheet
    Dim intKubun As Integer
    Dim intEdaban As Integer
    Dim intYousiki As Integer
    Dim lngFirstSheetIndex As Long
    Dim lngSheetCount As Long           'その11～12のシートの数
    Dim lngSheetCountDefault As Long    'その11～12で必ず存在するシートの数(6)
    Dim wksActive As Worksheet
    Set wksActive = ActiveSheet
    
    'その11～その12のシートの数を数える
    lngFirstSheetIndex = Worksheets("その10").Index + 1
    lngSheetCount = Worksheets("その13").Index - lngFirstSheetIndex
    lngSheetCountDefault = 6    'その11～12で必ず存在するシートの数＝6
    
    '開始シートのひとつ前のシートを取得
    Set wksMoveBase = Worksheets(lngFirstSheetIndex - 1)
    
    'その11～12のループ
    For intYousiki = 11 To 12
        
        '区分1～3のループ
        For intKubun = 1 To 3
            
            '枝番[その11(1)(3) の3の部分]のループ：
            '　1から「その11～12で追加したシート数合計（現在のシート数－必ず存在するシート数）+1」までループ
            For intEdaban = 1 To lngSheetCount - lngSheetCountDefault + 1
                
                'ループ中の区分、枝番をもつシートを取得（なければ""が返される）
                strCurrentSheet = GetPartySheetName("その" & CStr(intYousiki), intKubun, intEdaban)
                
                If strCurrentSheet <> "" Then
                
                    '該当シートが存在する場合、現在のシートを保持
                    Set wksCurrentSheet = Worksheets(strCurrentSheet)
                    
                    '現在のシートを、ベースのシートの後ろに並べる(既にそのように並んでいる場合は何もしない)
                    If wksCurrentSheet.Index - wksMoveBase.Index <> 1 Then
                        wksCurrentSheet.Move after:=wksMoveBase     '(参考)ブックの保護が解除されていないとこの行で失敗する
                    End If
                    
                    '現在のシートを、ベースのシートとする
                    Set wksMoveBase = wksCurrentSheet

                End If

            Next intEdaban
        Next intKubun
    Next intYousiki

    'ブック全体の再計算（これを行わないと、他シートを参照する数式セルが更新されない）
    Call ResetFormulasToOtherSheet
    
    'アクティブシートが変わってしまうので、元に戻す
    wksActive.Activate

End Sub

'区分と枝番からシート名を返す。存在しない場合は""を返す
Private Function GetPartySheetName(strYousiki As String, intKubun As Integer, intEdaban As Integer) As String
    
    Dim wksTemp As Worksheet
    
    'シート名を指定して、取得を試みる（無ければ例外がトラップされる）
    On Error GoTo ErrorTrap:
    Set wksTemp = Worksheets(strYousiki & "(" & CStr(intKubun) & ")(" & CStr(intEdaban) & ")")
    On Error GoTo 0
    
    GetPartySheetName = wksTemp.name
    
    Exit Function
    
ErrorTrap:
    
    GetPartySheetName = ""
    
End Function

'指定セル(rngTarget)に設定されているハイパーリンクの参照先を、rngLinkCellに変更する
Public Sub SetHyperlink(rngTarget As Range, rngLinkCell As Range)
    
    rngTarget.Hyperlinks(1).SubAddress = _
        "'" & rngLinkCell.Worksheet.name & "'!" & rngLinkCell.Address(False, False)

End Sub

'メニューのその11、その12へリンク先を変更する
'（※現仕様では、各区分で最も左にあるシートは、「その11(2)(1)」のように枝番が1になるので、変更する必要は無い）
Public Sub SetLinkPartySheets(isSortedByParty As Boolean)
    
    Dim wksLinkSheet As Worksheet
    Dim lngSheetIndexFirst As Long
    Dim lngSheetIndexLast As Long
    
    'その11～その12のシートインデックスを取得
    If isSortedByParty = True Then
        lngSheetIndexFirst = Worksheets("その10").Index + 1
        lngSheetIndexLast = Worksheets("その13").Index - 1
    End If
    
    With Worksheets("メニュー")
        
        
        'パーティーでソートされてる場合は、各区分で最も左にあるシートをリンク先にする
        If isSortedByParty = True Then
            'その11(1)
            Set wksLinkSheet = GetLeftmostSheet("その11(1)*", lngSheetIndexFirst, lngSheetIndexLast)    '最も左のシートを取得
            Call SetHyperlink(.Range("F20"), wksLinkSheet.Range("PATYI_NM"))                            'リンク先を設定
            
            'その11(2)
            Set wksLinkSheet = GetLeftmostSheet("その11(2)*", lngSheetIndexFirst, lngSheetIndexLast)
            Call SetHyperlink(.Range("F21"), wksLinkSheet.Range("PATYI_NM"))
            
            'その11(3)
            Set wksLinkSheet = GetLeftmostSheet("その11(3)*", lngSheetIndexFirst, lngSheetIndexLast)
            Call SetHyperlink(.Range("F22"), wksLinkSheet.Range("PATYI_NM"))
            
            'その12(1)
            Set wksLinkSheet = GetLeftmostSheet("その12(1)*", lngSheetIndexFirst, lngSheetIndexLast)
            Call SetHyperlink(.Range("F24"), wksLinkSheet.Range("PATYI_NM"))
            
            'その12(2)
            Set wksLinkSheet = GetLeftmostSheet("その12(2)*", lngSheetIndexFirst, lngSheetIndexLast)
            Call SetHyperlink(.Range("F25"), wksLinkSheet.Range("PATYI_NM"))
            
            'その12(3)
            Set wksLinkSheet = GetLeftmostSheet("その12(3)*", lngSheetIndexFirst, lngSheetIndexLast)
            Call SetHyperlink(.Range("F26"), wksLinkSheet.Range("PATYI_NM"))
        
        'シートがソートされていない場合は、枝番は(1)のシートをリンク先にする
        Else
            'その11(1)
            Call SetHyperlink(.Range("F20"), Worksheets("その11(1)(1)").Range("PATYI_NM"))
            'その11(2)
            Call SetHyperlink(.Range("F21"), Worksheets("その11(2)(1)").Range("PATYI_NM"))
            'その11(3)
            Call SetHyperlink(.Range("F22"), Worksheets("その11(3)(1)").Range("PATYI_NM"))
            'その12(1)
            Call SetHyperlink(.Range("F24"), Worksheets("その12(1)(1)").Range("PATYI_NM"))
            'その12(2)
            Call SetHyperlink(.Range("F25"), Worksheets("その12(2)(1)").Range("PATYI_NM"))
            'その12(3)
            Call SetHyperlink(.Range("F26"), Worksheets("その12(3)(1)").Range("PATYI_NM"))
            
        End If
        
    End With



End Sub

'指定したシートインデックス内で、strPatternに合致するシート名のうち、最も左にあるシートを取得する
'なければNothingを返す
Private Function GetLeftmostSheet(strPattern As String, lngSheetIndexFirst As Long, lngSheetIndexLast As Long) As Worksheet
    
    Dim i As Long
    Set GetLeftmostSheet = Nothing
    
    'インデックス内でループし、パターンにマッチするシート名なら返却する
    For i = lngSheetIndexFirst To lngSheetIndexLast
        
        If Worksheets(i).name Like strPattern Then
            
            Set GetLeftmostSheet = Worksheets(i)
            Exit Function
            
        End If
        
    Next i
    
End Function

'他シートを参照する数式を再設定する
'※シートの位置を移動すると、他シートを参照する数式が更新されなくなる場合があるため
Public Sub ResetFormulasToOtherSheet()
    
    Dim wsSelect As Worksheet
    Dim strSheetName As String
    
    '*** Excel 2002以降 ***
    ' ⇒Application.CalculateFullRebuildで再設定する
    If CInt(Application.Version) > EXCEL_VERSION_2000 Then
        
        'データをすべて計算し、依存を再構築
        Application.CalculateFullRebuild
    
    '*** Excel 2000以前 ***
    ' ⇒Application.CalculateFullRebuildが使用できないため、１セルずつ数式を再設定する
    Else
        
        '数式を再設定するため、シート保護を解除
        Call zUnlock
        
        'その13のうち、他シートを参照する数式を再設定
        With Worksheets("その13")
            Call ResetSingleFormula(.Range("SOSIKI_GK"))
            Call ResetSingleFormula(.Range("SENKYO_GK"))
            Call ResetSingleFormula(.Range("HAKKOU_JIGYO_GK"))
            Call ResetSingleFormula(.Range("SENDEN_GK"))
            Call ResetSingleFormula(.Range("KAISAI_GK"))
            Call ResetSingleFormula(.Range("SONOTA_GK"))
            Call ResetSingleFormula(.Range("CYOUSA_GK"))
            Call ResetSingleFormula(.Range("KIFU_GK"))
            Call ResetSingleFormula(.Range("SONOTA_KEIHI_GK"))
        End With
        
        'その2のうち、他シートを参照する数式を再設定(その13を参照するため、その13の後に実行する)
        With Worksheets("その2")
            Call ResetSingleFormula(.Range("HONNEN_SYUNYU_GK"))
            Call ResetSingleFormula(.Range("SISYUTU_SGK"))
            Call ResetSingleFormula(.Range("KOJIN_KIFU_GK"))
            Call ResetSingleFormula(.Range("TOKUTEI_KIFU_GK"))
            Call ResetSingleFormula(.Range("HOJIN_KIFU_GK"))
            Call ResetSingleFormula(.Range("SEIJI_KIFU_GK"))
            Call ResetSingleFormula(.Range("ATUSEN_GK"))
            Call ResetSingleFormula(.Range("TOKUMEI_KIFU_GK"))
        End With
        
        'その20のうち、他シートを参照する数式を再設定
        With Worksheets("その20")
            Call ResetSingleFormula(.Range("DANTAI_NM"))
            Call ResetSingleFormula(.Range("KAI_NM1"))
            Call ResetSingleFormula(.Range("KAI_NM2"))
        End With
        
        '8号様式の2のうち、他シートを参照する数式を再設定
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'        With Worksheets("8号様式の2")
        With Worksheets("16号様式")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
            Call ResetSingleFormula(.Range("DANTAI_NM_ORIGIN"))
        End With
        
        '全シートの「エラーチェック済」表示を再設定
        For Each wsSelect In Worksheets
            
            Call ResetSingleFormula(wsSelect.Range("DISP_CHECK_STATUS"))
            
        Next
    
        Application.CalculateFull
    
        'シート保護状態に戻す
        Call zLock
    
    End If
    
End Sub

'対象セルの数式を再設定する
Private Sub ResetSingleFormula(rngTarget As Range)
    
    rngTarget.Formula = rngTarget.Formula
    
End Sub


'「選択範囲を日付順に並び替え」ボタン押下処理
Public Sub CommandSortByDate()
    
    On Error GoTo ErrorTrap:
    
    Dim rngTargetRows As Range
    Dim lngRowBackup As Long
    Dim lngColBackup As Long
    Dim lngRowStart As Long
    Dim lngRowEnd As Long
    Dim lngSelectRows As Long
    Dim intResponse As Integer
    Dim hasSelection As Boolean
    Dim wksSheet As Worksheet
    Dim strDialogTitle As String
    strDialogTitle = "選択範囲を日付順に並び替え"
    Set wksSheet = ActiveSheet

    lngRowBackup = ActiveCell.Row
    lngColBackup = ActiveCell.column
    
    'ソート開始行、ソート終了行を取得
    With ActiveWindow.RangeSelection.Areas(1)
        lngSelectRows = .Rows.Count
        lngRowStart = .Row
        lngRowEnd = lngRowStart + lngSelectRows - 1
    End With
        
    With wksSheet
        If lngSelectRows > 1 Then
        '選択範囲の並び替えの場合
            hasSelection = True
        Else
        'シート全体の並び替えの場合
            hasSelection = False
        End If
        
        '選択範囲での並び替えの場合
        If hasSelection Then
            'ソート範囲のチェック
            If CheckSortByDate(wksSheet, lngRowStart, lngRowEnd) = False Then
                Exit Sub
            End If
            
            '取得した行を選択して表示する
            Set rngTargetRows = ActiveWindow.RangeSelection.Areas(1).EntireRow
            rngTargetRows.Select
            
            '確認ダイアログの表示
            intResponse = MsgBox("選択されている範囲を、日付順に並び替えます。" & vbCrLf & _
                                 "実行してよろしいですか？" & vbCrLf & vbCrLf & _
                                 "(※範囲を選択せずにこのボタンを押すと、シート全体を並び替えできます。)", _
                                 vbYesNo + vbInformation, strDialogTitle)
            If intResponse <> vbYes Then
                Exit Sub
            End If
            
        'シート全体でのソートの場合
        Else
            '確認ダイアログの表示
            intResponse = MsgBox("このシート全体のデータを日付順に並び替えます。" & vbCrLf & vbCrLf & _
                                 "実行してよろしいですか？", _
                                 vbYesNo + vbInformation, strDialogTitle)
            If intResponse <> vbYes Then
                Exit Sub
            End If
        End If
        
        'ソート処理
        Application.EnableEvents = False    'イベントを無効にする
        Call ScreenRedraw(False)            '画面描画OFF
        Call SetCalcMode(False)             '自動計算OFF
        
        '「エラーチェック済」を解除
        Call SetChangeStatusAsNoCheck
        
        If hasSelection Then
            '選択範囲をソートする
            Call SortByDate(wksSheet, lngRowStart, lngRowEnd)
        Else
            'シート全体をソートする
            Call SortByDate(wksSheet, .Range("行頭").Row + 1, .Range("行末").Row - 1)
        End If
        
        '行番号を振りなおす
        Call RebuildIchirenNo(wksSheet)
         
        '罫線を引きなおす
        Call LineReDraw(wksSheet, .Range("行頭").Row + 1, .Range("行末").Row - 1, .Range("左端").column - 1, .Range("右端").column)
        
        '範囲の選択を解除
        wksSheet.Cells(lngRowBackup, lngColBackup).Select
    
    End With
    
ExitProcedure:
    
    Call SetCalcMode(True)              '自動計算ON
    Call ScreenRedraw(True)             '画面描画ON
    Application.EnableEvents = True     'イベントを有効にする
    
    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(strDialogTitle)
    GoTo ExitProcedure:
End Sub

'ソート範囲のチェック
Private Function CheckSortByDate(wksSelect As Worksheet, lngRowStart As Long, lngRowEnd As Long) As Boolean
    
    Dim i As Long
    Dim strDialogTitle As String
    strDialogTitle = "選択範囲を日付順に並び替え"
    
    CheckSortByDate = True
    
    With wksSelect
        
        '行頭～行末であるか？
        If lngRowStart <= .Range("行頭").Row _
            Or lngRowEnd >= .Range("行末").Row Then
            
            CheckSortByDate = False
            MsgBox "指定された行は並び替えできません。", vbExclamation, strDialogTitle
            Exit Function
        End If
        
    End With
    
End Function

'「年月日」、「開催年月日」でソート
Private Function SortByDate(wksSelect As Worksheet, lngRowSortFirst As Long, lngRowSortLast As Long)

    Dim lngRow As Long
    Dim rngSortArea As Range
    Dim rngKeyCol As Range
    Dim lngColLeftEdge As Long
    Dim lngColRightEdge As Long
    
    With wksSelect
    
        'ソートキーカラムの設定
        If .name = "その10" Then
            'その10の場合（カラム名:KAISAI_DT）
            Set rngKeyCol = .Range("KAISAI_DT")
        Else
            'それ以外（カラム名:DT）
            Set rngKeyCol = .Range("DT")
        End If
        
        'ソート対象の左端、右端のカラムの設定
        If .name Like "その14*" Or .name Like "その15*" Then
            'その14,15の場合　（"右端"列の左の非表示列も対象とする）
            lngColLeftEdge = .Range("左端").column
            lngColRightEdge = .Range("KAIKEI_JIJYOU").column
        Else
            'それ以外
            lngColLeftEdge = .Range("左端").column
            lngColRightEdge = .Range("右端").column
        End If
        
        '１つの範囲をソートする
        Set rngSortArea = .Range(.Cells(lngRowSortFirst, lngColLeftEdge), .Cells(lngRowSortLast, lngColRightEdge))
        rngSortArea.Sort _
            Key1:=rngKeyCol, Order1:=xlAscending, _
            Header:=xlNo, MatchCase:=True, Orientation:=xlTopToBottom
    
    End With
    
End Function

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： txtTebikiLink_Click
' 機  能 ： 手引を開くクリック時の処理
' 引  数 ： 無し
' 返り値 ： 無し
'-------------------------------------------------------------------
Private Sub txtTebikiLink_Click()

On Error GoTo Error_txtTebikiLink_Click:
    'URLを開く
    CreateObject("Wscript.Shell").Run (LINK_TEBIKI)

    Exit Sub
    
Error_txtTebikiLink_Click:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'-------------------------------------------------------------------
' 関数名 ： changeTokuteiKifu
' 機  能 ： その2の「（うち特定寄附）【金額】」の制御処理
' 引  数 ： 無し
' 返り値 ： 無し
'-------------------------------------------------------------------
Public Sub changeTokuteiKifu()
    '（うち特定寄附）【金額】の制御
    Dim wsSelect As Worksheet
    Set wsSelect = Worksheets("その2")
    
    With wsSelect
    
        'シートの保護解除
        Call UnlockOneSheet(wsSelect)
        
        'その7(1)の「寄附者の氏名」項目に特定寄附が存在しない、かつセルのロックがかかっている場合
        If checkTokuteiKifu = False And .Range("TOKUTEI_KIFU_GK").Locked = True Then
        
            '（うち特定寄附）【金額】入力可能に変更
            .Range("TOKUTEI_KIFU_GK").Locked = False
            '表示状態に変更
            .Range("TOKUTEI_KIFU_GK").FormulaHidden = False
            '数式だけ削除
            .Range("TOKUTEI_KIFU_GK").value = .Range("TOKUTEI_KIFU_GK").value
            '5万円を超える金額の場合、初期化
            If .Range("TOKUTEI_KIFU_GK").value > 50000 Then
                .Range("TOKUTEI_KIFU_GK").value = 0
            End If
            '入力規則「5万円を超える金額は入力不可」を追加
            With .Range("TOKUTEI_KIFU_GK").Validation
                .Delete
                .Add Type:=xlValidateWholeNumber, _
                     Operator:=xlBetween, _
                     Formula1:=0, Formula2:=50000
            End With
            'セルの色(塗りつぶしなし)
            .Range("TOKUTEI_KIFU_GK").Interior.ColorIndex = xlColorIndexNone

        ElseIf checkTokuteiKifu = True And .Range("TOKUTEI_KIFU_GK").Locked = False Then
            '（うち特定寄附）【金額】入力不可に変更
            .Range("TOKUTEI_KIFU_GK").Locked = True
            '非表示状態に変更
            .Range("TOKUTEI_KIFU_GK").FormulaHidden = True
            '入力規則を削除
            .Range("TOKUTEI_KIFU_GK").Validation.Delete
            '数式を追加
            .Range("TOKUTEI_KIFU_GK") = "='その7(1)'!TOKUTEI_KIFU"
            'セルの色(淡い黄色)
            .Range("TOKUTEI_KIFU_GK").Interior.Color = 10092543
        End If
        
        'シートの保護
        Call LockOneSheet(wsSelect)
        
    End With
    
End Sub


-------------------------------------------------------------------------------
VBA MACRO ModuleSubtotal.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleSubtotal'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'-------------------------------------------------------------------
  ' 関数名 ： ContributorCopy_Common
  ' 機  能 ： 「同一寄附者の追加」ボタン押下時の処理
  '        ：
'-------------------------------------------------------------------
Sub ContributorCopy_Common()

    On Error GoTo ErrorTrap:

    Dim rngStart As Range
    Dim strSheetName As String
    
    With ActiveSheet
        strSheetName = .name
        
'        Call RowInsert(.Range("行頭").Row, .Range("行末").Row, .Range("左端").Column, .Range("右端").Column)
        Call ContributorCopy(.Range("行末").Row, .Range("行頭").Row, .Range("左端").column, .Range("右端").column, .Range("右端XML").column)

        If strSheetName Like "その7*" Or strSheetName Like "その8*" Or strSheetName Like "その11*" Or strSheetName Like "その12*" Then

            Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KINGAKU_DETAIL_ONLY").column)
'            rngStart.Formula = "1"
    
            '小計行以外のみの金額(KINGAKU_DETAIL_ONLY)列を設定する（オートフィルを使用）
            rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").column)), Type:=xlFillSeries
    
        End If
        
        If strSheetName = "その7(1)" Then
        
            '寄附金書類が「必要」とした行のみの金額(KOUJOGAKU_DETAIL_ONLY)列を設定する（オートフィルを使用）
            Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KOUJOGAKU_DETAIL_ONLY").column)
            rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KOUJOGAKU_DETAIL_ONLY").column)), Type:=xlFillSeries
        End If

    End With

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("行追加")

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ContributorCopy_Common2
  ' 機  能 ： 「同一寄附者の追加」ボタン押下時の処理（その8、11、12用）
  '        ：
'-------------------------------------------------------------------
Sub ContributorCopy_Common2()

    On Error GoTo ErrorTrap:
    
    Dim rngStart As Range
    Dim strSheetName As String
    
    With ActiveSheet
        strSheetName = .name
        
        Call ContributorCopy2(.Range("行末").Row, .Range("行頭").Row, .Range("左端").column, .Range("右端").column, .Range("右端XML").column)

        If strSheetName Like "その7*" Or strSheetName Like "その8*" Or strSheetName Like "その11*" Or strSheetName Like "その12*" Then

            Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KINGAKU_DETAIL_ONLY").column)
'            rngStart.Formula = "1"
    
            'オートフィル（セルを下方向にドラッグする）に任せる
            rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").column)), Type:=xlFillSeries
    
        End If

    End With

    Exit Sub

ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("行追加")

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： SubtotalOverlapCHK_Common
  ' 機  能 ： 小計行重複チェック + 小計行金額12桁チェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  '        ： (out) boolError … エラーがあればTrueを設定する
'-------------------------------------------------------------------
Sub SubtotalOverlapCHK_Common(wsSelect As Worksheet, boolError As Boolean)

    With wsSelect
    Call SubtotalOverlapCHK(wsSelect, .Range("行末").Row, .Range("行頭").Row, .Range("左端").column, .Range("右端").column, boolError)
    End With

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ContributorCopy
  ' 機  能 ： カーソル位置の下に新規の同一者の行を追加する（その7用）
  '        ：
  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
'-------------------------------------------------------------------
Sub ContributorCopy(lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer, intRightXmlCol As Integer)
    
    Dim intResponse As Integer, lngCursolRow As Long
    
    On Error GoTo Err_ContributorCopy:

    intResponse = MsgBox("カーソルのある場所の同一者を追加します。よろしいですか？", vbYesNo + vbQuestion, "同一者の追加")
    
    If intResponse = vbYes Then
    
        lngCursolRow = ActiveCell.Row
        
        'カーソルの位置が、行頭より下 行末より上 カーソル行が小計FLGがTrueでない場合はエラー
        If lngCursolRow > lngFirstRow And lngCursolRow < lngLastRow And Cells(lngCursolRow, Range("ROWKBN").column).value <> True Then

            '画面描画オフ
            Call ScreenRedraw(False)
            
            'カーソル位置の下に、書式を維持して１行追加する
            Call RowInsertBase(ActiveSheet, lngCursolRow, lngFirstRow + 1, lngLastRow - 1, intLeftCol, intRightXmlCol, 1, True)
            
            '寄附者の氏名
            Cells(lngCursolRow + 1, Range("KIFUSYA_NM").column).value = Cells(lngCursolRow, Range("KIFUSYA_NM").column).value
            '住所
            Cells(lngCursolRow + 1, Range("ADR").column).value = Cells(lngCursolRow, Range("ADR").column).value
            '職業
            Cells(lngCursolRow + 1, Range("SYOKUGYO").column).value = Cells(lngCursolRow, Range("SYOKUGYO").column).value
            '通し番号
            Cells(lngCursolRow + 1, Range("SEQ_NO").column).value = Cells(lngCursolRow, Range("SEQ_NO").column).value
            
            'カーソルのひとつ下の行を選択
            Rows(lngCursolRow + 1).Select
            
            '小計FLG False 設定
            Cells(lngCursolRow + 1, Range("ROWKBN").column).value = False
            '色変更
            Call CellColorChange(Selection, False)
            Call RowNoRebuild '行番号振りなおし
            '枠線引きなおし
            Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow + 1 - 1, intLeftCol - 1, intRightCol)
            
            '金額にフォーカス
            Cells(lngCursolRow + 1, Range("KINGAKU").column).Select
            
            '画面描画オン
            Call ScreenRedraw(True)
        Else
            MsgBox "選択した行からの追加はできません。", vbCritical, "同一者の追加"
        End If
    
    End If
    Exit Sub
    
Err_ContributorCopy:
    
    Call ScreenRedraw(True)
    MsgBox "同一者の追加に失敗しました。", vbCritical, "同一者の追加"

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ContributorCopy2
  ' 機  能 ： カーソル位置の下に新規の同一者の行を追加する（その8、11、12用）
  '        ：
  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
'-------------------------------------------------------------------
Sub ContributorCopy2(lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer, intRightXmlCol As Integer)
    
    Dim intResponse As Integer, lngCursolRow As Long
    
    On Error GoTo Err_ContributorCopy:

    intResponse = MsgBox("カーソルのある場所の同一者を追加します。よろしいですか？", vbYesNo + vbQuestion, "同一者の追加")
    
    If intResponse = vbYes Then
    
        lngCursolRow = ActiveCell.Row
        
        'カーソルの位置が、行頭より下 行末より上 カーソル行が小計FLGがTrueでない場合はエラー
        If lngCursolRow > lngFirstRow And lngCursolRow < lngLastRow And Cells(lngCursolRow, Range("ROWKBN").column).value <> True Then

            '画面描画オフ
            Call ScreenRedraw(False)
            
            'カーソル位置の下に、書式を維持して１行追加する
            Call RowInsertBase(ActiveSheet, lngCursolRow, lngFirstRow + 1, lngLastRow - 1, intLeftCol, intRightXmlCol, 1, True)
            
            '寄附者の氏名
            Cells(lngCursolRow + 1, Range("NM").column).value = Cells(lngCursolRow, Range("NM").column).value
            '住所
            Cells(lngCursolRow + 1, Range("ADR").column).value = Cells(lngCursolRow, Range("ADR").column).value
            '職業
            Cells(lngCursolRow + 1, Range("SYOKUGYO").column).value = Cells(lngCursolRow, Range("SYOKUGYO").column).value
            '通し番号
            Cells(lngCursolRow + 1, Range("SEQ_NO").column).value = Cells(lngCursolRow, Range("SEQ_NO").column).value
            
            'カーソルのひとつ下の行を選択
            Rows(lngCursolRow + 1).Select
            
            '小計FLG False 設定
            Cells(lngCursolRow + 1, Range("ROWKBN").column).value = False
            '色変更
            Call CellColorChange(Selection, False)
            Call RowNoRebuild '行番号振りなおし
            '枠線引きなおし
            Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow + 1 - 1, intLeftCol - 1, intRightCol)
            
            '金額にフォーカス
            Cells(lngCursolRow + 1, Range("KINGAKU").column).Select
            
            '寄附者の編集
'            Call ContributorEdit(lngLastRow + 1, lngFirstRow, intLeftCol, intRightCol)
            
            '画面描画オン
            Call ScreenRedraw(True)
        Else
            MsgBox "選択した行からの追加はできません。", vbCritical, "同一者の追加"
        End If
    
    End If
    Exit Sub
    
Err_ContributorCopy:
    
    Call ScreenRedraw(True)
    MsgBox "同一者の追加に失敗しました。", vbCritical, "同一者の追加"

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： ContributorSubtotal
  ' 機  能 ： カーソル位置に小計行を作成する
  '        ：
  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
'-------------------------------------------------------------------
Sub ContributorSubtotal(lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer)

    Dim intResponse As Integer, lngCursolRow As Long ', lngSKSum As Long
    Dim boolError As Boolean

    lngCursolRow = ActiveCell.Row
    
    'カーソルが行頭+1より下 行末より上 カーソル行が小計FLGがTrueでない カーソル行のひとつ上が小計FLGがTrueでない
    If lngCursolRow > (lngFirstRow + 1) And lngCursolRow < lngLastRow _
        And Cells(lngCursolRow, Range("ROWKBN").column).value <> True Then
        If Cells(lngCursolRow - 1, Range("ROWKBN").column).value <> True Then
        Else
            boolError = True
        End If
    Else
        boolError = True
    End If
    
    If boolError = False Then
        
        Dim lngI As Long, strKIFUSYA_NM As String, strAdr As String, strSYOKUGYO As String
        
        '比較初期値となるカーソルよりひとつ上の値を取得
        strKIFUSYA_NM = Cells(lngCursolRow - 1, Range("KIFUSYA_NM").column).value
        strAdr = Cells(lngCursolRow - 1, Range("ADR").column).value
        strSYOKUGYO = Cells(lngCursolRow - 1, Range("SYOKUGYO").column).value
        
        'いずれかひとつでも空欄だったらエラー
        If strKIFUSYA_NM = "" Or strAdr = "" Or strSYOKUGYO = "" Then
            MsgBox "寄附者の氏名、住所、職業に記述漏れがあります。", vbCritical, "同一寄附者の小計"
            Exit Sub
        End If
        
        'カーソル位置から行頭までloop
        For lngI = lngCursolRow - 1 To lngFirstRow + 1 Step -1
            
            '小計FLGがあったらExit
            If Cells(lngI, Range("ROWKBN").column).value = True Then Exit For
            '比較初期値と比較 異なっていたらError & exit
            If strKIFUSYA_NM <> Cells(lngI, Range("KIFUSYA_NM").column).value Or _
                strAdr <> Cells(lngI, Range("ADR").column).value Or _
                strSYOKUGYO <> Cells(lngI, Range("SYOKUGYO").column).value Then
                boolError = True
            End If
        
            'lngSKSum = lngSKSum + Cells(lngI, Range("KINGAKU").Column).Value
        
        Next lngI
        
        '比較初期値と比較 異なっている場合確認
        If boolError = True Then
            intResponse = MsgBox("小計追加位置と、上位の小計あるいは行頭との間において、寄附者が混在しています。" & vbCrLf & "混在を許可しますか？", vbYesNo + vbQuestion + vbDefaultButton2, "同一寄附者の小計")
            If intResponse = vbNo Then
                Exit Sub
            End If
        End If
        'Exitした行+1 カーソル位置-1 範囲選択
        Range(Cells(lngI + 1, intLeftCol), Cells(lngCursolRow - 1, intRightCol)).Activate
        
        intResponse = MsgBox("表示が反転している範囲の寄附者の小計を作成します。" & vbCrLf & "よろしいですか？", vbYesNo + vbQuestion, "同一寄附者の小計")

        If intResponse = vbYes Then
        
            'ActiveSheet.Unprotect Password:=ProtectPass
            '行挿入
            Rows(lngCursolRow).Insert Shift:=xlShiftDown
            Dim rngSK As Range
            Set rngSK = Range(Cells(lngCursolRow, intLeftCol), Cells(lngCursolRow, intRightCol))
            '編集ロック
            rngSK.Locked = True
            '色変更
            Call CellColorChange(rngSK, False, True)
            '小計表示
            rngSK(1, 1).value = "小計"
            '小計金額表示
            'rngSK(1, 2).Value = lngSKSum
            rngSK(1, 2).Formula = "=SUM(" & Range(Cells(lngI + 1, Range("KINGAKU").column), Cells(lngCursolRow - 1, Range("KINGAKU").column)).Address & ")"
            '行番号カラー解除
            rngSK(1, 0).Interior.ColorIndex = xlColorIndexNone
            Set rngSK = Nothing
            '小計FLG表示
            Cells(lngCursolRow, Range("ROWKBN").column).value = True
            Call RowNoRebuild '行番号振りなおし
            'ActiveSheet.Protect Password:=ProtectPass, UserInterfaceOnly:=True
            
        End If
    
    Else
        MsgBox "選択した行からの作成はできません。", vbCritical, "同一寄附者の小計"
    End If
    
End Sub

'-------------------------------------------------------------------
  ' 関数名 ： SubtotalRecalc_Common
  ' 機  能 ： 「小計の再計算」ボタン押下時の処理
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート（省略時はアクティブなシートを対象とする）
'-------------------------------------------------------------------
Sub SubtotalRecalc_Common(Optional wsSelect As Worksheet = Nothing)

    If wsSelect Is Nothing Then Set wsSelect = ActiveSheet

    With wsSelect
    Call SubtotalRecalc(wsSelect, .Range("行末").Row, .Range("行頭").Row, .Range("左端").column, .Range("右端").column)
    End With

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： SubtotalRecalc
  ' 機  能 ： 対象シートに存在する小計行に対し、金額の数式を再設定する
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
'-------------------------------------------------------------------
Sub SubtotalRecalc(wsSelect As Worksheet, lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer)

    Dim lngI As Long, lngSKRow As Long
    
    'イベントを無効にする
    Application.EnableEvents = False

    With wsSelect

    'wsSelect.Unprotect (ProtectPass)
    
    '行末-1から行頭までloop
    For lngI = lngLastRow - 1 To lngFirstRow Step -1
    
        '小計行である かつ 下に小計がない
        If .Cells(lngI, .Range("ROWKBN").column).value = True And lngSKRow = 0 Then
    
            '小計行の位置を保存
            lngSKRow = lngI
    
        '小計行である かつ 下に小計がある
        ElseIf .Cells(lngI, .Range("ROWKBN").column).value = True And lngSKRow <> 0 Then
    
            '下の小計行の金額欄のSumを更新
            '小計重複の場合金額欄を0とする
            If (lngI + 1) > (lngSKRow - 1) Then
                .Cells(lngSKRow, .Range("KINGAKU").column).value = 0
            Else
                Call SetFormulaSubtotalRow(wsSelect, lngSKRow, lngFirstRow, lngLastRow)
'                .Cells(lngSKRow, .Range("KINGAKU").Column).Formula = "=SUM(" & .Range(.Cells(lngI + 1, .Range("KINGAKU").Column), .Cells(lngSKRow - 1, .Range("KINGAKU").Column)).Address & ")"
            End If
            
            '小計行の位置を保存
            lngSKRow = lngI
        
        '行頭である かつ 下に小計がある
        ElseIf lngFirstRow = lngI And lngSKRow <> 0 Then
    
            '下の小計行の金額欄のSumを更新
            '行頭小計の場合金額欄を0とする
            If (lngI + 1) > (lngSKRow - 1) Then
                .Cells(lngSKRow, .Range("KINGAKU").column).value = 0
            Else
                Call SetFormulaSubtotalRow(wsSelect, lngSKRow, lngFirstRow, lngLastRow)
'                .Cells(lngSKRow, .Range("KINGAKU").Column).Formula = "=SUM(" & .Range(.Cells(lngI + 1, .Range("KINGAKU").Column), .Cells(lngSKRow - 1, .Range("KINGAKU").Column)).Address & ")"
            End If
        
        End If
    
    Next lngI

    'ActiveSheet.Protect (ProtectPass)

    End With
    
    'イベントを有効にする
    Application.EnableEvents = True

End Sub

'-------------------------------------------------------------------
  ' 関数名 ： SubtotalOverlapCHK
  ' 機  能 ： 小計行重複チェック + 小計行金額12桁チェックを行なう
  '        ：
  ' 引  数 ： (in)  wsSelect … 処理対象シート
  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
  '        ： (out) boolError … エラーがあればTrueを設定する
'-------------------------------------------------------------------
Sub SubtotalOverlapCHK(wsSelect As Worksheet, lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer, boolError As Boolean)
    
    Dim lngI As Long, lngSKRow As Long, boolErrorT As Boolean
    Dim intValueCheckCol As Integer, intSKFlgCol As Integer

    With wsSelect

    intValueCheckCol = .Range("KINGAKU").column
    intSKFlgCol = .Range("ROWKBN").column

    'ActiveSheet.Unprotect (ProtectPass)
    
    '行末-1から行頭+1までloop
    For lngI = lngLastRow - 1 To lngFirstRow Step -1

        '小計行である
        If .Cells(lngI, intSKFlgCol).value = True Then

            '小計行である かつ 下に小計がある
            If lngSKRow <> 0 Then
        
                '小計行が重複している
                If lngI = lngSKRow - 1 Then
                
                    '下の小計行にエラー
                    boolErrorT = True
                    boolError = True
                    Call setComment(.Cells(lngSKRow, intLeftCol).Worksheet, .Cells(lngSKRow, intLeftCol), MESSAGE_E172)
                    Call CellColorChange(.Range(.Cells(lngSKRow, intLeftCol), .Cells(lngSKRow, intRightCol)), boolErrorT, True)
                
                '小計行が重複していない
                Else
                    
                    '下の小計行にエラーなし
                    boolErrorT = False
                    Call CellColorChange(.Range(.Cells(lngSKRow, intLeftCol), .Cells(lngSKRow, intRightCol)), boolErrorT, True)
                
                    boolErrorT = False
                
                    '金額の12桁チェック
                    '9999999999999999以上はエラー
                    If .Cells(lngSKRow, intValueCheckCol).value >= 1000000000000# Then
                        
                        '塗りつぶし
                        boolErrorT = True
                        boolError = True
                        Call setComment(.Cells(lngSKRow, intValueCheckCol).Worksheet, .Cells(lngSKRow, intValueCheckCol), _
                                        MESSAGE_E148, "12桁")
                    End If
        
                    Call CellColorChange(.Cells(lngSKRow, intValueCheckCol), boolErrorT, True)
                    
                End If
    
            '小計行である かつ 下に小計がない
            ElseIf lngSKRow = 0 Then
    
                'この小計行にエラーなし
                boolErrorT = False
                Call CellColorChange(.Range(.Cells(lngI, intLeftCol), .Cells(lngI, intRightCol)), boolErrorT, True)
    
                boolErrorT = False
            
                '金額の12桁チェック
                '9999999999999999以上はエラー
                If .Cells(lngI, intValueCheckCol).value >= 1000000000000# Then
                    
                    '塗りつぶし
                    boolErrorT = True
                    boolError = True
                    Call setComment(.Cells(lngI, intValueCheckCol).Worksheet, .Cells(lngI, intValueCheckCol), _
                                    MESSAGE_E148, "12桁")
                End If
                
                Call CellColorChange(.Cells(lngI, intValueCheckCol), boolErrorT, True)

            End If
          
            '小計行の位置を保存
            lngSKRow = lngI
    
        '行頭である かつ すぐ下に小計がある
        ElseIf lngFirstRow = lngI And lngSKRow = lngFirstRow + 1 Then
   
            '下の小計行にエラー
            boolErrorT = True
            boolError = True
            Call setComment(.Cells(lngSKRow, intLeftCol).Worksheet, .Cells(lngSKRow, intLeftCol), MESSAGE_E172)
            Call CellColorChange(.Range(.Cells(lngSKRow, intLeftCol), .Cells(lngSKRow, intRightCol)), boolErrorT, True)
   
        '行頭である かつ 下に小計がある
        ElseIf lngFirstRow = lngI And lngSKRow <> 0 Then
    
            '下の小計行にエラーなし
            boolErrorT = False
            Call CellColorChange(.Range(.Cells(lngSKRow, intLeftCol), .Cells(lngSKRow, intRightCol)), boolErrorT, True)

            boolErrorT = False
        
            '金額の12桁チェック
            '9999999999999999以上はエラー
            If .Cells(lngSKRow, intValueCheckCol).value >= 1000000000000# Then
                
                '塗りつぶし
                boolErrorT = True
                boolError = True
                Call setComment(.Cells(lngSKRow, intValueCheckCol).Worksheet, .Cells(lngSKRow, intValueCheckCol), _
                                MESSAGE_E148, "12桁")
            End If
            
            Call CellColorChange(.Cells(lngSKRow, intValueCheckCol), boolErrorT, True)
   
        End If
    
    Next lngI

    'ActiveSheet.Protect (ProtectPass)

    End With

End Sub


' 以下のコメントアウトされたものは不要
''-------------------------------------------------------------------
'  ' 関数名 ： ContributorInsert_Common
'  ' 機  能 ： 「寄附者の追加」ボタン押下時の処理
'  '        ：
''-------------------------------------------------------------------
'Sub ContributorInsert_Common()
'
'    Call ContributorInsert(Range("行末").Row, Range("行頭").Row, Range("左端").Column, Range("右端").Column, Range("右端XML").Column)
'
'End Sub

''-------------------------------------------------------------------
'  ' 関数名 ： ContributorEdit_Common
'  ' 機  能 ： 「寄附者の編集」ボタン押下時の処理
'  '        ：
''-------------------------------------------------------------------
'Sub ContributorEdit_Common()
'
'    Call ContributorEdit(Range("行末").Row, Range("行頭").Row, Range("左端").Column, Range("右端").Column)
'
'End Sub

'
''-------------------------------------------------------------------
'  ' 関数名 ： ContributorSubtotal_Common
'  ' 機  能 ： 「同一寄附者の小計」ボタン押下時の処理
'  '        ：
''-------------------------------------------------------------------
'Sub ContributorSubtotal_Common()
'
'    Call ContributorSubtotal(Range("行末").Row, Range("行頭").Row, Range("左端").Column, Range("右端").Column)
'
'End Sub
'
'
''-------------------------------------------------------------------
'  ' 関数名 ： ContributorInsert
'  ' 機  能 ： カーソル位置の下に新規の行を追加する
'  '        ：
'  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
'  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
'  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
'  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
''-------------------------------------------------------------------
'Sub ContributorInsert(lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer, intRightXmlCol As Integer)
'
'    Dim intResponse As Integer
'    Dim lngSelectRow As Long
'
'    On Error GoTo Err_ContributorInsert:
'
'    intResponse = MsgBox("選択した行の下に寄附者を追加します。よろしいですか？", vbYesNo + vbQuestion, "寄附者の追加")
'
'    'カーソル位置の1つ下から行追加
'    If intResponse = vbYes Then
'
'        lngSelectRow = ActiveCell.Row
'
'        'カーソルの位置が、行頭より下 行末より上でない場合はエラー
'        If lngSelectRow > lngFirstRow And lngSelectRow < lngLastRow Then
'            '画面描画オフ
'            Call ScreenRedraw(False)
'
'            'カーソル位置の下に、書式を維持して１行追加する
'            Call RowInsertBase(ActiveSheet, lngSelectRow, lngFirstRow + 1, lngLastRow - 1, intLeftCol, intRightXmlCol, 1, True)
'
'            'カーソルのひとつ下の行を選択
'            Rows(lngSelectRow + 1).Select
'
'            '小計FLG False 設定
'            Cells(lngSelectRow + 1, Range("ROWKBN").Column).value = False
'            '色変更
'            Call CellColorChange(Selection, False)
'            Call RowNoRebuild '行番号振りなおし
'            '枠線引きなおし
'            Call LineReDraw(ActiveSheet, lngFirstRow + 1, lngLastRow + 1 - 1, intLeftCol - 1, intRightCol)
'
'            '寄附者の編集
'            Call ContributorEdit(lngLastRow + 1, lngFirstRow, intLeftCol, intRightCol)
'
'            '寄附者の氏名にフォーカス
'            Cells(lngSelectRow + 1, Range("KIFUSYA_NM").Column).Select
'
'            '画面描画オン
'            Call ScreenRedraw(True)
'
'        Else
'            MsgBox "選択した行からの追加はできません。", vbCritical, "寄附者の追加"
'        End If
'
'    End If
'    Exit Sub
'
'Err_ContributorInsert:
'
'    Call ScreenRedraw(True)
'    MsgBox "寄附者の追加に失敗しました。", vbCritical, "寄附者の追加"
'
'End Sub
'
'
''-------------------------------------------------------------------
'  ' 関数名 ： ContributorEdit
'  ' 機  能 ： カーソル位置の行を修正状態にする
'  '        ： ただしカーソルが「その他の寄附」セルにあれば、該当セルを修正状態にする
'  '        ： また、既に今回変更した行であれば、ロック解除し編集モードにする
'  '        ：
'  ' 引  数 ： (in)  lngLastRow    … 行末の行数  （セルの名前「行末」を指定）
'  '        ： (in)  lngFirstRow   … 行頭の行数  （セルの名前「行頭」を指定）
'  '        ： (in)  intLeftCol    … 左端の列数  （セルの名前「左端」を指定）
'  '        ： (in)  intRightCol   … 右端の列数  （その7(1):「寄附金(税額)控除」列を指定, それ以外:「備考」列を指定）
''-------------------------------------------------------------------
'Sub ContributorEdit(lngLastRow As Long, lngFirstRow As Long, intLeftCol As Integer, intRightCol As Integer)
'
'    Dim lngSelectRow As Long
'    Dim LngI As Long
'
'    lngLastRow = lngLastRow - 1
'    lngFirstRow = lngFirstRow + 1
'
'    lngSelectRow = Selection.Row
'
'    'カーソルが行頭より下 行末-1より上 カーソル行が小計FLGがTrueでない
'    If lngSelectRow >= lngFirstRow And lngSelectRow <= lngLastRow And Cells(lngSelectRow, Range("ROWKBN").Column).value <> True Then
'    Else
'        MsgBox "選択した行の編集は出来ません。", vbCritical, "寄附者の編集"
'        Exit Sub
'    End If
'
'    'ActiveSheet.Unprotect Password:=ProtectPass
'
'    For LngI = lngFirstRow To lngLastRow
'
'        If LngI = lngSelectRow Then
'            '行ロック解除
'            Range(Cells(LngI, intLeftCol), Cells(LngI, intRightCol)).Locked = False
'            '行番号カラー
'            Call CellColorChange(Cells(LngI, intLeftCol).Cells(1, 0), True, False, 2554545)
'        Else
'            '行ロック
'            Range(Cells(LngI, intLeftCol), Cells(LngI, intRightCol)).Locked = True
'            '行番号カラー解除
'            Call CellColorChange(Cells(LngI, intLeftCol).Cells(1, 0), False)
'        End If
'
'    Next LngI
'
'    'ActiveSheet.Protect Password:=ProtectPass, UserInterfaceOnly:=True
'
'End Sub

-------------------------------------------------------------------------------
VBA MACRO ModuleXML.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'********************************************************************
'定数定義
'********************************************************************
'ファイルフォーマット番号 （将来ﾌｧｲﾙﾚｲｱｳﾄを変更し、過去のシステムで読込不可にする場合に変更）
Private Const HEAD_INFO_FILEFORMATNO    As String = "1"
Private Const XML_ENCODING              As String = "version=""1.0"" encoding=""Shift_JIS"""


'********************************************************************
'メンバ変数定義
'********************************************************************
'XMLデータ全体のDOMオブジェクト
Private mdocXml             As MSXML2.DOMDocument
'KAIKEI_CHOUBOタグ配下の「会計帳簿データ有無」　ノード
Private mnodeKaikeiUmu      As MSXML2.IXMLDOMNode
'現在のインデントレベル
Private mlngCurrnetIndent   As Long


'********************************************************************
'以下、メンバ関数
'********************************************************************
'----------------------------------------------------------------
' 関数名 ： makeXMLPre
' 機　能 ： 「XMLデータ作成」ボタン押下時の処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub makeXMLPre()
    
    Dim nmsSelWS            As Names
    Dim wsSelect            As Worksheet
    Dim lngI                As Long
    Dim intReturn           As Boolean
    Dim intResponse         As Integer
    Dim isNeedCheck         As Boolean
    Dim isSortedPartySheets As Boolean
    
    isSortedPartySheets = False
    
    Set wsSelect = ActiveSheet
    Set nmsSelWS = wsSelect.Names
    
    '入力内容の確認メッセージを出力
    Dim intCheck As Integer
    intCheck = MsgBox(MESSAGE_I049, vbQuestion + vbOKCancel, "入力内容確認")
    'キャンセルなら終了
    If intCheck = 2 Then
        Exit Sub
    End If
    
    'チェックが必要かどうか？
    If gintCheckStatus = CHECK_STATUS_OK_GAIJI Then
        isNeedCheck = False
    Else
        intResponse = MsgBox("XMLデータ作成の前に、項目チェックを行います。", vbInformation + vbOKCancel, "XMLデータ作成")
        If intResponse <> vbOK Then
            Exit Sub
        End If
        
        isNeedCheck = True
    End If
    
    '必要なら項目チェック実行
    If isNeedCheck = True Then
        On Error GoTo ErrorTrap_VaridationCheck:    '---項目チェックのエラーハンドラ 開始
        
        '外字チェックを行う
        GaijiChkFlg = True
        GaijiErrCnt = 0
        ReDim GaijiErrInf(0)
        
        '*** チェック処理 ***
        Call ValidationCheck_All
        
        '「報告年 >= 宣誓日の年号」の場合ワーニングを表示
        Call senseiDtWarning
        
        'ステータスが「外字チェックOK」以外の場合は終了
        If gintCheckStatus <> CHECK_STATUS_OK_GAIJI Then
            Exit Sub
        End If
    
        On Error GoTo 0                             '---項目チェックのエラーハンドラ 終了
    End If

    '項目チェックのため、シートの順番を通常のシート順に戻す（パーティー順の場合）
    If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        Call ScreenRedraw(False)        '画面描画OFF
        Call bUnlock                    'ブックの保護を解除
        Call SortPartySheetsByNormal    '通常の順にする
        isSortedPartySheets = True
        Call ScreenRedraw(True)         '画面描画ON
    End If

XMLReturn:
    
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    '*** XMLデータ出力 ****
'    intReturn = makeXML
'
'    If intReturn = 1 Then   '出力パスが読み取り専用の場合
'        GoTo XMLReturn
'    End If
    '領収書管理画面のフォルダパスが指定されているか？
    Dim objSheet As Worksheet   'Excelシートオブジェクト

    '初期化
    Set objSheet = Nothing
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    If objSheet.Range("FOLDER_PATH").value <> "" Then
        '画像ファイル保存フォルダの存在チェックを行う
        If CheckFolderPath("XMLデータ作成") < 0 Then
            GoTo ExitProcedure
        End If
        'ファイルの件数にて判定
        If objSheet.Range("FILE_COUNT").value > 0 Then
            'ファイルの件数が1件でも存在すれば領収書を使用していると判定
            ModuleReceipt.Receipt_USE_Flg = True
        Else
            '未使用と判定
            ModuleReceipt.Receipt_USE_Flg = False
        End If
    Else
        '領収書関連機能を未使用と判定し、既存処理を行う。
        ModuleReceipt.Receipt_USE_Flg = False
    End If
    '領収書機能を使用しているか？
    If ModuleReceipt.Receipt_USE_Flg = True Then
        '作成対象指定ダイアログを開く
        ModuleReceipt.FOLDER_PATH = objSheet.Range("FOLDER_PATH").value
        '開く
        frmMakeXML.Show
        'リターン情報
        If ModuleReceipt.FrmCloseKbn = 3 Then
            '*** XMLデータ出力 ****
            intReturn = makeXML
            
            If intReturn = 1 Then   '出力パスが読み取り専用の場合
                GoTo XMLReturn
            End If
        ElseIf ModuleReceipt.FrmCloseKbn = 1 Then
            '領収書管理シートへ遷移
            Worksheets(SHEET_RECEIPT).Activate
            '処理終了
            GoTo ExitProcedure
        Else
            '処理終了
            GoTo ExitProcedure
        End If
    Else
        '*** XMLデータ出力 ****
        intReturn = makeXML
        
        If intReturn = 1 Then   '出力パスが読み取り専用の場合
            GoTo XMLReturn
        End If
    End If
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
'終了時の処理
ExitProcedure:

    'パーティーが複数ある場合、シートをパーティー順に戻す
    If isSortedPartySheets = True Then
        Call ScreenRedraw(False)        '画面描画OFF
        Call SortPartySheetsByParty     'パーティー順にする
        Call bLock                      'ブックを保護状態に戻す
        Call ScreenRedraw(True)         '画面描画ON
    End If
    
    Exit Sub
    
ErrorTrap_VaridationCheck:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("項目チェック")


End Sub

'----------------------------------------------------------------
' 関数名 ： makeXML
' 機　能 ： 収支報告書XMLファイル作成処理
' 引　数 ： なし
' 戻り値 ： -1 … 正常終了(またはキャンセル)
'        ：  0 … エラー
'        ：  1 … 指定パスが読み取り専用ファイル(処理は中止した)
'----------------------------------------------------------------
Private Function makeXML() As Integer
    
    On Error GoTo Err_makeXML
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStart("XMLデータ作成")
    
'@@01MOD START
    Dim ichirenNo           As Long
'@@01MOD END
    Dim lngI                As Long
    Dim intJ                As Integer
    Dim strsname            As String
    Dim strSRName           As String
    Dim strSSName           As String
    Dim strElem(15)         As String
    Dim strTextVal()        As String
    Dim strTextFormat()     As String
    Dim strHTextVal         As String
    Dim lngSTopRow          As Long
    Dim lngSBottomRow       As Long
    Dim intSCol             As Integer
    Dim intSRightCol        As Integer
    Dim intSLeftCol         As Integer
    Dim intSRightColX       As Integer
    Dim wsSelect            As Worksheet
    Dim strFileName         As String
    Dim strKNo              As String
    Dim strSKNo             As String
    Dim strKNoL             As String
    Dim strSKNoL            As String
    Dim boolEmptyAnd        As Boolean
    Dim isSortPartySheet    As Boolean      'シートの並び順が、パーティー順の状態かどうか
'Add mnaohiro 2010.02.10_START
    Dim strRowNo            As String       '行番号（明細を有する画面のB列）
'Add mnaohiro 2010.02.10_END
    
    Dim nodeBook   As MSXML2.IXMLDOMNode    '<BOOK>ノードのオブジェクト
    Dim nodeRoot   As MSXML2.IXMLDOMNode    'ループ中のシートの最上位ノードのオブジェクト
    Dim nodeKubun  As MSXML2.IXMLDOMNode    'ループ中のシートのKUBUNノードのオブジェクト
    Dim nodeSheet  As MSXML2.IXMLDOMNode    'ループ中のシートのSHEETノードのオブジェクト
    Dim nodeRow    As MSXML2.IXMLDOMNode    'ループ中のシートのROWノードのオブジェクト
    Dim nodeTemp   As MSXML2.IXMLDOMNode    'ループ中のシートの任意のノードオブジェクト
    
    makeXML = 0
    isSortPartySheet = False
    
    strFileName = FileDialog
    If strFileName = "" Then
        'MsgBox "ファイル名を指定してください。処理をキャンセルします。", vbCritical, "XMLデータ作成"
        makeXML = -1
        Exit Function
    End If
    
    'シートの順番が、パーティー順のかどうかを取得
    If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        isSortPartySheet = True
    End If
        
    'XML DOMオブジェクトの作成
    Set mdocXml = New MSXML2.DOMDocument        'XMLファイル全体のDOMオブジェクトを生成
    
    'XML宣言を追加
    Call mdocXml.appendChild(mdocXml.createProcessingInstruction("xml", XML_ENCODING))
    '<BOOK>ノードを追加
    Set nodeBook = mdocXml.appendChild(mdocXml.createNode(NODE_ELEMENT, "BOOK", ""))
    mlngCurrnetIndent = 1
    
    '<HEAD>
    '<SYUUSHI_UMU>
    Call Header(nodeBook)
    
    For Each wsSelect In Worksheets 'シートを開くループ
        
        'wsSelect.Activate
        strsname = wsSelect.name
        
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'       If strSName = "メニュー" Or strSName = "領収書一覧" Or strSName = "申請者一覧" Or strSName = "FAQ" Then
        If strsname = "メニュー" Or strsname = "領収書一覧" Or strsname = "申請者一覧" Or strsname = "FAQ" Or _
           strsname = ModuleReceipt.SHEET_RECEIPT Or strsname = ModuleReceipt.SHEET_PDF Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
            '--------------------------------------------------------------
            'メニュー, 領収書一覧, 申請者一覧
            '--------------------------------------------------------------
            'なにもしない
        
        ElseIf strsname = "寄附金" Then
            '--------------------------------------------------------------
            '寄附金
            '--------------------------------------------------------------
            strSRName = GetSRName(strsname)
            Set nodeRoot = AppendNode(nodeBook, strSRName)
            Set nodeSheet = AppendNode(nodeRoot, "SHEET")
            '団体の区分
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KUBUN")
            '国会議員氏名
            Set nodeTemp = AppendNode(nodeSheet, "ZEI411713")
            Call AppendTextNodeByCellName(nodeTemp, wsSelect, "GIIN_NM")
            Call PutCloseTag(nodeTemp)
            Set nodeTemp = AppendNode(nodeSheet, "ZEI411714")
            '支持者氏名
            Call AppendTextNodeByCellName(nodeTemp, wsSelect, "NM")
            '立候補選挙名
            Call AppendTextNodeByCellName(nodeTemp, wsSelect, "SENKYO")
            '立候補年月日
            Call AppendTextNodeByCellName(nodeTemp, wsSelect, "DT")
            'タグを閉じる
            Call PutCloseTag(nodeTemp)
            Call PutCloseTag(nodeSheet)
            Call PutCloseTag(nodeRoot)
            
        ElseIf strsname = "その1" Then
            '--------------------------------------------------------------
            '第7号様式 その1
            '--------------------------------------------------------------
            Call makeXMLSheet0701(wsSelect, strsname, nodeBook)
        
        ElseIf strsname = "その2" Then
            '--------------------------------------------------------------
            '第7号様式 その2
            '--------------------------------------------------------------
            strSRName = GetSRName(strsname)
            Set nodeRoot = AppendNode(nodeBook, strSRName)
            Set nodeSheet = AppendNode(nodeRoot, "SHEET")
            '収入総額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYUNYU_SGK")
            '前年繰越額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "ZENNEN_KKS_GK")
            '本年収入額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HONNEN_SYUNYU_GK")
            '支出総額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SISYUTU_SGK")
            '翌年繰越額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "YOKUNEN_KKS_GK")
            '個人負担党費金額
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOJIN_FUTAN_KGK")
            '個人負担党費員数
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOJIN_FUTAN_SU")
            '個人寄附
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOJIN_KIFU_GK")
            '個人寄附の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOJIN_KIFU_BIKOU")
            '特定寄附
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOKUTEI_KIFU_GK")
            '特定寄附の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOKUTEI_KIFU_BIKOU")
            '法人寄附
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HOJIN_KIFU_GK")
            '法人寄附の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HOJIN_KIFU_BIKOU")
            '政治団体寄附
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SEIJI_KIFU_GK")
            '政治団体寄附の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SEIJI_KIFU_BIKOU")
            '寄付小計
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_SKEI_GK")
            '寄付小計の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_SKEI_BIKOU")
            'あっせんによるもの
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "ATUSEN_GK")
            'あっせんによるものの備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "ATUSEN_BIKOU")
            '政党匿名寄附
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOKUMEI_KIFU_GK")
            '政党匿名寄附の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOKUMEI_KIFU_BIKOU")
            '寄付合計
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_GKEI_GK")
            '寄付合計の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_GKEI_BIKOU")
            'タグを閉じる
            Call PutCloseTag(nodeSheet)
            Call PutCloseTag(nodeRoot)
        
        ElseIf strsname = "その13" Then
            '--------------------------------------------------------------
            '第7号様式 その13
            '--------------------------------------------------------------
            strSRName = GetSRName(strsname)
            Set nodeRoot = AppendNode(nodeBook, strSRName)
            Set nodeSheet = AppendNode(nodeRoot, "SHEET")
            '人件費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JINKENHI_GK")
            '人件費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JINKENHI_KOUFU")
            '人件費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JINKENHI_BIKOU")
            '光熱水費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOUNETU_GK")
            '光熱水費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOUNETU_KOUFU")
            '光熱水費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KOUNETU_BIKOU")
            '備品・消耗品費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "BIHIN_GK")
            '備品・消耗品費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "BIHIN_KOUFU")
            '備品・消耗品費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "BIHIN_BIKOU")
            '事務所費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JIMUSYO_GK")
            '事務所費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JIMUSYO_KOUFU")
            '事務所費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "JIMUSYO_BIKOU")
            '経常経費小計
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KEIHI_SKEI_GK")
            '経常経費小計（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KEIHI_SKEI_KOUFU")
            '経常経費小計の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KEIHI_SKEI_BIKOU")
            '組織活動費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SOSIKI_GK")
            '組織活動費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SOSIKI_KOUFU")
            '組織活動費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SOSIKI_BIKOU")
            '選挙関係費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENKYO_GK")
            '選挙関係費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENKYO_KOUFU")
            '選挙関係費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENKYO_BIKOU")
            '機関紙誌の発行その他の事業費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_JIGYO_GK")
            '機関紙誌の発行その他の事業費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_JIGYO_KOUFU")
            '機関紙誌の発行その他の事業費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_JIGYO_BIKOU")
            '機関紙誌の発行事業費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HAKKOU_JIGYO_GK")
            '機関紙誌の発行事業費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HAKKOU_JIGYO_KOUFU")
            '機関紙誌の発行事業費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HAKKOU_JIGYO_BIKOU")
            '宣伝事業費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENDEN_GK")
            '宣伝事業費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENDEN_KOUFU")
            '宣伝事業費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENDEN_BIKOU")
            '政治資金パーティー開催事業費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAISAI_GK")
            '政治資金パーティー開催事業費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAISAI_KOUFU")
            '政治資金パーティー開催事業費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAISAI_BIKOU")
            'その他の事業費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_GK")
            'その他の事業費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_KOUFU")
            'その他の事業費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_BIKOU")
            '調査研究費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "CYOUSA_GK")
            '調査研究費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "CYOUSA_KOUFU")
            '調査研究費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "CYOUSA_BIKOU")
            '寄附・交付金
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_GK")
            '寄附・交付金（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_KOUFU")
            '寄附・交付金の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KIFU_BIKOU")
            'その他の経費
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_KEIHI_GK")
            'その他の経費（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_KEIHI_KOUFU")
            'その他の経費の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_KEIHI_BIKOU")
            '政治活動費小計
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KATUDOU_SKEI_GK")
            '政治活動費小計（交付金に係る支出）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KATUDOU_SKEI_KOUFU")
            '政治活動費小計の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KATUDOU_SKEI_BIKOU")
            '合計
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "GKEI_GK")
            'タグを閉じる
            Call PutCloseTag(nodeSheet)
            Call PutCloseTag(nodeRoot)
        
        ElseIf strsname = "その17" Then
            '--------------------------------------------------------------
            '第7号様式 その17
            '--------------------------------------------------------------
            strSRName = GetSRName(strsname)
            Set nodeRoot = AppendNode(nodeBook, strSRName)
            Set nodeSheet = AppendNode(nodeRoot, "SHEET")
            '土地
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOCHI_UMU")
            '土地の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TOCHI_BIKOU")
            '建物
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TATEMONO_UMU")
            '建物の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "TATEMONO_BIKOU")
            '借地権
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYAKUCHI_UMU")
            '借地権の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYAKUCHI_BIKOU")
            '動産
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DOUSAN_UMU")
            '動産の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DOUSAN_BIKOU")
            '預金
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "YOKIN_UMU")
            '預金の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "YOKIN_BIKOU")
            '金銭信託
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SINTAKU_UMU")
            '金銭信託の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SINTAKU_BIKOU")
            '有価証券
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYOUKEN_UMU")
            '有価証券の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYOUKEN_BIKOU")
            '出資による権利
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYUSSI_UMU")
            '出資による権利の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SYUSSI_BIKOU")
            '貸付金
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KASITUKE_UMU")
            '貸付金の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KASITUKE_BIKOU")
            '敷金
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIKIN_UMU")
            '敷金の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SIKIKIN_BIKOU")
            '施設利用権利
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SISETURIYOU_UMU")
            '施設利用権利の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SISETURIYOU_BIKOU")
            '借入金
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KARIIRE_UMU")
            '借入金の備考
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KARIIRE_BIKOU")
            'タグを閉じる
            Call PutCloseTag(nodeSheet)
            Call PutCloseTag(nodeRoot)

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'        ElseIf strSName = "8号様式の2" Then
        ElseIf strsname = "16号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
            '--------------------------------------------------------------
            '第8号様式の2
            '--------------------------------------------------------------
            Call makeXMLSheet0802(wsSelect, strsname, nodeBook)

        ElseIf strsname Like "その19*" Then
            '--------------------------------------------------------------
            '第7号様式 その19
            '--------------------------------------------------------------
            lngSTopRow = wsSelect.Range("行頭").Row
            lngSBottomRow = wsSelect.Range("行末").Row
            intSRightCol = wsSelect.Range("右端").column
            intSLeftCol = wsSelect.Range("左端").column
            intSRightColX = intSRightCol
    
            Call SheetNo(strsname, strKNo, strSKNo)
            
            strSRName = strsname
            
            'シート名のカッコをシングルクオーテーションで囲む
            strSSName = "'" & strsname & "'"
            strSRName = Left(strSRName, InStr(strSRName, "(") - 1) 'カッコより右側を削除
            Call SheetLastNo(strsname, strKNoL, strSKNoL, strKNo)
            
            strSRName = GetSRName(strSRName)
            
            '項目名を取ります
            For intJ = intSLeftCol To intSRightColX
                
                'セルに付けた名前を取得
                strHTextVal = wsSelect.Names.Item(, , "=" & strSSName & "!" & wsSelect.Cells(lngSTopRow, intJ).Address).name
                
                '名前の中のシート名を削除
                strHTextVal = Mid(strHTextVal, Len(strSSName) + 2)
                
                If strHTextVal = "" Then
                    Exit For
                Else
                    strElem(intJ) = strHTextVal
                    intSCol = intJ
                End If
            Next
            
            '開きタグ
            If strKNo = 1 Then
                
                Set nodeRoot = AppendNode(nodeBook, strSRName)
                Set nodeSheet = AppendNode(nodeRoot, "SHEET")
                Call AppendTextNode(nodeSheet, "KUBUN", wsSelect.Range("KUBUN").value)
            Else
                Set nodeSheet = AppendNode(nodeRoot, "SHEET")
                Call AppendTextNode(nodeSheet, "KUBUN", wsSelect.Range("KUBUN").value)
            End If
            
            '行ループ
            For lngI = lngSTopRow + 1 To lngSBottomRow - 1
                
                ReDim strTextVal(intSLeftCol To intSCol)
                ReDim strTextFormat(intSLeftCol To intSCol)
                
'Add mnaohiro 2010.02.10_START
                '行番号を取得（"左端"の一つ左隣りから取得）
                strRowNo = wsSelect.Cells(lngI, intSLeftCol - 1).value
'Add mnaohiro 2010.02.10_END
                
                '列ループ 項目取得
                For intJ = intSLeftCol To intSCol
                    
                    strTextVal(intJ) = wsSelect.Cells(lngI, intJ).value
                
                    strTextFormat(intJ) = wsSelect.Cells(lngI, intJ).NumberFormatLocal
                    
                Next intJ
                
                '列ループ 行がすべて空かどうかチェック
                For intJ = intSLeftCol To intSRightCol
                    If intJ = intSLeftCol Then
                        boolEmptyAnd = CellEmptyCheck2(strTextVal(intJ))
                    Else
                        boolEmptyAnd = boolEmptyAnd And CellEmptyCheck2(strTextVal(intJ))    '全件TrueでないとTrueにならない 一件でもFalseがあればFalseになる
                    End If
                Next intJ

                If boolEmptyAnd = False Then
                    '<ROW>ノードを追加
                    Set nodeRow = AppendNode(nodeSheet, "ROW")
                    '<ICHIREN_NO>ノードを追加
'Mod mnaohiro 2010.02.10_START
'Mod                     Call AppendTextNode(nodeRow, "ICHIREN_NO", LngI - lngSTopRow)
                    Call AppendTextNode(nodeRow, "ICHIREN_NO", strRowNo)
'Mod mnaohiro 2010.02.10_END
                    '列ループ
                    For intJ = intSLeftCol To intSCol
                        Call AppendTextNode(nodeRow, strElem(intJ), _
                            TextValFormat(strTextVal(intJ), strTextFormat(intJ), strElem(intJ)))
                    Next intJ
                    '</ROW> 閉じタグを追加
                    Call PutCloseTag(nodeRow)
                End If
            
            Next lngI
            
            Call PutCloseTag(nodeSheet)

            '閉じタグ
            If strKNo = strKNoL Then
                Call PutCloseTag(nodeRoot)
            End If
                
        ElseIf strsname = "その20" Then
            '--------------------------------------------------------------
            '第7号様式 その20
            '--------------------------------------------------------------
            strSRName = GetSRName(strsname)
            Set nodeRoot = AppendNode(nodeBook, strSRName)
            Set nodeSheet = AppendNode(nodeRoot, "SHEET")
        
            '領収書の写し添付有無
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "RYOUSYU_UMU")
            '監査意見書添付有無
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KANSA_IKEN_UMU")
            '政治資金監査報告書添付有無
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KANSA_HOUKOKU_UMU")
            '宣誓日
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SENSEI_DT")
            '政治団体名称
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DANTAI_NM")
            '会計責任者氏名（姓）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAI_NM1")
            '会計責任者氏名（名）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KAI_NM2")
            '代表者氏名（姓）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DAI_NM1")
            '代表者氏名（名）
            Call AppendTextNodeByCellName(nodeSheet, wsSelect, "DAI_NM2")
            
            Call PutCloseTag(nodeSheet)
            Call PutCloseTag(nodeRoot)

        Else
            '--------------------------------------------------------------
            '第7号様式 その3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16, 18
            '第8号様式
            '--------------------------------------------------------------
            lngSTopRow = wsSelect.Range("行頭").Row
            lngSBottomRow = wsSelect.Range("行末").Row
            intSRightCol = wsSelect.Range("右端").column
            intSLeftCol = wsSelect.Range("左端").column
    
            If strsname Like "その7*" Or strsname Like "その8*" Or strsname Like "その11*" Or _
               strsname Like "その12*" Or strsname Like "その14*" Or strsname Like "その15*" Then
            
                intSRightColX = wsSelect.Range("右端XML").column
            
            Else
            
                intSRightColX = intSRightCol
            
            End If
    
            Call SheetNo(strsname, strKNo, strSKNo)
            
            '上位タグ名を取得（例："その2"→"SYUUSHI07_02"）
            strSRName = strsname
            
            'シート名にカッコがある場合シングルクオーテーションで囲む(8号様式も)
            If strKNo = 0 And strSKNo = 0 Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'                If strSName = "8号様式" Then
                If strsname = "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                    strSSName = "'" & strsname & "'"
                Else
                    strSSName = strsname
                End If
            Else
                strSSName = "'" & strsname & "'"
                strSRName = Left(strSRName, InStr(strSRName, "(") - 1) 'カッコより右側を削除
                Call SheetLastNo(strsname, strKNoL, strSKNoL, strKNo)
            End If
            
            strSRName = GetSRName(strSRName)
            
            
            '項目名を取ります
            For intJ = intSLeftCol To intSRightColX
                
                'セルに付けた名前を取得
                strHTextVal = wsSelect.Names.Item(, , "=" & strSSName & "!" & wsSelect.Cells(lngSTopRow, intJ).Address).name
                
                '名前の中のシート名を削除
                strHTextVal = Mid(strHTextVal, Len(strSSName) + 2)
                
                If strHTextVal = "" Then
                    Exit For
                Else
                    strElem(intJ) = strHTextVal
                    intSCol = intJ
                End If
            Next
            
            '開きタグ
            If strKNo = 0 And strSKNo = 0 Then
                
                Set nodeRoot = AppendNode(nodeBook, strSRName)
                Set nodeSheet = AppendNode(nodeRoot, "SHEET")
            Else
                If strKNo = 1 Then
                    If strSKNo = 0 Or strSKNo = 1 Then '(1)(0) (1)(1)
                        
                        Set nodeRoot = AppendNode(nodeBook, strSRName)
                        Set nodeKubun = AppendNode(nodeRoot, "KUBUN" & strKNo)
                    End If
                Else
                    If strSKNo = 0 Or strSKNo = 1 Then '(?)(0) (?)(1)
                        
                        Set nodeKubun = AppendNode(nodeRoot, "KUBUN" & strKNo)
                    End If
                End If
                
                Set nodeSheet = AppendNode(nodeKubun, "SHEET")
            End If
            
            'その11 その12 パーティー名称を追加
            If strsname Like "その11*" Or strsname Like "その12*" Then
                'パーティー名
                Call AppendTextNodeByCellName(nodeSheet, wsSelect, "PATYI_NM")
                
                'パーティーのソート順（シートがパーティー順の場合のみ値を出力し、それ以外は値は空とする）
                If isSortPartySheet = True Then
                    Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SORT_NO")
                Else
                    Call AppendTextNode(nodeSheet, "SORT_NO", "")
                End If
            End If

            'その15 小区分を追加
            If strsname Like "その15*" Then
                Call AppendTextNodeByCellName(nodeSheet, wsSelect, "HIMOKU")
            End If
            
            '合計を追加(合計が存在しないシートは除外)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'            If Not strSName Like "その18*" And strSName <> "8号様式" Then
            If Not strsname Like "その18*" And strsname <> "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                Call AppendTextNodeByCellName(nodeSheet, wsSelect, "KINGAKU_GK")
            End If
            
            'その他の合計を追加
            If strsname = "その6" Then
                Call AppendTextNodeByCellName(nodeSheet, wsSelect, "MIMAN_GK")
            ElseIf strsname Like "その7*" Or strsname Like "その8*" Or strsname Like "その14*" Or strsname Like "その15*" Then
                Call AppendTextNodeByCellName(nodeSheet, wsSelect, "SONOTA_GK")
            End If

'@@01MOD START
'            For LngI = lngSTopRow + 1 To lngSBottomRow - 1
'                ReDim strTextVal(intSLeftCol To intSCol)
'                ReDim strTextFormat(intSLeftCol To intSCol)
'
'                '列ループ 項目取得
'                For intJ = intSLeftCol To intSCol
'
'                    strTextVal(intJ) = wsSelect.Cells(LngI, intJ).value
'
'                    strTextFormat(intJ) = wsSelect.Cells(LngI, intJ).NumberFormatLocal
'
'                Next intJ
'
'                '列ループ 行がすべて空かどうかチェック
'                For intJ = intSLeftCol To intSRightCol
'                    If intJ = intSLeftCol Then
'                        boolEmptyAnd = CellEmptyCheck2(strTextVal(intJ))
'                    Else
'                        boolEmptyAnd = boolEmptyAnd And CellEmptyCheck2(strTextVal(intJ))    '全件TrueでないとTrueにならない 一件でもFalseがあればFalseになる
'                    End If
'
'                Next intJ
'
'                If boolEmptyAnd = False Then
'
'                    '<ROW>ノードを追加
'                    Set nodeRow = AppendNode(nodeSheet, "ROW")
'
'
'                    Call AppendTextNode(nodeRow, "ICHIREN_NO", LngI - lngSTopRow)
'
'                    '列ループ
'                    For intJ = intSLeftCol To intSCol
'
'                        Call AppendTextNode(nodeRow, strElem(intJ), _
'                            TextValFormat(strTextVal(intJ), strTextFormat(intJ), strElem(intJ)))
'
'                    Next intJ
'
'                    '</ROW> 閉じタグを追加
'                    Call PutCloseTag(nodeRow)
'
'                End If
'            Next LngI

            '行ループ
            ichirenNo = 0
            For lngI = lngSTopRow + 1 To lngSBottomRow - 1
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'                If strSName = "8号様式" Then
                If strsname = "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
                    '--------------------------------------------------------------
                    '第8号様式
                    '--------------------------------------------------------------
                    If Len(Trim(wsSelect.Cells(lngI, wsSelect.Range("ICHIREN_NO").column).value & "")) > 0 _
                        And IsNumeric(wsSelect.Cells(lngI, wsSelect.Range("ICHIREN_NO").column).value) = True Then
                        
                        ReDim strTextVal(intSLeftCol To intSCol)
                        ReDim strTextFormat(intSLeftCol To intSCol)
                        
                        '列ループ 項目取得
                        For intJ = intSLeftCol To intSCol
                            
                            strTextVal(intJ) = wsSelect.Cells(lngI, intJ).value
                        
                            strTextFormat(intJ) = wsSelect.Cells(lngI, intJ).NumberFormatLocal
                            
                        Next intJ
                        
                        '列ループ 行がすべて空かどうかチェック
                        For intJ = intSLeftCol To intSRightCol
                            If intJ = intSLeftCol Then
                                boolEmptyAnd = CellEmptyCheck2(strTextVal(intJ))
                            Else
                                boolEmptyAnd = boolEmptyAnd And CellEmptyCheck2(strTextVal(intJ))    '全件TrueでないとTrueにならない 一件でもFalseがあればFalseになる
                            End If
                        Next intJ

                        If boolEmptyAnd = False Then
                            '<ROW>ノードを追加
                            Set nodeRow = AppendNode(nodeSheet, "ROW")
                            ichirenNo = ichirenNo + 1
                            '<ICHIREN_NO>ノードを追加
                            Call AppendTextNode(nodeRow, "ICHIREN_NO", ichirenNo & "")
                            '列ループ
                            For intJ = intSLeftCol To intSCol
                                Call AppendTextNode(nodeRow, strElem(intJ), _
                                    TextValFormat(strTextVal(intJ), strTextFormat(intJ), strElem(intJ)))
                            Next intJ
                            '</ROW> 閉じタグを追加
                            Call PutCloseTag(nodeRow)
                        End If
                        
                    End If
                    
                Else
                    '--------------------------------------------------------------
                    '第7号様式 その3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16, 18
                    '--------------------------------------------------------------
                    ReDim strTextVal(intSLeftCol To intSCol)
                    ReDim strTextFormat(intSLeftCol To intSCol)
                    
'Add mnaohiro 2010.02.10_START
                    '行番号を取得（"左端"の一つ左隣りから取得）
                    strRowNo = wsSelect.Cells(lngI, intSLeftCol - 1).value
'Add mnaohiro 2010.02.10_END
                    
                    '列ループ 項目取得
                    For intJ = intSLeftCol To intSCol
                        
                        strTextVal(intJ) = wsSelect.Cells(lngI, intJ).value
                    
                        strTextFormat(intJ) = wsSelect.Cells(lngI, intJ).NumberFormatLocal
                        
                    Next intJ
                    
                    '列ループ 行がすべて空かどうかチェック
                    For intJ = intSLeftCol To intSRightCol
                        If intJ = intSLeftCol Then
                            boolEmptyAnd = CellEmptyCheck2(strTextVal(intJ))
                        Else
                            boolEmptyAnd = boolEmptyAnd And CellEmptyCheck2(strTextVal(intJ))    '全件TrueでないとTrueにならない 一件でもFalseがあればFalseになる
                        End If
                    Next intJ

                    If boolEmptyAnd = False Then
                        '<ROW>ノードを追加
                        Set nodeRow = AppendNode(nodeSheet, "ROW")
                        '<ICHIREN_NO>ノードを追加
'Mod mnaohiro 2010.02.10_START
'Mod                         Call AppendTextNode(nodeRow, "ICHIREN_NO", LngI - lngSTopRow)
                        Call AppendTextNode(nodeRow, "ICHIREN_NO", strRowNo)
'Mod mnaohiro 2010.02.10_END
                        '列ループ
                        For intJ = intSLeftCol To intSCol
                            Call AppendTextNode(nodeRow, strElem(intJ), _
                                TextValFormat(strTextVal(intJ), strTextFormat(intJ), strElem(intJ)))
                        Next intJ
                        '</ROW> 閉じタグを追加
                        Call PutCloseTag(nodeRow)
                    End If

                End If
               
            Next lngI
'@@01MOD END
            
            '閉じタグ
            If strKNo = 0 And strSKNo = 0 Then
                
                Call PutCloseTag(nodeSheet)
                Call PutCloseTag(nodeRoot)
            Else
                
                Call PutCloseTag(nodeSheet)
                
                If strKNo = strKNoL Then
                    If strSKNo = 0 Or strSKNo = strSKNoL Then '(1)(0) (1)(1)
                        
                        Call PutCloseTag(nodeKubun)
                        Call PutCloseTag(nodeRoot)
                        
                    End If
                Else
                    If strSKNo = 0 Or strSKNo = strSKNoL Then '(2)(0) (2)(1)
                        
                        Call PutCloseTag(nodeKubun)
                    End If
                End If
            End If
        
        End If
        
    Next wsSelect
    
    Call PutCloseTag(nodeBook)
   
    '出力
    Call mdocXml.Save(strFileName)

    '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStop("XMLデータ作成")

    Worksheets("メニュー").Activate
    MsgBox "XMLデータ作成が完了しました。", vbInformation, "XMLデータ作成"
    makeXML = -1
    
    Exit Function

Err_makeXML:
    
    Select Case Err.Number
    Case 75
        MsgBox "指定したファイルが読み取り専用です。他のファイル名を指定してください。", vbCritical, "XMLデータ作成"
        
        makeXML = 1
        
    Case Else
    
        '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
        Call DispException("XMLデータ作成")
        
    End Select

End Function

'----------------------------------------------------------------
' 関数名 ： FileDialog
' 機　能 ： XML出力時のファイル保存用ダイアログを表示
' 引　数 ： なし
' 戻り値 ： ファイルパス
'----------------------------------------------------------------
Private Function FileDialog() As String
    
    Dim strDefaultFileName  As String
    Dim strFileName         As String
    Dim intResponse         As Integer
    
    strDefaultFileName = "SYUUSI"
    strFileName = Application.GetSaveAsFilename(InitialFileName:=strDefaultFileName, FileFilter:="XMLファイル(*.xml),*.xml")
    
    If strFileName = "" Or strFileName = "False" Then
        Exit Function
    End If
    
    'B-CCL-047
'    If Dir(strFileName) <> "" Then
    If isFileExists(strFileName) Then
        
        intResponse = MsgBox(strFileName & "　は既に存在します。上書きしますか？", vbYesNo + vbQuestion + vbDefaultButton2, "XMLデータ作成")
        
        If intResponse = vbNo Then
            Exit Function
        End If
    
    End If

    FileDialog = strFileName

End Function

'----------------------------------------------------------------
' 関数名 ： TextValFormat
' 機　能 ：
' 引　数 ： strTextVal　･･･
'        ： strFormatVal･･･
'        ： strElem     ･･･
' 戻り値 ：
'----------------------------------------------------------------
Private Function TextValFormat(strTextVal As String, _
                                strFormatVal As String, _
                                Optional strElem As String) As String
    Dim strge As String
    Dim strgm As String
    Dim strgd As String
    
    '区切り文字が機種依存を返す為７文字で日付を判定　+03/01/29
    If Mid(strFormatVal, 1, 7) = "[$-411]" Then

        '短い形式もあるので取りあえず、西暦４桁とする
        strTextVal = Format(strTextVal, "yyyy/mm/dd")

        '変数初期化
        strge = ""
        strgm = ""
        strgd = ""
        strge = Format$(strTextVal, "ge")
        strgm = Format$(strTextVal, "m")
        strgd = Format$(strTextVal, "d")
        
        '空文字の場合出力しない
        If strge = "" Or strgm = "" Or strgd = "" Then
        Else
        
            'ﾌｫｰﾏｯﾄ関数も区切り文字は機種依存の為、文字列をge/m/dの形にする
            strTextVal = strge & "/" & strgm & "/" & strgd

        End If
    End If
    
    strTextVal = SrchReplace(strTextVal, vbCrLf, "")    '改行CRLF消去
    strTextVal = SrchReplace(strTextVal, vbCr, "")      '改行CR消去
    strTextVal = SrchReplace(strTextVal, vbLf, "")      '改行LF消去

    If strTextVal = "True" Then
        strTextVal = 1                                  'Trueの場合1に変換
    ElseIf strTextVal = "False" Then
        strTextVal = 0                                  'Falseの場合0に変換
    Else
    End If
    
    If strElem = "ZEIGAKUKOUJYO" Then
        If strTextVal = "必要" Then
            strTextVal = 1
        Else
            strTextVal = 0
        End If
    End If
    
    If strElem = "RYOUSYU" Then
        If strTextVal = "領収書等を徴し難かった支出の明細書を作成する" Then
            strTextVal = 1
        ElseIf strTextVal = "振込明細書に係る支出目的書を作成する" Then
            strTextVal = 2
        Else
            strTextVal = 0
        End If
    End If
    
    If strElem = "KOUFUKIN" Then
        If strTextVal = "（交）" Then
            strTextVal = 1
        Else
            strTextVal = 0
        End If
    End If
    
    '(特)変換
    If strElem = "KIFUSYA_NM" Then
        If strTextVal Like "（特）*" Then
            strTextVal = SrchReplace(strTextVal, "（特）", "(特)", 3)
'        ElseIf strTextVal Like "（特)*" Then
'            strTextVal = SrchReplace(strTextVal, "（特)", "(特)", 3)
'        ElseIf strTextVal Like "(特）*" Then
'            strTextVal = SrchReplace(strTextVal, "(特）", "(特)", 3)
        End If
    End If
    
    TextValFormat = strTextVal

End Function

'----------------------------------------------------------------
' 関数名 ： GetSRName
' 機　能 ：
' 引　数 ： strSName　･･･
' 戻り値 ：
'----------------------------------------------------------------
Public Function GetSRName(strsname As String) As String

    Dim strSRName As String

    strSRName = strsname

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    If strSRName = "8号様式" Then
    If strSRName = "15号様式" Then
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        strSRName = "SYUUSHI08"
    ElseIf strSRName = "寄附金" Then
        strSRName = "SYUUSHI_KIFUKOUJYO"
    Else
        strSRName = SrchReplace(strSRName, "そ", "") '「その」を「」に変換
        strSRName = SrchReplace(strSRName, "の", "")
        strSRName = "SYUUSHI07_" & Format(strSRName, "00")
    End If

    GetSRName = strSRName

End Function

'----------------------------------------------------------------
' 関数名 ： CellEmptyCheck2
' 機　能 ：
' 引　数 ： strTemp　･･･
' 戻り値 ：
'----------------------------------------------------------------
Private Function CellEmptyCheck2(strTemp As String) As Boolean

    If (IsNull(strTemp) Or IsEmpty(strTemp) Or strTemp = "") = True Then
        CellEmptyCheck2 = True
    Else
        CellEmptyCheck2 = False
    End If

End Function

'----------------------------------------------------------------
' 関数名 ： Header
' 機　能 ：
' 引　数 ： node　･･･
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub Header(ByRef node As MSXML2.IXMLDOMNode)

    Dim wsSelect        As Worksheet
    Dim lngI            As Long
    Dim strSyuushiUmu   As String
    Dim nodeRoot        As MSXML2.IXMLDOMNode
    Dim strChouboAppVer As String
    
    Set wsSelect = Worksheets("メニュー")
    strChouboAppVer = wsSelect.Range("CHOUBO_APP_VER").value
    
    '<HEAD>タグ内を出力
    Set nodeRoot = AppendNode(node, "HEAD")
    'バージョン
    Call AppendTextNode(nodeRoot, "VERSION", wsSelect.Range("VERSION").value)
    'APPタグ（作成アプリケーション名）
    Call AppendTextNode(nodeRoot, "APP", APP_NAME_ZENKOKU)
    
    'ファイルフォーマット番号
    Call AppendTextNode(nodeRoot, "FILE_FORMAT_NO", HEAD_INFO_FILEFORMATNO)
    
    '「告示作成アプリ」 [ 収支報告書:"0", 要旨作成:"1" ]
    '※2008/7/29 会計帳簿・収支報告書作成ソフトより　旧　APP_FLG　→　新　KOKUJI_APP_FLG　に変更する｡
    '　これは､現行の収支アプレットや旧バージョンの作成ソフトで､新様式のファイルを読み込ませないようにするための措置｡
    Call AppendTextNode(nodeRoot, "KOKUJI_APP_FLG", APP_FLG)
    
    '会計帳簿作成ソフトバージョン(会計帳簿から作成された場合、規定セルに設定される。その場合のみタグを出力)
    If IsEmptyString(strChouboAppVer) = False Then
        Call AppendTextNode(nodeRoot, "CHOUBO_APP_VER", strChouboAppVer)
    End If
    
    Call PutCloseTag(nodeRoot)
    
    '<SYUUSHI_UMU>タグ内を出力
    '例：<SYUUSHI_UMU>0000000000000000000000000000000000000000000</SYUUSHI_UMU>　（1あり0なし）
    Set nodeRoot = AppendNode(node, "SYUUSHI_UMU_FLG")
    
    '収支有無フラグを作成する
    strSyuushiUmu = ""
    For lngI = 1 To 60  'F列 1-60行 「作成有無」を検索
        Select Case wsSelect.Range("G" & lngI).value
    
        Case "True"     '有
            strSyuushiUmu = strSyuushiUmu & "1"
        Case "False"    '無
            strSyuushiUmu = strSyuushiUmu & "0"
        End Select
    Next

    Call AppendTextNode(nodeRoot, "SYUUSHI_UMU", strSyuushiUmu)
    Call PutCloseTag(nodeRoot)

End Sub

'----------------------------------------------------------------
' 関数名 ： makeXMLSheet0802
' 機　能 ： 8号様式の2シートのXMLデータ作成を行う
' 引　数 ： (in) wsSelect … 対象シートオブジェクト
'        ： (in) strSName … 対象シート名
'        ： (in) nodeBook … 追加対象ノード(BOOKノード)
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub makeXMLSheet0802(wsSelect As Worksheet, strsname As String, nodeBook As MSXML2.IXMLDOMNode)
    
    Dim strSRName       As String
    Dim nmsSelWS        As Names
    Dim lngR            As Long
    Dim intI            As Integer
    Dim strTextVal      As String
    Dim strTextFormat   As String
    Dim strElem         As String
    Dim meisai_line     As Long
    Dim meisai_clm      As Long
    Dim nodeRoot        As MSXML2.IXMLDOMNode    'ループ中のシートの最上位ノードのオブジェクト
    Dim nodeSheet       As MSXML2.IXMLDOMNode    'ループ中のシートのSHEETノードのオブジェクト
    
    Set nmsSelWS = wsSelect.Names
    strSRName = "SYUUSHI08_02"
    Set nodeRoot = AppendNode(nodeBook, strSRName)
    
    meisai_line = 9
    Do Until wsSelect.Cells(meisai_line, 2) = ""
        
        Set nodeSheet = AppendNode(nodeRoot, "SHEET")
        
        meisai_clm = 2
        strElem = "KOMOKU"
        GoSub TextPrint

        meisai_clm = 4
        strElem = "TEKIYOU"
        GoSub TextPrint
            
        meisai_clm = 4
        meisai_line = meisai_line + 4
        strElem = "DANTAI_NM"
        GoSub TextPrint
            
            '項目
'            Call GetVar(wsSelect, strSName, strSName & "!" & "KOMOKU", , 3)
            '摘要
'            Call GetVar(wsSelect, strSName, strSName & "!" & "TEKIYOU", , 3)
            '政治団体の名称
'            Call GetVar(wsSelect, strSName, strSName & "!" & "DANTAI_NM", , 3)

        
        Call PutCloseTag(nodeSheet)
        
        meisai_line = meisai_line + 9
    Loop
    
    Call PutCloseTag(nodeRoot)

    Exit Sub

TextPrint:
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    strTextVal = Worksheets("8号様式の2").Cells(meisai_line, meisai_clm).value
    strTextVal = Worksheets("16号様式").Cells(meisai_line, meisai_clm).value
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    strTextFormat = Worksheets("8号様式の2").Cells(meisai_line, meisai_clm).NumberFormat
    strTextFormat = Worksheets("16号様式").Cells(meisai_line, meisai_clm).NumberFormat
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
    
'    strElem = Mid(nmsSelWS(Cells(meisai_line, meisai_clm)).Name, Len(strSName) + 2)
    
    Call AppendTextNode(nodeSheet, strElem, TextValFormat(strTextVal, strTextFormat))
    
    Return

End Sub

'----------------------------------------------------------------
' 関数名 ： AppendNode
' 機　能 ： XMLノードに、指定のタグ名の子ノードを追加する
' 引　数 ： node        …
'        ： strNodeName …
' 戻り値 ：
'----------------------------------------------------------------
Public Function AppendNode(ByRef node As MSXML2.IXMLDOMNode, strNodeName As String) As MSXML2.IXMLDOMNode
    
    'インデント（改行＋タブの出力）
    Call DoIndent(node, mlngCurrnetIndent)
    'ノードを追加
    Set AppendNode = node.appendChild(mdocXml.createNode(NODE_ELEMENT, strNodeName, ""))
    'インデントレベルを１つ下げる
    mlngCurrnetIndent = mlngCurrnetIndent + 1
    
End Function

'----------------------------------------------------------------
' 関数名 ： AppendTextNode
' 機　能 ： XMLノードに、指定のテキストノードを追加する
' 引　数 ： node        …
'        ： strNodeName …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub AppendTextNode(ByRef node As MSXML2.IXMLDOMNode, strNodeName As String, strText As String)
    
    'インデント（改行＋タブの出力）
    Call DoIndent(node, mlngCurrnetIndent)
    'ノードとテキストを追加
    node.appendChild(mdocXml.createNode(NODE_ELEMENT, strNodeName, "")).Text = strText
    
End Sub

'----------------------------------------------------------------
' 関数名 ： AppendTextNodeByCellName
' 機　能 ： シートとセルの名前を指定することで、
'        ： そのセル名をタグ名としてテキストノードを追加する
' 引　数 ： node        …
'        ： wsSelect    …
'        ： strNodeName …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub AppendTextNodeByCellName(ByRef node As MSXML2.IXMLDOMNode, wsSelect As Worksheet, strNodeName As String)
    
    With wsSelect.Range(strNodeName)
        Call AppendTextNode(node, strNodeName, TextValFormat(.value, .NumberFormat))
    End With
    
End Sub

'----------------------------------------------------------------
' 関数名 ： PutCloseTag
' 機　能 ： タグを閉じる（インデントと改行のテキストを追加する）
' 引　数 ： node        …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub PutCloseTag(ByRef node As MSXML2.IXMLDOMNode)
    
    'インデントレベルを１つ上げる
    mlngCurrnetIndent = mlngCurrnetIndent - 1
    'インデント（改行＋タブの出力）
    Call DoIndent(node, mlngCurrnetIndent)
    
End Sub

'----------------------------------------------------------------
' 関数名 ： DoIndent
' 機　能 ： 現在のタブの分だけインデントする
' 引　数 ： node        …
'        ： lngIndent   …
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub DoIndent(ByRef node As MSXML2.IXMLDOMNode, lngIndent As Long)
    
    Call node.appendChild(mdocXml.createTextNode(vbCrLf))
    Call node.appendChild(mdocXml.createTextNode(String$(lngIndent, vbTab)))
    
End Sub

-------------------------------------------------------------------------------
VBA MACRO ModuleXMLAccess.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleXMLAccess'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'********************************************************************
'定数定義
'********************************************************************
'取込みを禁止するバージョン（これ以前のバージョンは取込不可）
Private Const NOT_ALLOW_VERSION     As String = "20070301"
'読込可能なファイルフォーマット番号
Private Const ALLOW_FILEFORMATNO    As String = "1"


'********************************************************************
'メンバ変数定義
'********************************************************************
Private mstrTagNameOnError  As String


'********************************************************************
'以下、メンバメソッド
'********************************************************************
'----------------------------------------------------------------
' 関数名 ： XML_Open
' 機　能 ： XMLドキュメントをOpenする
' 引　数 ： strXmlFilePath ･･･ OpenするXMLドキュメントのパス
'        ： xdcDoc　       ･･･ XMLドキュメント
' 戻り値 ：
'----------------------------------------------------------------
Public Function XML_Open(strXmlFilePath As String, _
                         ByRef xdcDoc As MSXML2.DOMDocument) As Boolean
    
    On Error GoTo Err_XML_Open
    
    'XMLドキュメントオブジェクトの作成
    Set xdcDoc = New MSXML2.DOMDocument
    
    '妥当性の検証は行わない
    xdcDoc.validateOnParse = False
    
    'XMLドキュメントをロードし結果を返す
    XML_Open = xdcDoc.Load(strXmlFilePath)
    
    If XML_Open = False Then
        'XMLドキュメントOpen失敗時の処理
        Call XML_LoadError(xdcDoc)    'エラーメッセージの出力
    End If
     
Exit_XML_Open:
    Exit Function
    
Err_XML_Open:
    'エラー処理
'    Call Out_Message("W1000001", "XML_Open", Err.Number)
    Resume Exit_XML_Open
                        
End Function

'----------------------------------------------------------------
' 関数名 ： XML_LoadError
' 機　能 ： XMLOpen時のエラーメッセージの表示
' 引　数 ： xdcDoc ･･･ XMLドキュメント
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XML_LoadError(ByRef xdcDoc As MSXML2.DOMDocument)
    
    Dim strErrText  As String
    Dim xpePE       As MSXML2.IXMLDOMParseError

    On Error GoTo Err_XML_LoadError

    'ParseError オブジェクトを取得する
    Set xpePE = xdcDoc.parseError
    
    With xpePE
       strErrText = "このファイルは正しいファイルでないため、取込みに失敗しました。" & vbCrLf & _
                    "詳細な原因は以下を参照してください。" & vbCrLf & vbCrLf & _
                    "次の XML ドキュメントの読み込みに失敗しました :" & _
                    "エラー # : " & .errorCode & ": " & xpePE.reason & _
                    "行 #: " & .Line & vbCrLf & _
                    "行位置 : " & .linepos & vbCrLf & _
                    "ファイル内の位置 : " & .filePos & vbCrLf & _
                    "ソース テキスト : " & .srcText & vbCrLf & _
                    "ドキュメント URL : " & .url
    End With
    
    MsgBox strErrText, vbCritical
    
Exit_XML_LoadError:
    Exit Sub
    
Err_XML_LoadError:
    'エラー処理
'    Call Out_Message("W1000001", "XML_LoadError", Err.Number)
    Resume Exit_XML_LoadError

End Sub

'----------------------------------------------------------------
' 関数名 ： XML_GetData
' 機　能 ： XMLTagデータの取得（日付項目の場合、西暦に変換する）
' 引　数 ： node        ･･･
'        ： strTagName　･･･
' 戻り値 ： 指定Tagのデータ内容
'----------------------------------------------------------------
Public Function XML_GetData(node As MSXML2.IXMLDOMNode, _
                            strTagName As String) As String
    
    On Error GoTo Err_XML_GetData
    
    Dim strNodeValue As String
    
    strNodeValue = node.selectSingleNode(strTagName).Text

    '日付項目の場合は、西暦に変換する。
    '（値をセルに貼り付ける場合に、セルの表示形式を適用させるため）
    If IsDateTagName(strTagName) Then
        XML_GetData = Format(strNodeValue, "yyyy/mm/dd")
    Else
        XML_GetData = strNodeValue
    End If
    
    Exit Function
    
Err_XML_GetData:
    'エラー処理
    XML_GetData = ""
    
'    If node Is Nothing Then
'        Debug.Print "！XML Warning[" & strTagName & "]を取得失敗"
'    Else
'        Debug.Print "！XML Warning[" & node.nodeName & "]から[" & strTagName & "]を取得しようとして失敗"
'    End If
    
End Function

'----------------------------------------------------------------
' 関数名 ： XML_GetDataNodeList
' 機　能 ： XMLTagデータの取得（日付項目の場合、西暦に変換する）
' 引　数 ： xnlItem    ･･･ XMLドキュメント
'        ： strTagName ･･･ 取得するデータのTag名
'        ： lngIndex　 ･･･ 取得するデータのIndex
' 戻り値 ： 指定Tagのデータ内容
'----------------------------------------------------------------
Public Function XML_GetDataNodeList(ByRef xnlItem As MSXML2.IXMLDOMNodeList, _
                               strTagName As String, _
                               lngIndex As Long) As String
    
    On Error GoTo Err_XML_GetDataNodeList
    
    Dim xelItem         As MSXML2.IXMLDOMElement
    Dim xelChildItem    As MSXML2.IXMLDOMElement
    Dim xnlChildItem    As MSXML2.IXMLDOMNodeList
    Dim strNodeValue    As String
    
    'XMLよりTagを指定して読込
    Set xelItem = xnlItem.Item(lngIndex)
    Set xnlChildItem = xelItem.getElementsByTagName(strTagName)
    Set xelChildItem = xnlChildItem.Item(0)
    'XML_GetDataNodeList = xelChildItem.FirstChild.nodeValue
    'XML_GetData = xelItem.Text
    
    strNodeValue = xelChildItem.FirstChild.nodeValue
    
    '日付項目の場合は、西暦に変換する。
    '（値をセルに貼り付ける場合に、セルの表示形式を適用させるため）
    If IsDateTagName(strTagName) Then
        XML_GetDataNodeList = Format(strNodeValue, "yyyy/mm/dd")
    Else
        XML_GetDataNodeList = strNodeValue
    End If
    
Exit_XML_GetDataNodeList:

    Exit Function
    
Err_XML_GetDataNodeList:
    'エラー処理
    XML_GetDataNodeList = ""
'    Call Out_Message("W1000001", "XML_GetData", Err.Number)
    Resume Exit_XML_GetDataNodeList
    
End Function

'----------------------------------------------------------------
' 関数名 ： XML_GetDataIndex
' 機　能 ： XMLTagデータ数の取得
' 引　数 ： xdcDoc     ･･･ XMLドキュメント名
'        ： strTagName ･･･ 取得するデータのTag名
' 戻り値 ： XMLTagデータ数
'----------------------------------------------------------------
Public Function XML_GetDataIndex(ByRef xdcDoc As MSXML2.DOMDocument, _
                                 strTagName As String) As Long
                                 
    On Error GoTo Err_XML_GetDataIndex
    
    Dim xnlItem As MSXML2.IXMLDOMNodeList
    
    'XMLよりTag数を取得
    Set xnlItem = xdcDoc.getElementsByTagName(strTagName)
    XML_GetDataIndex = xnlItem.length
    
Exit_XML_GetDataIndex:

    Exit Function
    
Err_XML_GetDataIndex:
    'エラー処理
    XML_GetDataIndex = 0
'    Call Out_Message("W1000001", "XML_GetDataIndex", Err.Number)
    Resume Exit_XML_GetDataIndex
    
End Function

'----------------------------------------------------------------
' 関数名 ： XML_Close
' 機　能 ： XMLのClose
' 引　数 ： xdcDoc     ･･･ XMLドキュメント名
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XML_Close(ByRef xdcDoc As MSXML2.DOMDocument)
    
    On Error GoTo Err_XML_Close
    
    'XMLドキュメントオブジェクトの開放
    Set xdcDoc = Nothing
    
Exit_XML_Close:

    Exit Sub
    
Err_XML_Close:
    'エラー処理
'    Call Out_Message("W1000001", "XML_Close", Err.Number)
    Resume Exit_XML_Close
    
End Sub

'----------------------------------------------------------------
' 関数名 ： XML_Import
' 機　能 ： 「XMLデータ取込」ボタン押下時の処理
' 引　数 ： なし
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XML_Import()

    Dim isSuccessOpen   As Boolean
    Dim strXmlFilePath  As String
    Dim xdcDoc          As MSXML2.DOMDocument
    Dim intXML_Import   As Integer
    Dim strVersion      As String
    Dim strApp          As String
    Dim strYosiki       As String
    Dim boolExistYosiki As Boolean '様式タグ(YOSIKI)の有無 / True:有り, False:無し
    Dim intResponse     As Integer
    Dim strMsg          As String
    Dim strRirekiUmu    As String
    Dim strFileFormatNo As String
    'APP_FLG判定用（要旨作成ソフト対応）
    Dim strAppFlg       As String
    Dim isSuccessImport As Boolean
    Dim nodeBook        As MSXML2.IXMLDOMNode
    Dim nodeHead        As MSXML2.IXMLDOMNode
    
    On Error GoTo Err_XML_import

    'XMLドキュメントパスの設定
    strXmlFilePath = OpenFileDialog
    If strXmlFilePath = "" Then
        Exit Sub
    End If

    'XMLドキュメントのOpen
    isSuccessOpen = XML_Open(strXmlFilePath, xdcDoc)
        
    'XMLドキュメントOpen成否判定
    If isSuccessOpen = False Then
        'XMLドキュメントOpen失敗時、
        '戻り値(-1)を設定し処理をぬける
        intXML_Import = -1
        GoTo Exit_XML_Import
    End If

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    blnNoChkAdr = True
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

    'XMLドキュメントOpen成功時の処理
    Set nodeBook = xdcDoc.selectSingleNode("BOOK")
    Set nodeHead = nodeBook.selectSingleNode("HEAD")
               
    'XMLよりTagを指定して読み込みを行う
    strVersion = GetNodeText(nodeHead, "VERSION")               'バージョン
    strApp = GetNodeText(nodeHead, "APP")                       'ａｐｐ
    'KOKUJI_APP_FLGタグの取得（要旨作成ソフト対応）
    strAppFlg = GetNodeText(nodeHead, "KOKUJI_APP_FLG")
    strFileFormatNo = GetNodeText(nodeHead, "FILE_FORMAT_NO")   'ファイルフォーマット番号
    
    '様式タグ(YOSIKI)の存在を取得し、存在すれば値も取得
    If Not nodeHead.selectSingleNode("YOSIKI") Is Nothing Then
        boolExistYosiki = True
        strYosiki = GetNodeText(nodeHead, "YOSIKI")             '様式（都団体or全国団体）
    Else
        boolExistYosiki = False
    End If
    '収支報告書変更履歴有無を取得
    strRirekiUmu = GetNodeText(nodeHead, "RIREKI_UMU")
    
    '作成されたアプリケーションをチェック
    If Not strApp Like "*収支報告書*" Then
        MsgBox strXmlFilePath & "　は収支報告書XMLファイルではありません。", vbOKOnly + vbCritical, "XMLデータ取込"
        GoTo Exit_XML_Import
    End If
    
    '作成されたアプリケーションバージョンをチェック
    If Len(strVersion) > 0 Then
        If strVersion <= NOT_ALLOW_VERSION Then
            MsgBox strXmlFilePath & "　は古いバージョンのソフトで作成されたXMLファイルです。このファイルは取込できません。", vbOKOnly + vbCritical, "XMLデータ取込"
            GoTo Exit_XML_Import
        End If
    End If
    
    'KOKUJI_APP_FLGの判定（要旨作成ソフト対応）
    If strAppFlg = APP_FLG_KOKUJI Then
        MsgBox strXmlFilePath & "　は、告示用の収支報告書XMLファイルです。このファイルは取込できません。", vbOKOnly + vbCritical, "XMLデータ取込"
        GoTo Exit_XML_Import
        
    ElseIf strAppFlg <> APP_FLG Then
        MsgBox strXmlFilePath & "　は、ファイルの形式が正しくないため、取込できません。（「KOKUJI_APP_FLG」タグが不正です）", vbOKOnly + vbCritical, "XMLデータ取込"
        GoTo Exit_XML_Import
    End If
    
    'ファイルフォーマット番号のチェック
    '※将来XMLファイルのレイアウトが変更になった場合、新しいレイアウトの
    '　ファイルを古いバージョンのソフトで取り込めないようにするための仕掛け
    If strFileFormatNo <> ALLOW_FILEFORMATNO Then
        MsgBox strXmlFilePath & vbCrLf & vbCrLf _
            & "このファイルは、新しい形式のファイルであるため、このバージョンのソフトでは取込みできません。", vbOKOnly + vbCritical, "XMLデータ取込"
        GoTo Exit_XML_Import
    End If
    
    '実行確認
    intResponse = MsgBox("APP:" & ConvertAppName(strApp) & vbCrLf & "バージョン:" & strVersion & vbCrLf & "取込を実行します。よろしいですか？", vbYesNo + vbQuestion, "XMLデータ取込")
    If intResponse = vbNo Then GoTo Exit_XML_Import
    
    '処理時間計測開始（IS_COUNT_TIME フラグがTrueの場合のみ)
    Call CountTimeStart("XMLデータ取込")
    
    'イベントを無効にする
    Application.EnableEvents = False
    '画面描画、自動計算OFF、ブックの保護解除
    Call ScreenRedraw(False)
    Call SetCalcMode(False)
    Call bUnlock
    
    '*** XMLのデータを読込み、各シートに設定する ***
    isSuccessImport = ImportXmlData(xdcDoc)
    
    If isSuccessImport = True Then
        Call IMP7   '申請者一覧シートの設定
        
        Call IMP14E '領収書一覧シートの設定
        
        Worksheets("メニュー").Activate 'メニューをアクティブ
        
        'メニューの全てのチェックボックスをオフにする
        Call AllFlgOff
        
        Call ScreenRedraw(True)
        
        '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
        Call CountTimeStop("XMLデータ取込")
        
        MsgBox "XMLデータ取込が完了しました。", vbOKOnly + vbInformation, "XMLデータ取込"
    Else
        '処理時間計測終了（IS_COUNT_TIME フラグがTrueの場合のみ)
        Call CountTimeStop("XMLデータ取込")
        
        MsgBox "XMLデータ取込時にエラーが発生しました。" & vbCrLf _
            & "エラー発生箇所：" & mstrTagNameOnError, vbCritical, "XMLデータ取込"
    End If

Exit_XML_Import:

    '画面描画OFF
    Call ScreenRedraw(False)
    
    'XMLドキュメントのClose
    Call XML_Close(xdcDoc)
    
    '全シートロック、ブックを保護
    Call zLock
    Call bLock
    
    'メニューをアクティブ
    Worksheets("メニュー").Activate
    
    '画面描画、自動計算ON
    Call ScreenRedraw(True)
    Call SetCalcMode(True)
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
    blnNoChkAdr = False
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
    
    'イベントを有効にする
    Application.EnableEvents = True
    
    intXML_Import = isSuccessImport
    
    Exit Sub
    
Err_XML_import:
    'エラー処理
    isSuccessImport = False
    Call ScreenRedraw(True)
    Application.StatusBar = False
    
    Select Case Err.Number
    'ユーザ定義のエラー：シートの追加(Worksheet.Copyに失敗)の場合
    Case vbObjectError + CUSTOM_ERRORNUM_SHEETCOPY
        MsgBox "シート追加ができませんでした。" & vbCrLf & "一度 Excel を終了してから、やり直してください。", vbCritical, "XMLデータ取込"
    
    Case Else
        '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
        Call DispException("XMLデータ取込")
        
    End Select
    
    Resume Exit_XML_Import

End Sub

'----------------------------------------------------------------
' 関数名 ： ImportXmlData
' 機　能 ： 収支報告書XMLをシートに展開する
' 引　数 ： xdcDoc      … 取込み対象XML
'        ： isKaikeiXml … 会計帳簿から出力した連携用XMLを
'        ：                取込処理の場合 True, それ以外は False
' 戻り値 ：
'----------------------------------------------------------------
Public Function ImportXmlData(xdcDoc As MSXML2.DOMDocument, _
                                Optional isKaikeiXml As Boolean = False) As Boolean
    
    Dim strUmu              As String
    Dim intReturnCodeThis   As Integer          '各シート取込み処理の結果(0:正常, -1:エラー)
    Dim existsMultiParty    As Boolean          'その11, 12において、パーティーが２つ以上あるかどうか
    Dim mapSortNo           As New EasyHashMap  '↑を判定するための、その11,12のソート番号の種類を格納するマップ
    Dim nodeBook            As MSXML2.IXMLDOMNode
    
    Set nodeBook = xdcDoc.selectSingleNode("BOOK")
    
    existsMultiParty = False
    ImportXmlData = False
    
    'ステータスバーに進捗の表示をする(進捗の母数はシート数） ※会計帳簿からの取り込み時のみ
    Call CountStatusbar("会計帳簿の内容を取込んでいます...", 53)
    
    'シートの順番が、パーティー順の場合、通常のシート順に戻す
    If Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        
        'シートを通常の順にソートする
        Call SortPartySheetsByNormal
        
        'メニューの その11,12のリンクの遷移先を通常のものにする
        Call SetLinkPartySheets(False)
    End If
    
    '収支有無
    strUmu = GetNodeText(nodeBook, "SYUUSHI_UMU_FLG/SYUUSHI_UMU")
    '会計帳簿作成ソフトバージョンを取得。タグが無ければクリア
    If nodeBook.selectSingleNode("HEAD/CHOUBO_APP_VER") Is Nothing Then
        Worksheets("メニュー").Range("CHOUBO_APP_VER").ClearContents
    Else
        Worksheets("メニュー").Range("CHOUBO_APP_VER").value = GetNodeText(nodeBook, "HEAD/CHOUBO_APP_VER")
    End If
    

    'SYUUSHI07_01
    mstrTagNameOnError = "SYUUSHI07_01"
    If UmuJudge(strUmu, 1) = True Then
        intReturnCodeThis = XMLtoWS_0701(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    End If
    Call CountStatusbar     'ステータスバーの進捗をカウントアップ


    'SYUUSHI07_02
    mstrTagNameOnError = "SYUUSHI07_02"
    If UmuJudge(strUmu, 2) = True Then
        intReturnCodeThis = XMLtoWS_0702(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    End If
    Call CountStatusbar

    'SYUUSHI07_03
    mstrTagNameOnError = "SYUUSHI07_03"
    If UmuJudge(strUmu, 3) = True Then
        intReturnCodeThis = XMLtoWS_0703(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0703(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_04
    mstrTagNameOnError = "SYUUSHI07_04"
    If UmuJudge(strUmu, 4) = True Then
        intReturnCodeThis = XMLtoWS_0704(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0704(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_05
    mstrTagNameOnError = "SYUUSHI07_05"
    If UmuJudge(strUmu, 5) = True Then
        intReturnCodeThis = XMLtoWS_0705(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0705(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_06
    mstrTagNameOnError = "SYUUSHI07_06"
    If UmuJudge(strUmu, 6) = True Then
        intReturnCodeThis = XMLtoWS_0706(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0706(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_07 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_07 KUBUN1"
    If UmuJudge(strUmu, 7) = True Then
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_07 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_07 KUBUN2"
    If UmuJudge(strUmu, 8) = True Then
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 2)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 2, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_07 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_07 KUBUN3"
    If UmuJudge(strUmu, 9) = True Then
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 3)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0707(nodeBook, 3, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_08 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_08 KUBUN1"
    If UmuJudge(strUmu, 10) = True Then
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_08 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_08 KUBUN2"
    If UmuJudge(strUmu, 11) = True Then
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 2)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 2, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_08 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_08 KUBUN3"
    If UmuJudge(strUmu, 12) = True Then
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 3)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0708(nodeBook, 3, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_09
    mstrTagNameOnError = "SYUUSHI07_09"
    If UmuJudge(strUmu, 13) = True Then
        intReturnCodeThis = XMLtoWS_0709(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0709(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_10
    mstrTagNameOnError = "SYUUSHI07_10"
    If UmuJudge(strUmu, 14) = True Then
        intReturnCodeThis = XMLtoWS_0710(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0710(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_11 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_11 KUBUN1"
    If UmuJudge(strUmu, 15) = True Then
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 1, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 1, mapSortNo, True)  'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_11 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_11 KUBUN2"
    If UmuJudge(strUmu, 16) = True Then
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 2, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 2, mapSortNo, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_11 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_11 KUBUN3"
    If UmuJudge(strUmu, 17) = True Then
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 3, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0711(nodeBook, 3, mapSortNo, True) 'クリア処理
    End If
    Call CountStatusbar
    
    'パーティーの数が2つ以上あるかどうか？
    If mapSortNo.CountItem >= 2 Then
        existsMultiParty = True
    End If
    'パーティーの数はその11,12それぞれにおいてカウントするため、マップをクリアする
    Set mapSortNo = New EasyHashMap

    'SYUUSHI07_12 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_12 KUBUN1"
    If UmuJudge(strUmu, 18) = True Then
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 1, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 1, mapSortNo, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_12 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_12 KUBUN2"
    If UmuJudge(strUmu, 19) = True Then
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 2, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 2, mapSortNo, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_12 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_12 KUBUN3"
    If UmuJudge(strUmu, 20) = True Then
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 3, mapSortNo)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0712(nodeBook, 3, mapSortNo, True) 'クリア処理
    End If
    Call CountStatusbar

    'パーティーの数が2つ以上あるかどうか？
    If mapSortNo.CountItem >= 2 Then
        existsMultiParty = True
    End If
    
    'SYUUSHI07_13
    mstrTagNameOnError = "SYUUSHI07_13"
    If UmuJudge(strUmu, 21) = True Then
        intReturnCodeThis = XMLtoWS_0713(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    End If
    Call CountStatusbar

    'SYUUSHI07_14 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_14 KUBUN1"
    If UmuJudge(strUmu, 22) = True Then
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_14 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_14 KUBUN2"
    If UmuJudge(strUmu, 23) = True Then
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 2)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 2, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_14 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_14 KUBUN3"
    If UmuJudge(strUmu, 24) = True Then
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 3)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0714(nodeBook, 3, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN1"
    If UmuJudge(strUmu, 25) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN2"
    If UmuJudge(strUmu, 26) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 2)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 2, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN3"
    If UmuJudge(strUmu, 27) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 3)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 3, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN4
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN4"
    If UmuJudge(strUmu, 28) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 4)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 4, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN5
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN5"
    If UmuJudge(strUmu, 29) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 5)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 5, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN6
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN6"
    If UmuJudge(strUmu, 30) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 6)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 6, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN7
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN7"
    If UmuJudge(strUmu, 31) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 7)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 7, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN8
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN8"
    If UmuJudge(strUmu, 32) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 8)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 8, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_15 KUBUN9
    mstrTagNameOnError = "SYUUSHI07_15 KUBUN9"
    If UmuJudge(strUmu, 33) = True Then
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 9)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0715(nodeBook, 9, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_16
    mstrTagNameOnError = "SYUUSHI07_16"
    If UmuJudge(strUmu, 34) = True Then
        intReturnCodeThis = XMLtoWS_0716(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0716(nodeBook, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_17
    mstrTagNameOnError = "SYUUSHI07_17"
    If UmuJudge(strUmu, 35) = True Then
        intReturnCodeThis = XMLtoWS_0717(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN1
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN1"
    If UmuJudge(strUmu, 36) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN2
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN2"
    If UmuJudge(strUmu, 37) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 2)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 2, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN3
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN3"
    If UmuJudge(strUmu, 38) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 3)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 3, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN4
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN4"
    If UmuJudge(strUmu, 39) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 4)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 4, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN5
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN5"
    If UmuJudge(strUmu, 40) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 5)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 5, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN6
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN6"
    If UmuJudge(strUmu, 41) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 6)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 6, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN7
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN7"
    If UmuJudge(strUmu, 42) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 7)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 7, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN8
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN8"
    If UmuJudge(strUmu, 43) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 8)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 8, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN9
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN9"
    If UmuJudge(strUmu, 44) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 9)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 9, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN10
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN10"
    If UmuJudge(strUmu, 45) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 10)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 10, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN11
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN11"
    If UmuJudge(strUmu, 46) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 11)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 11, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_18 KUBUN12
    mstrTagNameOnError = "SYUUSHI07_18 KUBUN12"
    If UmuJudge(strUmu, 47) = True Then
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 12)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0718(nodeBook, 12, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_19
    mstrTagNameOnError = "SYUUSHI07_19"
    If UmuJudge(strUmu, 48) = True Then
        intReturnCodeThis = XMLtoWS_0719(nodeBook, 1)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0719(nodeBook, 1, True) 'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI07_20
    mstrTagNameOnError = "SYUUSHI07_20"
    If UmuJudge(strUmu, 49) = True Then
        intReturnCodeThis = XMLtoWS_0720(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0720(nodeBook, True)  'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI08
    mstrTagNameOnError = "SYUUSHI08"
    If UmuJudge(strUmu, 50) = True Then
        intReturnCodeThis = XMLtoWS_08(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_08(nodeBook, True)  'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI08_02
    mstrTagNameOnError = "SYUUSHI08_02"
    If UmuJudge(strUmu, 51) = True Then
        intReturnCodeThis = XMLtoWS_0802(nodeBook)
        If intReturnCodeThis = -1 Then Exit Function
    Else
        intReturnCodeThis = XMLtoWS_0802(nodeBook, True)  'クリア処理
    End If
    Call CountStatusbar

    'SYUUSHI_KIFUKOUJYO
    mstrTagNameOnError = "SYUUSHI_KIFUKOUJYO"
    intReturnCodeThis = XMLtoWS_KIFU(nodeBook)
    Call CountStatusbar
    
    'パーティー順にソートすべきかどうかのステータスをセットする
    With Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET")
        If existsMultiParty = True Then
            .value = True
        Else
            .value = False
        End If
    End With
    
    '２つ以上のパーティーがある場合、ソートする（会計帳簿からの連携用XML取込時は、項目チェック等を行った後行うため不要）
    If existsMultiParty = True And isKaikeiXml = False Then
        
        'シートをパーティー(SORT_NO)順にソートする
        Call SortPartySheetsByParty
        
        'メニューの その11,12のリンクの遷移先を変更する
        Call SetLinkPartySheets(True)
    End If
    
    'ステータスバーを元に戻す
    Application.StatusBar = False
    
    ImportXmlData = True
    
End Function

'----------------------------------------------------------------
' 関数名 ： UmuJudge
' 機　能 ： 指定したポジションのSYUUSHI_UMUが1or0を判定する
' 引　数 ： strUmu …
'        ： lngPos …
' 戻り値 ：
'----------------------------------------------------------------
Private Function UmuJudge(strUmu As String, lngPos As Long) As Boolean

    Select Case Mid(strUmu, lngPos, 1)
    Case "1"
        UmuJudge = True
    Case "0"
        UmuJudge = False
    Case Else
        UmuJudge = False
    End Select

End Function

'----------------------------------------------------------------
' 関数名 ： AllCellClear
' 機　能 ： 全セルの色ならびに内容クリア
' 引　数 ： wsSelect    …
'        ： lngFirstRow …
'        ： lngLastRow  …
'        ： intLeftCol  …
'        ： intRightCol …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub AllCellClear(wsSelect As Worksheet, _
                            lngFirstRow As Long, _
                            lngLastRow As Long, _
                            intLeftCol As Integer, _
                            intRightCol As Integer)
    With wsSelect
    
        '前もって全セル色クリア
        Dim rngContents As Range
        Set rngContents = .Range(.Cells(lngFirstRow + 1, intLeftCol), .Cells(lngLastRow - 1, intRightCol))
        Call CellColorChange(rngContents, False)
    
        '既入力内容削除
        rngContents.ClearContents
        Set rngContents = Nothing

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： AllCellLockClear
' 機　能 ： 全セルのロックを解除
' 引　数 ： wsSelect    …
'        ： lngFirstRow …
'        ： lngLastRow  …
'        ： intLeftCol  …
'        ： intRightCol …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub AllCellLockClear(wsSelect As Worksheet, _
                            lngFirstRow As Long, _
                            lngLastRow As Long, _
                            intLeftCol As Integer, _
                            intRightCol As Integer)
    With wsSelect
    
        Dim rngContents As Range
        Set rngContents = .Range(.Cells(lngFirstRow + 1, intLeftCol), .Cells(lngLastRow - 1, intRightCol))
        
        rngContents.Locked = False

        Set rngContents = Nothing

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： RangeClear
' 機　能 ： 指定Rangeの色ならびに内容クリア
' 引　数 ： wsSelect    …
'        ： strTagName  …
'        ： rngContents …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub RangeClear(wsSelect As Worksheet, _
                        strTagName As String, _
                        Optional rngContents As Range = Nothing)
    With wsSelect

        If rngContents Is Nothing Then Set rngContents = .Range(strTagName)
        
        Call CellColorChange(rngContents, False, rngContents.Locked)

        If rngContents.Locked = False Then

            '既入力内容削除
            If rngContents.MergeCells = True Then
                rngContents.value = ""
            Else
                rngContents.ClearContents
            End If
        
        End If
        
        Set rngContents = Nothing

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： RangeDeleteValue
' 機　能 ： 指定Rangeの内容クリア（色は変更しない）
' 引　数 ： wsSelect    …
'        ： strTagName  …
'        ： rngContents …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub RangeDeleteValue(wsSelect As Worksheet, _
                            strTagName As String, _
                            Optional rngContents As Range = Nothing)
    With wsSelect

        If rngContents Is Nothing Then Set rngContents = .Range(strTagName)
        
        If rngContents.Locked = False Then

            '既入力内容削除
            If rngContents.MergeCells = True Then
                rngContents.value = ""
            Else
                rngContents.ClearContents
            End If
        
        End If
        
        Set rngContents = Nothing

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： ShortRowInsert
' 機　能 ： 足りない行の追加
' 引　数 ： wsSelect    …
'        ： lngIndex    …
'        ： lngFirstRow …
'        ： lngLastRow  …
'        ： intLeftCol  …
'        ： intRightCol …
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub ShortRowInsert(wsSelect As Worksheet, _
                            lngIndex As Long, _
                            lngFirstRow As Long, _
                            lngLastRow As Long, _
                            intLeftCol As Integer, _
                            intRightCol As Integer)

    Dim lngRowCount As Long
    Dim lngI        As Long

    lngRowCount = lngLastRow - lngFirstRow - 1

    With wsSelect

        '行数が足りない場合、行追加する
        If lngIndex > lngRowCount Then
    
            '行末よりひとつ前の行のセルをアクティブ
                
            For lngI = lngRowCount To lngIndex
        
                .Rows(lngLastRow - 1).Insert Shift:=xlShiftDown
        
            Next lngI
        
            Call RowNoRebuild(wsSelect) '行番号振りなおし
            '枠線引きなおし
            Call LineReDraw(wsSelect, lngFirstRow + 1, lngLastRow + (lngIndex - lngRowCount), intLeftCol - 1, intRightCol)

        Else
        End If

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： XMLtoRange
' 機　能 ： XMLの指定Nodeの値をRange.Valueに入力
' 引　数 ： wsSelect     …
'        ： node         …
'        ： strTagName   …
'        ： strRangeName …
'        ： isClearColor …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XMLtoRange(wsSelect As Worksheet, _
                        node As MSXML2.IXMLDOMNode, _
                        strTagName As String, _
                        Optional strRangeName As String = Empty, _
                        Optional isClearColor As Boolean = False)

    If IsEmptyString(strRangeName) = True Then
        strRangeName = strTagName
    End If

    With wsSelect.Range(strRangeName)

        If .Locked = False Then
            
            If isClearColor = True Then
                Call CellColorChange(wsSelect.Range(strRangeName), False)
            End If
            
            .value = XML_GetData(node, strTagName)
        End If

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： XMLtoDetailRange
' 機　能 ： varValの値をCells.Valueに入力
' 引　数 ： wsSelect     …
'        ： node         …
'        ： strTagName   …
'        ： strRangeName …
'        ： isClearColor …
' 戻り値 ： なし
'----------------------------------------------------------------
Private Sub XMLtoDetailRange(wsSelect As Worksheet, _
                                strTagName As String, _
                                varVal As Variant, _
                                lngIndex As Long, _
                                lngFirstRow As Long, _
                                intColPos As Integer)
    Dim lngI        As Long
    Dim intPosCol   As Integer
    
    With wsSelect
    
        intPosCol = .Range(strTagName).column
    
        For lngI = 1 To lngIndex
        
            .Cells(lngFirstRow + lngI, intPosCol).value = varVal(intColPos, lngI)
        
        Next lngI

    End With

End Sub

'Mod mnaohiro 2010.02.10_START
'Mod 'XMLの内容を詳細行に入力（共通）
'Mod Sub XMLtoDetailCommonNormal(wsSelect As Worksheet, nodelistRow As MSXML2.IXMLDOMNodeList, strTagName As Variant, _
'Mod                             lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
'Mod     Dim LngI As Long
'Mod     Dim intJ As Integer
'Mod     Dim strVal() As String
'Mod     Dim lngRowCount As Long
'Mod     Dim nodeRow As MSXML2.IXMLDOMNode
'Mod     lngRowCount = nodelistRow.length
'Mod     '配列を行×列の大きさに設定
'Mod     ReDim strVal(1 To UBound(strTagName), 1 To lngRowCount) As String
'Mod     'XMLから配列にデータを格納する
'Mod     For LngI = 0 To lngRowCount - 1
'Mod         Set nodeRow = nodelistRow.Item(LngI)
'Mod         'カラムループ
'Mod         For intJ = 1 To UBound(strTagName)
'Mod             '値取得
'Mod             strVal(intJ, LngI + 1) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
'Mod         Next intJ
'Mod     Next LngI
'Mod     '不足行追加
'Mod     Call ShortRowInsert(wsSelect, lngRowCount, lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod     '配列からシートに値を設定
'Mod     For intJ = 1 To UBound(strTagName)
'Mod         Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, lngRowCount, lngFirstRow, intJ)
'Mod     Next intJ
'Mod End Sub
'Mod
'Mod 'XMLの内容を詳細行に入力（その7,8）
'Mod Sub XMLtoDetailCommonSYUUSHI07_0708(wsSelect As Worksheet, nodelistRow As MSXML2.IXMLDOMNodeList, strTagName As Variant, _
'Mod                             lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
'Mod
'Mod     Dim LngI As Long
'Mod     Dim intJ As Integer
'Mod     Dim strVal() As String
'Mod     Dim lngRowCount As Long
'Mod     Dim strSheetName As String
'Mod     Dim rngStart As Range
'Mod     Dim nodeRow As MSXML2.IXMLDOMNode
'Mod     lngRowCount = nodelistRow.length
'Mod
'Mod     '配列を行×列の大きさに設定
'Mod     ReDim strVal(1 To UBound(strTagName), 1 To lngRowCount) As String
'Mod
'Mod     'XMLから配列にデータを格納する
'Mod     For LngI = 0 To lngRowCount - 1
'Mod
'Mod         Set nodeRow = nodelistRow.Item(LngI)
'Mod
'Mod         '列ループ
'Mod         For intJ = 1 To UBound(strTagName)
'Mod
'Mod             'Tag名でSelect
'Mod             Select Case CStr(strTagName(intJ))
'Mod
'Mod             '「寄附金（税額）控除」値取得
'Mod             Case "ZEIGAKUKOUJYO"
'Mod
'Mod                 Select Case GetNodeText(nodeRow, CStr(strTagName(intJ)))
'Mod                 Case 1
'Mod                     strVal(intJ, LngI + 1) = "必要"
'Mod
'Mod                 End Select
'Mod
'Mod             '行区分 0 = FALSE 1 = TRUE
'Mod             Case "ROWKBN"
'Mod
'Mod                 Select Case GetNodeText(nodeRow, CStr(strTagName(intJ)))
'Mod                 Case 0
'Mod                     strVal(intJ, LngI + 1) = "FALSE"
'Mod
'Mod                 Case 1
'Mod                     strVal(intJ, LngI + 1) = "TRUE"
'Mod
'Mod                 Case Else
'Mod                     strVal(intJ, LngI + 1) = "FALSE"
'Mod
'Mod                 End Select
'Mod
'Mod             Case Else
'Mod
'Mod                 '値取得
'Mod                 strVal(intJ, LngI + 1) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
'Mod
'Mod             End Select
'Mod
'Mod         Next intJ
'Mod
'Mod     Next LngI
'Mod
'Mod
'Mod     '不足行追加
'Mod     Call ShortRowInsert(wsSelect, lngRowCount, lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod
'Mod     '隠しセルの初期化
'Mod     With wsSelect
'Mod         strSheetName = .name
'Mod
'Mod         Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KINGAKU_DETAIL_ONLY").Column)
'Mod
'Mod         'オートフィル（セルを下方向にドラッグする）に任せる
'Mod         rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").Column)), Type:=xlFillSeries
'Mod         If strSheetName = "その7(1)" Then
'Mod             Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KOUJOGAKU_DETAIL_ONLY").Column)
'Mod
'Mod             'オートフィル（セルを下方向にドラッグする）に任せる
'Mod             rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KOUJOGAKU_DETAIL_ONLY").Column)), Type:=xlFillSeries
'Mod         End If
'Mod
'Mod     End With
'Mod
'Mod     '配列からシートに値を設定
'Mod     For intJ = 1 To UBound(strTagName)
'Mod
'Mod         Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, lngRowCount, lngFirstRow, intJ)
'Mod
'Mod     Next intJ
'Mod
'Mod     '小計行の書式を設定
'Mod '    For intJ = 1 To lngRowCount
'Mod     For LngI = 1 To lngRowCount
'Mod
'Mod         With wsSelect
'Mod
'Mod             '小計の場合
'Mod '            If .Cells(lngFirstRow + intJ, .Range("ROWKBN").Column).value = True Then
'Mod             If .Cells(lngFirstRow + LngI, .Range("ROWKBN").Column).value = True Then
'Mod
'Mod                 'セル色灰色
'Mod '                Call CellColorChange(.Range(.Cells(lngFirstRow + intJ, intLeftCol), .Cells(lngFirstRow + intJ, intRightCol)), False, True)
'Mod                 Call CellColorChange(.Range(.Cells(lngFirstRow + LngI, intLeftCol), .Cells(lngFirstRow + LngI, intRightCol)), False, True)
'Mod                 '行ロック
'Mod '                .Range(.Cells(lngFirstRow + intJ, intLeftCol), .Cells(lngFirstRow + intJ, intRightCol + 2)).Locked = True
'Mod                 .Range(.Cells(lngFirstRow + LngI, intLeftCol), .Cells(lngFirstRow + LngI, intRightCol + 2)).Locked = True
'Mod
'Mod             End If
'Mod
'Mod '            .Cells(lngFirstRow + intJ, .Range("NOT_EMPTY").Column).value = "1"
'Mod             .Cells(lngFirstRow + LngI, .Range("NOT_EMPTY").Column).value = "1"
'Mod
'Mod         End With
'Mod
'Mod '    Next intJ
'Mod     Next LngI
'Mod
'Mod     '小計の再計算
'Mod     Call SubtotalRecalc_Common(wsSelect)
'Mod
'Mod End Sub
'Mod
'Mod 'XMLの内容を詳細行に入力（その11,12）
'Mod Sub XMLtoDetailCommonSYUUSHI07_1112(wsSelect As Worksheet, nodelistRow As MSXML2.IXMLDOMNodeList, strTagName As Variant, _
'Mod                             lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
'Mod
'Mod     Dim LngI As Long
'Mod     Dim intJ As Integer
'Mod     Dim strVal() As String
'Mod     Dim lngRowCount As Long
'Mod     Dim nodeRow As MSXML2.IXMLDOMNode
'Mod     Dim strSheetName As String
'Mod     Dim rngStart As Range
'Mod     lngRowCount = nodelistRow.length
'Mod
'Mod     '配列を行×列の大きさに設定
'Mod     ReDim strVal(1 To UBound(strTagName), 1 To lngRowCount) As String
'Mod
'Mod     'XMLから配列にデータを格納する
'Mod     For LngI = 0 To lngRowCount - 1
'Mod
'Mod         Set nodeRow = nodelistRow.Item(LngI)
'Mod
'Mod         '列ループ
'Mod         For intJ = 1 To UBound(strTagName)
'Mod
'Mod             'Tag名でSelect
'Mod             Select Case CStr(strTagName(intJ))
'Mod
'Mod             '行区分 0 = FALSE 1 = TRUE
'Mod             Case "ROWKBN"
'Mod
'Mod                 Select Case GetNodeText(nodeRow, CStr(strTagName(intJ)))
'Mod                 Case 0
'Mod                     strVal(intJ, LngI + 1) = "FALSE"
'Mod
'Mod                 Case 1
'Mod                     strVal(intJ, LngI + 1) = "TRUE"
'Mod
'Mod                 Case Else
'Mod                     strVal(intJ, LngI + 1) = "FALSE"
'Mod
'Mod                 End Select
'Mod
'Mod             Case Else
'Mod
'Mod                 '値取得
'Mod                 strVal(intJ, LngI + 1) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
'Mod
'Mod             End Select
'Mod
'Mod         Next intJ
'Mod
'Mod     Next LngI
'Mod
'Mod     '不足行追加
'Mod     Call ShortRowInsert(wsSelect, lngRowCount, lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod
'Mod     '隠しセルの初期化
'Mod     With wsSelect
'Mod         strSheetName = .name
'Mod
'Mod         Set rngStart = .Cells(.Range("行頭").Row + 1, .Range("KINGAKU_DETAIL_ONLY").Column)
'Mod
'Mod         'オートフィル（セルを下方向にドラッグする）に任せる
'Mod         rngStart.AutoFill Destination:=.Range(rngStart, .Cells(.Range("行末").Row - 1, .Range("KINGAKU_DETAIL_ONLY").Column)), Type:=xlFillSeries
'Mod     End With
'Mod
'Mod     '配列からシートに値を設定
'Mod     For intJ = 1 To UBound(strTagName)
'Mod
'Mod         Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, lngRowCount, lngFirstRow, intJ)
'Mod
'Mod     Next intJ
'Mod
'Mod     '小計行の書式を設定
'Mod '    For intJ = 1 To lngRowCount
'Mod     For LngI = 1 To lngRowCount
'Mod
'Mod         With wsSelect
'Mod
'Mod             '小計の場合
'Mod '            If .Cells(lngFirstRow + intJ, .Range("ROWKBN").Column).value = True Then
'Mod             If .Cells(lngFirstRow + LngI, .Range("ROWKBN").Column).value = True Then
'Mod
'Mod                 'セル色灰色
'Mod '                Call CellColorChange(.Range(.Cells(lngFirstRow + intJ, intLeftCol), .Cells(lngFirstRow + intJ, intRightCol)), False, True)
'Mod                 Call CellColorChange(.Range(.Cells(lngFirstRow + LngI, intLeftCol), .Cells(lngFirstRow + LngI, intRightCol)), False, True)
'Mod                 '行ロック
'Mod '                .Range(.Cells(lngFirstRow + intJ, intLeftCol), .Cells(lngFirstRow + intJ, intRightCol + 1)).Locked = True
'Mod                 .Range(.Cells(lngFirstRow + LngI, intLeftCol), .Cells(lngFirstRow + LngI, intRightCol + 1)).Locked = True
'Mod
'Mod             End If
'Mod
'Mod '            .Cells(lngFirstRow + intJ, .Range("NOT_EMPTY").Column).value = "1"
'Mod             .Cells(lngFirstRow + LngI, .Range("NOT_EMPTY").Column).value = "1"
'Mod
'Mod         End With
'Mod
'Mod '    Next intJ
'Mod     Next LngI
'Mod
'Mod     '小計の再計算
'Mod     Call SubtotalRecalc_Common(wsSelect)
'Mod
'Mod End Sub
'Mod
'Mod 'XMLのNodeListの内容を詳細行に入力（その19）
'Mod Sub XMLtoDetailCommonNodeSYUUSHI07_19(wsSelect As Worksheet, nodelistRow As MSXML2.IXMLDOMNodeList, strTagName As Variant, _
'Mod                             lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
'Mod
'Mod     Dim LngI As Long
'Mod     Dim intJ As Integer
'Mod     Dim strVal() As String
'Mod     Dim lngRowCount As Long
'Mod     Dim nodeRow As MSXML2.IXMLDOMNode
'Mod     lngRowCount = nodelistRow.length
'Mod
'Mod     '配列を行×列の大きさに設定
'Mod     ReDim strVal(1 To UBound(strTagName), 1 To lngRowCount) As String
'Mod
'Mod     'XMLから配列にデータを格納する
'Mod     For LngI = 0 To lngRowCount - 1
'Mod
'Mod         Set nodeRow = nodelistRow.Item(LngI)
'Mod
'Mod         'カラムループ
'Mod         For intJ = 1 To UBound(strTagName)
'Mod             '値取得
'Mod             strVal(intJ, LngI + 1) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
'Mod
'Mod         Next intJ
'Mod
'Mod     Next LngI
'Mod
'Mod     '不足行追加
'Mod     Call ShortRowInsert(wsSelect, lngRowCount, lngFirstRow, lngLastRow, intLeftCol, intRightCol)  '不足行追加
'Mod
'Mod     '配列からシートに値を設定
'Mod     For intJ = 1 To UBound(strTagName)
'Mod
'Mod         Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, lngRowCount, lngFirstRow, intJ)
'Mod
'Mod     Next intJ
'Mod
'Mod End Sub
'Mod
'Mod 'XMLのNodeListの内容を詳細行に入力（その15）
'Mod Sub XMLtoDetailCommonNodeListSYUUSHI07_15(wsSelect As Worksheet, nodelistRow As MSXML2.IXMLDOMNodeList, strTagName As Variant, _
'Mod                             lngFirstRow As Long, lngLastRow As Long, intLeftCol As Integer, intRightCol As Integer)
'Mod
'Mod     Dim LngI As Long
'Mod     Dim intJ As Integer
'Mod     Dim strVal() As String
'Mod     Dim lngRowCount As Long
'Mod     Dim nodeRow As MSXML2.IXMLDOMNode
'Mod     lngRowCount = nodelistRow.length
'Mod
'Mod     '配列を行×列の大きさに設定
'Mod     ReDim strVal(1 To UBound(strTagName), 1 To lngRowCount) As String
'Mod
'Mod     'XMLから配列にデータを格納する
'Mod     For LngI = 0 To lngRowCount - 1
'Mod
'Mod         Set nodeRow = nodelistRow.Item(LngI)
'Mod
'Mod         'カラムループ
'Mod         For intJ = 1 To UBound(strTagName)
'Mod
'Mod             'Tag名でSelect
'Mod             Select Case CStr(strTagName(intJ))
'Mod
'Mod             '「領収書を徴し難かったもの」値取得
'Mod             Case "RYOUSYU"
'Mod
'Mod                 Select Case GetNodeText(nodeRow, CStr(strTagName(intJ)))
'Mod                 Case 1
'Mod                     strVal(intJ, LngI + 1) = "領収書等を徴し難かった支出の明細書を作成する"
'Mod
'Mod                 Case 2
'Mod                     strVal(intJ, LngI + 1) = "振込明細書に係る支出目的書を作成する"
'Mod
'Mod                 End Select
'Mod
'Mod             Case Else
'Mod
'Mod                 '値取得
'Mod                 strVal(intJ, LngI + 1) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
'Mod
'Mod             End Select
'Mod
'Mod         Next intJ
'Mod
'Mod     Next LngI
'Mod
'Mod     '不足行追加
'Mod     Call ShortRowInsert(wsSelect, lngRowCount, lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod
'Mod     '配列からシートに値を設定
'Mod     For intJ = 1 To UBound(strTagName)
'Mod
'Mod         Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, lngRowCount, lngFirstRow, intJ)
'Mod
'Mod     Next intJ
'Mod
'Mod End Sub

'----------------------------------------------------------------
' 関数名 ： XMLtoDetailCommonNormal
' 機　能 ： XMLの内容を詳細行に入力
'        ： 対象画面：その3, 4, 5, 6, 9, 10, 14, 15, 16, 18, 19
' 引　数 ： wsSelect    --- 値反映先ワークシートオブジェクト
'        ： nodelistRow --- XMLノードリスト
'        ： strTagName  --- 値反映先明細の列名（配列）
'        ： lngFirstRow --- 処理開始行
'        ： lngLastRow  --- 処理終了行
'        ： intLeftCol  --- 処理開始列
'        ： intRightCol --- 処理終了列
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XMLtoDetailCommonNormal(ByRef wsSelect As Worksheet, _
                                    ByRef nodelistRow As MSXML2.IXMLDOMNodeList, _
                                    ByRef strTagName As Variant, _
                                    ByVal lngFirstRow As Long, _
                                    ByVal lngLastRow As Long, _
                                    ByVal intLeftCol As Integer, _
                                    ByVal intRightCol As Integer)
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim strVal()        As String
    Dim lngRowCount     As Long
    Dim nodeRow         As MSXML2.IXMLDOMNode
    Dim lngMaxRow       As Long
    Dim lngIchirenNo    As Long
    
    'データ数を取得
    lngRowCount = nodelistRow.length
    
    '最大行数を判定
    If lngRowCount > 0 Then
        lngMaxRow = GetMaxIchirenNo(nodelistRow)
    Else
        lngMaxRow = 0
    End If
    
    '配列を行×列の大きさに設定
    ReDim strVal(1 To UBound(strTagName), 1 To lngMaxRow) As String
    
    'XMLから配列にデータを格納する
    For lngI = 0 To lngRowCount - 1
    
        '行情報を取得
        Set nodeRow = nodelistRow.Item(lngI)
        
        '一連番号を取得
        lngIchirenNo = CLng(nodeRow.selectSingleNode("ICHIREN_NO").Text)
        
        '一連番号に合致する行に各情報をセット
        For intJ = 1 To UBound(strTagName)
            
            'タグ毎に固有のセット処理を行う
            Select Case CStr(strTagName(intJ))
            Case "RYOUSYU"
                'その15 - 「領収書を徴し難かったもの」の場合
                If GetNodeText(nodeRow, CStr(strTagName(intJ))) = "1" Then
                    strVal(intJ, lngIchirenNo) = "領収書等を徴し難かった支出の明細書を作成する"
                    
                ElseIf GetNodeText(nodeRow, CStr(strTagName(intJ))) = "2" Then
                    strVal(intJ, lngIchirenNo) = "振込明細書に係る支出目的書を作成する"
                    
                Else
                    strVal(intJ, lngIchirenNo) = ""
                    
                End If
            Case "KOUFUKIN"
                'その14・15 - 「交付金に係る支出」の場合
                If GetNodeText(nodeRow, CStr(strTagName(intJ))) = "1" Then
                    strVal(intJ, lngIchirenNo) = "（交）"
                Else
                    strVal(intJ, lngIchirenNo) = ""
                End If
            Case Else
                'その他の場合
                strVal(intJ, lngIchirenNo) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
                
            End Select
            
        Next intJ
        
    Next lngI

    '不足行追加
    Call ShortRowInsert(wsSelect, lngMaxRow, lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    '配列からシートに値を設定
    For intJ = 1 To UBound(strTagName)
        Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, _
                                lngMaxRow, lngFirstRow, intJ)
    Next intJ

End Sub

'----------------------------------------------------------------
' 関数名 ： XMLtoDetailCommonSyoukei
' 機　能 ： XMLの内容を詳細行に入力（小計が存在する画面用）
'        ： 対象画面：その7, 8, 11, 12
' 引　数 ： wsSelect    --- 値反映先ワークシートオブジェクト
'        ： nodelistRow --- XMLノードリスト
'        ： strTagName  --- 値反映先明細の列名（配列）
'        ： lngFirstRow --- 処理開始行
'        ： lngLastRow  --- 処理終了行
'        ： intLeftCol  --- 処理開始列
'        ： intRightCol --- 処理終了列
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XMLtoDetailCommonSyoukei(ByRef wsSelect As Worksheet, _
                                    ByRef nodelistRow As MSXML2.IXMLDOMNodeList, _
                                    ByRef strTagName As Variant, _
                                    ByVal lngFirstRow As Long, _
                                    ByVal lngLastRow As Long, _
                                    ByVal intLeftCol As Integer, _
                                    ByVal intRightCol As Integer)
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim strVal()        As String
    Dim lngRowCount     As Long
    Dim rngStart        As Range
    Dim nodeRow         As MSXML2.IXMLDOMNode
    Dim lngMaxRow       As Long
    Dim lngIchirenNo    As Long
    Dim strSheetName    As String
    
    'シート名を取得
    strSheetName = wsSelect.name
    
    'データ数を取得
    lngRowCount = nodelistRow.length
    
    '最大行数を判定
    If lngRowCount > 0 Then
        lngMaxRow = GetMaxIchirenNo(nodelistRow)
    Else
        lngMaxRow = 0
    End If
    
    '配列を行×列の大きさに設定
    ReDim strVal(1 To UBound(strTagName), 1 To lngMaxRow) As String

    'XMLから配列にデータを格納する
    For lngI = 0 To lngRowCount - 1
    
        '行情報を取得
        Set nodeRow = nodelistRow.Item(lngI)
        
        '一連番号を取得
        lngIchirenNo = CLng(nodeRow.selectSingleNode("ICHIREN_NO").Text)
        
        '一連番号に合致する行に各情報をセット
        For intJ = 1 To UBound(strTagName)

            'タグ毎に固有のセット処理を行う
            Select Case CStr(strTagName(intJ))
            Case "ZEIGAKUKOUJYO"
                '寄附金（税額）控除の場合
                If GetNodeText(nodeRow, CStr(strTagName(intJ))) = "1" Then
                    strVal(intJ, lngIchirenNo) = "必要"
                Else
                    strVal(intJ, lngIchirenNo) = ""
                End If
                
            Case "ROWKBN"
                '行区分の場合（0=FALSE、1=TRUE）
                If GetNodeText(nodeRow, CStr(strTagName(intJ))) = "1" Then
                    strVal(intJ, lngIchirenNo) = "TRUE"
                Else
                    strVal(intJ, lngIchirenNo) = "FALSE"
                End If
                
            Case Else
                'その他の場合
                strVal(intJ, lngIchirenNo) = XML_GetData(nodeRow, CStr(strTagName(intJ)))
                    
            End Select
            
        Next intJ

    Next lngI

    '不足行追加
    Call ShortRowInsert(wsSelect, lngMaxRow, lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    '隠しセルの初期化
    With wsSelect
        Set rngStart = .Cells(.Range("行頭").Row + 1, _
                              .Range("KINGAKU_DETAIL_ONLY").column)
        'オートフィル（セルを下方向にドラッグする）に任せる
        rngStart.AutoFill Destination:=.Range(rngStart, _
                                              .Cells(.Range("行末").Row - 1, _
                                              .Range("KINGAKU_DETAIL_ONLY").column)), _
                                       Type:=xlFillSeries
        If strSheetName = "その7(1)" Then
            Set rngStart = .Cells(.Range("行頭").Row + 1, _
                                  .Range("KOUJOGAKU_DETAIL_ONLY").column)
            'オートフィル（セルを下方向にドラッグする）に任せる
            rngStart.AutoFill Destination:=.Range(rngStart, _
                                                  .Cells(.Range("行末").Row - 1, _
                                                  .Range("KOUJOGAKU_DETAIL_ONLY").column)), _
                                           Type:=xlFillSeries
        End If
    End With

    '配列からシートに値を設定
    For intJ = 1 To UBound(strTagName)
        Call XMLtoDetailRange(wsSelect, CStr(strTagName(intJ)), strVal, _
                                lngMaxRow, lngFirstRow, intJ)
    Next intJ

    '小計行の書式を設定
    For lngI = 1 To lngMaxRow
        With wsSelect
            '小計の場合
            If .Cells(lngFirstRow + lngI, .Range("ROWKBN").column).value = True Then
                'セル色を薄い黄色へ
                Call CellColorChange(.Range(.Cells(lngFirstRow + lngI, intLeftCol), _
                                            .Cells(lngFirstRow + lngI, intRightCol)), _
                                     False, _
                                     True)
                '行ロック
                If strSheetName Like "その7*" Or strSheetName Like "その8*" Then
                    'その7、8（寄附系画面）
                    .Range(.Cells(lngFirstRow + lngI, intLeftCol), _
                           .Cells(lngFirstRow + lngI, intRightCol + 2)).Locked = True
                Else
                    'その11、12（パーティー系画面）
                    .Range(.Cells(lngFirstRow + lngI, intLeftCol), _
                           .Cells(lngFirstRow + lngI, intRightCol + 1)).Locked = True
                End If
            End If
            .Cells(lngFirstRow + lngI, .Range("NOT_EMPTY").column).value = "1"
        End With
    Next lngI

    '小計の再計算
    Call SubtotalRecalc_Common(wsSelect)

End Sub
'Mod mnaohiro 2010.02.10_END

'@@01MOD START
'-------------------------------------------------------------------
' 関数名 ： XMLtoDetailCommonSYUUSHI08
' 機  能 ： XMLの内容を詳細行に入力（8号様式）
' 引  数 ： wsSelect        Worksheet
' 　　　 ： nodelistRow     MSXML2.IXMLDOMNodeList
' 　　　 ： strTagName      項目名（配列）
' 　　　 ： lngFirstRow     始まり行
' 　　　 ： lngLastRow      終わり行
' 　　　 ： intLeftCol      左列
' 　　　 ： intRightCol     右列
' 　　　 ：
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub XMLtoDetailCommonSYUUSHI08(wsSelect As Worksheet, _
                                        nodelistRow As MSXML2.IXMLDOMNodeList, _
                                        strTagName As Variant, _
                                        lngFirstRow As Long, _
                                        lngLastRow As Long, _
                                        intLeftCol As Integer, _
                                        intRightCol As Integer)

    Dim lngI        As Long
    Dim intJ        As Integer
    Dim strVal()    As String
    Dim lngRowCount As Long
    Dim nodeRow     As MSXML2.IXMLDOMNode
    Dim koumoku()   As String
    Dim tekiyou()   As String
    Dim kingaku()   As String
    Dim dt()        As String
    Dim jijyou()    As String
    
    lngRowCount = nodelistRow.length
    
    ReDim koumoku(lngRowCount)
    ReDim tekiyou(lngRowCount)
    ReDim kingaku(lngRowCount)
    ReDim dt(lngRowCount)
    ReDim jijyou(lngRowCount)

    For lngI = 1 To lngRowCount
    
        Set nodeRow = nodelistRow.Item(lngI - 1)
        
        '値取得
        koumoku(lngI) = XML_GetData(nodeRow, CStr(strTagName(1)))
        tekiyou(lngI) = XML_GetData(nodeRow, CStr(strTagName(2)))
        kingaku(lngI) = XML_GetData(nodeRow, CStr(strTagName(3)))
        dt(lngI) = XML_GetData(nodeRow, CStr(strTagName(4)))
        jijyou(lngI) = XML_GetData(nodeRow, CStr(strTagName(5)))

    Next

    Call SetYousiki08(lngRowCount, koumoku, tekiyou, kingaku, dt, jijyou, True)
        
End Sub
'@@01MOD END

'----------------------------------------------------------------
' 関数名 ： OpenFileDialog
' 機　能 ： ファイルダイアログを開く
' 引　数 ： なし
' 戻り値 ： ファイルパス
'----------------------------------------------------------------
Private Function OpenFileDialog() As String
    
    Dim strFileName As String
    Dim intResponse As Integer
    
    strFileName = Application.GetOpenFilename(FileFilter:="XMLファイル(*.xml),*.xml")
    
    If strFileName = "" Or strFileName = "False" Then
        Exit Function
    End If
    
    'B-CCL-047
'    If Dir(strFileName) = "" Then
    If isFileExists(strFileName) = False Then
    
        MsgBox strFileName & "　は存在しません。", vbOKOnly + vbCritical, "XMLデータ取込"
    
    End If

    OpenFileDialog = strFileName

End Function

'----------------------------------------------------------------
' 関数名 ： SheetSetup
' 機　能 ： シート数を揃える（その１１、１２、１５、１９で使用）
' 引　数 ： strSName    …
'        ： intKubun    …
'        ： lngSheetTag …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub SheetSetup(strsname As String, intKubun As Integer, lngSheetTag As Long)

    Dim strSKNo         As String
    Dim lngI            As Long
    Dim wsSelect        As Worksheet
    Dim rngDelete       As Range
    Dim intDeleteCol    As Integer
'    Dim intKaikeiJijyouCol As Integer
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long

    '同一区分シートの調整 および最終枝版の取得
    '（同一区分の枝版が連番となっていない場合、そのシート以降は削除する）
    If strsname Like "その19*" Then
        strSKNo = NormalizeSheets("その19")
    Else
        strSKNo = NormalizeSheets(strsname)
    End If

    'シートの追加・削除・クリア処理
    Select Case lngSheetTag - strSKNo
    'シート数が一緒 追加削除無し（クリア処理のみ行なう）
    Case 0

        For lngI = 1 To lngSheetTag

            GoSub CellClear

        Next lngI

    'シート数が少ない 追加する
    Case Is > 0

'        Call bUnlock

        For lngI = strSKNo To lngSheetTag - 1

            Set wsSelect = Worksheets(strsname & "(" & lngI & ")")
            
            'シートのコピー（Excel VBAの制限によってエラーとなった場合は、独自の例外を発生する）
            Call CopySheetSimple(wsSelect, isRaiseException:=True)
'            wsSelect.Activate
'            wsSelect.Copy After:=wsSelect
            Set wsSelect = Nothing

        Next lngI
'        Call bLock
        GoSub CellClear
'        If strSName Like "その11*" Then Call SNo11SumRebuild
'        If strSName Like "その12*" Then Call SNo12SumRebuild
        If strsname Like "その15*" Then Call SNo15SumRebuild(strsname & "(1)", CStr(intKubun))

    'シート数が多い 削除する
    Case Is < 0

'        Call bUnlock

        For lngI = strSKNo To lngSheetTag + 1 Step -1
            If strsname Like "その19*" Then
                Set wsSelect = Worksheets("その19(" & CStr(lngI) & ")")
            Else
                Set wsSelect = Worksheets(strsname & "(" & CStr(lngI) & ")")
            End If
            Application.DisplayAlerts = False
            wsSelect.Activate
            wsSelect.Delete
            Application.DisplayAlerts = True
            Set wsSelect = Nothing

        Next lngI
'        Call bLock
        GoSub CellClear
'        If strSName Like "その11*" Then Call SNo11SumRebuild
'        If strSName Like "その12*" Then Call SNo12SumRebuild
        If strsname Like "その15*" Then Call SNo15SumRebuild(strsname & "(1)", CStr(intKubun))

    End Select

Exit Sub

CellClear:
    
    For lngI = 1 To lngSheetTag
    
        If strsname Like "その19*" Then
            Set wsSelect = Worksheets("その19(" & CStr(lngI) & ")")
        Else
            Set wsSelect = Worksheets(strsname & "(" & lngI & ")")
        End If
        
        'シート全体のセルのクリア
        Call SheetClear(wsSelect)
        
'        intLeftCol = wsSelect.Range("左端").Column
'        intRightCol = wsSelect.Range("右端").Column
'        lngFirstRow = wsSelect.Range("行頭").Row
'        lngLastRow = wsSelect.Range("行末").Row
'
'        'セルのクリアのみ行う
'        If strSName Like "その11*" Or strSName Like "その12*" Then
'
'            '2008/08/04 FIX クリア右端を右端XMLに再設定
'            intRightCol = wsSelect.Range("右端XML").Column
'
'            Call RangeClear(wsSelect, "PATYI_NM") 'PATYI_NM セル色クリア 内容クリア
'            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
'
'            Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア
'            '2008/08/04 FIX 小計以外の行がロックのまま
'            Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol - 1) 'セルロッククリア
'
'        ElseIf strSName Like "その15*" Then
'
'            Call RangeClear(wsSelect, "HIMOKU") 'HIMOKU セル色クリア 内容クリア
'            Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
'
'            '「領収書を徴し難かったもの」列の内容をクリア（セル色は変更しない）
'            intDeleteCol = wsSelect.Range("RYOUSYU").Column
'            GoSub DeleteColumn
'            '「領収書を徴し難かったもの」列のセル色を黄色に変更
'            Call ExceptionCellColorChange(wsSelect, lngFirstRow + 1, lngLastRow - 1)
'
'            'その15はワーク用の列「KAIKEI_SEQ_NO」もクリア--2008/08/01Fix
'            intDeleteCol = wsSelect.Range("KAIKEI_SEQ_NO").Column
'            GoSub DeleteColumn
'
'            'その15はワーク用の列「KAIKEI_JIJYOU」もクリア--2008/08/01Fix
'            intDeleteCol = wsSelect.Range("KAIKEI_JIJYOU").Column
'            GoSub DeleteColumn
'
'            Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア
'
'            '2008/08/04 FIX 小計以外の行がロックのまま
'            Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol)  'セル色クリア 内容クリア ロッククリア
'
'        ElseIf strSName Like "その19*" Then
'
'            Call RangeClear(wsSelect, "KBN_1") '項目別区分 内容クリア
'            Call RangeClear(wsSelect, "KBN_2") '項目別区分 内容クリア
'            Call RangeClear(wsSelect, "KBN_3") '項目別区分 内容クリア
'            Call CellColorChange(wsSelect.Range("KOMOKU_KBN_1"), False)
'            Call CellColorChange(wsSelect.Range("KOMOKU_KBN_2"), False)
'            Call CellColorChange(wsSelect.Range("KOMOKU_KBN_3"), False)
'
'            Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア
'
'        End If
'
'        Set wsSelect = Nothing
    
    Next lngI
    
    Return

'DeleteColumn:
'
'    Set rngDelete = wsSelect.Range(wsSelect.Cells(lngFirstRow + 1, intDeleteCol), wsSelect.Cells(lngLastRow - 1, intDeleteCol))
'    Call RangeDeleteValue(wsSelect, "", rngDelete)
'
'    Return

End Sub

'----------------------------------------------------------------
' 関数名 ： XMLtoRangeCHK17
' 機　能 ： その17 チェックボックスに対する処理
' 引　数 ： wsSelect   …
'        ： node       …
'        ： strTagName …
'        ： strChkNo   …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub XMLtoRangeCHK17(wsSelect As Worksheet, _
                            node As MSXML2.IXMLDOMNode, _
                            strTagName As String, _
                            strChkNo As String)
    With wsSelect
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
        'Call CellColorChange(.Range("CHK" & strChkNo), False)
        Call CellColorChange(.Range("_CHK" & strChkNo), False)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END
        Call CellColorChange(.Range("NCHK" & strChkNo), False)

        Select Case GetNodeText(node, strTagName)
        Case 1
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
            'With .Range("CHK" & strChkNo)
            With .Range("_CHK" & strChkNo)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

                If .Locked = False Then
                    .value = True
                End If

            End With
            With .Range("NCHK" & strChkNo)

                If .Locked = False Then
                    .value = False
                End If

            End With

        Case 0
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'            With .Range("CHK" & strChkNo)
            With .Range("_CHK" & strChkNo)
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

                If .Locked = False Then
                    .value = False
                End If

            End With
            With .Range("NCHK" & strChkNo)

                If .Locked = False Then
                    .value = True
                End If

            End With
        Case Else
        End Select

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： DefaultValueSet
' 機　能 ： 規定値セット（その7 「寄附金（税額）控除」をFALSEに初期化するために使用）
' 引　数 ： wsSelect        …
'        ： lngFirstRow     …
'        ： lngLastRow      …
'        ： intSetCol       …
'        ： strDefaultValue …
' 戻り値 ： なし
'----------------------------------------------------------------
Public Sub DefaultValueSet(wsSelect As Worksheet, _
                            lngFirstRow As Long, _
                            lngLastRow As Long, _
                            intSetCol As Integer, _
                            strDefaultValue As String)
    With wsSelect
    
        '指定Range内のCellをDefaultValueにする
        Dim rngContents As Range, rngRoop As Range
        Set rngContents = .Range(.Cells(lngFirstRow + 1, intSetCol), .Cells(lngLastRow - 1, intSetCol))
        
        For Each rngRoop In rngContents
        
            rngRoop.value = strDefaultValue
        
        Next rngRoop
        
        Set rngContents = Nothing

    End With

End Sub

'----------------------------------------------------------------
' 関数名 ： IsDateTagName
' 機　能 ： 日付項目のタグであるかを返す
' 引　数 ： str … タグ名
' 戻り値 ： True : 日付項目である / False : 日付項目でない
'----------------------------------------------------------------
Private Function IsDateTagName(str As String) As Boolean
    
    Dim tagName As String
    
    'タグ名を抜き出す（例："AAA/BBB/DT" → "DT"）
    tagName = Mid(str, InStrRev(str, "/") + 1)
    
    Select Case tagName
        Case "DT"
            IsDateTagName = True
        Case "KAISAI_DT"
            IsDateTagName = True
        Case "SIKIN_KIKAN1"
            IsDateTagName = True
        Case "SIKIN_KIKAN2"
            IsDateTagName = True
        Case "GIIN_KIKAN1"
            IsDateTagName = True
        Case "GIIN_KIKAN2"
            IsDateTagName = True
        Case "SENSEI_DT"
            IsDateTagName = True
        Case Else
            IsDateTagName = False
    End Select
    
End Function

'----------------------------------------------------------------
' 関数名 ： ConvertAppName
' 機　能 ： APPタグの値を、表示用に変換する
'        ： タグ値が「収支報告書作成ソフト〔 〕」であれば、
'        ： そのカッコ内の文字列を返す
' 引　数 ： str … 変換対象文字列
' 戻り値 ： APPタグ値のアプリケーション名
'----------------------------------------------------------------
Private Function ConvertAppName(str As String) As String
    
    If str Like "収支報告書作成ソフト〔*〕" Then
        '収支報告書作成ソフト〔○○〕 の○○を取り出す。(12文字目～末尾のひとつ前）
        ConvertAppName = Mid$(str, 12, Len(str) - 12)
    Else
        ConvertAppName = str
    End If
    
End Function

'----------------------------------------------------------------
' 関数名 ： GetNodeText
' 機　能 ： 指定タグの値を１つ取得する
' 引　数 ： node     … 対象ノード
'        ： strQuery …
' 戻り値 ： 渡されたノード直下に存在する、指定タグの値（テキストノードの値）
'----------------------------------------------------------------
Public Function GetNodeText(node As MSXML2.IXMLDOMNode, _
                            strQuery As String) As String
    On Error GoTo ErrorTrap:
    
    GetNodeText = node.selectSingleNode(strQuery).Text
    
    Exit Function

ErrorTrap:
    '取得でエラーとなった場合は空の文字列を返す
    GetNodeText = ""
'    If node Is Nothing Then
'        Debug.Print "！XML Warning[" & strQuery & "]を取得失敗"
'    Else
'        Debug.Print "！XML Warning[" & node.nodeName & "]から[" & strQuery & "]を取得しようとして失敗"
'    End If
    
End Function

'Add mnaohiro 2010.02.10_START
'----------------------------------------------------------------
' 関数名 ： GetMaxRowCnt
' 機　能 ： 明細行が存在する画面のXMLノードから
'           一連番号の最大値を取得する
' 引　数 ： objNodeList --- 走査対象ノードリスト
' 戻り値 ： 一連番号の最大値
'----------------------------------------------------------------
Private Function GetMaxIchirenNo(ByRef objNodeList As MSXML2.IXMLDOMNodeList) As Long
On Error GoTo Error_GetMaxRowCnt:

    Dim lngCnt          As Long
    Dim lngIchirenNo    As Long
    Dim lngMaxRowCnt    As Long
    Dim objNode         As MSXML2.IXMLDOMNode
    
    '初期化
    GetMaxIchirenNo = 0
    lngMaxRowCnt = 0
    
    'XMLから配列にデータを格納する
    For lngCnt = 0 To objNodeList.length - 1
    
        '行情報を取得
        Set objNode = objNodeList.Item(lngCnt)
        
        '一連番号を取得
        lngIchirenNo = CLng(objNode.selectSingleNode("ICHIREN_NO").Text)
        
        '最大の一連番号を格納
        If lngMaxRowCnt < lngIchirenNo Then
            lngMaxRowCnt = lngIchirenNo
        End If
        
    Next lngCnt
    
    '返却領域に値を設定し終了
    GetMaxIchirenNo = lngMaxRowCnt
    Exit Function

Error_GetMaxRowCnt:
    '例外発生
    GetMaxIchirenNo = -1

End Function
'Add mnaohiro 2010.02.10_END


'********************************************************************
'以下、未使用メソッド
'********************************************************************
''-------------------------------------------------------------------------------
'' @(f)
''
'' 機能      : XMLTagデータの取得
''
'' 返り値    : 指定Tagのデータ内容
''
'' 引き数    : ARG1 - XMLドキュメント名
'' 　　　    : ARG2 - 取得するデータのTag名
'' 　　　    : ARG3 - 取得するデータのIndex
''
'' 機能説明  : XMLTagに該当するデータの取得。
''
'' 備考      : 日付項目の場合、西暦に変換する
''-------------------------------------------------------------------------------
'Public Function XML_GetData(ByRef xdcDoc As MSXML2.DOMDocument, _
'                               strTagName As String, _
'                               lngIndex As Long) As String
'
'    On Error GoTo Err_XML_GetData
'
'    Dim xnlItem As MSXML2.IXMLDOMNodeList
'    Dim xelItem As MSXML2.IXMLDOMElement
'    Dim strNodeValue As String
'
'''XMLよりTagを指定して読込
'    Set xnlItem = xdcDoc.getElementsByTagName(strTagName)
'    Set xelItem = xnlItem.Item(lngIndex)
'    'XML_GetData = xelItem.FirstChild.nodeValue
'    strNodeValue = xelItem.FirstChild.nodeValue
'    'XML_GetData = xelItem.Text
'
'    '日付項目の場合は、西暦に変換する。
'    '（値をセルに貼り付ける場合に、セルの表示形式を適用させるため）
'    If IsDateTagName(strTagName) Then
'        XML_GetData = Format(strNodeValue, "yyyy/mm/dd")
'    Else
'        XML_GetData = strNodeValue
'    End If
'
'Exit_XML_GetData:
'
'    Exit Function
'
'Err_XML_GetData:
'    'エラー処理
'    XML_GetData = ""
''    Call Out_Message("W1000001", "XML_GetData", Err.Number)
'    Resume Exit_XML_GetData
'
'End Function

''XMLの指定Nodeの値をRange.Valueに入力
'Sub XMLtoRange(wsSelect As Worksheet, ByRef xdcDoc As MSXML2.DOMDocument, strNodeName As String, strTagName As String, lngIndex As Long, Optional strRangeName As String = Empty, Optional boolColorClear As Boolean = False)
'
'    If IsNull(strRangeName) = True Or IsEmpty(strRangeName) = True Or strRangeName = "" Then strRangeName = strTagName
'
'    With wsSelect.Range(strRangeName)
'
'        If .Locked = False Then
'            If boolColorClear = True Then Call CellColorChange(wsSelect.Range(strRangeName), False)
'            .value = XML_GetData(xdcDoc, strNodeName & "/" & strTagName, lngIndex)
'            'Debug.Print strTagName & ":" & .Value
'        End If
'
'    End With
'
'End Sub
'
''-------------------------------------------------------------------------------
'' @(f)
''
'' 機能      : 指定タグの値を１つ取得する
''
'' 返り値    : 渡されたノード直下に存在する、指定タグの値（テキストノードの値）
''
'' 引き数    : node - 対象ノード
'' 　　　    : tagName - 取得対象タグ名またはselectNodesメソッドで指定可能なパス（指定したnode以下から取得する）
'' 　　　    : isFormatConvert - True:日付項目の場合、"yyyy/mm/dd"フォーマットに変換する, False:変換しない
''
'' 機能説明  :
''
'' 備考      :
''-------------------------------------------------------------------------------
'Public Function GetNodeTextOrginal(node As MSXML2.IXMLDOMNode, _
'                               tagName As String, Optional isFormatConvert As Boolean = True) As String
'
'    On Error GoTo Err_GetNodeTextOrginal
'
'    Dim nodelist As MSXML2.IXMLDOMNodeList
'    Dim strNodeValue As String
'    strNodeValue = ""
'
'    Set nodelist = node.selectNodes(tagName)
'    If nodelist.length > 0 Then
'        strNodeValue = nodelist.Item(0).Text
'    End If
'
'    '日付項目の場合は、西暦に変換する。
'    '（値をセルに貼り付ける場合に、セルの表示形式を適用させるため）
'    If isFormatConvert Then
'        If IsDateTagName(tagName) Then
'            GetNodeTextOrginal = Format$(strNodeValue, "yyyy/mm/dd")
'        Else
'            GetNodeTextOrginal = strNodeValue
'        End If
'    Else
'        GetNodeTextOrginal = strNodeValue
'    End If
'
'    Exit Function
'
'Err_GetNodeTextOrginal:
'    'エラー処理
'    GetNodeTextOrginal = ""
'    Exit Function
'
'End Function
'
'
''-------------------------------------------------------------------------------
'' @(f)
''
'' 機能      : 単項目１つのXML値を取得し、シートに設定する
''
'' 返り値    : -
''
'' 引き数    : wsSelect - 対象シート
'' 　　　    : node - 対象ノード
'' 　　　    : tagName - 取得対象タグ名またはselectNodesメソッドで指定可能なパス（指定したnode以下から取得する）
'' 　　　    : strRangeName - 値を設定するするセルの名称（省略時はタグ名と同じと解釈）
''
'' 機能説明  : 変更履歴を含めて取得する
''
'' 備考      :
''-------------------------------------------------------------------------------
'Sub LoadXmlCell(wsSelect As Worksheet, node As MSXML2.IXMLDOMNode, tagName As String, Optional strRangeName As String = Empty)
'
'    Dim rngTarget As Range
'    Dim strValueXml As String       'XMLの値
'
'    If IsEmptyString(strRangeName) Then strRangeName = tagName
'    Set rngTarget = wsSelect.Range(strRangeName)                    '入力エリア中のtagNameに該当するセル
'
'    '値を取得
'    strValueXml = GetNodeText(node, tagName)
'
'    'セルににセット
'    rngTarget.MergeArea.value = strValueXml
'
'End Sub
'
'
-------------------------------------------------------------------------------
VBA MACRO ModuleXMLSheet.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleXMLSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'********************************************************************
'以下、メンバメソッド
'********************************************************************
'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0702
' 機　能 ： XMLデータを「7号様式 その2」に設定する
' 引　数 ： nodeBook … XMLノード
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0702(nodeBook As MSXML2.IXMLDOMNode) As Integer

    Dim wsSelect    As Worksheet
    Dim nodeSheet   As MSXML2.IXMLDOMNode       'SHEETタグ
    
    Set wsSelect = Worksheets("その2")

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_02/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0702 = -1
        Exit Function
    End If

    'XMLTagデータの取得処理（XML_GetData）を行う
    Call RangeClear(wsSelect, "SYUNYU_SGK")
    Call XMLtoRange(wsSelect, nodeSheet, "ZENNEN_KKS_GK", , True)
    Call RangeClear(wsSelect, "HONNEN_SYUNYU_GK")
    Call RangeClear(wsSelect, "SISYUTU_SGK")
    Call RangeClear(wsSelect, "YOKUNEN_KKS_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "KOJIN_FUTAN_KGK", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KOJIN_FUTAN_SU", , True)
    If wsSelect.Range("KOJIN_FUTAN_SU").value = "" Then
        wsSelect.Range("KOJIN_FUTAN_SU").value = 0
    End If
    Call RangeClear(wsSelect, "KOJIN_KIFU_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "KOJIN_KIFU_BIKOU", , True)
    
    '（うち特定寄附）【金額】の値が5万円以下なら一旦入力可能にする
    'ただし、その7(1)の取込で再度入力可否の判定をする
    Dim strTokuteiKifuGk As String
    Dim boolUnLockedTokuteiKifuGk As Boolean
    
    strTokuteiKifuGk = XML_GetData(nodeSheet, "TOKUTEI_KIFU_GK")
    boolUnLockedTokuteiKifuGk = False
    
    If IsNumeric(strTokuteiKifuGk) Then
        If CDbl(strTokuteiKifuGk) <= 50000 Then
            boolUnLockedTokuteiKifuGk = True
        End If
    End If
    
    If boolUnLockedTokuteiKifuGk Then
        '入力可能に変更
        wsSelect.Range("TOKUTEI_KIFU_GK").Locked = False
        '表示状態に変更
        wsSelect.Range("TOKUTEI_KIFU_GK").FormulaHidden = False
        '数式だけ削除
        wsSelect.Range("TOKUTEI_KIFU_GK").value = wsSelect.Range("TOKUTEI_KIFU_GK").value
        'セルの色(塗りつぶしなし)
        wsSelect.Range("TOKUTEI_KIFU_GK").Interior.ColorIndex = xlColorIndexNone
        
        'シートの保護解除
        Call UnlockOneSheet(wsSelect)
        
        '入力規則「5万円を超える金額は入力不可」を追加
        With wsSelect.Range("TOKUTEI_KIFU_GK").Validation
            .Delete
            .Add Type:=xlValidateWholeNumber, _
                 Operator:=xlBetween, _
                 Formula1:=0, Formula2:=50000
        End With
        
        'シートの保護
        Call LockOneSheet(wsSelect)
        
        'XMLの値をセット
        Call XMLtoRange(wsSelect, nodeSheet, "TOKUTEI_KIFU_GK", , True)
    Else
        '入力不可に変更
        wsSelect.Range("TOKUTEI_KIFU_GK").Locked = True
        '非表示状態に変更
        wsSelect.Range("TOKUTEI_KIFU_GK").FormulaHidden = True
        '入力規則を削除
        wsSelect.Range("TOKUTEI_KIFU_GK").Validation.Delete
        '数式を追加
        wsSelect.Range("TOKUTEI_KIFU_GK") = "='その7(1)'!TOKUTEI_KIFU"
        'セルの色(淡い黄色)
        wsSelect.Range("TOKUTEI_KIFU_GK").Interior.Color = 10092543
    End If
    
    Call XMLtoRange(wsSelect, nodeSheet, "TOKUTEI_KIFU_BIKOU", , True)
    Call RangeClear(wsSelect, "HOJIN_KIFU_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "HOJIN_KIFU_BIKOU", , True)
    Call RangeClear(wsSelect, "SEIJI_KIFU_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "SEIJI_KIFU_BIKOU", , True)
    Call RangeClear(wsSelect, "KIFU_SKEI_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "KIFU_SKEI_BIKOU", , True)
    Call RangeClear(wsSelect, "ATUSEN_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "ATUSEN_BIKOU", , True)
    Call RangeClear(wsSelect, "TOKUMEI_KIFU_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "TOKUMEI_KIFU_BIKOU", , True)
    Call RangeClear(wsSelect, "KIFU_GKEI_GK")
    Call XMLtoRange(wsSelect, nodeSheet, "KIFU_GKEI_BIKOU", , True)

    XMLtoWS_0702 = 0

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0703
' 機　能 ： XMLデータを「7号様式 その3」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0703(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その3")
    
    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0703 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_03/SHEET")

    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0703 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 6
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "GIGYOU_SYURUI"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "BIKOU"
    strTagName(4) = "KAIKEI_YOUSIKI_NO"
    strTagName(5) = "KAIKEI_DT"
    strTagName(6) = "KAIKEI_HEADLINE_NO"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0703 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0703 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0704
' 機　能 ： XMLデータを「7号様式 その4」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0704(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その4")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0704 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_04/SHEET")

    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0704 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 4
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "KARIIRESAKI"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "BIKOU"
    strTagName(4) = "KAIKEI_DT"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0704 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0704 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0705
' 機　能 ： XMLデータを「7号様式 その5」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0705(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その5")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0705 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_05/SHEET")

    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0705 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 5
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "HONSIBU_NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "JIMU_ADR"
    strTagName(5) = "BIKOU"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0705 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0705 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0706
' 機　能 ： XMLデータを「7号様式 その6」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0706(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その6")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0706 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_06/SHEET")

    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0706 = -1
        Exit Function
    End If

    'MIMAN_GK
    Call XMLtoRange(wsSelect, nodeSheet, "MIMAN_GK")
    
    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    
    'データ有りか？
    If lngIndex = 0 Then
        'ROWがない場合もありうるためエラー扱いにしない
        '戻り値(0)を設定し処理をぬける
        XMLtoWS_0706 = 0
        Exit Function
    End If

    intColNum = 5
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "TEKIYOU"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "BIKOU"
    strTagName(4) = "KAIKEI_SEQ_NO"         '会計帳簿からの連携時のみ出力されるタグ：会計帳簿の通し番号
    strTagName(5) = "KAIKEI_DT"             '会計帳簿からの連携時のみ出力されるタグ：会計帳簿の年月日

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0706 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0706 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0707
' 機　能 ： XMLデータを「7号様式 その7」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その7の1～3何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0707(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その7" & "(" & CStr(intKubun) & ")")


    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

'    ''''注意！「寄附金（税額）控除」クリアのため 「ZEIGAKUKOUJYO」 指定
'    Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, wsSelect.Range("ZEIGAKUKOUJYO").Column) 'セル色クリア 内容クリア
'    '2008/08/04 FIX 小計以外の行がロックのまま
'    Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, wsSelect.Range("ZEIGAKUKOUJYO").Column) 'ロッククリア
'    Call DefaultValueSet(wsSelect, lngFirstRow, lngLastRow, wsSelect.Range("ROWKBN").Column, "FALSE") 'ROWKBNをFALSEにセット
'    Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
'    Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0707 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_07/KUBUN" & CStr(intKubun) & "/SHEET")
    
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0707 = -1
        Exit Function
    End If
    
    'SONOTA_GK
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_GK")
    
    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    
    'データ有りか？
    lngIndex = nodelistRow.length
    If lngIndex = 0 Then
        'ROWがない場合もありうるためエラー扱いにしない
        '戻り値(0)を設定し処理をぬける
        XMLtoWS_0707 = 0
        Exit Function
    End If

    intColNum = 9
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "KIFUSYA_NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "ADR"
    strTagName(5) = "SYOKUGYO"
    strTagName(6) = "BIKOU"
    strTagName(7) = "SEQ_NO"
    strTagName(8) = "ZEIGAKUKOUJYO"
    strTagName(9) = "ROWKBN"

'Mod mnaohiro 2010.02.10_START
'Mod     Call XMLtoDetailCommonSYUUSHI07_0708(wsSelect, nodelistRow, strTagName, _
'Mod                                             lngFirstRow, lngLastRow, intLeftCol, intRightCol)
    'XMLデータを画面に設定
    Call XMLtoDetailCommonSyoukei(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END

    XMLtoWS_0707 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0707 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0708
' 機　能 ： XMLデータを「7号様式 その8」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その8の1～3何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0708(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
'    Dim strNode As String
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その8" & "(" & CStr(intKubun) & ")")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

'    Call AllCellClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol) 'セル色クリア 内容クリア '2008/08/04 FIX 右端XMLまで削除
'    '2008/08/04 FIX 小計以外の行がロックのまま
'    Call AllCellLockClear(wsSelect, lngFirstRow, lngLastRow, intLeftCol, intRightCol - 1) 'セルロッククリア
'    Call RangeClear(wsSelect, "SONOTA_GK") 'SONOTA_GK セル色クリア 内容クリア
'    Call RangeClear(wsSelect, "KINGAKU_GK") 'KINGAKU_GKクリア

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0708 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_08/KUBUN" & CStr(intKubun) & "/SHEET")

    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0708 = -1
        Exit Function
    End If

    'SONOTA_GK
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_GK")

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    
    'データ有りか？
    lngIndex = nodelistRow.length
    If lngIndex = 0 Then
        'ROWがない場合もありうるためエラー扱いにしない
        '戻り値(0)を設定し処理をぬける
        XMLtoWS_0708 = 0
        Exit Function
    End If

    intColNum = 9
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "KIKAN"
    strTagName(5) = "ADR"
    strTagName(6) = "SYOKUGYO"
    strTagName(7) = "BIKOU"
    strTagName(8) = "SEQ_NO"
    strTagName(9) = "ROWKBN"

'Mod mnaohiro 2010.02.10_START
'Mod     Call XMLtoDetailCommonSYUUSHI07_0708(wsSelect, nodelistRow, strTagName, _
'Mod                                             lngFirstRow, lngLastRow, intLeftCol, intRightCol)
    'XMLデータを画面に設定
    Call XMLtoDetailCommonSyoukei(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END

    XMLtoWS_0708 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0708 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0709
' 機　能 ： XMLデータを「7号様式 その9」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0709(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その9")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0709 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_09/SHEET")
    
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0709 = -1
        Exit Function
    End If
    
    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck
    
    'カラム数
    intColNum = 4
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "BASYO"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "BIKOU"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0709 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0709 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0710
' 機　能 ： XMLデータを「7号様式 その10」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0710(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    
    Set wsSelect = Worksheets("その10")

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0710 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_10/SHEET")
    
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0710 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 6
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "PATYI_NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "SHIHARAI_SU"
    strTagName(4) = "KAISAI_DT"
    strTagName(5) = "KAISAI_BASYO"
    strTagName(6) = "BIKOU"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0710 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0710 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0711
' 機　能 ： XMLデータを「7号様式 その11」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その11の1～3何れかを指定する
'        ： mapSortNo     … ソート用オブジェクト
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0711(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                mapSortNo As EasyHashMap, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim lngSheetTag     As Long
    Dim strsname        As String
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim strSortNo       As String
    Dim nodelistSheet   As MSXML2.IXMLDOMNodeList   'SHEETタグの配列
    Dim intColNum       As Integer
    Dim strTagName()    As String

    strsname = "その11" & "(" & CStr(intKubun) & ")"

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        Call SheetSetup(strsname, intKubun, 1) 'シート数1のみに調整
        XMLtoWS_0711 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodelistSheet = nodeBook.selectNodes("SYUUSHI07_11/KUBUN" & CStr(intKubun) & "/SHEET")
    lngIndex = nodelistSheet.length

    'データ数チェックSub
    GoSub DataCheck
    '<SHEET>数
    lngSheetTag = lngIndex
    
    'シート数調整
    Call SheetSetup(strsname, intKubun, lngSheetTag)

    intColNum = 8
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "ADR"
    strTagName(5) = "SYOKUGYO"
    strTagName(6) = "BIKOU"
    strTagName(7) = "SEQ_NO"
    strTagName(8) = "ROWKBN"

    'XMLよりTagを指定して読み込みを行う
    For lngI = 0 To lngIndex - 1

        Set wsSelect = Worksheets(strsname & "(" & CStr(lngI + 1) & ")")
        intLeftCol = wsSelect.Range("左端").column
        intRightCol = wsSelect.Range("右端").column
        lngFirstRow = wsSelect.Range("行頭").Row
        lngLastRow = wsSelect.Range("行末").Row

        'パーティー名称
        Call XMLtoRange(wsSelect, nodelistSheet.Item(lngI), "PATYI_NM")
        
        'ソート番号　（ソート番号の保持＆シートに設定）
        strSortNo = XML_GetData(nodelistSheet.Item(lngI), "SORT_NO")
        If IsEmptyString(strSortNo) = False Then
            
            'パーティーの数を数えてパーティー順に並べるかどうかを判断するため、マップにソート番号を重複無しで格納する
            If mapSortNo.ExistsKey(strSortNo) = False Then
                mapSortNo.AddItem strSortNo, ""     'キーのみ格納すれば良いため、値は空文字
            End If
            
            wsSelect.Range("SORT_NO").value = strSortNo
        End If

        'ROWのNodeListを取得
        Set nodelistRow = nodelistSheet(lngI).selectNodes("ROW")

        'データ数の取得
        lngIndex = nodelistRow.length
        
        'データ有りか？
        If lngIndex = 0 Then
            'ROWがない場合もありうるためエラー扱いにしない
            '戻り値(0)を設定しROW処理を行わない
            XMLtoWS_0711 = 0
        Else
'Mod mnaohiro 2010.02.10_START
'Mod             Call XMLtoDetailCommonSYUUSHI07_1112(wsSelect, nodelistRow, strTagName, _
'Mod                                                 lngFirstRow, lngLastRow, intLeftCol, intRightCol)
            'XMLデータを画面に設定
            Call XMLtoDetailCommonSyoukei(wsSelect, nodelistRow, strTagName, _
                                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END

        End If

        Set wsSelect = Nothing

    Next lngI

    XMLtoWS_0711 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0711 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0712
' 機　能 ： XMLデータを「7号様式 その12」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その12の1～3何れかを指定する
'        ： mapSortNo     … ソート用オブジェクト
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0712(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                mapSortNo As EasyHashMap, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim lngSheetTag     As Long
    Dim strSKNo         As String
    Dim strsname        As String
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim strSortNo       As String
    Dim nodelistSheet   As MSXML2.IXMLDOMNodeList   'SHEETタグの配列
    Dim intColNum       As Integer
    Dim strTagName()    As String

    strsname = "その12" & "(" & CStr(intKubun) & ")"

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        Call SheetSetup(strsname, intKubun, 1) 'シート数1のみに調整
        XMLtoWS_0712 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodelistSheet = nodeBook.selectNodes("SYUUSHI07_12/KUBUN" & CStr(intKubun) & "/SHEET")
    lngIndex = nodelistSheet.length

    'データ数チェックSub
    GoSub DataCheck
    '<SHEET>数
    lngSheetTag = lngIndex
    
    'シート数調整
    Call SheetSetup(strsname, intKubun, lngSheetTag)

    intColNum = 9
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "NM"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "KIKAN"
    strTagName(5) = "ADR"
    strTagName(6) = "SYOKUGYO"
    strTagName(7) = "BIKOU"
    strTagName(8) = "SEQ_NO"
    strTagName(9) = "ROWKBN"

    'XMLよりTagを指定して読み込みを行う
    For lngI = 0 To lngIndex - 1

        Set wsSelect = Worksheets(strsname & "(" & CStr(lngI + 1) & ")")
        intLeftCol = wsSelect.Range("左端").column
        intRightCol = wsSelect.Range("右端").column
        lngFirstRow = wsSelect.Range("行頭").Row
        lngLastRow = wsSelect.Range("行末").Row

        'PATYI_NM
        Call XMLtoRange(wsSelect, nodelistSheet.Item(lngI), "PATYI_NM")

        'ソート番号　（ソート番号の保持＆シートに設定）
        strSortNo = XML_GetData(nodelistSheet.Item(lngI), "SORT_NO")
        If IsEmptyString(strSortNo) = False Then
            
            'パーティーの数を数えてパーティー順に並べるかどうかを判断するため、マップにソート番号を重複無しで格納する
            If mapSortNo.ExistsKey(strSortNo) = False Then
                mapSortNo.AddItem strSortNo, ""     'キーのみ格納すれば良いため、値は空文字
            End If
            
            wsSelect.Range("SORT_NO").value = strSortNo
        End If

        'ROWのNodeListを取得
        Set nodelistRow = nodelistSheet(lngI).selectNodes("ROW")

        'データ数の取得
        lngIndex = nodelistRow.length
        
        'データ有りか？
        If lngIndex = 0 Then
            'ROWがない場合もありうるためエラー扱いにしない
            '戻り値(0)を設定しROW処理を行わない
            XMLtoWS_0712 = 0
        Else
'Mod mnaohiro 2010.02.10_START
'Mod             Call XMLtoDetailCommonSYUUSHI07_1112(wsSelect, nodelistRow, strTagName, _
'Mod                                     lngFirstRow, lngLastRow, intLeftCol, intRightCol)
            'XMLデータを画面に設定
            Call XMLtoDetailCommonSyoukei(wsSelect, nodelistRow, strTagName, _
                                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END
        End If

        Set wsSelect = Nothing

    Next lngI

    XMLtoWS_0712 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0712 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0713
' 機　能 ： XMLデータを「7号様式 その13」に設定する
' 引　数 ： nodeBook      … XMLノード
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0713(nodeBook As MSXML2.IXMLDOMNode) As Integer

    Dim wsSelect    As Worksheet
    Dim nodeSheet   As MSXML2.IXMLDOMNode       'SHEETタグ
    
    Set wsSelect = Worksheets("その13")

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_13/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0713 = -1
        Exit Function
    End If

    'XMLTagデータの取得処理（XML_GetData）を行う
    Call XMLtoRange(wsSelect, nodeSheet, "JINKENHI_GK", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KOUNETU_GK", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "BIHIN_GK", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "JIMUSYO_GK", , True)

    Call RangeClear(wsSelect, "KEIHI_SKEI_GK")
    Call RangeClear(wsSelect, "SOSIKI_GK")
    Call RangeClear(wsSelect, "SENKYO_GK")
    Call RangeClear(wsSelect, "SONOTA_JIGYO_GK")
    Call RangeClear(wsSelect, "HAKKOU_JIGYO_GK")
    Call RangeClear(wsSelect, "SENDEN_GK")
    Call RangeClear(wsSelect, "KAISAI_GK")
    Call RangeClear(wsSelect, "SONOTA_GK")
    Call RangeClear(wsSelect, "CYOUSA_GK")
    Call RangeClear(wsSelect, "KIFU_GK")
    Call RangeClear(wsSelect, "SONOTA_KEIHI_GK")
    Call RangeClear(wsSelect, "KATUDOU_SKEI_GK")
    Call RangeClear(wsSelect, "GKEI_GK")

    '全国団体用の場合のみ、「本部又は支部に対して供与した交付金に係る支出」列のデータの取込を行う
    If DantaiKubun = 0 Then
        Call XMLtoRange(wsSelect, nodeSheet, "JINKENHI_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "KOUNETU_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "BIHIN_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "JIMUSYO_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "KEIHI_SKEI_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SOSIKI_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SENKYO_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_JIGYO_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "HAKKOU_JIGYO_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SENDEN_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "KAISAI_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "CYOUSA_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "KIFU_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_KEIHI_KOUFU", , True)
        Call XMLtoRange(wsSelect, nodeSheet, "KATUDOU_SKEI_KOUFU", , True)
    End If

    Call XMLtoRange(wsSelect, nodeSheet, "JINKENHI_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KOUNETU_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "BIHIN_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "JIMUSYO_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KEIHI_SKEI_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SOSIKI_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SENKYO_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_JIGYO_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "HAKKOU_JIGYO_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SENDEN_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KAISAI_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "CYOUSA_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KIFU_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_KEIHI_BIKOU", , True)
    Call XMLtoRange(wsSelect, nodeSheet, "KATUDOU_SKEI_BIKOU", , True)

    XMLtoWS_0713 = 0

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0714
' 機　能 ： XMLデータを「7号様式 その14」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その14の1～3何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0714(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim wsSelect        As Worksheet
    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim lngSheetTag     As Long
    Dim strSKNo         As String
    Dim strsname        As String
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim rngDelete       As Range
    Dim intDeleteCol    As Integer
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String

    strsname = "その14" & "(" & CStr(intKubun) & ")"
    Set wsSelect = Worksheets(strsname)

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0714 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_14/KUBUN" & CStr(intKubun) & "/SHEET")
    
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0714 = -1
        Exit Function
    End If
    
    intColNum = 11
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "MOKUTEKI"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "NM"
    strTagName(5) = "ADR"
    strTagName(6) = "BIKOU"
    strTagName(7) = "RYOUSYU"
    strTagName(8) = "KOUFUKIN"
    strTagName(9) = "KAIKEI_HEADLINE_NO"    '会計帳簿からの連携時のみ出力されるタグ：会計帳簿の見出し行番号
    strTagName(10) = "KAIKEI_SEQ_NO"         '会計帳簿からの連携時のみ出力されるタグ：会計帳簿の通し番号
    strTagName(11) = "KAIKEI_JIJYOU"        '会計帳簿からの連携時のみ出力されるタグ：領収書を徴し難かった事情

    Set wsSelect = Worksheets(strsname)
    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'SONOTA_GK
    Call XMLtoRange(wsSelect, nodeSheet, "SONOTA_GK")

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    
    'データ有りか？
    If lngIndex = 0 Then
        'ROWがない場合もありうるためエラー扱いにしない
        '戻り値(0)を設定しROW処理を行わない
        XMLtoWS_0714 = 0
    Else
        'XMLデータを画面に設定
        Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                        lngFirstRow, lngLastRow, intLeftCol, intRightCol)
    End If

    XMLtoWS_0714 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0714 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0715
' 機　能 ： XMLデータを「7号様式 その15」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その15の1～9何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0715(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim lngSheetTag     As Long
    Dim strSKNo         As String
    Dim strsname        As String
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim nodelistSheet   As MSXML2.IXMLDOMNodeList   'SHEETタグの配列
    Dim intColNum       As Integer
    Dim strTagName()    As String

    strsname = "その15" & "(" & CStr(intKubun) & ")"

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        Call SheetSetup(strsname, intKubun, 1) 'シート数1のみに調整
        XMLtoWS_0715 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodelistSheet = nodeBook.selectNodes("SYUUSHI07_15/KUBUN" & CStr(intKubun) & "/SHEET")
    lngIndex = nodelistSheet.length

    'データ数チェックSub
    GoSub DataCheck
    '<SHEET>数
    lngSheetTag = lngIndex

    'シート数調整
    Call SheetSetup(strsname, intKubun, lngSheetTag)

    intColNum = 10
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "MOKUTEKI"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "NM"
    strTagName(5) = "ADR"
    strTagName(6) = "BIKOU"
    strTagName(7) = "RYOUSYU"
    strTagName(8) = "KOUFUKIN"
    strTagName(9) = "KAIKEI_SEQ_NO"     '会計帳簿からの連携時のみ出力されるタグ：会計帳簿の通し番号
    strTagName(10) = "KAIKEI_JIJYOU"     '会計帳簿からの連携時のみ出力されるタグ：領収書を徴し難かった事情

    'XMLよりTagを指定して読み込みを行う
    For lngI = 0 To lngIndex - 1

        Set wsSelect = Worksheets(strsname & "(" & CStr(lngI + 1) & ")")
        intLeftCol = wsSelect.Range("左端").column
        intRightCol = wsSelect.Range("右端").column
        lngFirstRow = wsSelect.Range("行頭").Row
        lngLastRow = wsSelect.Range("行末").Row

        'HIMOKU
        Call XMLtoRange(wsSelect, nodelistSheet.Item(lngI), "HIMOKU")

        'SONOTA_GK
        Call XMLtoRange(wsSelect, nodelistSheet.Item(lngI), "SONOTA_GK")

        'ROWのNodeListを取得
        Set nodelistRow = nodelistSheet(lngI).selectNodes("ROW")

        'データ数の取得
        lngIndex = nodelistRow.length

        'データ有りか？
        If lngIndex = 0 Then
            'ROWがない場合もありうるためエラー扱いにしない
            '戻り値(0)を設定しROW処理を行わない
            XMLtoWS_0715 = 0
        Else
'Mod mnaohiro 2010.02.10_START
'Mod             Call XMLtoDetailCommonNodeListSYUUSHI07_15(wsSelect, nodelistRow, strTagName, _
'Mod                                     lngFirstRow, lngLastRow, intLeftCol, intRightCol)
            'XMLデータを画面に設定
            Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END
        End If

        Set wsSelect = Nothing

    Next lngI

    XMLtoWS_0715 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0715 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0716
' 機　能 ： XMLデータを「7号様式 その16」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0716(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String
    Dim intKaikeiShisyutuKmkNoCol As Integer

    Set wsSelect = Worksheets("その16")
    
    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0716 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_16/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0716 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 7
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "SHISYUTU_KMK"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "HONSIBU_NM"
    strTagName(5) = "JIMU_ADR"
    strTagName(6) = "BIKOU"
    strTagName(7) = "KAIKEI_SHISYUTU_KMK_NO"    '会計帳簿からの連携時のみ出力されるタグ：支出項目の番号

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0716 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0716 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0717
' 機　能 ： XMLデータを「7号様式 その17」に設定する
' 引　数 ： nodeBook      … XMLノード
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0717(nodeBook As MSXML2.IXMLDOMNode) As Integer

    Dim wsSelect    As Worksheet
    Dim nodeSheet   As MSXML2.IXMLDOMNode       'SHEETタグ
    
    Set wsSelect = Worksheets("その17")

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_17/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0717 = -1
        Exit Function
    End If

    'XMLTagデータの取得処理（XML_GetData）を行う
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "TOCHI_UMU", 1)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "TATEMONO_UMU", 2)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SYAKUCHI_UMU", 3)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "DOUSAN_UMU", 4)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "YOKIN_UMU", 5)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SINTAKU_UMU", 6)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SYOUKEN_UMU", 7)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SYUSSI_UMU", 8)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "KASITUKE_UMU", 9)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SIKIKIN_UMU", 10)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "SISETURIYOU_UMU", 11)
    Call XMLtoRangeCHK17(wsSelect, nodeSheet, "KARIIRE_UMU", 12)

    Call XMLtoRange(wsSelect, nodeSheet, "TOCHI_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "TATEMONO_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SYAKUCHI_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "DOUSAN_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "YOKIN_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SINTAKU_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SYOUKEN_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SYUSSI_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "KASITUKE_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SIKIKIN_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "SISETURIYOU_BIKOU")
    Call XMLtoRange(wsSelect, nodeSheet, "KARIIRE_BIKOU")

    XMLtoWS_0717 = 0

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0718
' 機　能 ： XMLデータを「7号様式 その18」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その18の1～12何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0718(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String

    Set wsSelect = Worksheets("その18" & "(" & CStr(intKubun) & ")")
    
    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
    Call SheetClear(wsSelect)

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_0718 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_18/KUBUN" & CStr(intKubun) & "/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0718 = -1
        Exit Function
    End If

    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length

    'データ数チェックSub
    GoSub DataCheck

    intColNum = 4
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "TEKIYOU"
    strTagName(2) = "KINGAKU"
    strTagName(3) = "DT"
    strTagName(4) = "BIKOU"

    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)

    XMLtoWS_0718 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0718 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0719
' 機　能 ： XMLデータを「7号様式 その19」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： intKubun      … その19の1～3何れかを指定する
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0719(nodeBook As MSXML2.IXMLDOMNode, _
                                intKubun As Integer, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim lngSheetTag     As Long
    Dim strSKNo         As String
    Dim strsname        As String
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim nodelistSheet   As MSXML2.IXMLDOMNodeList   'SHEETタグの配列
    Dim intColNum       As Integer
    Dim strTagName()    As String

    strsname = "その19" & "(" & CStr(intKubun) & ")"

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        Call SheetSetup(strsname, intKubun, 1) 'シート数1のみに調整
        XMLtoWS_0719 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodelistSheet = nodeBook.selectNodes("SYUUSHI07_19/SHEET")
    lngIndex = nodelistSheet.length

    'データ数チェックSub
    GoSub DataCheck
    '<SHEET>数
    lngSheetTag = lngIndex
    
    'シート数調整
    Call SheetSetup("その19", intKubun, lngSheetTag)

    intColNum = 6
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "TEKIYOU"
    strTagName(2) = "YOUTO"
    strTagName(3) = "SIYOU_KANKEI"
    strTagName(4) = "SIYOU_YOUTO"
    strTagName(5) = "SIYOU_MENSEKI"
    strTagName(6) = "SIYOU_KAKAKU"

    'XMLよりTagを指定して読み込みを行う
    For lngI = 0 To lngIndex - 1

        Set wsSelect = Worksheets("その19" & "(" & CStr(lngI + 1) & ")")
        intLeftCol = wsSelect.Range("左端").column
        intRightCol = wsSelect.Range("右端").column
        lngFirstRow = wsSelect.Range("行頭").Row
        lngLastRow = wsSelect.Range("行末").Row


        '項目別区分  (対象チェックボックスを設定する)
        Select Case GetNodeText(nodelistSheet(lngI), "KUBUN")
        Case "1"
            wsSelect.Range("KBN_1").value = True
        Case "2"
            wsSelect.Range("KBN_2").value = True
        Case "3"
            wsSelect.Range("KBN_3").value = True
        End Select

        
        'ROWのNodeListを取得
        Set nodelistRow = nodelistSheet(lngI).selectNodes("ROW")

        'データ数の取得
        lngIndex = nodelistRow.length

        'データ有りか？
        If lngIndex = 0 Then
            'ROWがない場合もありうるためエラー扱いにしない
            '戻り値(0)を設定しROW処理を行わない
            XMLtoWS_0719 = 0
        Else
'Mod mnaohiro 2010.02.10_START
'Mod             Call XMLtoDetailCommonNodeSYUUSHI07_19(wsSelect, nodelistRow, strTagName, _
'Mod                                             lngFirstRow, lngLastRow, intLeftCol, intRightCol)
            'XMLデータを画面に設定
            Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                            lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'Mod mnaohiro 2010.02.10_END
        End If

        Set wsSelect = Nothing

    Next lngI

    XMLtoWS_0719 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0719 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0720
' 機　能 ： XMLデータを「7号様式 その20」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0720(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim strKUBUN    As String
    Dim wsSelect    As Worksheet
    Dim nodeSheet   As MSXML2.IXMLDOMNode       'SHEETタグ
    
    Set wsSelect = Worksheets("その20")

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI07_20/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_0720 = -1
        Exit Function
    End If

    'クリア処理
    Call RangeClear(wsSelect, "RYOUSYU_UMU")
    Call RangeClear(wsSelect, "KANSA_IKEN_UMU")
    Call RangeClear(wsSelect, "KANSA_HOUKOKU_UMU")
    Call RangeClear(wsSelect, "SENSEI_DT")
    Call RangeClear(wsSelect, "DANTAI_NM")
    Call RangeClear(wsSelect, "KAI_NM1")
    Call RangeClear(wsSelect, "KAI_NM2")
    Call RangeClear(wsSelect, "DAI_NM1")
    Call RangeClear(wsSelect, "DAI_NM2")

    'XMLTagデータの取得処理（XML_GetData）を行う
    '領収書の写し
    strKUBUN = GetNodeText(nodeSheet, "RYOUSYU_UMU")

    Select Case CInt(strKUBUN)
        Case 0
            wsSelect.Range("RYOUSYU_UMU").value = False
        Case 1
            wsSelect.Range("RYOUSYU_UMU").value = True
        Case Else
    End Select

    '監査意見書
    strKUBUN = GetNodeText(nodeSheet, "KANSA_IKEN_UMU")

    Select Case CInt(strKUBUN)
        Case 0
            wsSelect.Range("KANSA_IKEN_UMU").value = False
        Case 1
            wsSelect.Range("KANSA_IKEN_UMU").value = True
        Case Else
    End Select

    '政治資金監査報告書
    strKUBUN = GetNodeText(nodeSheet, "KANSA_HOUKOKU_UMU")

    Select Case CInt(strKUBUN)
        Case 0
            wsSelect.Range("KANSA_HOUKOKU_UMU").value = False
        Case 1
            wsSelect.Range("KANSA_HOUKOKU_UMU").value = True
        Case Else
    End Select

    Call XMLtoRange(wsSelect, nodeSheet, "SENSEI_DT")

    Call XMLtoRange(wsSelect, nodeSheet, "DANTAI_NM")

    Call XMLtoRange(wsSelect, nodeSheet, "KAI_NM1")

    Call XMLtoRange(wsSelect, nodeSheet, "KAI_NM2")

    Call XMLtoRange(wsSelect, nodeSheet, "DAI_NM1")

    Call XMLtoRange(wsSelect, nodeSheet, "DAI_NM2")


    XMLtoWS_0720 = 0

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_08
' 機　能 ： XMLデータを「8号様式」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_08(nodeBook As MSXML2.IXMLDOMNode, _
                            Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim wsSelect        As Worksheet
    Dim intLeftCol      As Integer
    Dim intRightCol     As Integer
    Dim lngFirstRow     As Long
    Dim lngLastRow      As Long
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ
    Dim nodelistRow     As MSXML2.IXMLDOMNodeList
    Dim intColNum       As Integer
    Dim strTagName()    As String

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    Set wsSelect = Worksheets("8号様式")
    Set wsSelect = Worksheets("15号様式")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

    intLeftCol = wsSelect.Range("左端").column
    intRightCol = wsSelect.Range("右端").column
    lngFirstRow = wsSelect.Range("行頭").Row
    lngLastRow = wsSelect.Range("行末").Row

    'シート全体のセルのクリア
'@@01MOD START
'    Call SheetClear(wsSelect)
'@@01MOD END

    'セルのクリアのみ行う
    If boolClearOnly = True Then
        XMLtoWS_08 = 0
        Exit Function
    End If

    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI08/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_08 = -1
        Exit Function
    End If
    
    'ROWのNodeListを取得
    Set nodelistRow = nodeSheet.selectNodes("ROW")
    lngIndex = nodelistRow.length
    'データ数チェックSub
    GoSub DataCheck

    'カラム数
    intColNum = 5
    ReDim strTagName(1 To intColNum) As String

    strTagName(1) = "KOMOKU"
    strTagName(2) = "TEKIYOU"
    strTagName(3) = "KINGAKU"
    strTagName(4) = "DT"
    strTagName(5) = "JIJYOU"

'@@01MOD START
'    Call XMLtoDetailCommonNormal(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)
    Call XMLtoDetailCommonSYUUSHI08(wsSelect, nodelistRow, strTagName, _
                                    lngFirstRow, lngLastRow, intLeftCol, intRightCol)
'@@01MOD END

    XMLtoWS_08 = 0

    Exit Function

DataCheck:
    'データ有りか？
    If lngIndex = 0 Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_08 = -1
        Exit Function
    End If

    Return

End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_0802
' 機　能 ： XMLデータを「8号様式の2」に設定する
' 引　数 ： nodeBook      … XMLノード
'        ： boolClearOnly … クリアのみフラグ
'        ：                  （True=値のクリア処理のみを行う、False=通常処理を行う）
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_0802(nodeBook As MSXML2.IXMLDOMNode, _
                                Optional boolClearOnly As Boolean = False) As Integer

    Dim lngIndex        As Long
    Dim lngI            As Long
    Dim intJ            As Integer
    Dim strKUBUN        As String
    Dim str項目()       As String
    Dim str適用()       As String
    Dim LoopMax         As Integer
    Dim meisai_low      As Long
    Dim inst_low        As Long
    Dim wsSelect        As Worksheet
    Dim nodelistSheet   As MSXML2.IXMLDOMNodeList   'SHEETタグの配列

'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 START
'    Set wsSelect = Worksheets("8号様式の2")
    Set wsSelect = Worksheets("16号様式")
'EDIT 2014/12/19 Fujitsu)Ito H27政治資金 END

'    With wsSelect
'        .Activate
'
'        '既存のデータをクリア
'        'G列に行番号が設定されている行を削除する
'        meisai_low = 16
'        Do Until .Cells(meisai_low, 7).value = ""
'            meisai_low = meisai_low + 1
'        Loop
'        .Range(.Cells(16, 1), .Cells(meisai_low, 1)).EntireRow.Delete
'        .Cells(9, 2).value = ""
'        .Cells(9, 4).value = ""
'
'    End With

    'SHEETノードを取得する
    Set nodelistSheet = nodeBook.selectNodes("SYUUSHI08_02/SHEET")
    lngIndex = nodelistSheet.length

    'データ数チェック
    If lngIndex = 0 Then
        
        'クリアのみ行う
        Call PutSelectedDataFurikomi(wsSelect, 0, str項目, str適用)
        
        XMLtoWS_0802 = -1
        Exit Function
    End If

    ReDim str項目(1 To lngIndex) As String
    ReDim str適用(1 To lngIndex) As String

    'XMLTagデータの取得処理（XML_GetData）を行う
    For lngI = 0 To lngIndex - 1
    
        '項目
        strKUBUN = GetNodeText(nodelistSheet.Item(lngI), "KOMOKU")
        str項目(lngI + 1) = strKUBUN
    
        '摘要
        strKUBUN = GetNodeText(nodelistSheet.Item(lngI), "TEKIYOU")
        str適用(lngI + 1) = strKUBUN
        
    Next lngI
    
    ' *** 様式のページを増減し、データを設定する ***
    Call PutSelectedDataFurikomi(wsSelect, lngIndex, str項目, str適用)

' 2008/9/6 性能向上のため修正
'    With wsSelect
'        .Activate
'
'        '様式を複写しながら、データをセット
'        meisai_low = 9
'        inst_low = 16
'        For LngI = 1 To lngIndex
'
'            .Cells(meisai_low, 2).value = str項目(LngI)
'            .Cells(meisai_low, 4).value = str適用(LngI)
'
'            If lngIndex > LngI Then
'                Rows("3:15").Select
'                Application.CutCopyMode = False
'                Selection.Copy
'                Rows(inst_low).Select
'                Selection.PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
'                    False, Transpose:=False
'                inst_low = inst_low + 13
'            End If
'            meisai_low = meisai_low + 13
'        Next LngI
'
'    End With
'
'    ActiveSheet.PageSetup.PrintArea = "$B$3:$F$" & inst_low - 1
    
    Application.CutCopyMode = False

    XMLtoWS_0802 = 0


End Function

'----------------------------------------------------------------
' 関数名 ： XMLtoWS_KIFU
' 機　能 ： XMLデータを「寄附金（税額）控除」に設定する
' 引　数 ： nodeBook      … XMLノード
' 戻り値 ： 正常=0、異常=-1
'----------------------------------------------------------------
Public Function XMLtoWS_KIFU(nodeBook As MSXML2.IXMLDOMNode) As Integer

    Dim wsSelect        As Worksheet
    Dim strSENKYO_INP   As String
    Dim strKUBUN        As String
    Dim nodeSheet       As MSXML2.IXMLDOMNode       'SHEETタグ

    Set wsSelect = Worksheets("寄附金")
    
    'SHEETノードを取得する
    Set nodeSheet = nodeBook.selectSingleNode("SYUUSHI_KIFUKOUJYO/SHEET")
    
    'データ有りか？
    If nodeSheet Is Nothing Then
        '戻り値(-1)を設定し処理をぬける
        XMLtoWS_KIFU = -1
        Exit Function
    End If

    'クリア処理
    Call RangeClear(wsSelect, "_CHK1")
    Call RangeClear(wsSelect, "_CHK2")
    Call RangeClear(wsSelect, "GIIN_NM")
    Call RangeClear(wsSelect, "NM")
    Call RangeClear(wsSelect, "SENKYO_INP")
    Call RangeClear(wsSelect, "DT")

    'デフォルトコメントを復活
    Call UnlockOneSheet(wsSelect)
    If TypeName(wsSelect.Range("GIIN_NM").Comment) = "Nothing" Then
        'コメントが存在なければ追加
        wsSelect.Range("GIIN_NM").AddComment (MESSAGE_I001)
        wsSelect.Range("GIIN_NM").Comment.Visible = False
        wsSelect.Range("GIIN_NM").Comment.Shape.Width = 150
        wsSelect.Range("GIIN_NM").Comment.Shape.Height = 63
        wsSelect.Range("GIIN_NM").Comment.Shape.TextFrame.Characters.Font.Size = 12
    End If
    If TypeName(wsSelect.Range("NM").Comment) = "Nothing" Then
        'コメントが存在なければ追加
        wsSelect.Range("NM").AddComment (MESSAGE_I002)
        wsSelect.Range("NM").Comment.Visible = False
        wsSelect.Range("NM").Comment.Shape.Width = 150
        wsSelect.Range("NM").Comment.Shape.Height = 63
        wsSelect.Range("NM").Comment.Shape.TextFrame.Characters.Font.Size = 12
    End If
    Call LockOneSheet(wsSelect)
    
    'XMLTagデータの取得処理（XML_GetData）を行う
    strKUBUN = GetNodeText(nodeSheet, "KUBUN")

    Select Case CInt(strKUBUN)
    Case 0
        wsSelect.Range("_CHK1").value = False
        wsSelect.Range("_CHK2").value = False

    Case 1
        wsSelect.Range("_CHK1").value = True
        wsSelect.Range("_CHK2").value = False

    Case 2
        wsSelect.Range("_CHK1").value = False
        wsSelect.Range("_CHK2").value = True

    Case Else
    
    End Select

    Call XMLtoRange(wsSelect, nodeSheet, "ZEI411713", "GIIN_NM")

    Call XMLtoRange(wsSelect, nodeSheet, "ZEI411714/NM", "NM")

    strSENKYO_INP = GetNodeText(nodeSheet, "ZEI411714/SENKYO")

    If strSENKYO_INP = "" Then
        wsSelect.Range("SENKYO_INP").value = ""
    Else
        strSENKYO_INP = Left(strSENKYO_INP, Len(strSENKYO_INP) - 2) '最後の「選挙」分を引く
        wsSelect.Range("SENKYO_INP").value = strSENKYO_INP
    End If

    Call XMLtoRange(wsSelect, nodeSheet, "ZEI411714/DT", "DT")

    XMLtoWS_KIFU = 0

End Function

-------------------------------------------------------------------------------
VBA MACRO History.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/History'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
'@@01MOD 福力基　8号様式の出力形式を変更（１ページ毎にヘッダー、フッターを出力）
-------------------------------------------------------------------------------
VBA MACRO ModuleExcel2007.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleExcel2007'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Sub TextBox22_Click()
    Dim range1 As Range

    Range("U5").Activate
End Sub

Sub TextBox23_Click()
    Dim range1 As Range

    Range("T6").Activate
End Sub

-------------------------------------------------------------------------------
VBA MACRO Sheet56.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet56'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : Sheet47(領収書管理)
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2014 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'領収書管理シート
Public FirstActiveFlg As Boolean                  '初回起動フラグ。領収書管理シートを表示した際に最初の1回だけ画像ファイル保存先フォルダの空白チェックと値代入を行う為のフラグ

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Worksheet_Activate
' 機  能 ： ワークシートを表示した場合の処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Worksheet_Activate()
On Error GoTo Error_Worksheet_Activate
    
    Const ACTION_NAME As String = "領収書取込"
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim strTemplateFolderPath As String
    '初期化
    Set objSheet = Nothing
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    
    If objSheet.Range("FOLDER_PATH").value = "" And FirstActiveFlg = False Then
        'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
        If ThisWorkbook.pATH = "" Then
            If ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value = "" Then
                Exit Sub
            End If
            '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
            '会計帳簿から渡されたパスをこのブックのパスとする
            strTemplateFolderPath = ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value
        Else
            strTemplateFolderPath = ThisWorkbook.pATH
        End If
        '初回起動時に画像ファイル保存先フォルダが空白の場合は初期値を入れる
        objSheet.Range("FOLDER_PATH").value = UnionFilePathAndName(strTemplateFolderPath, "画像")
    End If
    '次回以降チェックしないようにフラグを変える
    FirstActiveFlg = True
    '最新の状態に更新
    Call ModuleReceipt.CreateFileList
    
    Exit Sub

Error_Worksheet_Activate:

    'イベントを無効解除
    Application.EnableEvents = True

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Worksheet_FollowHyperlink
' 機  能 ： ハイパーリンクがクリックされた場合の処理
' 引  数 ： クリックされた位置情報
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)

On Error GoTo Error_Worksheet_FollowHyperlink

    Const ACTION_NAME As String = "領収書取込"
    Dim strImageFilePath As String
    strImageFilePath = ""
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim fileCnt As Long
    strImageFilePath = ""

    'リンク元を判定
    If Target.Range.column > 2 Then
        '行番号取得（引数となるため）
        fileCnt = Target.Range.Row
        '削除処理
        If Target.Range.column = 7 Then
            '削除処理を呼び出す
            Call ModuleReceipt.Btn_Delete_Image_Click(fileCnt)
        '差替処理
        ElseIf Target.Range.column = 8 Then
            '差替処理を呼び出す
            Call ModuleReceipt.Btn_Replace_Image_Click(fileCnt)
        End If
        '処理を終了する
        Exit Sub
    End If

    '-----------------------------------------------------------
    '1.領収書管理画面(GA30801)の項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-----------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If ModuleReceipt.CheckFolderPath(ACTION_NAME) < 0 Then
        Exit Sub
    End If
    
    'イベントを無効にする
    Application.EnableEvents = False
    '画面の表示をストップ
    Application.ScreenUpdating = False
    '初期化
    Set objSheet = Nothing
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    
    '-----------------------------------------------------------
    '2.画像情報取得
    '-----------------------------------------------------------
    '画像のファイルパス
    strImageFilePath = UnionFilePathAndName(objSheet.Range("FOLDER_PATH").value, Target.TextToDisplay)
    
    '画像が存在するか
    If isFileExists(strImageFilePath) = False Then
        '画面の表示を戻す
        Application.ScreenUpdating = True
        'イベントを無効解除
        Application.EnableEvents = True
        Exit Sub
    Else
        '画像オブジェクト削除
        If VarType(Evaluate("IMAGE_VIEW")) = vbObject Then
           objSheet.Shapes("IMAGE_VIEW").Delete
        End If
        '挿入
        With objSheet.Pictures.Insert(Filename:=strImageFilePath)
            .CopyPicture    'クリップボードにコピー
            .Delete         '画像をいったん削除
            
        End With
        '画像を貼り付け****************************************************************************
        If Target.Range.Row > 25 Then
            objSheet.Paste Destination:=Range("J" & Target.Range.Row - 10)
        Else
            objSheet.Paste Destination:=Range("J15")
        End If
        '画像を貼り付け****************************************************************************
        
        '名前付け
        Selection.name = "IMAGE_VIEW"
        '画像のサイズ調整**************************************************************************
        If Selection.Width > 400 Then
            Selection.Width = 400
        End If
        '画像のサイズ調整**************************************************************************
        Target.Range.Select
        
    End If

    '画面の表示を戻す
    Application.ScreenUpdating = True
    'イベントを無効解除
    Application.EnableEvents = True
    Exit Sub
Error_Worksheet_FollowHyperlink:

    '画面の表示を戻す
    Application.ScreenUpdating = True
    'イベントを無効解除
    Application.EnableEvents = True

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END


-------------------------------------------------------------------------------
VBA MACRO ModuleReceipt.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleReceipt'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ModuleReceipt
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2015 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'領収書管理関連モジュール
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------
'　定数
'----------------------------------------
Private Const FILENAME_RECEIPT_SOFT As String = "ScanApplication.exe"   '領収書取込のEXE名
Private Const FILENAME_RECEIPT_TEXT As String = "FolderPath.txt"        '領収書取込が出力するテキストファイル名
Public Const FILE_ZIP_NAME As String = "SYUUSI_PDF.zip"                 'ファイル名
Private Const DIALOG_TITLE As String = "領収書管理"
Public Const SHEET_RECEIPT As String = "領収書管理"
Public Const SHEET_PDF As String = "MakePDF"
'領収書取込画面起動時の引数1
Public Const RECEIPT_APP_KBN_0 As Long = 0        '1-(2)光熱水費
Public Const RECEIPT_APP_KBN_1 As Long = 1        '1-(3)備品･消耗品費
Public Const RECEIPT_APP_KBN_2 As Long = 2        '1-(4)事務所費
Public Const RECEIPT_APP_KBN_3 As Long = 3        '2-(1)組織活動費
Public Const RECEIPT_APP_KBN_4 As Long = 4        '2-(2)選挙関係費
Public Const RECEIPT_APP_KBN_5 As Long = 5        '2-(3)-ｱ機関紙誌の発行事業費
Public Const RECEIPT_APP_KBN_6 As Long = 6        '2-(3)-ｲ宣伝事業費
Public Const RECEIPT_APP_KBN_7 As Long = 7        '2-(3)-ｳ政治資金パーティー開催事業費
Public Const RECEIPT_APP_KBN_8 As Long = 8        '2-(3)-ｴその他の事業費
Public Const RECEIPT_APP_KBN_9 As Long = 9        '2-(4)調査研究費
Public Const RECEIPT_APP_KBN_10 As Long = 10      '2-(5)寄附･交付金
Public Const RECEIPT_APP_KBN_11 As Long = 11      '2-(6)その他の経費
Public Const RECEIPT_APP_KBN_12 As Long = 12      '9指定なし
'シート名　その15は複数シートがありえるのでLIKEで比較
Public Const SHEET_14_1 = "その14(1)"   '項目別区分2．光熱水費画面
Public Const SHEET_14_2 = "その14(2)"   '項目別区分3．備品・消耗品費画面
Public Const SHEET_14_3 = "その14(3)"   '項目別区分4．事務所費画面
Public Const SHEET_15_1 = "その15(1)"   '項目別区分1．組織活動費画面
Public Const SHEET_15_2 = "その15(2)"   '項目別区分2．選挙関係費画面
Public Const SHEET_15_3 = "その15(3)"   '項目別区分3．機関紙誌の発行事業費画面
Public Const SHEET_15_4 = "その15(4)"   '項目別区分4．宣伝事業費画面
Public Const SHEET_15_5 = "その15(5)"   '項目別区分5．政治資金パーティー開催事業費画面
Public Const SHEET_15_6 = "その15(6)"   '項目別区分6．その他の事業費画面
Public Const SHEET_15_7 = "その15(7)"   '項目別区分7．調査研究費画面
Public Const SHEET_15_8 = "その15(8)"   '項目別区分8．寄附・交付金画面
Public Const SHEET_15_9 = "その15(9)"   '項目別区分9．その他の経費画面
'----------------------------------------
'　変数
'----------------------------------------
Public FOLDER_PATH As String                      '画像ファイル保存先フォルダの値
Public ZIP_FOLDER_PATH As String                  'ZIPファイル保存先フォルダの値
Public ImageViewOpenFlg As Boolean                '領収書画像一覧を開く際の区分(True：ボタン等を表示する。False：非表示)
Public Receipt_USE_Flg As Boolean                 '領収書機能を使っているかフラグ(True:使っている False：未使用)
'画面の区分
Public SelectChkKbn As Long     'ボタン区分（1：全てチェックをつけた状態で画面起動。0：何もしない）
Public FrmCloseKbn As Long      '終了区分（0:閉じるボタン 1：領収書管理画面へ　2：PDFのみ作成 3：XMLも作成）
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Back_Menu_Click
' 機  能 ： メニューへ戻るボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Back_Menu_Click()

On Error GoTo Error_Btn_MoveMenuSheet_Click:

    Const ACTION_NAME As String = "メニューへ戻るボタン"

    '「メニュー」シートに遷移
    Worksheets("メニュー").Activate
    
    ActiveWindow.ScrollColumn = 1

    Exit Sub

Error_Btn_MoveMenuSheet_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Open_Imagelist_Click
' 機  能 ： 領収書画像一覧ボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Open_Imagelist_Click()

On Error GoTo Error_Btn_Open_Imagelist_Click:

    Const ACTION_NAME As String = "領収書画像一覧ボタン"
    Dim objSheet As Worksheet   'Excelシートオブジェクト

    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE, False) < 0 Then
        Exit Sub
    End If

    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    FOLDER_PATH = objSheet.Range("FOLDER_PATH").value
    'ボタンやチェックボックスは非表示
    ImageViewOpenFlg = False
    '開く
    frmImageView.Show
    
    Exit Sub

Error_Btn_Open_Imagelist_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Reference_Path_Click
' 機  能 ： 参照ボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Reference_Path_Click()

On Error GoTo Error_Btn_Reference_Path_Click:

    Const ACTION_NAME As String = "参照ボタン"
    Dim objSheet As Worksheet   'Excelシートオブジェクト

    'イベントを無効にする
    Application.EnableEvents = False
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    '-------------------------------------------------------------------
    '1.フォルダを選択するダイアログボックスを表示する
    '-------------------------------------------------------------------
    With Application.FileDialog(msoFileDialogFolderPicker)
        '初期表示フォルダの設定(初期はカレントディレクトリ)
        .InitialFileName = ThisWorkbook.pATH & "\"
        'ダイアログ表示
        If .Show = -1 Then
            ' [ OK ] ボタンが押された場合
            'フォルダが取得出来た場合は、画像ファイル保存フォルダに値をセットする
            If .SelectedItems(1) <> "" Then
                objSheet.Range("FOLDER_PATH").value = .SelectedItems(1)
                '最新の状態に更新
                Call CreateFileList
            End If
        Else
            ' [ キャンセル ] ボタンが押された場合は処理を抜ける
            'イベントを無効解除
            Application.EnableEvents = True
            Exit Sub
        End If
    End With
    
    'イベントを無効解除
    Application.EnableEvents = True
    Exit Sub

Error_Btn_Reference_Path_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Open_Folder_Click
' 機  能 ： フォルダを開くボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Open_Folder_Click()

On Error GoTo Error_Btn_Open_Folder_Click:

    Const ACTION_NAME As String = "フォルダを開くボタン"
    Dim objSheet As Worksheet   'Excelシートオブジェクト

    'イベントを無効にする
    Application.EnableEvents = False
   
    '-------------------------------------------------------------------
    '1.項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-------------------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE, False) < 0 Then
        'イベントを無効解除
        Application.EnableEvents = True
        Exit Sub
    End If

    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    '-------------------------------------------------------------------
    '2.フォルダを開く
    '-------------------------------------------------------------------
    CreateObject("Shell.Application").Open objSheet.Range("FOLDER_PATH").value

    'イベントを無効解除
    Application.EnableEvents = True

    Exit Sub

Error_Btn_Open_Folder_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Insert_Image_Click
' 機  能 ： 画像を追加ボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Insert_Image_Click()

On Error GoTo Error_Btn_Insert_Image_Click:

    Const ACTION_NAME As String = "画像を追加ボタン"
    Dim selectFile As Variant
    Dim copyFileName As String
    Dim filePos As Long
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim fileDlog As FileDialog
    '初期化
    copyFileName = ""
    filePos = 0
    'イベントを無効にする
    Application.EnableEvents = False
   
    '-------------------------------------------------------------------
    '1.項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-------------------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE, False) < 0 Then
        'イベントを無効解除
        Application.EnableEvents = True
        Exit Sub
    End If

    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)

    '-------------------------------------------------------------------
    '2.ファイルを選択するダイアログボックスを表示する
    '-------------------------------------------------------------------
    Set fileDlog = Application.FileDialog(msoFileDialogOpen)
    With fileDlog
        ''ボタンのテキストを[選択]にします
        .ButtonName = "選択"
        With .Filters
            ''「ファイルの種類」をクリアします
            .Clear
            ''「ファイルの種類」を登録します
            .Add "画像ファイル", "*.jpg; *.jpeg; *.gif", 1
        End With
        ''表示するフォルダを指定します
        .InitialFileName = ThisWorkbook.pATH & "\"
        ''表示するアイコンの大きさを指定します。
        .InitialView = msoFileDialogViewLargeIcons
        If .Show = True Then
            ''有効なボタンがクリックされた
            'ファイルが取得出来た場合は、画像をコピーする
            If .SelectedItems(1) <> "" Then
                If .InitialFileName = objSheet.Range("FOLDER_PATH").value & "\" Then
                    '同じ階層からは追加できない
                    Call GetMessageBox(MESSAGE_W181, DIALOG_TITLE)
                    'イベントを無効解除
                    Set fileDlog = Nothing
                    Application.EnableEvents = True
                    Exit Sub
                End If
                For Each selectFile In .SelectedItems
                    'ファイルをコピーする
                    copyFileName = ""
                    filePos = InStrRev(selectFile, "\")
                    'フルパスからファイル名だけ抜き取る
                    copyFileName = Mid(selectFile, filePos + 1)
                    'コピー
                    FileCopy selectFile, objSheet.Range("FOLDER_PATH").value & "\" & copyFileName
                    
                Next selectFile
            Else
                '取得出来ない場合は処理を抜ける
                'イベントを無効解除
                Set fileDlog = Nothing
                Application.EnableEvents = True
                Exit Sub
            End If
        Else
            ' [ キャンセル ] ボタンが押された場合は処理を抜ける
            'イベントを無効解除
            Set fileDlog = Nothing
            Application.EnableEvents = True
            Exit Sub
        End If
    End With
    '-------------------------------------------------------------------
    '3.最新の状態に更新
    '-------------------------------------------------------------------
    Call CreateFileList
    
    'イベントを無効解除
    Set fileDlog = Nothing
    Application.EnableEvents = True

    Exit Sub

Error_Btn_Insert_Image_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Open_Folder_Click
' 機  能 ： 削除ボタン押下処理
' 引  数 ： 行番号　※15～・・・
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub Btn_Delete_Image_Click(ByVal CellNo As Long)

On Error GoTo Error_Btn_Delete_Image_Click:

    Const ACTION_NAME As String = "削除ボタン"
    Dim strImageFilePath As String
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim shellObj As Object
    Dim nameObj As Object
       
    If CellNo < 15 Then
        Exit Sub
    End If
    '-------------------------------------------------------------------
    '1.項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-------------------------------------------------------------------
    If CheckFolderPath(DIALOG_TITLE) < 0 Then
        Exit Sub
    End If

    '-------------------------------------------------------------------
    '2.ファイルを削除
    '-------------------------------------------------------------------
    '確認ダイアログ表示
    If (GetMessageBox(MESSAGE_G049, DIALOG_TITLE) = False) Then
        Exit Sub
    End If

    'イベントを無効にする
    Application.EnableEvents = False

    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    '画像のファイルパス
    strImageFilePath = UnionFilePathAndName(objSheet.Range("FOLDER_PATH").value, _
                                            objSheet.Range("B" & CellNo).value)

    '画像の存在チェック
    If isFileExists(strImageFilePath) = False Then
        MsgBox "削除に失敗しました。" & vbCrLf & _
               "最新の状態に更新ボタンを実行してください。"
        
        'イベントを無効解除
        Application.EnableEvents = True
        Exit Sub
    Else
        'ファイルをゴミ箱へ移動する
        Const ssfBITBUCKET = 10
        Set shellObj = CreateObject("Shell.Application")
        'ゴミ箱を指定
        Set nameObj = shellObj.Namespace(ssfBITBUCKET)
        'ファイルの移動でゴミ箱へ移動する(結果、削除されたようにみえる)
        nameObj.movehere (strImageFilePath)
        '初期化
        Set shellObj = Nothing
        Set nameObj = Nothing
    End If
    
    '-------------------------------------------------------------------
    '3.最新の状態に更新
    '-------------------------------------------------------------------
    Call CreateFileList
    
    'イベントを無効解除
    Application.EnableEvents = True

    Exit Sub

Error_Btn_Delete_Image_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Replace_Image_Click
' 機  能 ： 差替ボタン押下処理
' 引  数 ： 行番号　※15～・・・
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub Btn_Replace_Image_Click(ByVal CellNo As Long)

On Error GoTo Error_Btn_Replace_Image_Click:

    Const ACTION_NAME As String = "差替ボタン"
    Dim strImageFilePath As String
    Dim selectFile As Variant
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim fileDlog As FileDialog
   
    If CellNo < 15 Then
        Exit Sub
    End If
    '-------------------------------------------------------------------
    '1.項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-------------------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE) < 0 Then
        Exit Sub
    End If

    '-------------------------------------------------------------------
    '2.確認
    '-------------------------------------------------------------------
    '確認ダイアログ表示
    If (GetMessageBox(MESSAGE_G050, DIALOG_TITLE) = False) Then
        Exit Sub
    End If

    'イベントを無効にする
    Application.EnableEvents = False

    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    '画像のファイルパス
    strImageFilePath = UnionFilePathAndName(objSheet.Range("FOLDER_PATH").value, _
                                            objSheet.Range("B" & CellNo).value)
    
    '-------------------------------------------------------------------
    '3.ファイルを選択するダイアログボックスを表示する
    '-------------------------------------------------------------------
    Set fileDlog = Application.FileDialog(msoFileDialogOpen)
    With fileDlog
        ''ボタンのテキストを[選択]にします
        .ButtonName = "選択"
        .AllowMultiSelect = True
        With .Filters
            ''「ファイルの種類」をクリアします
            .Clear
            ''「ファイルの種類」を登録します
            .Add "画像ファイル", "*.jpg; *.jpeg; *.gif", 1
        End With
        ''表示するフォルダを指定します
        .InitialFileName = ThisWorkbook.pATH & "\"
        ''表示するアイコンの大きさを指定します。
        .InitialView = msoFileDialogViewLargeIcons
        If .Show = True Then
            ''有効なボタンがクリックされた
            'ファイルが取得出来た場合は、画像をコピーする
            If .SelectedItems(1) <> "" Then
                For Each selectFile In .SelectedItems
                    '同じ階層の同じファイルは差替できない
                    If objSheet.Range("FOLDER_PATH").value & "\" & objSheet.Range("B" & CellNo).value = selectFile Then
                        '同じ階層からは追加できない
                        Call GetMessageBox(MESSAGE_W182, DIALOG_TITLE)
                        'イベントを無効解除
                        Set fileDlog = Nothing
                        Application.EnableEvents = True
                        Exit Sub
                    Else
                        '上書き
                        FileCopy selectFile, objSheet.Range("FOLDER_PATH").value & "\" & objSheet.Range("B" & CellNo).value
                    End If
                Next selectFile
            Else
                '取得出来ない場合は処理を抜ける
                Set fileDlog = Nothing
                'イベントを無効解除
                Application.EnableEvents = True
                Exit Sub
            End If
        Else
            ' [ キャンセル ] ボタンが押された場合は処理を抜ける
            'イベントを無効解除
            Set fileDlog = Nothing
            Application.EnableEvents = True
            Exit Sub
        End If
    End With

    '-------------------------------------------------------------------
    '4.最新の状態に更新
    '-------------------------------------------------------------------
    Call CreateFileList
    
    'イベントを無効解除
    Set fileDlog = Nothing
    Application.EnableEvents = True

    Exit Sub

Error_Btn_Replace_Image_Click:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Import_Receipt_Click
' 機  能 ： 領収書取込ボタン押下処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Import_Receipt_Click()

On Error GoTo Error_Btn_Import_Receipt_Click:

    Const ACTION_NAME As String = "領収書取込ボタン"
    Dim ret As String   'アプリのリターン値
    Dim appFilePath As String
    Dim templateFolderPath As String
    Dim txtFilePath As String
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    'テキストを読み込む
    Dim buf As String
    '変更後のフォルダパス
    Dim NewFolderPath As String
    Dim strTemplateFolderPath As String

    'イベントを無効にする
    Application.EnableEvents = False

    '-----------------------------------------------------------
    '1.領収書管理画面(GB030763)の項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-----------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE, False) < 0 Then
        GoTo ExitProcedure
    End If

    '領収書取り込みアプリをチェックする
    appFilePath = checkReceiptFile(FILENAME_RECEIPT_SOFT, DIALOG_TITLE)
    'EXEの場所を取得出来なかった
    If appFilePath = "" Then
        '実行しない
        GoTo ExitProcedure
    End If
    
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    
    '-----------------------------------------------------------
    '2.領収書取込画面を起動する。
    '-----------------------------------------------------------
    'アプリのパスに引数1と2を追加する
    Select Case True
        Case Application.ActiveSheet.name = SHEET_14_1              '光熱水費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_0
        Case Application.ActiveSheet.name = SHEET_14_2              '備品・消耗品費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_1
        Case Application.ActiveSheet.name = SHEET_14_3              '事務所費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_2
        Case Application.ActiveSheet.name Like SHEET_15_1 & "*"     '組織活動費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_3
        Case Application.ActiveSheet.name Like SHEET_15_2 & "*"     '選挙関係費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_4
        Case Application.ActiveSheet.name Like SHEET_15_3 & "*"     '機関紙誌の発行事業費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_5
        Case Application.ActiveSheet.name Like SHEET_15_4 & "*"     '宣伝事業費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_6
        Case Application.ActiveSheet.name Like SHEET_15_5 & "*"     '政治資金パーティー開催事業費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_7
        Case Application.ActiveSheet.name Like SHEET_15_6 & "*"     'その他の事業費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_8
        Case Application.ActiveSheet.name Like SHEET_15_7 & "*"     '調査研究費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_9
        Case Application.ActiveSheet.name Like SHEET_15_8 & "*"     '寄附・交付金
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_10
        Case Application.ActiveSheet.name Like SHEET_15_9 & "*"     'その他の経費
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_11
        Case Else                                                   '領収書管理
            appFilePath = appFilePath & " " & RECEIPT_APP_KBN_12
    End Select
    '引数2を追加
    appFilePath = appFilePath & " """ & objSheet.Range("FOLDER_PATH").value & """"
    
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 START
'    'キーボード操作を禁止
'    Application.Interactive = False
    '画面の更新をストップする
    Application.ScreenUpdating = False
    Application.Cursor = xlWait
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 END

    '領収書取り込みアプリ起動
    '待機モードで開く
    ret = CreateObject("Wscript.Shell").Run(appFilePath, 5, True)
    
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 START
'    'キーボード操作禁止を解除
'    Application.Interactive = True
    '画面の更新ストップを解除する。
    Application.ScreenUpdating = True
    Application.Cursor = xlDefault
    ActiveSheet.Activate
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 END
    
    '-----------------------------------------------------------
    '3.領収書画面が閉じられた後
    '-----------------------------------------------------------
    'アプリ側でパスが変更されているかチェック
    'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
    If ThisWorkbook.pATH = "" Then
        '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
        '会計帳簿から渡されたパスをこのブックのパスとする
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value, TEMPLATE_FOLDER_NAME)
    Else
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.pATH, TEMPLATE_FOLDER_NAME)
    End If

    'テキスト
    txtFilePath = UnionFilePathAndName(strTemplateFolderPath, FILENAME_RECEIPT_TEXT)
    'ファイルの存在チェック
    If isFileExists(txtFilePath) = True Then
        '初期化
        NewFolderPath = ""
        Open txtFilePath For Input As #1
            'テキストを1行読む(1行しか無い)
            Line Input #1, buf
            '取得できたら
            If buf <> "" Then
                NewFolderPath = buf
            End If
        Close #1
        '取得したフォルダパスが本当に存在するかチェック
        'ファイルの存在チェック
        If isFolderExists(NewFolderPath) = True Then
            '存在が確認できた場合だけセットする
            objSheet.Range("FOLDER_PATH").value = NewFolderPath
        End If
        '最後にテキストを削除する
        Kill txtFilePath
    End If
    
    '-----------------------------------------------------------
    '4.画面の更新
    '-----------------------------------------------------------
    '最新の状態に更新
    Call CreateFileList

    'イベントを有効にする
    Application.EnableEvents = True

    Exit Sub
    
ExitProcedure:
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 START
'    'キーボード操作禁止を解除する
'    Application.Interactive = True
    '画面の更新ストップを解除する。
    Application.ScreenUpdating = True
    Application.Cursor = xlDefault
'EDIT 2015/03/31 Fujitsu)Ito H27政治資金 END
    'イベントを有効にする
    Application.EnableEvents = True
    
    Exit Sub
Error_Btn_Import_Receipt_Click:
    
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

    GoTo ExitProcedure
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CheckFolderPath
' 機  能 ： 画像ファイル保存フォルダのディレクトリ存在チェック
' 引  数 ：(in) strMessageTitle … エラー時のダイアログのタイトル
'        ：(in) MsgFlg … フォルダパスが空白の場合にメッセージを「表示しない」フラグ。Trueの場合のみ空白時にメッセージ表示
' 返り値 ： 正常：0
'        ： エラー：-1
'-------------------------------------------------------------------
Public Function CheckFolderPath(ByVal strMessageTitle As String, Optional ByVal MsgFlg As Boolean = False) As Long

On Error GoTo Error_CheckFolderPath:
    
    Dim strFolderPath As String
    Dim objSheet As Worksheet   'Excelシートオブジェクト
     
    '初期化
    Set objSheet = Nothing
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    strFolderPath = objSheet.Range("FOLDER_PATH").value
    'そもそも空白だったら
    If strFolderPath = "" Then
        If MsgFlg = False Then
            Call GetMessageBox(MESSAGE_W175_1, strMessageTitle)
        End If
        CheckFolderPath = -1
        '初期化
        Set objSheet = Nothing
        Exit Function
    End If
    
    'フォルダ存在チェック
    If isFolderExists(strFolderPath) = False Then
        Call GetMessageBox(MESSAGE_W175, strMessageTitle)
        CheckFolderPath = -1
        '初期化
        Set objSheet = Nothing
        Exit Function
    Else
        'OK
        CheckFolderPath = 0
    End If

    '初期化
    Set objSheet = Nothing
    Exit Function

Error_CheckFolderPath:
    '初期化
    Set objSheet = Nothing
    CheckFolderPath = -1

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Refresh_List_Click
' 機  能 ： 最新の情報に更新ボタン押下処理
' 引  数 ： 無し
' 返り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Refresh_List_Click()
    '最新の状態に更新
    Call CreateFileList
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END


'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CreateFileList
' 機  能 ： 画像ファイル保存情報の一覧を作成する
' 引  数 ： 無し
' 返り値 ： 無し
'-------------------------------------------------------------------
Public Sub CreateFileList()

On Error GoTo Error_CreateFileList:
    
    Const ACTION_NAME As String = "最新の状態に更新"
    Dim buf As String
    Dim cnt As Long
    Dim tobj As Shape
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim fso As Object
    Dim fileDataSet As Object
    Dim file As Variant
    
    '領収書管理シートを取得
    Set objSheet = Worksheets(SHEET_RECEIPT)
    '初期位置を取得
    cnt = objSheet.Range("FILE_NAME").Row
    'コピーや切取りの操作を取り消します
    Application.CutCopyMode = False
    '件数を初期化
    objSheet.Range("FILE_COUNT").value = 0

    '画面の表示をストップ
    Application.ScreenUpdating = False
    '一度リストをクリア(ただしリストの1行目を残す)
    objSheet.Range("B" & cnt + 2, objSheet.Cells(Rows.Count, 1).End(xlToRight)).EntireRow.Delete
    objSheet.Rows(cnt + 1).ClearContents
    
    'イベントを無効にする
    Application.EnableEvents = False
    '画面の表示をストップ
    Application.ScreenUpdating = False
    Call SetCalcMode(False)
    
    'ボタンを削除
    For Each tobj In objSheet.Shapes
        If (LCase(tobj.name) Like "btn_delete_image*") Or (LCase(tobj.name) Like "btn_replace_image*") Then
            'オブジェクトを削除
            tobj.Delete
        End If
    Next
    '画像オブジェクト削除
    If VarType(Evaluate("IMAGE_VIEW")) = vbObject Then
       objSheet.Shapes("IMAGE_VIEW").Delete
    End If
    
    '-----------------------------------------------------------
    '1.領収書管理画面(GB030763)の項目名「FOLDER_PATH」のディレクトリ存在チェック
    '-----------------------------------------------------------
    '画像ファイル保存フォルダの存在チェックを行う
    If CheckFolderPath(DIALOG_TITLE) < 0 Then
        '画面の表示を戻す
        Application.ScreenUpdating = True
        'イベントを無効解除
        Application.EnableEvents = True
        Call SetCalcMode(True)
        Exit Sub
    End If

    Set fso = CreateObject("Scripting.FileSystemObject")
    '-- "FILENAMEフィールドを作成"
    Set fileDataSet = CreateObject("ADODB.Recordset")
    'フィールド(ファイル名)
    fileDataSet.Fields.Append "FILENAME", 200, 300, 32
    'フィールド(取込日時)
    fileDataSet.Fields.Append "FILETIME", 200, 300, 32
    'レコードセットオープン
    fileDataSet.Open
    '-----------------------------------------------------------
    '2.フォルダに存在するすべてのファイル名を取得する
    '-----------------------------------------------------------
    '-- GetFolderでパスを取得しAdoに格納
    For Each file In fso.GetFolder(objSheet.Range("FOLDER_PATH").value).files
        'ファイルの拡張子がjpg、jpeg、gifのファイルだけ取得する
        If (LCase(file.name) Like "*.jpg") Or (LCase(file.name) Like "*.jpeg") Or (LCase(file.name) Like "*.gif") Then
            '行追加
            fileDataSet.AddNew
            'ファイル名をセット
            fileDataSet.Fields(0) = file.name
            '取込日時をセット(フォーマット変換する)
            fileDataSet.Fields(1) = Format(file.DateLastModified, "yyyy/mm/dd hh:mm")
            '行をレコードセットに更新
            fileDataSet.Update
        End If
    Next
    
    '-----------------------------------------------------------
    '3.ファイル情報(名称と更新日)を「画像ファイル保存情報」一覧に表示する
    '-----------------------------------------------------------
    'ファイルが1件でも取得できたら処理をする
    If fileDataSet.RecordCount > 0 Then
        '取得したファイル一覧を更新日の降順でソートし直す
        fileDataSet.Sort = "FILETIME DESC"
        fileDataSet.MoveFirst
        '行を追加する
        With objSheet
            'リストの1行目をコピー
            .Rows(Range("B" & cnt + 1).Row).Copy
            'ファイルが2件以上ある場合は行を挿入。
            If fileDataSet.RecordCount > 1 Then
                '2行目から件数分、行を挿入
                .Range(cnt + 2 & ":" & cnt + fileDataSet.RecordCount).Insert
                '行の挿入した箇所をクリア
                .Range(cnt + 2 & ":" & cnt + fileDataSet.RecordCount).ClearComments
            End If
            'コピーや切取りの操作を取り消します
            Application.CutCopyMode = False
            
            'Recordsetの件数分、内容を追加していく
            Do Until fileDataSet.EOF
                'カウントプラス
                cnt = cnt + 1
                'MAX65536行
                If cnt > 65536 Then
                    Exit Do
                End If
                'ファイル名
                .Range("B" & cnt).value = fileDataSet.Fields(0)
                'ハイパーリンク追加
                .Range("B" & cnt).Hyperlinks.Add Anchor:=.Range("B" & cnt), _
                                                 Address:="", _
                                                 ScreenTip:="画像を表示します。", _
                                                 TextToDisplay:=""
                'ハイパーリンクを設定するとフォントが強制的に変更されるので規約に戻す
                .Range("B" & cnt).Font.name = "ＭＳ 明朝"
                .Range("B" & cnt).Font.Size = 12
                
                '取込日時
                .Range("E" & cnt).value = fileDataSet.Fields(1)
                '削除リンクを追加
                .Range("G" & cnt).value = "削除"
                .Range("G" & cnt).Hyperlinks.Add Anchor:=objSheet.Range("G" & cnt), _
                                                    Address:="", _
                                                    ScreenTip:="画像を削除します。", _
                                                    TextToDisplay:=""
                .Range("G" & cnt).Font.name = "ＭＳ 明朝"
                .Range("G" & cnt).Font.Size = 12
                .Range("G" & cnt).HorizontalAlignment = xlCenter
                
                '差替リンクを追加
                .Range("H" & cnt).value = "差替"
                .Range("H" & cnt).Hyperlinks.Add Anchor:=objSheet.Range("H" & cnt), _
                                                    Address:="", _
                                                    ScreenTip:="画像を差替します。", _
                                                    TextToDisplay:=""
                .Range("H" & cnt).Font.name = "ＭＳ 明朝"
                .Range("H" & cnt).Font.Size = 12
                .Range("H" & cnt).HorizontalAlignment = xlCenter

                
                '次の行へ
                fileDataSet.MoveNext
            Loop
        End With
        '件数をセット
        objSheet.Range("FILE_COUNT").value = fileDataSet.RecordCount
    End If
    'クリア
    Set objSheet = Nothing
    Set fso = Nothing
    Set fileDataSet = Nothing
    '画面の表示を戻す
    Application.ScreenUpdating = True
    'イベントを無効解除
    Application.EnableEvents = True
    Call SetCalcMode(True)

    Exit Sub

Error_CreateFileList:
    '画面の表示を戻す
    Application.ScreenUpdating = True
    'イベントを無効解除
    Application.EnableEvents = True
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CheckReceiptFile
' 機  能 ： 領収書取り込みアプリが使用可能かチェックする
' 引  数 ： (in) strTemplateFile … EXEファイル名
'        ： (in) strMessageTitle … エラー時のダイアログのタイトル
' 返り値 ： 正常：領収書取り込みアプリのフルパス
'        ： エラー：空文字("")
'-------------------------------------------------------------------
Public Function checkReceiptFile(strTemplateFile As String, strMessageTitle As String) As String
    
On Error GoTo Error_CheckReceiptFile:
    
    Dim strTemplateFilePath As String
    Dim strTemplateFolderPath As String
    Dim strMessage As String
    Dim objSheet As Worksheet   'Excelシートオブジェクト
    Dim isNoSave As Boolean     '会計帳簿作成ソフトの収支報告書作成で出力されてから未保存の場合:True
   
    checkReceiptFile = ""
    
    'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
    If ThisWorkbook.pATH = "" Then
        '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
        '会計帳簿から渡されたパスをこのブックのパスとする
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value, TEMPLATE_FOLDER_NAME)
        isNoSave = True
    Else
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.pATH, TEMPLATE_FOLDER_NAME)
        isNoSave = False
    End If
    
    If isFolderExists(strTemplateFolderPath) = False Then
        If isNoSave Then
            '会計帳簿から渡されたパスの場合（メッセージを区別）
            strMessage = "このブックを出力した会計帳簿作成ソフトと同じフォルダに""" & TEMPLATE_FOLDER_NAME & """フォルダが存在しないため、実行できません。" & vbCrLf & _
                    "詳細な対応方法は「FAQ」シートを参照してください。"
        Else
            '収支報告書作成ソフトを同じパスの場合
            strMessage = "このブックと同じフォルダに""" & TEMPLATE_FOLDER_NAME & """フォルダが存在しないため、実行できません。" & vbCrLf _
                        & vbCrLf _
                        & "この操作を行うには、このブックを収支報告書作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。" & vbCrLf & _
                    "詳細な対応方法は「FAQ」シートを参照してください。"
        End If
        MsgBox strMessage, vbCritical, strMessageTitle
        Exit Function
    End If
    
    '領収書取り込みアプリのファイルパス
    strTemplateFilePath = UnionFilePathAndName(strTemplateFolderPath, strTemplateFile)
    
    '領収書取り込みアプリが存在するか
    If isFileExists(strTemplateFilePath) = False Then
        strMessage = "この操作に必要なファイルが存在しないため、実行できません。" & vbCrLf _
                    & vbCrLf _
                    & "この操作を行うには、""" & TEMPLATE_FOLDER_NAME & """フォルダ内に「" & strTemplateFile & "」が必要です。"
        
        MsgBox strMessage, vbCritical, strMessageTitle
        Exit Function
    End If
    
'ADD 2015/05/28 Fujitsu)Nakajima H27政治資金 START
    'フォルダ名に半角スペースが入ると例外エラーが発生するため「"」で囲う
    strTemplateFilePath = """" & strTemplateFilePath & """"
'ADD 2015/05/28 Fujitsu)Nakajima H27政治資金 END
    
    'リターン値設定
    checkReceiptFile = strTemplateFilePath
    
    Exit Function
Error_CheckReceiptFile:
    '初期化
    checkReceiptFile = ""

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Imp_Folder_Path
' 機  能 ： 会計帳簿作成ソフトから画像ファイル保存先フォルダパスを取得しセットする
' 引  数 ： 画像ファイル保存先フォルダパス
' 返り値 ： 無し
'-------------------------------------------------------------------
Public Sub Imp_Folder_Path(ByVal strFolderPath As String)
    
    Dim objSheet As Worksheet   'Excelシートオブジェクト
   
    If strFolderPath <> "" Then
        '領収書管理シートを取得
        Set objSheet = Worksheets(SHEET_RECEIPT)
        objSheet.Range("FOLDER_PATH").value = strFolderPath
        Set objSheet = Nothing
    End If
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

-------------------------------------------------------------------------------
VBA MACRO Message.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Message'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : Message
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2015 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
Public Const MESSAGE_TITLE_ROW_INSERT As String = "行の追加"

Public Const MESSAGE_W161 As String = "W161%%これ以上の行の追加はできません。"

Public Const MESSAGE_W023 As String = "W023%%「作成対象」が選択されていません。" & vbCrLf & _
                                      "「作成対象」はどれか１つ以上選択してください。" & vbCrLf

Public Const MESSAGE_W173 As String = "W173%%住所情報に誤りがある可能性があります。" & vbCrLf & _
                                      "再度ご確認下さい｡" & vbCrLf & _
                                      "・政令市の住所には、区名の入力を行って下さい。" & vbCrLf & _
                                      "※このメッセージが出た状態でも印刷・保存は可能です。"

Public Const MESSAGE_W175 As String = "W175%%存在しない画像ファイル保存フォルダが設定されています。" & vbCrLf & _
                                      "正しい画像ファイル保存フォルダを設定してください。"

Public Const MESSAGE_W175_1 As String = "W175%%正しい画像ファイル保存フォルダを設定してください。"
                                      
Public Const MESSAGE_W180 As String = "W180%%領収書画像が選択されていません。" & vbCrLf & _
                                      "領収書画像をどれか１つ以上選択してください。" & vbCrLf

Public Const MESSAGE_W181 As String = "W181%%指定された画像の追加はできません。" & vbCrLf & _
                                      "他のフォルダの画像を指定してください。"

Public Const MESSAGE_W182 As String = "W182%%指定された画像の差替はできません。" & vbCrLf & _
                                      "他の画像を指定してください。"

Public Const MESSAGE_G049 As String = "G049%%ファイルを削除します。よろしいですか？"
Public Const MESSAGE_G081 As String = "G081%%領収書管理画面へ移動します。よろしいですか？"
Public Const MESSAGE_G050 As String = "G050%%ファイルを差替します。" & vbCrLf & _
                                      "ファイルは上書きされますがよろしいですか？"
Public Const MESSAGE_G082 As String = "G082%%提出用ファイルを作成します。よろしいですか？"

Public Const MESSAGE_G083 As String = "G083%%エラーが見つかりました。エラーとなったシートを開き、入力内容を確認してください。" & vbCrLf & _
                                      "エラー箇所へ遷移しますか？" & vbCrLf & vbCrLf & _
                                      "エラーとなっている箇所（ピンク色の箇所）にマウスカーソルを合わせると、エラーの内容が表示されます。"

'2020/12/14 フォルダ名誤り修正
'Public Const MESSAGE_S025 As String = "S025%%このブックと同じフォルダに(%1)フォルダが存在しないため、実行できません。" & vbCrLf & vbCrLf & _
'                                      "この操作を行うには、このブックを会計帳簿作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。"
        
'Public Const MESSAGE_S025_1 As String = "S025%%このブックと同じフォルダに(%1)フォルダにCSVフォルダが存在しないため、実行できません。" & vbCrLf & vbCrLf & _
'                                      "この操作を行うには、このブックを会計帳簿作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。"
        
Public Const MESSAGE_S025 As String = "S025%%このブックと同じフォルダに(%1)フォルダが存在しないため、実行できません。" & vbCrLf & vbCrLf & _
                                      "この操作を行うには、このブックを収支報告書作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。"
        
Public Const MESSAGE_S025_1 As String = "S025%%このブックと同じフォルダに(%1)フォルダにCSVフォルダが存在しないため、実行できません。" & vbCrLf & vbCrLf & _
                                      "この操作を行うには、このブックを収支報告書作成ソフトをインストールしたフォルダ内に置いた状態で実行してください。"
        
        
Public Const MESSAGE_S002 As String = "S002%%この操作に必要なファイルが存在しないため、実行できません。" & vbCrLf & vbCrLf & _
                                      "この操作を行うには、(%1)フォルダ内のCSVフォルダに「(%2)」が必要です。"

Public Const MESSAGE_G086 As String = "G086%%印刷に(%1)程度、時間がかかる場合があります。" & vbCrLf & _
                                      "" & vbCrLf & _
                                      "印刷を実施しますか？"
'ADD 2016/11/01 H28政治資金 START
'2019/4/26 修正
Public Const MESSAGE_E001 As String = "入力が必要ですが、何も入力されていません（E001）" & vbCrLf & vbCrLf & _
                                    "該当する事項を入力してください。"

Public Const MESSAGE_I001 As String = "いわゆる「主義主張団体」や「政策研究団体」と呼ばれている団体が該当します。"

Public Const MESSAGE_I002 As String = "いわゆる「後援会」と呼ばれている団体が該当します。"

Public Const MESSAGE_W190 As String = "「預金又は貯金残高、金銭信託額、有価証券価格の合計額」が" & vbCrLf & "翌年繰越額より大きくなっています。"

Public Const MESSAGE_W191 As String = "宣誓日は収支報告書の報告年の翌年以降の日付を入力してください。" & vbCrLf & _
                    "(ただし、解散等に伴う収支報告書を提出する場合は除きます。)"

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

Public Const MESSAGE_E002 As String = "チェックボックスの選択が正しくありません（E002）" & vbCrLf & vbCrLf & _
                                    "チェックボックスは、どちらか1つにチェックをつけてください。"
Public Const MESSAGE_E006 As String = "必要事項の記入のない行に入力されています（E006）" & vbCrLf & vbCrLf & _
                                    "この行に入力を行う場合は、必要事項に記入してください。" & vbCrLf & _
                                    "入力を行わない場合は、この値を削除してください。"
Public Const MESSAGE_E008 As String = "扱うことのできる数値の範囲を超えています。（E008）" & vbCrLf & vbCrLf & _
                                    "12桁以内の数値になるように、明細（計算元）の数値を修正してください。"
Public Const MESSAGE_E011 As String = "全角のひらがな以外が入力されています（E011）" & vbCrLf & vbCrLf & _
                                    "この項目は、全角のひらがなのみで入力してください。"
Public Const MESSAGE_E012 As String = "全角以外の文字が入力されています（E012）" & vbCrLf & vbCrLf & _
                                    "この項目は、全角の文字（「あ」、「漢」、「３」など）のみで入力し、" & vbCrLf & _
                                    "半角の文字（「ｱ」、「A」、「3」など）は入力しないでください。"
Public Const MESSAGE_E013 As String = "リストにない内容が入力されています（E013）" & vbCrLf & vbCrLf & _
                                    "この項目は、セルを選択した時に現れる三角ボタンを押し、" & vbCrLf & _
                                    "表示されたリストの中から該当事項を選択してください。"
Public Const MESSAGE_E017 As String = "資金管理団体の「指定の有無」は「無」が設定されています（E017）" & vbCrLf & vbCrLf & _
                                    "資金管理団体の指定がある場合、「指定の有無」を「有」にしてください。" & vbCrLf & _
                                    "指定がない場合、この項目は空欄としてください。"
Public Const MESSAGE_E018 As String = "国会議員関係政治団体の「国会議員関係政治団体の区分」は、" & vbCrLf & _
                                    "指定無しとなっています（E018）" & vbCrLf & vbCrLf & _
                                    "国会議員関係政治団体の指定がある場合、その指定を行ってください。" & vbCrLf & _
                                    "指定がない場合、この項目は空欄としてください。"
Public Const MESSAGE_E019 As String = "不要な項目に入力されています（E019）" & vbCrLf & vbCrLf & _
                                    "この入力内容の場合、この項目は入力不要であるため、空欄としてください。"
Public Const MESSAGE_E029 As String = "正しい電話番号の形式ではありません（E029）" & vbCrLf & vbCrLf & _
                                    "セルには「03-1234-5678」のように、半角の数字およびハイフン（-）で入力してください。"
Public Const MESSAGE_E120 As String = "(%1)文字以内で入力してください（E120）"
Public Const MESSAGE_E121 As String = "数字を入力してください。" & vbCrLf & _
                                    "もしくは、(%1)桁以内で入力してください（E121）"
Public Const MESSAGE_E123 As String = "年月日を入力してください（E123）"
Public Const MESSAGE_E137 As String = "取込する機器が選択されていません（E137）" & vbCrLf & vbCrLf & _
                                    "使用する機器が正しく接続されていることを確認し、" & vbCrLf & _
                                    "「機器選択」ボタンより使用する機器を選択してください。"
Public Const MESSAGE_E138 As String = "領収書取込は重複して開くことはできません（E138）" & vbCrLf & vbCrLf & _
                                    "既に開かれている領収書取込を閉じるボタンで終了後、再度実行してください。"
Public Const MESSAGE_E144 As String = "取り込み可能な機器がインストールされていません（E144）"
Public Const MESSAGE_E147 As String = "E147%%(%1)と同じ氏名は使用できません（E147）" & vbCrLf & vbCrLf & _
                                    "別の名前を入力してください。"
Public Const MESSAGE_E148 As String = "正しい金額ではありません（E148）" & vbCrLf & vbCrLf & _
                                    "(%1)以下の金額を入力してください。"
Public Const MESSAGE_E149 As String = "政治団体の区分が設定されていません（E149）" & vbCrLf & vbCrLf & _
                                    "政治団体の区分の指定がある場合、政治団体の区分を選択してください。" & vbCrLf & _
                                    "選択がない場合、この項目は空欄としてください。"
' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 START
Public Const MESSAGE_E150 As String = "国会議員関係政治団体の区分は、２号団体又は３号団体が指定なしとなっています（E150）" & vbCrLf & vbCrLf & _
                                    "国会議員関係政治団体の２号団体又は３号団体の指定がある場合、その指定を行ってください。" & vbCrLf & _
                                    "指定がない場合、この項目は空欄としてください。"
' 2025/06/05 政治資金・政党助成関係申請・届出オンラインシステムの令和６年法改正に係る機能改修の対応 END
Public Const MESSAGE_E151 As String = "期間が重複しています（E151）" & vbCrLf & vbCrLf & _
                                    "重複した期間を指定することはできません。"
Public Const MESSAGE_E152 As String = "正しい年ではありません（E152）" & vbCrLf & vbCrLf & _
                                    "報告年と同一年を入力してください。"
Public Const MESSAGE_E153 As String = "正しい期間ではありません（E153）" & vbCrLf & vbCrLf & _
                                    "資金管理団体の指定の期間（自～至）を入力してください。"
Public Const MESSAGE_E154 As String = "「国会議員関係政治団体に関する特例の適用期間(至)」より後の日付が入力されています（E154）" & vbCrLf & vbCrLf & _
                                    "「国会議員関係政治団体に関する特例の適用期間(至)」より前の日付を入力してください。"
Public Const MESSAGE_E155 As String = "正しい期間ではありません（E155）" & vbCrLf & vbCrLf & _
                                    "国会議員関係政治団体に関する特例の適用期間(自～至)を入力してください。"
Public Const MESSAGE_E156 As String = "正しい入力ではありません（E156）"
Public Const MESSAGE_E157 As String = "金額が不正です（E157）" & vbCrLf & vbCrLf & _
                                    "合計金額が対象項目より少なくなっています。"
Public Const MESSAGE_E158 As String = "使用できない文字が含まれています((%1)文字目)（E158）"
Public Const MESSAGE_E159 As String = "小計の集計範囲に異なる通し番号が存在しています（E159）" & vbCrLf & vbCrLf & _
                                    "「通し番号・日付順で並び替え」を実行してください。"
Public Const MESSAGE_E160 As String = "(%1)の場合、この項目には入力できません（E160）" & vbCrLf & vbCrLf & _
                                    "項目を削除してください。"
Public Const MESSAGE_E170 As String = "預金又は貯金残高が翌年繰越額より大きくなっています（E170）"
Public Const MESSAGE_E171 As String = "一方が0の場合、他方も0である必要があります（E171）"
Public Const MESSAGE_E172 As String = "小計が正しくありません（E172）" & vbCrLf & vbCrLf & _
                                    "小計行を作成した後に行われた編集操作によって、" & vbCrLf & _
                                    "明細と小計の位置関係が正しくない状態になっています。" & vbCrLf & _
                                    "再度「通し番号・日付順で並び替え」を行うか、または小計行を削除してください。"
Public Const MESSAGE_E173 As String = "小計行が存在しません（E173）" & vbCrLf & vbCrLf & _
                                    "同じ通し番号が複数存在するにもかかわらず、" & vbCrLf & _
                                    "小計行が存在しない状態になっています。" & vbCrLf & _
                                    "「通し番号・日付順で並び替え」を行うか、" & vbCrLf & _
                                    "または異なる通し番号を入力してください。"
Public Const MESSAGE_I049 As String = "XMLデータを作成します。" & vbCrLf & vbCrLf & _
                                    "以下の内容について、入力内容に誤りがないか、" & vbCrLf & _
                                    "ご確認のうえ、【OK】ボタンを押下してください。" & vbCrLf & vbCrLf & _
                                    "・報告年は正しく入力されていますか。" & vbCrLf & vbCrLf & _
                                    "・下記の項目が現在届け出されている事項と一致していますか。" & vbCrLf & _
                                    "　代表者名" & vbCrLf & _
                                    "　会計責任者名" & vbCrLf & _
                                    "　主たる事務所の所在地" & vbCrLf & _
                                    "　政治団体区分" & vbCrLf & _
                                    "　資金管理団体の指定の有無"
Public Const MESSAGE_I050 As String = "収支報告書を印刷します。" & vbCrLf & vbCrLf & _
                                    "以下の内容について、入力内容に誤りがないか、" & vbCrLf & _
                                    "ご確認のうえ、【OK】ボタンを押下してください。" & vbCrLf & vbCrLf & _
                                    "・報告年は正しく入力されていますか。" & vbCrLf & vbCrLf & _
                                    "・下記の項目が現在届け出されている事項と一致していますか。" & vbCrLf & _
                                    "　代表者名" & vbCrLf & _
                                    "　会計責任者名" & vbCrLf & _
                                    "　主たる事務所の所在地" & vbCrLf & _
                                    "　政治団体区分" & vbCrLf & _
                                    "　資金管理団体の指定の有無"
Public Const MESSAGE_W175_2 As String = "この位置では実行できません。" & vbCrLf & _
                                    "転記する政治資金パーティーの行を選択し、再度実行してください。"
Public Const MESSAGE_W176 As String = "選択した行の政治資金パーティーの名称が入力されていません。" & vbCrLf & _
                                    "「事業の種類」欄に政治資金パーティーの名称を入力し、" & vbCrLf & _
                                    "再度実行してください。"
Public Const MESSAGE_G089 As String = "G089%%このシートの「通し番号」を1から振りなおします。" & vbCrLf & vbCrLf & _
                                    "「(%1)」の内容が同一の行には、同一の番号を付与します。" & vbCrLf & _
                                    "入力済みの「通し番号」は更新されますがよろしいでしょうか？"
Public Const MESSAGE_G082_1 As String = "G082%%「その10」シート(機関紙誌の発行その他の事業による収入のうち特定" & _
                                    "パーティーの対価に係る収入の内訳)の「特定パーティーの名称」欄に" & _
                                    "選択されたパーティー名を転記します。" & vbCrLf & _
                                    "実行してよろしいですか？"
Public Const MESSAGE_G083_1 As String = "G083%%「その11」シート(政治資金パーティーの対価に係る収入の内訳)を新しく" & _
                                    "作成し、「政治資金パーティーの名称」欄に選択されたパーティー名を" & _
                                    "転記します。" & vbCrLf & _
                                    "なお、「政治資金パーティーの名称」が登録されていない「その11」シート" & _
                                    "(政治資金パーティーの対価に係る収入の内訳)が存在する場合は、" & _
                                    "既存のシートに転記されます。" & vbCrLf & _
                                    "実行してよろしいですか？"
Public Const MESSAGE_G084 As String = "G084%%「その15(5)」シート（政治活動費の内訳「5.政治資金パーティー開催事業費」）" & _
                                    "を新しく作成し、「項目別区分」欄に選択されたパーティー名を転記します。" & vbCrLf & _
                                    "なお、「項目別区分」が登録されていない「その15(5)」シートが存在する" & _
                                    "場合は、既存のシートに転記されます。" & vbCrLf & _
                                    "実行してよろしいですか？"
Public Const MESSAGE_E174 As String = "政治資金パーティーの名称は、様式・区分ごとにそれぞれ違うものを入力してください（E174）"
Public Const MESSAGE_E175 As String = "「政治団体の区分」で指定されている内容と異なります（E175）" & vbCrLf & vbCrLf & _
                                    "この項目は、政治団体の区分が「政党」又は「政治資金団体」の場合は" & vbCrLf & _
                                    "「監査意見書（政党及び政治資金団体に限る。）」を指定してください。" & vbCrLf & _
                                    "それ以外の場合は空欄としてください。"
Public Const MESSAGE_E176 As String = "その14、その15シートと入力内容が異なります（E176）"
Public Const MESSAGE_E177 As String = "チェックボックスの選択が正しくありません（E177）" & vbCrLf & vbCrLf & _
                                    "寄附金（税額）控除がある場合、どれか1つにチェックをつけてください。"
Public Const MESSAGE_E178 As String = "チェックボックスの選択が正しくありません（E178）" & vbCrLf & vbCrLf & _
                                    "寄附金（税額）控除がない場合、チェックをつけないでください。"
Public Const MESSAGE_E179 As String = "「政治団体の区分」で指定されている内容と異なります（E179）" & vbCrLf & vbCrLf & _
                                    "政治団体の区分が「政党」、「政党の支部」、「政治資金団体」のいずれかの場合は、" & vbCrLf & _
                                    "チェックボックスにチェックをつけてください。" & vbCrLf & _
                                    "それ以外の場合はチェックをつけないでください。"
Public Const MESSAGE_E180 As String = "「政治団体の区分」で指定されている内容と異なります（E180）" & vbCrLf & vbCrLf & _
                                    "政治団体の区分が「政党」、「政党の支部」、「政治資金団体」のいずれかの場合は、" & vbCrLf & _
                                    "チェックボックスにチェックをつけないでください。" & vbCrLf & _
                                    "それ以外の場合はチェックをつけてください。"
Public Const MESSAGE_E181 As String = "「その7(1)」シート（寄附の内訳「1.個人」）の「寄附金（税額）控除」欄が" & vbCrLf & _
                                    "「必要」となっている寄附者が存在しません（E181）"
Public Const MESSAGE_E182 As String = "「その7(1)」シート（寄附の内訳「1.個人」）の「寄附金（税額）控除」欄が" & vbCrLf & _
                                    "「必要」となっていない寄附者が存在します（E182）"
Public Const MESSAGE_E183 As String = "「経常経費小計（本部又は支部に対して供与した交付金に係る支出）」と" & vbCrLf & _
                                    "「政治活動費小計（本部又は支部に対して供与した交付金に係る支出）」の合計金額が" & vbCrLf & _
                                    "「その16」シート（本部又は支部に対して供与した交付金に係る支出の内訳）の" & vbCrLf & _
                                    "合計金額と一致しません（E183）"
Public Const MESSAGE_E184 As String = "合計金額が「その13」シート（支出項目別金額の内訳）の" & vbCrLf & _
                                    "「経常経費小計（本部又は支部に対して供与した交付金に係る支出）」と" & vbCrLf & _
                                    "「政治活動費小計（本部又は支部に対して供与した交付金に係る支出）」の" & vbCrLf & _
                                    "合計金額と一致しません（E184）"
Public Const MESSAGE_E185 As String = "金額が「その14(1)」シート（経常経費（人件費を除く。）の内訳「2.光熱水費」）の" & vbCrLf & _
                                    "合計金額より少なくなっています（E185）"
Public Const MESSAGE_E186 As String = "合計金額が「その13」シート（支出項目別金額の内訳）の「2.光熱水費」の" & vbCrLf & _
                                    "金額より多くなっています（E186）"
Public Const MESSAGE_E187 As String = "金額が「その14(2)」シート（経常経費（人件費を除く。）の内訳「3.備品・消耗品費」）の" & vbCrLf & _
                                    "合計金額より少なくなっています（E187）"
Public Const MESSAGE_E188 As String = "合計金額が「その13」シート（支出項目別金額の内訳）の「3.備品・消耗品費」の" & vbCrLf & _
                                    "金額より多くなっています（E188）"
Public Const MESSAGE_E189 As String = "金額が「その14(3)」シート（経常経費（人件費を除く。）の内訳「4.事務所費」）の" & vbCrLf & _
                                    "合計金額より少なくなっています（E189）"
Public Const MESSAGE_E190 As String = "合計金額が「その13」シート（支出項目別金額の内訳）の「4.事務所費」の" & vbCrLf & _
                                    "金額より多くなっています（E190）"
Public Const MESSAGE_E191 As String = "金額が不正です（E191）" & vbCrLf & vbCrLf & _
                                    "0以上の金額になるよう明細（計算元）の数値を修正してください。"
Public Const MESSAGE_E192 As String = "項目別区分の選択が正しくありません（E192）" & vbCrLf & vbCrLf & _
                                    "(%1)に対応する項目別区分を選択してください。"
Public Const MESSAGE_E193 As String = "項目別区分の選択が正しくありません（E193）" & vbCrLf & vbCrLf & _
                                    "(%1)に入力がない項目別区分は選択しないでください。"
Public Const MESSAGE_E194 As String = "当シートは12月31日現在で不動産を有している資金管理団体のみ記載してください（E194）"
Public Const MESSAGE_E195 As String = "項目別区分の選択が正しくありません（E195）" & vbCrLf & vbCrLf & _
                                    "明細行の記載がない場合、項目別区分は選択しないでください。"
Public Const MESSAGE_E196 As String = "項目別区分の選択が正しくありません（E196）" & vbCrLf & vbCrLf & _
                                    "明細行を記載する場合、いずれかの項目別区分を選択してください。"
Public Const MESSAGE_E197 As String = "項目別区分の選択が正しくありません（E196）" & vbCrLf & vbCrLf & _
                                    "「その19」シート（不動産の利用の現況）間で同一の項目別区分は選択しないでください。"
Public Const MESSAGE_E198 As String = "項目別区分の選択が正しくありません（E198）" & vbCrLf & vbCrLf & _
                                    "明細行の記載がない場合は「無」を、明細行の記載がある場合は「有」を選択してください。"
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
  ' 関数名 ： GetMessage
  ' 機  能 ： メッセージを出力する
  ' 引  数 ： msg          … 出力メッセージ
  '        ： screenId     … 画面ID
  '        ： title        … MSGBOXのタイトル
  '        ： repMessage   … 置換対象のメッセージ 複数存在する場合はセミコロンつなぎ(aaaa;bbbb;cccc)
  '                                置換対象の文字列は(%n)とする
  ' 戻り値 ： 取得したメッセージの文字列
'-------------------------------------------------------------------
Private Function GetMessage(ByVal msg As String, ByVal title As String, Optional ByVal repMessage As String) As String

    Dim val() As String
    Dim msgVal As String

    val = Split(msg, "%%")

    msgVal = val(1)

    ' 置換処理(%1)→repMessageで指定した文字列に渡す
    GetMessage = ReplaceMassage(msgVal, repMessage)

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
  ' 関数名 ： ReplaceMassage
  ' 機  能 ： 置換対象の文字列が指定されている場合以下処理を実行
  ' 引  数 ： msg          … メッセージ
  '        ： repMessage   … 置換文字列
  ' 戻り値 ： 取得したメッセージの文字列
  ' 備考   ： 例 対象値 = (%1)支部、(%2)支部
  '        ：    repMessage = ○○;××
  '        ：    処理結果    ○○支部、××支部
'-------------------------------------------------------------------
Public Function ReplaceMassage(ByVal msg As String, ByVal repMessage As String) As String

    Dim rep() As String
    Dim i As Integer

    If Len(repMessage) > 0 Then
        rep = Split(repMessage, ";")

        For i = 0 To UBound(rep)
            msg = Replace(msg, "(%" & i + 1 & ")", rep(i))
        Next i
    End If

    ReplaceMassage = msg

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
  ' 関数名 ： GetMessageBox
  ' 機  能 ： メッセージボックスを出力する
  ' 引  数 ： msg          … 出力メッセージ
  '        ： title        … タイトル
  '      　： repMessage   … 置換対象のメッセージ
  ' 戻り値 ： true:false
'-------------------------------------------------------------------
Public Function GetMessageBox(ByVal msg As String, ByVal title As String, Optional ByVal repMessage As String) As Boolean

    Dim val() As String

    val = Split(msg, "%%")

    msg = GetMessage(msg, title, repMessage)

    GetMessageBox = MessageBoxOut(CStr(val(0)), msg, title)

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
  ' 関数名 ： MessageBoxOut
  ' 機  能 ： メッセージボックスを出力する
  ' 引  数 ： key … コード
  '        ： msg … メッセージ
  '        ： title … タイトル
  ' 戻り値 ： 取得したメッセージの文字列
'-------------------------------------------------------------------
Public Function MessageBoxOut(ByVal key As String, ByVal msg As String, ByVal title As String) As Boolean

    Select Case Left(key, 1)
        Case "I"
            Call MsgBox(msg, vbInformation, title)
        Case "W"
            Call MsgBox(msg, vbExclamation, title)
        Case "S"
            Call MsgBox(msg, vbCritical, title)
        Case "G"
            If MsgBox(msg, vbQuestion + vbOKCancel, title) = vbOK Then
                MessageBoxOut = True
            Else
                MessageBoxOut = False
            End If
    End Select

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
-------------------------------------------------------------------------------
VBA MACRO frmImageView.frm 
in file: xl/vbaProject.bin - OLE stream: 'VBA/frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : frmImageView
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2014 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'領収書画像一覧
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------
'　定数
'----------------------------------------
Private Const imageWidth = 250 'イメージの幅
Private Const imageHeight = 200 'イメージの高さ
Private Const HCount = 3 '横に表示する個数
Private Const CheckBoxHeight = 15   'チェックボックスの高さ
Private Const CheckBoxWidth = 100   'チェックボックスの幅
Private Const spaceHeight = 13  '２行目以降に追加するスペースの高さ
Private Const labelHeight = 30  'ファイル名分の高さ
Private Const DIALOG_TITLE As String = "領収書画像一覧"
'----------------------------------------
'　変数
'----------------------------------------
Public ImageFilePath As String
Private ImageCount As Long
Dim myImage() As ClsImageView
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： UserForm_Initialize
' 機  能 ： 初期表示処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub UserForm_Initialize()

    Dim rowCount As Long
    Dim imageFolder As String
    Dim fso As Object
    Dim fileDataSet As Object
    Dim file As Variant

    rowCount = 0
    ImageCount = 0
    '-----------------------------------------------------------
    '1.項目名「FOLDER_PATH」のディレクトリ情報を取得する。
    '-----------------------------------------------------------
    '画像ファイル保存先フォルダ情報取得
    imageFolder = ModuleReceipt.FOLDER_PATH
    
    '-----------------------------------------------------------
    '2.起動された画面により処理分岐
    '-----------------------------------------------------------
    If ModuleReceipt.ImageViewOpenFlg = False Then
        'ラベルを非表示
        LBL_TITLE.Visible = False
        'ボタンを非表示
        Btn_Select_All.Visible = False
        Btn_Clear_All.Visible = False
        Btn_Goto_ReceiptSheet.Visible = False
        Btn_Make_Pdf.Visible = False
    Else
        'ラベルを表示する
        LBL_TITLE.Visible = True
        'ボタンを表示する
        Btn_Select_All.Visible = True
        Btn_Clear_All.Visible = True
        Btn_Goto_ReceiptSheet.Visible = True
        Btn_Make_Pdf.Visible = True
    End If
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    '-- "FILENAMEフィールドを作成"
    Set fileDataSet = CreateObject("ADODB.Recordset")
    'フィールド(ファイル名)
    fileDataSet.Fields.Append "FILENAME", 200, 300, 32
    'フィールド(取込日時)
    fileDataSet.Fields.Append "FILETIME", 200, 300, 32
    'レコードセットオープン
    fileDataSet.Open
    '-----------------------------------------------------------
    '2.フォルダに存在するすべてのファイル名を取得する
    '-----------------------------------------------------------
    '-- GetFolderでパスを取得しAdoに格納
    For Each file In fso.GetFolder(imageFolder).files
        'ファイルの拡張子がjpg、jpeg、gifのファイルだけ取得する
        If (LCase(file.name) Like "*.jpg") Or (LCase(file.name) Like "*.jpeg") Or (LCase(file.name) Like "*.gif") Then
            '行追加
            fileDataSet.AddNew
            'ファイル名をセット
            fileDataSet.Fields(0) = file.name
            '取込日時をセット(フォーマット変換する)
            fileDataSet.Fields(1) = Format(file.DateLastModified, "yyyy/mm/dd hh:mm")
            '行をレコードセットに更新
            fileDataSet.Update
        End If
    Next
    'ファイルが1件でも取得できたら処理をする
    If fileDataSet.RecordCount > 0 Then
        '取得したファイル一覧を更新日の降順でソートし直す
        fileDataSet.Sort = "FILETIME DESC"
        fileDataSet.MoveFirst
    End If
    'Recordsetの件数分、内容を追加していく
    Do Until fileDataSet.EOF
        '-----------------------------------------------------------
        '3.画像を画面に表示する
        '-----------------------------------------------------------
        '枠線用ラベル追加
        With FrameImage.Controls.Add("Forms.Label.1")
            '左位置指定
            .Left = ((ImageCount Mod HCount) * imageWidth)
            If (ImageCount \ HCount) < 1 Then
                .Top = (rowCount * CheckBoxHeight) '上位置指定
            Else
                .Top = ((rowCount * CheckBoxHeight) + (rowCount * imageHeight) + (rowCount * labelHeight)) - 1
            End If
            '幅指定
            .Width = imageWidth + 1
            '高さ指定
            .Height = (CheckBoxHeight + imageHeight + labelHeight) + 1
            .name = "W_Lbl" & ImageCount
        End With
        'フラグがTrueの場合はチェックボックスを追加する
        With FrameImage.Controls.Add("Forms.CheckBox.1", "Chk_Select_Image" & ImageCount) 'チェックボックス追加
            .Left = (ImageCount Mod HCount) * imageWidth + 1 '左位置指定
            If (ImageCount \ HCount) < 1 Then
                .Top = (rowCount * CheckBoxHeight) + 1 '上位置指定
            Else
                .Top = (rowCount * CheckBoxHeight) + (rowCount * imageHeight) + (rowCount * labelHeight)
            End If
            .Width = CheckBoxWidth '幅指定
            .Height = CheckBoxHeight '高さ指定
            .name = "Chk_Select_Image" & ImageCount '名前
            .Tag = imageFolder & "\" & fileDataSet.Fields(0)   'タグにはファイル名を入れる
            If ModuleReceipt.ImageViewOpenFlg = False Then
                .Visible = False
            End If
        End With
        'イメージ追加
        With FrameImage.Controls.Add("Forms.Image.1", "IMAGE_VIEW" & ImageCount)
        'サムネイル化
            '画像が読み込めなかった場合に備える
            On Error Resume Next
                '画像読み込み
                .Picture = LoadPicture(imageFolder & "\" & fileDataSet.Fields(0), imageWidth, imageHeight)
            'エラートラップ解除
            On Error GoTo 0
            '左位置指定
            .Left = (ImageCount Mod HCount) * imageWidth
            If rowCount < 1 Then
            '上位置指定
            .Top = (rowCount * imageHeight) + CheckBoxHeight
            Else
            '上位置指定
            .Top = (rowCount * CheckBoxHeight) + (rowCount * imageHeight) + (rowCount * labelHeight) + CheckBoxHeight
            End If
            '幅指定
            .Width = imageWidth + 1
            '高さ指定
            .Height = imageHeight
            '表示方法指定(元画像の縦横比を崩さずに縮小または拡大して全部を表示)
            .PictureSizeMode = fmPictureSizeModeZoom
            '名前を設定
            .name = "IMAGE_VIEW" & ImageCount
            '画像のフルパスをtagに保存(クリックされた時に開くファイル)
            .Tag = imageFolder & "\" & fileDataSet.Fields(0)
        End With
        'ラベル追加
        With FrameImage.Controls.Add("Forms.Label.1")
            '左位置指定
            .Left = (ImageCount Mod HCount) * imageWidth + 1
            '1行目だけ処理分岐
            If rowCount < 1 Then
                '上位置指定
                .Top = (rowCount * imageHeight) + imageHeight + CheckBoxHeight
            Else
                '上位置指定
                .Top = (rowCount * CheckBoxHeight) + (rowCount * imageHeight) + (rowCount * labelHeight) + imageHeight + CheckBoxHeight
            End If
            '表示する内容
            .Caption = fileDataSet.Fields(0)
            '幅指定
            .Width = imageWidth - 1
            '高さ指定
            .Height = labelHeight - 1.5
            .name = "FILE_NAME" & ImageCount
        End With
        
        '表示イメージ数+1
        ImageCount = ImageCount + 1
        '3画像毎に1行追加
        If ImageCount Mod 3 = 0 Then
            rowCount = rowCount + 1
        End If
        '次の行へ
        fileDataSet.MoveNext
    Loop
    'フレームの設定
    With FrameImage
        'スクロールバー表示
        .ScrollBars = fmScrollBarsBoth
        '全体の幅設定
        .ScrollWidth = imageWidth * HCount
        '全体の高さ設定
        .ScrollHeight = ((imageHeight + labelHeight + CheckBoxHeight) * ((ImageCount - 1) \ HCount + 1)) + 1
    End With
    Set fso = Nothing
    Set fileDataSet = Nothing
    
    'クラスを適用する
    Dim i As Long
    ReDim myImage(0 To ImageCount)
    For i = 0 To ImageCount - 1
        '画像にクリックイベントを追加する
        Set myImage(i) = New ClsImageView
        Set myImage(i).Image = Me.Controls("IMAGE_VIEW" & CStr(i))
        '中枠用ラベルに罫線を入れる
        Me.Controls("W_Lbl" & CStr(i)).BorderStyle = fmBorderStyleSingle
        'フォント指定
        Me.Controls("FILE_NAME" & CStr(i)).Font.name = "MS UI Gothic"
        Me.Controls("FILE_NAME" & CStr(i)).Font.Size = 12
    Next i
    '一括選択
    If ModuleReceipt.SelectChkKbn = 1 Then
        Call Btn_Select_All_Click
    End If
    
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Close_Click
' 機  能 ： 閉じるボタンの処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Close_Click()
On Error GoTo Error_Btn_Close_Click:

    Const ACTION_NAME = "閉じるボタン"
    '区分セット
    FrmCloseKbn = 0
    '画面終了
    Unload frmImageView

    Exit Sub

Error_Btn_Close_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Goto_ReceiptSheet_Click
' 機  能 ： 領収書管理へボタンの処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Goto_ReceiptSheet_Click()
On Error GoTo Error_Btn_Goto_ReceiptSheet_Click:

    Const ACTION_NAME = "領収書管理へボタン"
    
    '確認ダイアログ表示
    If (GetMessageBox(MESSAGE_G081, DIALOG_TITLE) = False) Then
        Exit Sub
    End If
   
    '区分セット
    FrmCloseKbn = 1
    '画面終了
    Unload frmImageView

    Exit Sub

Error_Btn_Goto_ReceiptSheet_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Clear_All_Click
' 機  能 ： 一括解除ボタンの処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Clear_All_Click()
On Error GoTo Error_Btn_Clear_All_Click:

    Const ACTION_NAME = "一括解除ボタン"
    Dim i As Long
    If ImageCount > 0 Then
        For i = 0 To ImageCount - 1
            'チェックを外す
            Me.Controls("Chk_Select_Image" & CStr(i)).value = False
        Next i
    End If

    Exit Sub

Error_Btn_Clear_All_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Select_All_Click
' 機  能 ： 一括選択ボタンの処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Select_All_Click()
On Error GoTo Error_Btn_Select_All_Click:

    Const ACTION_NAME = "一括選択ボタン"
    Dim i As Long
    If ImageCount > 0 Then
        For i = 0 To ImageCount - 1
            'チェックを付ける
            Me.Controls("Chk_Select_Image" & CStr(i)).value = True
        Next i
    End If

    Exit Sub

Error_Btn_Select_All_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Make_Pdf_Click
' 機  能 ： 作成ボタンの処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Make_Pdf_Click()
On Error GoTo Error_Btn_Make_Pdf_Click:

    Const ACTION_NAME = "作成ボタン"
    
    Dim i As Long
    Dim fileCnt As Long
    Dim ZIP_File As Variant
    Dim zipName As String
    Dim intResponse As Integer
    '初期化
    fileCnt = 0
    If ImageCount > 0 Then
        '初期化
        ReDim ModuleReceiptPDF.FileListAry(ImageCount)
        For i = 0 To ImageCount - 1
            If Me.Controls("Chk_Select_Image" & CStr(i)).value = True Then
                ModuleReceiptPDF.FileListAry(fileCnt) = Me.Controls("Chk_Select_Image" & CStr(i)).Tag
                fileCnt = fileCnt + 1
            End If
        Next i
        If fileCnt = 0 Then
            'ワーニングメッセージ［W180］を表示する
            Call GetMessageBox(MESSAGE_W180, DIALOG_TITLE)
            Exit Sub
        
        End If
        '最後に余計なものを削除
        ReDim Preserve ModuleReceiptPDF.FileListAry(fileCnt - 1)
        
        'ZIPファイル保存用ダイアログを出す
        If (GetMessageBox(MESSAGE_G082, DIALOG_TITLE) = False) Then
            Exit Sub
        End If

        '適当に名前を付ける
        zipName = "SYUUSI_PDF"
    
        'GetSaveAsFilenameメソッドを実行
        ZIP_File = Application.GetSaveAsFilename( _
                   InitialFileName:=FILE_ZIP_NAME, _
                   FileFilter:="ZIPファイル(*.zip),*.zip")
        If ZIP_File = False Then
            Exit Sub
        Else
            ZIP_FOLDER_PATH = ZIP_File
            '一応確認
            If ZIP_FOLDER_PATH = "" Then
                Exit Sub
            End If
            '上書き確認
            If isFileExists(ZIP_FOLDER_PATH) Then
                intResponse = MsgBox(ZIP_File & "　は既に存在します。上書きしますか？", _
                                     vbYesNo + vbQuestion + vbDefaultButton2, _
                                     "領収書提出用ファイル作成")
                If intResponse = vbNo Then
                    Exit Sub
                End If
            End If
        End If
        'イベントを無効にする
        Application.EnableEvents = False
        
        '変数定義
        Dim sfo As Object
        '処理で使用するオブジェクトの初期化
        Set sfo = CreateObject("Scripting.FileSystemObject")
        '古い同名圧縮ファイルがあったら削除する。
        If sfo.FileExists(ZIP_FOLDER_PATH) = True Then
            sfo.DeleteFile ZIP_FOLDER_PATH
        End If
        Set sfo = Nothing
        
        'PDF作成処理
        Call ModuleReceiptPDF.MakeReceiptPDF
        'メッセージ
        MsgBox "領収書提出用ファイルの作成が完了しました。"
        '作成後は画面を閉じる
        If frmMakeXML.MakeXMLFlg = True Then
            ModuleReceipt.FrmCloseKbn = 3
        Else
            ModuleReceipt.FrmCloseKbn = 2
        End If
        '画面終了
        Unload frmImageView
    Else
        'ワーニングメッセージ［W180］を表示する
        Call GetMessageBox(MESSAGE_W180, DIALOG_TITLE)
        Exit Sub
    End If
    'イベントを有効
    Application.EnableEvents = True
    
    Exit Sub

Error_Btn_Make_Pdf_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

-------------------------------------------------------------------------------
VBA MACRO ClsImageView.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ClsImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ClsImageView
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2014 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'画像クラス
Public WithEvents myImage As MSForms.Image
Attribute myImage.VB_VarHelpID = -1
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Image
' 機  能 ： 画像のプロパティを設定する
' 引  数 ： 画像コントロール
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Property Set Image(InstImage As MSForms.Image)
    Set myImage = InstImage
End Property
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： myImage_DblClick
' 機  能 ： 画像ダブルクリックの処理
' 引  数 ： クリックイベント
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub myImage_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
On Error GoTo Error_myImage_DblClick:
    Const ACTION_NAME As String = "画像押下時処理"
    
    If myImage.Tag <> "" Then   '画像のtag(フルパス)が設定されていたら
        '-----------------------------------------------------------
        '2.画像をWindows標準の画像閲覧ソフトで開く
        '-----------------------------------------------------------
        CreateObject("Wscript.Shell").Run ("""" & myImage.Tag & """")
    End If
    Exit Sub
Error_myImage_DblClick:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

-------------------------------------------------------------------------------
VBA MACRO ModuleChkAdr.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleChkAdr'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ModuleChkAdr
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2015 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/09  Ito　　            新規作成
' -------------------------------------------------------------------
'住所チェックモジュール
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------
'　定数
'----------------------------------------
Private Const TABLE_ZENKOKU = "ZENKOKU.CSV"     '都道府県と市区町村名を格納したCSVファイル名
Private Const TABLE_SEIREI = "SEIREI.CSV"       '政令指定都市の情報を格納したCSVファイル名
Private Const TABLE_KEN = "KEN.CSV"             '都道府県一覧
Private Const CON_EXTPROP = "text;HDR=No;FMT=Delimited"     'ADOのオプション設定
Private Const COL_PREF = "F1"                   '都道府県・市区町村CSVの「都道府県」のカラム名
Private Const COL_CITY = "F2"                   '都道府県・市区町村CSVの「市区町村」のカラム名
Private Const COL_SEIREI_CITY = "F1"            '政令指定都市CSVの「都市」のカラム名
Private Const COL_SEIREI_TOWN = "F2"            '政令指定都市CSVの「町名」のカラム名
Private Const COL_KEN_KEN = "F2"                '都道府県CSVの「都道府県」のカラム名
Public dblMessageFontSize As Double             'エラーメッセージ(セルのコメント)のフォントサイズ
Public Const PREFIX_ERROR = "E"
Public Const PREFIX_WARNING = "W"
Public Const COLORINDEX_ERROR As Long = 38
Public Const COLORINDEX_WARNING As Integer = 40
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CHK_ADR
' 機  能 ： 住所欄が含まれているかチェックする
' 引  数 ： ワークシート名
'           対象セル
' 返り値 ： True:住所欄 False:それ以外のセル
'-------------------------------------------------------------------
Public Sub CHK_ADR(ByVal sh As Worksheet, ByVal Target As Range)
On Error GoTo Error_CHK_ADR:
    Dim column As Long
    column = -1
    If blnNoChkAdr = True Then
        Exit Sub
    End If
    'Targetに住所欄が含まれているかチェック
    If ((ModuleChkAdr.IsAdrCol(sh, Target, column))) Then
        'チェック対象の列の位置を取得出来た場合のみ
        If column > 0 Then
            If CheckCSVFile = "" Then
                Exit Sub
            End If
            '住所チェックを行う
            Call ModuleChkAdr.CheckCol(sh, Target, column)
        End If
    End If
    Exit Sub
Error_CHK_ADR:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CheckReceiptFile
' 機  能 ： 住所CSVが使用可能かチェックする
' 引  数 ： 無し
' 返り値 ： 正常：CSVのフルパス
'        ： エラー：空文字("")
'-------------------------------------------------------------------
Public Function CheckCSVFile() As String
    
On Error GoTo Error_CheckReceiptFile:
    
    Const MESSAGE_TITLE As String = "住所チェック"
    Dim strTemplateFolderPath As String
    Dim strCSVFolderPath As String
    Dim strCSVFilePath As String
    Dim strMessage As String
    Dim checkReceiptFile As String
    
    'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
    If ThisWorkbook.pATH = "" Then
        If ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value = "" Then
            Exit Function
        End If
        '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
        '会計帳簿から渡されたパスをこのブックのパスとする
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value, TEMPLATE_FOLDER_NAME)
        
    Else
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.pATH, TEMPLATE_FOLDER_NAME)
        
    End If
    'テンプレートフォルダが存在するか
    If isFolderExists(strTemplateFolderPath) = False Then
        Call GetMessageBox(MESSAGE_S025 & vbCrLf & vbCrLf & "詳細な対応方法は「FAQ」シートを参照してください。", MESSAGE_TITLE, TEMPLATE_FOLDER_NAME)
        Exit Function
    End If
    
    'CSVフォルダのパスを取得（このブックと同じフォルダ）
    strCSVFolderPath = UnionFilePathAndName(strTemplateFolderPath, "CSV")
    
    'テンプレートフォルダが存在するか
    If isFolderExists(strCSVFolderPath) = False Then
        Call GetMessageBox(MESSAGE_S025_1, MESSAGE_TITLE, TEMPLATE_FOLDER_NAME)
        Exit Function
    End If
    
    'CSVのファイルパス
    strCSVFilePath = UnionFilePathAndName(strCSVFolderPath, TABLE_KEN)
    'CSVが存在するか
    If isFileExists(strCSVFilePath) = False Then
        strMessage = TEMPLATE_FOLDER_NAME & ";" & TABLE_KEN
        Call GetMessageBox(MESSAGE_S002, MESSAGE_TITLE, strMessage)
        Exit Function
    End If
    'CSVのファイルパス
    strCSVFilePath = UnionFilePathAndName(strCSVFolderPath, TABLE_SEIREI)
    'CSVが存在するか
    If isFileExists(strCSVFilePath) = False Then
        strMessage = TEMPLATE_FOLDER_NAME & ";" & TABLE_SEIREI
        Call GetMessageBox(MESSAGE_S002, MESSAGE_TITLE, strMessage)
        Exit Function
    End If
    'CSVのファイルパス
    strCSVFilePath = UnionFilePathAndName(strCSVFolderPath, TABLE_ZENKOKU)
    'CSVが存在するか
    If isFileExists(strCSVFilePath) = False Then
        strMessage = TEMPLATE_FOLDER_NAME & ";" & TABLE_ZENKOKU
        Call GetMessageBox(MESSAGE_S002, MESSAGE_TITLE, strMessage)
        Exit Function
    End If
    
    'リターン値設定
    CheckCSVFile = strCSVFilePath
    Exit Function
Error_CheckReceiptFile:
    '初期化
    checkReceiptFile = ""

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： IsAdrCol
' 機  能 ： セルが住所欄かを判定する
' 引  数 ： ワークシート名
'           対象セル
'           住所欄のカラム位置
' 返り値 ： True:住所欄 False:それ以外のセル
'-------------------------------------------------------------------
Public Function IsAdrCol(ByVal sh As Worksheet, ByVal Target As Range, ByRef TargetColumn As Long) As Boolean

On Error GoTo Error_IsAdrCol:
   
    Dim WorkName
    Dim adrName As String
    Dim i As Long
    Dim nTarget As Range
    Select Case sh.name
        Case "その1"
            '団体情報の場合はチェック方法が違う
            '団体情報の場合で「所在地」の場合のみ
            For i = 1 To Target.Count
                '対象の行列の位置が「所在地」のセルと全く同一の場合のみ住所チェックを行う
                If (Target(i).column = sh.Range("JIM_ADR").column) And (Target(i).Row = sh.Range("JIM_ADR").Row) Then
                    If CheckCSVFile = "" Then
                        Exit Function
                    End If
                    '対象シートの保護解除(セルのコメントを操作するため)
                    Call UnlockOneSheet(sh)
                    dblMessageFontSize = 12
                    '住所欄の場合のみで値が入っている場合は住所チェック
                    If Target(i).value <> "" Then
                        '一旦初期化する
                        Target(i).ClearComments
                        Target(i).Interior.ColorIndex = xlColorIndexNone
                        '住所チェック実施
                        If CheckAddress(Target(i).value) < 0 Then
                            'エラーなので該当行をエラーとする
                            Call SetError(Target(i), MESSAGE_W173)
                        End If
                    Else
                        '空白の場合はコメントと背景色を元に戻す
                        Target(i).ClearComments
                        Target(i).Interior.ColorIndex = xlColorIndexNone
                    End If
                    '対象シートロック設定
                    Call LockOneSheet(sh)
                    'これ以上はチェックする必要がないので処理を抜ける
                    Exit For
                End If
            Next
            '個別チェック済みなのでFalseで返す
            IsAdrCol = False
            TargetColumn = -1
            Exit Function
        Case Else
            '-------------------------------------------
            '上記のシート以外で、その7、8、11、12、14、15のみ
            '-------------------------------------------
            If (sh.name Like "*その7*") Or (sh.name Like "*その8*") Or (sh.name Like "*その11*") Or _
               (sh.name Like "*その12*") Or (sh.name Like "*その14*") Or (sh.name Like "*その15*") Then
                '修正カラムにADRの文字が入っている場合のみ
                adrName = ""
                For Each WorkName In sh.Names
                    If (WorkName.name Like "*ADR") Then
                        adrName = WorkName.name
                        Exit For
                    End If
                Next
                '修正セル情報が取得出来た場合のみ住所欄チェックを行う
                If adrName <> "" Then
                    '住所欄
                    IsAdrCol = True
                    TargetColumn = sh.Range(adrName).column
                    Exit Function
                End If
            
            End If
    End Select
    Exit Function

Error_IsAdrCol:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CheckCol
' 機  能 ： セルが住所欄かを判定する
' 引  数 ： ワークシート名
'           対象セル
'           住所欄のカラム位置
' 返り値 ： True:住所欄 False:それ以外のセル
'-------------------------------------------------------------------
Public Sub CheckCol(ByVal sh As Worksheet, ByVal Target As Range, ByVal TargetColumn As Long)
    
On Error GoTo Error_CheckCol:
    
    If Not Target Is Nothing Then
        Dim i As Long
        Dim nTarget As Range
'        '対象シートロック設定
'        Call LockOneSheet(Sh)
        'コメントのフォントサイズ指定
        dblMessageFontSize = 12
        For i = 1 To Target.Count
            '引数の住所欄のカラム位置と対象のカラム位置が同じか？ついでに5行以上の場合のみ
            If Target(i).column = TargetColumn And Target(i).Row > 5 Then
                '住所欄の場合のみで値が入っている場合は住所チェック
                If Target(i).value <> "" Then
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 START
                    '対象シートの保護解除(セルのコメントを操作するため)
                    Call UnlockOneSheet(sh)
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 END
                    '一旦初期化する
                    Target(i).ClearComments
                    Target(i).Interior.ColorIndex = xlColorIndexNone
                    '住所チェック実施
                    If CheckAddress(Target(i).value) < 0 Then
                        'エラーなので該当行をエラーとする
                        Call SetError(Target(i), MESSAGE_W173)
                    End If
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 START
                    '対象シートロック設定
                    Call LockOneSheet(sh)
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 END
                Else
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 START
                    If Not Target(i).Comment Is Nothing Then
                        '対象シートの保護解除(セルのコメントを操作するため)
                        Call UnlockOneSheet(sh)
                        '空白の場合はコメントと背景色を元に戻す
                        Target(i).ClearComments
                        Target(i).Interior.ColorIndex = xlColorIndexNone
                        '対象シートロック設定
                        Call LockOneSheet(sh)
                    End If
'ADD 2015/03/13 Fujitsu)Ito H27政治資金 END
'                    '空白の場合はコメントと背景色を元に戻す
'                    target(i).ClearComments
'                    target(i).Interior.ColorIndex = xlColorIndexNone
                End If
            End If
        Next
'        '対象シートロック設定
'        Call LockOneSheet(Sh)
    End If
    Exit Sub
Error_CheckCol:

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： LockOneSheet
' 機  能 ： 指定したシートに対し、シートの保護をかける
' 引  数 ： ワークシート名
' 返り値 ： 指定なし
'-------------------------------------------------------------------
Public Function LockOneSheet(wksSheet As Worksheet)
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    Dim actSheet As Worksheet
    Set actSheet = ActiveSheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
    wksSheet.Protect Password:=ProtectPass, UserInterfaceOnly:=True
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    actSheet.Activate
    Set actSheet = Nothing
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： UnlockOneSheet
' 機  能 ： 指定したシートに対し、シートの保護をかける
' 引  数 ： ワークシート名
' 返り値 ： 指定なし
'-------------------------------------------------------------------
Public Function UnlockOneSheet(wksSheet As Worksheet)
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    Dim actSheet As Worksheet
    Set actSheet = ActiveSheet
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
    wksSheet.Unprotect Password:=ProtectPass
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 START
    actSheet.Activate
    Set actSheet = Nothing
'ADD 2015/01/16 Fujitsu)Ito H27政治資金 END
End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： SetError
' 機  能 ： セルの背景色を変更する
'        ： 引数のboolErrorがTrueであれば背景色を設定し、
'        ： Falseであれば背景色を元に戻す
' 引  数 ： (in)  rngCHK … 処理対象セルオブジェクト
'        ： (out) boolError            … エラーがあればTrueが格納される
'        ： (in)  boolLowlightColor … エラーで無い場合、lngLowlightColorを設定する場合True
'        ： (in)  lngHighlightColor … エラーの場合の背景色
'        ： (in)  lngLowlightColor … エラーでない場合の背景色
'-------------------------------------------------------------------
Public Sub SetError(rngTarget As Range, strMessageCode As String, ParamArray strBindArray() As Variant)

    Dim strMessage As String
    Dim strTemp    As String
    Dim i          As Long
    Dim lngMsgCnt  As Long

    strMessage = strMessageCode
    '埋め込み文字列が指定されていれば、埋め込む
    If Not IsEmpty(strBindArray) Then
        For i = 0 To UBound(strBindArray)
            strMessage = Replace$(strMessage, "(%" & CStr(i + 1) & ")", strBindArray(i))
        Next i
    End If

    'ワーニングかどうか
    If Left$(strMessageCode, 1) = PREFIX_WARNING Then
        rngTarget.Interior.ColorIndex = COLORINDEX_WARNING
    Else
        rngTarget.Interior.ColorIndex = COLORINDEX_ERROR
    End If

    'メッセージ中の改行コードはLFとする必要があるため、念のためCRLF→LFに置換
    '(※CRLFとすると、Excel 2000で「・」に化ける)
    strMessage = Replace$(strMessage, vbCrLf, vbLf)
    'メッセージからコード部を削除
    strMessage = Mid(strMessage, 7, Len(strMessage))
    'コメントを設定
    If rngTarget.Comment Is Nothing Then

        rngTarget.AddComment strMessage     '注意：シートが保護状態でないこと（保護状態だとコメントが付加されない）
        rngTarget.Comment.Visible = False
        rngTarget.Comment.Shape.TextFrame.AutoSize = True

        With rngTarget.Comment.Shape.TextFrame.Characters.Font
            .Size = dblMessageFontSize
        End With
    Else
        '既にエラー等が設定されていれば、その下に追記する
        rngTarget.Comment.Text rngTarget.Comment.Text & vbLf _
            & "------------------------------------------------" & vbLf _
            & strMessage
    End If
    If rngTarget.Parent.name <> "" Then
        'エラー箇所のシート名が取得出来たら格納する
        Call setMovePoint(ErrMovePoint, rngTarget.Parent.name, rngTarget.Address)
    End If

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CheckAddress
' 機  能 ： 住所チェック
' 引  数 ： 住所
' 返り値 ： 0：正常 -1：エラー
'-------------------------------------------------------------------
Public Function CheckAddress(inAddress As String) As Long

On Error GoTo Error_CheckAddress:
    'ADODBとの接続用
    Dim adoConect As Object
    'レコードセット
    Dim recAddress As Object
    'SQL文
    Dim sqlAddress As String
    'SQLのリターン
    Dim resultSql As Boolean
    Dim CON_STR As String
    Dim strTemplateFolderPath As String
    
    '初期化(エラーにしておいて、正常終了になったら0にする)
    CheckAddress = -1
    resultSql = True

    '空白の場合は処理を抜ける
    If inAddress = "" Then
        CheckAddress = 0
        Exit Function
    End If
    
    'ADOの指定 CSVファイルはtemplateフォルダ以下にある想定
    'テンプレートフォルダのパスを取得（このブックと同じフォルダ）
    If ThisWorkbook.pATH = "" Then
        '会計帳簿から作成されて保存していない状態の場合は、このブックのパスが不定のため、
        '会計帳簿から渡されたパスをこのブックのパスとする
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.Worksheets("メニュー").Range("KAIKEI_FILE_PATH").value, TEMPLATE_FOLDER_NAME)
    Else
        strTemplateFolderPath = UnionFilePathAndName(ThisWorkbook.pATH, TEMPLATE_FOLDER_NAME)
    End If

#If Win64 Then '64ビット版
    CON_STR = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" & strTemplateFolderPath & "\CSV" & ";"
#Else '32ビット版
    CON_STR = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & strTemplateFolderPath & "\CSV" & ";"
#End If
    
    Set adoConect = CreateObject("ADODB.Connection")
    '接続情報を格納
    With adoConect
        .ConnectionString = CON_STR
        .Properties("Extended Properties").value = CON_EXTPROP
        .Open
    End With
    'レコードセット宣言
    Set recAddress = CreateObject("ADODB.Recordset")
    '初期化
    sqlAddress = ""
    
    '全国住所における存在チェック
    sqlAddress = " SELECT [F1] " & _
                 " FROM " & TABLE_KEN & _
                 " WHERE '" & inAddress & "' LIKE " & COL_KEN_KEN & " & '%'"
    'SQL実行
    recAddress.Open sqlAddress, adoConect
    '返答取得
    resultSql = recAddress.EOF
    '初期化
    recAddress.Close
    If Not (resultSql) Then    '都道府県の入力あり
        'SQL組み立て
        sqlAddress = " SELECT [F1] " & _
                     " FROM " & TABLE_ZENKOKU & _
                     " WHERE '" & inAddress & "' LIKE " & COL_PREF & " & " & COL_CITY & " & '%'"
        'SQL実行
        recAddress.Open sqlAddress, adoConect
        If recAddress.EOF Then '一致しなかったらエラー
            'NG
            GoTo ExitProcedure
        End If
    Else                    '都道府県の入力なし
        'SQL組み立て
        sqlAddress = " SELECT [F1] " & _
                     " FROM " & TABLE_ZENKOKU & _
                     " WHERE '" & inAddress & "' LIKE " & COL_CITY & " & '%'"
        'SQL実行
        recAddress.Open sqlAddress, adoConect
        If recAddress.EOF Then
            GoTo ExitProcedure
        End If
    End If
    
    '初期化
    sqlAddress = ""
    recAddress.Close
    
    '政令指定都市チェック
    '政令指定都市でなければTrueで終了
    sqlAddress = " SELECT [F1] " & _
                 " FROM " & TABLE_SEIREI & _
                 " WHERE '" & inAddress & "' LIKE '%' & " & COL_SEIREI_CITY & " & '%'"
    recAddress.Open sqlAddress, adoConect
    If recAddress.EOF Then
        '正常終了
        CheckAddress = 0
        GoTo ExitProcedure
    End If
    
    '初期化
    recAddress.Close

    '政令指定都市なら区の存在チェック
    sqlAddress = " SELECT [F1] " & _
                 " FROM " & TABLE_SEIREI & _
                 " WHERE '" & inAddress & "' LIKE '%' & " & COL_SEIREI_CITY & " & " & COL_SEIREI_TOWN & " & '%'"
    recAddress.Open sqlAddress, adoConect
    If Not (recAddress.EOF) Then
        '正常終了
        CheckAddress = 0
        GoTo ExitProcedure
    End If

    'イベントを無効解除
    Application.EnableEvents = True
    '正常終了
    CheckAddress = 0
    GoTo ExitProcedure

ExitProcedure:
    '後始末
    Set recAddress = Nothing
    Set adoConect = Nothing
    
    Exit Function

Error_CheckAddress:
    CheckAddress = -1

    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
    GoTo ExitProcedure

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
-------------------------------------------------------------------------------
VBA MACRO ModuleErrorMove.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleErrorMove'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ModuleReceipt
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2014 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'エラー時の遷移先情報格納用
Public Type ErrorMovePoint
    strSheet    As String   'シート名
    strName     As String   '遷移先
End Type
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------------------------------
' 関数名 ： setMovePoint
' 機　能 ： 遷移先設定
' 引　数 ： ErrorMovePoint   ･･･ 構造体(遷移先情報格納用)
'           strSheet         ･･･ 文字列(遷移先シート名)
'           strName          ･･･ 文字列(遷移先セル名(名前定義 or セル位置))
' 戻り値 ： 無し
'----------------------------------------------------------------
Public Sub setMovePoint(ByRef ErrMovePoint As ErrorMovePoint, ByVal strSheet As String, ByVal strName As String)
    
    If (strSheet = "" Or strName = "" Or IsNull(strSheet) Or IsNull(strName)) Then
        Exit Sub
    End If
    
    '未設定の場合は遷移先を設定する
    If ErrMovePoint.strSheet = "" And ErrMovePoint.strName = "" Then
        ErrMovePoint.strSheet = strSheet 'シート名を設定
        ErrMovePoint.strName = strName   '遷移先セルを設定
    End If
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

-------------------------------------------------------------------------------
VBA MACRO Sheet57.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet57'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
-------------------------------------------------------------------------------
VBA MACRO frmMakeXML.frm 
in file: xl/vbaProject.bin - OLE stream: 'VBA/frmMakeXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : frmMakeXML
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2014 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'作成対象指定ダイアログ
Private Const DIALOG_TITLE As String = "作成対象指定"
'作成対象のフラグ
Public MakeXMLFlg As Boolean            'XML作成フラグ（True：XML作成処理を行う。False：XML作成処理を行わない）
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： UserForm_Initialize
' 機  能 ： 初期表示処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub UserForm_Initialize()
On Error GoTo Error_UserForm_Initialize:

    Const ACTION_NAME = "作成対象指定"
    
    '画面の初期設定
    '収支報告書のXMLファイルを作成する=ON
    Chk_Make_Xml.value = True

    '領収書提出用ファイルを作成する=ON
    Chk_Make_Pdf.value = True
    
    Exit Sub

Error_UserForm_Initialize:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Make_Click
' 機  能 ： 作成ボタン押下時
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Make_Click()
On Error GoTo Error_Btn_Make_Click:

    Const ACTION_NAME = "作成ボタン"

    'チェックボックスの状態を判定
    '1-1-1.項目名「Chk_Make_Xml」と項目名「Chk_Make_Pdf」の両方のチェックがOffの場合
    If Chk_Make_Xml.value = False And Chk_Make_Pdf.value = False Then
        'ワーニングメッセージ［W023］を表示する
        Call GetMessageBox(MESSAGE_W023, DIALOG_TITLE)
        Exit Sub
    Else
        'XML作成の判定
        If Chk_Make_Xml.value = True Then
            'XML作成する
            MakeXMLFlg = True
        Else
            'XML作成しない
            MakeXMLFlg = False
        End If
        'PDF作成判定
        If Chk_Make_Pdf.value = True Then
            '領収書画像一覧表示フラグをONに
            ModuleReceipt.ImageViewOpenFlg = True
            '2019/06/13 個別作成機能削除（一括作成固定）
            '一括
            ModuleReceipt.SelectChkKbn = 1
            
            '領収書画像一覧起動
            frmImageView.Show
            
            '閉じるボタンでのリターンの場合
            If ModuleReceipt.FrmCloseKbn = 0 Then
                Exit Sub
            ElseIf ModuleReceipt.FrmCloseKbn = 1 Then
                '領収書管理画面へ遷移の場合
                Unload frmMakeXML
                Exit Sub
            Else
                'XML作成
                Unload frmMakeXML
                Exit Sub
            End If
        Else
            'PDF作成しないので画面を終了してXML作成を行う
            ModuleReceipt.FrmCloseKbn = 3
            Unload frmMakeXML
            Exit Sub
        End If
    End If
    Exit Sub

Error_Btn_Make_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： Btn_Cancel_Click
' 機  能 ： キャンセルボタン押下時
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub Btn_Cancel_Click()
On Error GoTo Error_Btn_Cancel_Click:

    Const ACTION_NAME = "キャンセルボタン"
    '画面を閉じる
    Unload frmMakeXML

    Exit Sub

Error_Btn_Cancel_Click:
    ' 共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException(ACTION_NAME)
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

-------------------------------------------------------------------------------
VBA MACRO ModuleReceiptPDF.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleReceiptPDF'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ModuleReceiptPDF
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2015 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'領収書PDF作成モジュール
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------
'　定数
'----------------------------------------
Private Const SHEET_MAKE_PDF As String = "MakePDF"
Private Const ZIP_WAIT_TIME As Single = 1         'ZIP作成時に使用。ZIP作成は非同期なのでチェックの為に処理を止める秒数
'----------------------------------------
'　変数
'----------------------------------------
Public FileListAry() As String
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： MakeReceiptPDF
' 機  能 ： PDF作成処理
' 引  数 ： 無し
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub MakeReceiptPDF()
On Error GoTo Error_MakeReceiptPDF:

    Dim myF As Variant
    Dim mySp As Object
    Dim myAD1 As String
    Dim myAD2 As String
    Dim myHH As Double
    Dim myWW As Double
    Dim myHH2 As Double
    Dim myWW2 As Double
    Dim pATH As String
    Dim cnt As Long
    Dim file As String
    Dim pdfCount As Integer
    Dim i As Integer
    Dim objFileSys
    Dim objWBK As Workbook
    Dim objSH As Worksheet
    Dim Target As Range
    Dim folderPathPDF As String
    Dim fso As Object
    '圧縮対象のファイル
    Dim files()
    Dim tmp_Path As String
    Dim tmp_Path2 As String
    
    'シート情報取得
    Set objWBK = ThisWorkbook
    Set objSH = objWBK.Worksheets(SHEET_MAKE_PDF)
    Set Target = objSH.Range("A1:L72")
    Set objFileSys = CreateObject("Scripting.FileSystemObject")
    '配列の件数が0件なら処理を抜ける
    If UBound(FileListAry) < 0 Then
        Exit Sub
    Else
        ReDim files(UBound(FileListAry))
    End If
    'フォルダがなかったら自動的に作成する
    folderPathPDF = ThisWorkbook.pATH & "\PDF"
    If isFolderExists(folderPathPDF) = False Then
        MkDir folderPathPDF
    End If
    '画面描画OFF
    Call ScreenRedraw(False)
    Call bUnlock                    'ブックの保護を解除
    'イベントを無効にする
    Application.EnableEvents = False
    'PDF変換用シートの非表示を解除
    objSH.Visible = True
    'シートのロック解除
    Call UnlockOneSheet(objSH)

    '初期化
    cnt = 0
    For i = 0 To UBound(FileListAry)
        '最初のファイル名取得
        file = FileListAry(i)
        'ファイルの拡張子がjpg、jpeg、gifのファイルだけ取得する
        If (LCase(file) Like "*.jpg") Or (LCase(file) Like "*.jpeg") Or (LCase(file) Like "*.gif") Then
            tmp_Path = file
            'ファイル存在チェック
            If isFileExists(tmp_Path) = True Then
                'ファイル名から拡張子だけを除外する
                tmp_Path2 = objFileSys.GetBaseName(tmp_Path)
                'PDF保存先
                tmp_Path2 = folderPathPDF & "\" & tmp_Path2
                
                '===============画像の掃除
                For Each mySp In objSH.Shapes
                    myAD1 = mySp.TopLeftCell.MergeArea.Address
                    myAD2 = Target.Address
                    If myAD1 = myAD2 Then
                        mySp.Delete
                    End If
                Next
                '===============画像の貼り付け
                Set mySp = objSH.Shapes.AddPicture(Filename:=tmp_Path, LinkToFile:=False, _
                    SaveWithDocument:=True, _
                    Left:=Target.Left, _
                    Top:=Target.Top, _
                    Width:=0, Height:=0)    '★一旦縦横０で。
                mySp.ScaleHeight 1, msoTrue '★元のサイズに戻す
                mySp.ScaleWidth 1, msoTrue  '★元のサイズに戻す
                '===============タテヨコの縮尺を保持
                mySp.LockAspectRatio = True
                '横を調整
                If mySp.Width > Target.Width Then
                    mySp.Width = Target.Width
                End If
                '縦を調整
                If mySp.Height > Target.Height Then
                    mySp.Height = Target.Height
                End If
                '===============中央へ調整
                myHH2 = (Target.Height / 2) - (mySp.Height / 2)
                myWW2 = (Target.Width / 2) - (mySp.Width / 2)
                mySp.Top = Target.Top + myHH2
                mySp.Left = Target.Left + myWW2
                Set mySp = Nothing
                
                objSH.ExportAsFixedFormat Type:=xlTypePDF, _
                Filename:=tmp_Path2, _
                Quality:=xlQualityStandard, _
                IncludeDocProperties:=True, _
                IgnorePrintAreas:=False, _
                OpenAfterPublish:=False
                'PDFファイル名を格納
                files(i) = tmp_Path2 & ".pdf"
            End If
        End If
    Next
    '画像の掃除
    For Each mySp In objSH.Shapes
        myAD1 = mySp.TopLeftCell.MergeArea.Address
        myAD2 = Target.Address
        If myAD1 = myAD2 Then
            mySp.Delete
        End If
    Next
    'シートのロック解除
    Call LockOneSheet(objSH)
    'PDF変換用シートを非表示
    objSH.Visible = False
    '初期化
    Set objWBK = Nothing
    Set objSH = Nothing
    Set objFileSys = Nothing
    Set mySp = Nothing
    Set Target = Nothing
    Dim Folder(0)
    Folder(0) = folderPathPDF
    
    'ZIP作成
    'Call MakeZip(ZIP_FOLDER_PATH, files)
    Call MakeZip(ZIP_FOLDER_PATH, Folder)
    'ZIP作成後、PDFフォルダを削除する
    Set fso = CreateObject("Scripting.FileSystemObject")
    fso.DeleteFolder folderPathPDF, True
    Set fso = Nothing
    
    Call ScreenRedraw(True)
    Exit Sub
    
Error_MakeReceiptPDF:
    Set objWBK = ThisWorkbook
    Set objSH = objWBK.Worksheets(SHEET_MAKE_PDF)
    'PDF変換用シートを非表示
    objSH.Visible = False
    Set objWBK = Nothing
    Set objSH = Nothing
    Set objFileSys = Nothing
    Set mySp = Nothing
    Set Target = Nothing
    Set fso = Nothing
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： MakeZip
' 機  能 ： ZIP作成処理
' 引  数 ： ZIP保存先のパス
'　　　　　圧縮するファイル（配列）
' 戻り値 ： 無し
'-------------------------------------------------------------------
Private Sub MakeZip(ByVal ZipPath, ByRef FileArray)
    
On Error GoTo Error_MakeZip:
    
    'マウスアイコンを砂時計にする。
    Application.Cursor = xlWait
    '変数定義
    Dim sfo, app, file, zipFolder
    Dim num As Long
    Dim stmZipFile
    '処理で使用するオブジェクトの初期化
    Set sfo = CreateObject("Scripting.FileSystemObject")
    Set app = CreateObject("Shell.Application")
    
    'ファイルが存在していないことを確認する
    If sfo.FileExists(ZipPath) = False Then
        '空のzipファイルを作成する
        With sfo.CreateTextFile(ZipPath, True)
            .Write "PK" & Chr(5) & Chr(6) & String(18, 0)
            .Close
        End With
    End If
    '新規作成したzipファイルへ圧縮対象をコピーする
    num = 0
    For Each file In FileArray
        If CStr(file) <> "" Then
            'ZIPファイルのパスを変数に代入して、値（この場合はパス）に変化がないようにする。
            Set zipFolder = app.Namespace(sfo.GetAbsolutePathName(ZipPath))
            file = sfo.GetAbsolutePathName(file)
            'Zipフォルダに圧縮対象のファイルをコピーする
            zipFolder.CopyHere file
            'ファイル数をカウントアップ
            num = num + 1
            ' ZIP ファイルの圧縮は非同期で行われるため、ZIPファイルの件数と処理しているカウントを比較する
            Do Until zipFolder.Items().Count = num
                '件数不一致の場合は処理を待つ。
                Application.Cursor = xlWait
                Application.Wait (DateAdd("s", ZIP_WAIT_TIME, Now))
                Application.Cursor = xlWait
            Loop
            Set zipFolder = Nothing
        End If
    Next
    '初期化
    Set sfo = Nothing
    Set app = Nothing
    Set zipFolder = Nothing
    
    Application.Cursor = xlDefault      'マウスアイコンを元に戻す。
    
    Exit Sub

Error_MakeZip:
    '初期化
    Set sfo = Nothing
    Set app = Nothing
    Set zipFolder = Nothing
    Application.Cursor = xlDefault      'マウスアイコンを元に戻す。
    
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException

End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END
-------------------------------------------------------------------------------
VBA MACRO Sheet58.cls 
in file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet58'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

-------------------------------------------------------------------------------
VBA MACRO frmInsertRow.frm 
in file: xl/vbaProject.bin - OLE stream: 'VBA/frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Option Explicit


Private Const MAX_INSERT_ROW = 9999
Private Const MIN_INSERT_ROW = 1


Private Sub cmdCancel_Click()

    Me.Tag = ""

    Me.Hide

End Sub

Private Sub cmdRun_Click()

    If IsEmptyString(txtCount.Text) Then

        MsgBox "行数が入力されていません。" & vbCrLf & "1～9999の数値を入力してください。", vbOKOnly + vbExclamation, "行の追加"

        txtCount.SetFocus

    ElseIf IsValidNumber(txtCount.Text, MIN_INSERT_ROW, MAX_INSERT_ROW) Then

        Me.Tag = txtCount.Text

        Me.Hide

    Else

        MsgBox "入力された行数が正しくありません。" & vbCrLf & "1～9999の数値を入力してください。", vbOKOnly + vbExclamation, "行の追加"

        txtCount.SetFocus

    End If

End Sub

Private Sub spnCount_Change()

    If spnCount.value <> 0 Then

        txtCount.value = spnCount.value

    End If

End Sub

Private Sub txtCount_Change()

    ' スピンボタンに値を受け渡す
    If txtCount.value = "" Then

        'txtCount.value = 0

    Else

        On Error Resume Next

        spnCount.value = CLng(txtCount.value)

        On Error GoTo 0

    End If

End Sub

Private Sub UserForm_Initialize()

    With txtCount

        .SelStart = 0
        .SelLength = Len(.Text)

        .SetFocus

    End With

End Sub
-------------------------------------------------------------------------------
VBA MACRO ModuleChangeRow.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleChangeRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
' -------------------------------------------------------------------
' システム   : 政治資金・政党助成システムの更新等
' ファイル名 : ModuleChangeRow
' 開発担当   : 富士通（株）
'
' (C)Copyright FUJITSU 2015 All Rights Reserved.
'
' ご注意：本内容の一部または全部を無断で使用、転載することは
'         禁止されています。
'
' VERSION    DATE        BY                CHANGE/COMMENT
' -------------------------------------------------------------------
' 1.00       2014/12/19  Ito　　            新規作成
' -------------------------------------------------------------------
'15行毎に小計欄を追加するモジュール
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'----------------------------------------
'　定数
'----------------------------------------
Private Const SHEET_NAME1 As String = "*その1*"
Private Const SHEET_NAME2 As String = "*その2*"
Private Const SHEET_NAME3 As String = "*その3*"
Private Const SHEET_NAME4 As String = "*その4*"
Private Const SHEET_NAME5 As String = "*その5*"
Private Const SHEET_NAME6 As String = "*その6*"
Private Const SHEET_NAME7 As String = "*その7*"
Private Const SHEET_NAME8 As String = "*その8*"
Private Const SHEET_NAME9 As String = "*その9*"
Private Const SHEET_NAME10 As String = "*その10*"
Private Const SHEET_NAME11 As String = "*その11*"
Private Const SHEET_NAME12 As String = "*その12*"
Private Const SHEET_NAME14 As String = "*その14*"
Private Const SHEET_NAME15 As String = "*その15*"
Private Const SHEET_NAME16 As String = "*その16*"
Private Const SHEET_NAME18O As String = "*その18(5)*"
Private Const SHEET_NAME18KA As String = "*その18(6)*"
Private Const SHEET_NAME18KI As String = "*その18(7)*"
Private Const SHEET_NAME20 As String = "*その20*"
Private Const SHEET_NAME15Y As String = "*15号様式*"
Private Const VIEW_PAGESUM_STR As String = "こ　の　頁　の　小　計"     'この頁の小計の文言
Private Const PAGE_COUNT As Long = 15       '1ページの最大明細件数
'2020/12/10 Windows10対応によりずれが発生するようになったため戻し
'Private Const ROW_HIGHT As Single = 28.8   '明細の高さ(2017/3/6)Windows10対応。
'2020/12/10 ここまで
Private Const ROW_HIGHT As Single = 29.25   '明細の高さ
Public Const MSG_VIEW_COUNT As Long = 1000   '印刷時にメッセージを表示する基準の件数
Public Const MSG_VIEW_COUNT_T As Long = 3000 '印刷時にメッセージを表示する基準の件数(計算用）
'----------------------------------------
'　変数
'----------------------------------------
Public StopSheetChangeEvent As Boolean
Public wkSheetNameArray() As String         'ワーク用シートの名前一覧
Public sumPageCountPrint As Long            '印刷時の合計明細件数（頁の小計を追加するシートだけ）
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2015/01/21 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CountPageSum
' 機  能 ： 印刷する対象の明細件数を合算していく
' 引  数 ： 処理するワークシートの配列
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub CountPageSum(ByVal objSheet As Worksheet)
    
On Error GoTo Error_CountPageSum:
    
    Dim lngLastRow As Long
    '-------------------------------------------
    '定数に定められているシート名のみ処理を行う
    '-------------------------------------------
    If (objSheet.name Like SHEET_NAME3) Or _
        (objSheet.name Like SHEET_NAME4) Or _
        (objSheet.name Like SHEET_NAME5) Or _
        (objSheet.name Like SHEET_NAME6) Or _
        (objSheet.name Like SHEET_NAME7) Or _
        (objSheet.name Like SHEET_NAME8) Or _
        (objSheet.name Like SHEET_NAME9) Or _
        (objSheet.name Like SHEET_NAME10) Or _
        (objSheet.name Like SHEET_NAME11) Or _
        (objSheet.name Like SHEET_NAME12) Or _
        (objSheet.name Like SHEET_NAME14) Or _
        (objSheet.name Like SHEET_NAME15) Or _
        (objSheet.name Like SHEET_NAME16) Then
        
        '件数カウント
        '印刷範囲の調整
        lngLastRow = (objSheet.Range("行末").Row - objSheet.Range("行頭").Row) - 1
        If lngLastRow > 0 Then
            sumPageCountPrint = sumPageCountPrint + lngLastRow
        End If
    End If
    
    Exit Sub

Error_CountPageSum:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2015/01/21 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： ChkSheet
' 機  能 ： 小計欄を追加するシートか判定を行う
' 引  数 ： 処理するワークシート
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub ChkSheet(ByVal objSheet As Worksheet)
    
On Error GoTo Error_ChkSheet:
    Dim lngAddCnt As Long   '行末のカウント（合計行の上に行がある場合は＋１）
    Dim lngLastRow As Long
    '-------------------------------------------
    '定数に定められているシート名のみ処理を行う
    '-------------------------------------------
    'シートその3、その4、その5、その6、その9、その10、その14、その15、その16の場合（通し番号の無いシート）
    If (objSheet.name Like SHEET_NAME3) Or _
            (objSheet.name Like SHEET_NAME4) Or _
            (objSheet.name Like SHEET_NAME5) Or _
            (objSheet.name Like SHEET_NAME6) Or _
            (objSheet.name Like SHEET_NAME9) Or _
            (objSheet.name Like SHEET_NAME10) Or _
            (objSheet.name Like SHEET_NAME14) Or _
            (objSheet.name Like SHEET_NAME15) Or _
            (objSheet.name Like SHEET_NAME16) Then
        
        'その6、その14、その15は合計行の上に行がある
        If (objSheet.name Like SHEET_NAME6) Or _
            (objSheet.name Like SHEET_NAME14) Or _
            (objSheet.name Like SHEET_NAME15) Then
            lngAddCnt = 1
        Else
            lngAddCnt = 0
        End If
        
        Call SetCalcMode(False)              '自動計算OFF
        '15行毎に小計欄を追加する
        Call CreatePageSum(objSheet, lngAddCnt)
        Call SetCalcMode(True)              '自動計算ON
    
    'シートその7、その8、その11、その12の場合（通し番号があるシート）
    ElseIf (objSheet.name Like SHEET_NAME7) Or _
           (objSheet.name Like SHEET_NAME8) Or _
           (objSheet.name Like SHEET_NAME11) Or _
           (objSheet.name Like SHEET_NAME12) Then

        'その7、その8は合計行の上に行がある
        If (objSheet.name Like SHEET_NAME7) Or _
            (objSheet.name Like SHEET_NAME8) Then
            lngAddCnt = 1
        Else
            lngAddCnt = 0
        End If
        Call SetCalcMode(False)              '自動計算OFF
        '15行毎に小計欄を追加する
        Call CreatePageSumSeq(objSheet, lngAddCnt)
        Call SetCalcMode(True)              '自動計算ON
    
    '15号様式の場合、小計欄の追加はしないが行番号を印刷時に非表示にするため、印刷範囲を調整する
    ElseIf (objSheet.name Like SHEET_NAME15Y) Then
        '印刷範囲の調整
        'lngLastRow = objSheet.Range("行末").Row
        'objSheet.PageSetup.PrintArea = "$C$1:$G$" & lngLastRow + 3
        objSheet.Columns("B").Hidden = True
    End If
    Exit Sub

Error_ChkSheet:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2015/01/07 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CreateWKSheet
' 機  能 ： 印刷用にシートをコピーする
' 引  数 ： 処理するワークシートの配列
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub CreateWKSheet(strSheetNameArray() As String)
    
On Error GoTo Error_CreateWKSheet:
    
    Dim i As Long
    Dim objSheet As Worksheet
    Dim wsCreateSheet As String
    Dim cntSheetWk As Long                   'ワーク用シート件数
    '初期化
    cntSheetWk = 0
    
    For i = LBound(strSheetNameArray) To UBound(strSheetNameArray)
        '-------------------------------------------
        '定数に定められているシート名のみ処理を行う
        '-------------------------------------------
        If (strSheetNameArray(i) Like SHEET_NAME2) Or _
            (strSheetNameArray(i) Like SHEET_NAME3) Or _
            (strSheetNameArray(i) Like SHEET_NAME4) Or _
            (strSheetNameArray(i) Like SHEET_NAME5) Or _
            (strSheetNameArray(i) Like SHEET_NAME6) Or _
            (strSheetNameArray(i) Like SHEET_NAME7) Or _
            (strSheetNameArray(i) Like SHEET_NAME8) Or _
            (strSheetNameArray(i) Like SHEET_NAME9) Or _
            (strSheetNameArray(i) Like SHEET_NAME10) Or _
            (strSheetNameArray(i) Like SHEET_NAME11) Or _
            (strSheetNameArray(i) Like SHEET_NAME12) Or _
            (strSheetNameArray(i) Like SHEET_NAME14) Or _
            (strSheetNameArray(i) Like SHEET_NAME15) Or _
            (strSheetNameArray(i) Like SHEET_NAME16) Or _
            (strSheetNameArray(i) Like SHEET_NAME18O) Or _
            (strSheetNameArray(i) Like SHEET_NAME18KA) Or _
            (strSheetNameArray(i) Like SHEET_NAME18KI) Or _
            (strSheetNameArray(i) Like SHEET_NAME20) Or _
            (strSheetNameArray(i) Like SHEET_NAME15Y) Then
            
            '印刷用にシートをコピー
            'BOOKロック解除
            Call bUnlock
            '取得
            Set objSheet = Worksheets(strSheetNameArray(i))
            'SHEETロック解除
            Call UnlockOneSheet(objSheet)
            'コピー用
            wsCreateSheet = "WK_" & strSheetNameArray(i)
            'シートをコピー
            'objSheet.Activate
            On Error GoTo ErrorTrap:
            objSheet.Copy after:=objSheet
            '名前変更
            ActiveSheet.name = wsCreateSheet
            'ワーニング背景色を直す
            If ActiveSheet.name Like SHEET_NAME2 Then
                If ActiveSheet.name Like SHEET_NAME20 Then
                    Call CellColorChange(Worksheets("WK_その20").Range("SENSEI_DT"), False)
                Else
                    Call CellColorChange(Worksheets("WK_その2").Range("YOKUNEN_KKS_GK"), False, True)
                End If
            ElseIf ActiveSheet.name Like SHEET_NAME18O Then
                Call CellColorChange(Worksheets("WK_その18(5)").Range("YOKIN_ZNDK"), False)
            ElseIf ActiveSheet.name Like SHEET_NAME18KA Then
                Call CellColorChange(Worksheets("WK_その18(6)").Range("KINSEN_SHINTAKU_GAKU"), False)
            ElseIf ActiveSheet.name Like SHEET_NAME18KI Then
                Call CellColorChange(Worksheets("WK_その18(7)").Range("YUUKA_SHOUKEN_KAKAKU"), False)
            End If
            'その15だけコピー後にその16の前に移動する
            If strSheetNameArray(i) Like SHEET_NAME15 Then
                Sheets(wsCreateSheet).Move before:=Sheets("その16")
            End If
            On Error GoTo 0
            
            'BOOKロック
            Call bLock
            'SHEETロック
            Call LockOneSheet(objSheet)

            '配列の名前を変更
            strSheetNameArray(i) = wsCreateSheet
            '印刷用配列に名前を入れる
            wkSheetNameArray(cntSheetWk) = wsCreateSheet
            cntSheetWk = cntSheetWk + 1
        End If
    Next
    If cntSheetWk > 0 Then
        '最後に配列のサイズを、データの数に合わせる
        ReDim Preserve wkSheetNameArray(cntSheetWk - 1) As String
    End If
    
    Exit Sub

ErrorTrap:
        '独自のエラーを投げる
        '※独自のエラー番号は、標準のエラー番号と重複しないようにvbObjectError（定数）を加算した値とする
        Err.Raise (vbObjectError + CUSTOM_ERRORNUM_SHEETCOPY), Err.Source, _
        "シート追加に失敗しました。一度Excelを終了した後、再試行してください。"
        
        Exit Sub
Error_CreateWKSheet:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2015/01/07 Fujitsu)Ito H27政治資金 END

'2019/5/1　追加
'-------------------------------------------------------------------
' 関数名 ： CreateWKSheetOne
' 機  能 ： 印刷用にシートをコピーする
' 引  数 ： 処理するワークシートの配列
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub CreateWKSheetOne(strSheetName As String)
    
On Error GoTo Error_CreateWKSheetOne:
    
    Dim i As Long
    Dim objSheet As Worksheet
    Dim wsCreateSheet As String
    Dim cntSheetWk As Long                   'ワーク用シート件数
    '初期化
    cntSheetWk = 0

    '-------------------------------------------
    '定数に定められているシート名のみ処理を行う
    '-------------------------------------------
    If (strSheetName Like SHEET_NAME1) Or _
        (strSheetName Like SHEET_NAME2) Or _
        (strSheetName Like SHEET_NAME3) Or _
        (strSheetName Like SHEET_NAME4) Or _
        (strSheetName Like SHEET_NAME5) Or _
        (strSheetName Like SHEET_NAME6) Or _
        (strSheetName Like SHEET_NAME7) Or _
        (strSheetName Like SHEET_NAME8) Or _
        (strSheetName Like SHEET_NAME9) Or _
        (strSheetName Like SHEET_NAME10) Or _
        (strSheetName Like SHEET_NAME11) Or _
        (strSheetName Like SHEET_NAME12) Or _
        (strSheetName Like SHEET_NAME14) Or _
        (strSheetName Like SHEET_NAME15) Or _
        (strSheetName Like SHEET_NAME16) Or _
        (strSheetName Like SHEET_NAME18O) Or _
        (strSheetName Like SHEET_NAME18KA) Or _
        (strSheetName Like SHEET_NAME18KI) Or _
        (strSheetName Like SHEET_NAME20) Or _
        (strSheetName Like SHEET_NAME15Y) Then
        
        '印刷用にシートをコピー
        'BOOKロック解除
        Call bUnlock
        '取得
        Set objSheet = Worksheets(strSheetName)
        'SHEETロック解除
        Call UnlockOneSheet(objSheet)
        'コピー用
        wsCreateSheet = "WK_" & strSheetName
        'シートをコピー
        'objSheet.Activate
        On Error GoTo ErrorTrap:
        objSheet.Copy after:=objSheet
        '名前変更
        ActiveSheet.name = wsCreateSheet
        'ワーニング背景色を直す
        If ActiveSheet.name Like SHEET_NAME2 Then
            If ActiveSheet.name Like SHEET_NAME20 Then
                Call CellColorChange(Worksheets("WK_その20").Range("SENSEI_DT"), False)
            Else
                Call CellColorChange(Worksheets("WK_その2").Range("YOKUNEN_KKS_GK"), False, True)
            End If
        ElseIf ActiveSheet.name Like SHEET_NAME18O Then
            Call CellColorChange(Worksheets("WK_その18(5)").Range("YOKIN_ZNDK"), False)
        ElseIf ActiveSheet.name Like SHEET_NAME18KA Then
            Call CellColorChange(Worksheets("WK_その18(6)").Range("KINSEN_SHINTAKU_GAKU"), False)
        ElseIf ActiveSheet.name Like SHEET_NAME18KI Then
            Call CellColorChange(Worksheets("WK_その18(7)").Range("YUUKA_SHOUKEN_KAKAKU"), False)
        End If
        'その15だけコピー後にその16の前に移動する
        If strSheetName Like SHEET_NAME15 Then
            Sheets(wsCreateSheet).Move before:=Sheets("その16")
        End If
        On Error GoTo 0
        
        'BOOKロック
        Call bLock
        'SHEETロック
        Call LockOneSheet(objSheet)

    End If

    
    Exit Sub

ErrorTrap:
        '独自のエラーを投げる
        '※独自のエラー番号は、標準のエラー番号と重複しないようにvbObjectError（定数）を加算した値とする
        Err.Raise (vbObjectError + CUSTOM_ERRORNUM_SHEETCOPY), Err.Source, _
        "シート追加に失敗しました。一度Excelを終了した後、再試行してください。"
        
        Exit Sub
Error_CreateWKSheetOne:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2015/01/07 Fujitsu)Ito H27政治資金 END



'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： ChkDelSheet
' 機  能 ： 小計欄を削除するシートか判定を行う
' 引  数 ： 処理するワークシート
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub ChkDelSheet()
    
On Error GoTo Error_ChkDelSheet:
    Dim i As Long
    Dim objSheet As Worksheet
    
    For i = LBound(wkSheetNameArray) To UBound(wkSheetNameArray)
        If wkSheetNameArray(i) <> "" Then
        
            Application.DisplayAlerts = False
            'BOOKロック解除
            Call bUnlock
            
            '取得
            Set objSheet = Worksheets(wkSheetNameArray(i))
            
            'シートを削除
            objSheet.Activate
            objSheet.Delete
            
            'BOOKロック
            Call bLock
            Application.DisplayAlerts = True
        End If
    Next

    Exit Sub

Error_ChkDelSheet:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CreatePageSum
' 機  能 ： 15行毎に小計欄を追加する
' 引  数 ： 処理するワークシート
'　 　　　　合計行の位置を判定する件数。（合計行の上に別の小計があるシートはその行数を。通常は0）
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub CreatePageSum(ByVal objSheet As Worksheet, ByVal lngAddCnt As Long)

On Error GoTo Error_CreatePageSum:
    
    Dim lngCount As Long
    Dim lngViewCount As Long
    Dim lngLastRow As Long
    Dim lngFirstRow As Long
    Dim lngLeftCol As Long
    Dim rngRowNo As Range
    Dim lngCursolRow As Long
    Dim blnAddFlg As Boolean
    Dim lngSumColum As Long
    Dim i As Long
    Dim lngSumAddCount As Long
    Dim lngPageCount As Long        '1ページの明細件数
    Dim blnBeforeFlg As Boolean
    Dim lngCallStartRow As Long     '小計の計算範囲の開始位置
    Dim lngCallEndRow As Long       '小計の計算範囲の終了位置
    Dim lngPageMeiCount As Long     '1ページの明細件数
    Dim lngLastSumRow As Long       '最後に小計行を追加した行番号
'2021/01/26 行数カウント方法修正
    Dim lngNextAddRows As Long
    Dim blnFinalFlg As Boolean
    blnFinalFlg = False
'2021/01/26 ここまで
    '初期化
    lngPageCount = 0
    lngCount = 0
    lngViewCount = 0
    lngSumAddCount = 0
    blnAddFlg = False
    blnBeforeFlg = False
    If objSheet Is Nothing Then
        Set objSheet = ActiveSheet
    End If
    
    With objSheet

        '行末等を取得
        lngLastRow = .Range("行末").Row
        lngFirstRow = .Range("行頭").Row
        lngLeftCol = .Range("左端").column
        lngCursolRow = lngFirstRow + 1
        '高さチェック
'2021/01/26 行数カウント方法修正
'        lngPageMeiCount = lngPageMeiCount + 1
'        If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'            lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'        End If
'2021/01/26 ここまで
        
        '全ての行をチェックする
'2021/01/26 行数カウント方法修正
'        For lngCount = 0 To ((lngLastRow) - (lngFirstRow + 1))
        For lngCount = 1 To ((lngLastRow) - (lngFirstRow + 1))
        
            lngPageCount = lngPageCount + 1
            lngPageMeiCount = lngPageMeiCount + 1
            If .Rows(lngCursolRow).Height > ROW_HIGHT Then
                lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
            End If
            If .Rows(lngCursolRow + 1).Height > ROW_HIGHT Then
                lngNextAddRows = 1 + (Application.RoundDown((.Rows(lngCursolRow + 1).Height / ROW_HIGHT), 0))
            Else
                lngNextAddRows = 1
            End If
'2021/01/26 ここまで

            '最終行か？（行の追加を行っているので判定が必要）
            If ((lngFirstRow + 1) + (lngCount + lngSumAddCount)) >= (lngLastRow + lngSumAddCount) Then
'2021/01/26 行数カウント方法修正
'                If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'2021/01/26 ここまで
                    blnAddFlg = False
'2021/01/26 行数カウント方法修正
'                End If
'2021/01/26 ここまで

                
                If blnAddFlg = True Then
'2020/12/14 最終行への小計行挿入が検知できない問題への修正
'                Else
                ElseIf blnFinalFlg = False Then
'2020/12/14 ここまで
'2021/01/26 行数カウント方法修正
                    'カウント＋１
'                    lngPageCount = lngPageCount + 1
'2021/01/26 ここまで
                    '追加する行をセット
'2020/12/14 ループカウンタの調整にあわせて挿入位置の取得方法を変更
'                    lngCursolRow = ((lngFirstRow + 1) + (lngCount + lngSumAddCount))
                    lngCursolRow = lngLastRow + lngSumAddCount
'2020/12/14 ここまで
                    If blnBeforeFlg = True Then
                        lngCursolRow = lngCursolRow - 1
                    End If
                    
                    '行番号のカウントはする
                    lngViewCount = lngViewCount + 1
                    '金額の位置は？
                    lngSumColum = .Range("KINGAKU").column
                    '合計行をコピーする
                    .Rows(Range("C" & (lngLastRow + lngAddCnt + lngSumAddCount)).Row).Copy
                    '行挿入
                    .Range(lngCursolRow & ":" & lngCursolRow).Insert
                    '行番号は空白
                    .Cells(lngCursolRow, 2).value = ""
                    'タイトルを指定
                    .Cells(lngCursolRow, 3).value = VIEW_PAGESUM_STR
                    '金額部にSUM関数をセット
                    If lngPageCount > 1 Then
                        lngPageCount = lngPageCount - 1
                    End If
                    '小計計算範囲の開始位置
                    If lngLastSumRow > 0 Then
                        lngCallStartRow = lngLastSumRow
                    Else
                        lngCallStartRow = lngCursolRow - lngPageMeiCount
                    End If
                    '小計計算範囲の終了位置
                    lngCallEndRow = lngCursolRow - 1
                    '小計のセルにSUM関数をセットする
                    .Cells(lngCursolRow, lngSumColum).Formula = "=SUM(D" & lngCallStartRow & ":D" & lngCallEndRow & "" & ")"
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 START
                    '罫線を設定する
                    .Range(.Cells(lngCursolRow, 2), .Cells(lngCursolRow, 4)).Borders.Weight = xlMedium
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 END
                    'コピーや切取りの操作を取り消します
                    Application.CutCopyMode = False
                End If
                '最終行なので抜ける
                Exit For
            End If
            '行番号のカウントはする
            lngViewCount = lngViewCount + 1
'2021/01/26 行数カウントの方法修正
            '1ページの件数カウント
'            lngPageCount = lngPageCount + 1
'2021/01/26 ここまで
            '追加する行をセット
            lngCursolRow = lngCursolRow + 1

            '15行目か
'2021/01/26 行数カウントの方法修正
'            If lngPageCount > 0 And lngPageCount >= PAGE_COUNT Then
            If lngPageCount > 0 And (lngPageCount = PAGE_COUNT Or lngPageCount + lngNextAddRows > PAGE_COUNT) Then
'2021/01/26 ここまで
                '次の行チェックをスルーする為、フラグをTrueに（次の行はこの追加した行となるため）
                blnAddFlg = True
                '追加する
                '金額の位置は？
                lngSumColum = .Range("KINGAKU").column
                If blnBeforeFlg = True Then
                    lngCursolRow = lngCursolRow - 1
                End If
                '合計行をコピーする
                .Rows(Range("C" & (lngLastRow + lngAddCnt + lngSumAddCount)).Row).Copy
                '行挿入
                .Range(lngCursolRow & ":" & lngCursolRow).Insert
                '行番号は空白
                .Cells(lngCursolRow, 2).value = ""
                'タイトルを指定
                .Cells(lngCursolRow, 3).value = VIEW_PAGESUM_STR

                '金額部にSUM関数をセット
                If lngLastSumRow > 0 Then
                    lngCallStartRow = lngLastSumRow
                Else
                    lngCallStartRow = lngCursolRow - lngPageMeiCount
                End If
                lngCallEndRow = lngCursolRow - 1
                .Cells(lngCursolRow, lngSumColum).Formula = "=SUM(D" & lngCallStartRow & ":D" & lngCallEndRow & "" & ")"
                '小計行を追加した行を記憶
                lngLastSumRow = lngCursolRow + 1
                '改ページ（ただし現在が最終行の場合は改ページしない）
                If lngCursolRow >= (lngLastRow + lngSumAddCount) Then
'2020/12/14 最終行への小計行挿入が検知できない問題への修正
                    blnFinalFlg = True
'2020/12/14 ここまで
                Else
                    .Range(lngCursolRow + 1 & ":" & lngCursolRow + 1).PageBreak = xlManual
                End If
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 START
                '罫線を設定する
                .Range(.Cells(lngCursolRow, 2), .Cells(lngCursolRow, 4)).Borders.Weight = xlMedium
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 END
                'コピーや切取りの操作を取り消します
                Application.CutCopyMode = False
                '追加した件数を保持
                lngSumAddCount = lngSumAddCount + 1
                '1ページの件数をリセット
                lngPageCount = 0
                'lngPageCount = 1
                If blnBeforeFlg = True Then
                    blnBeforeFlg = False
                    blnAddFlg = False

                    'Windows10対応(2017/03/07)
                    lngCursolRow = lngCursolRow + 1
'2021/01/26 行数カウントの方法修正
'                    If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                        lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'                    End If
'2021/01/26 ここまで
                    'Windows10対応ここまで
                Else
                    lngCursolRow = lngCursolRow + 1
                    'Windows10対応(2017/03/07)
'2021/01/26 行数カウントの方法修正
'                    If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                        lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'                    End If
'2021/01/26 ここまで
                End If
                lngPageMeiCount = 0
                'Windows10対応ここまで
            Else
                'フラグを戻す
                blnAddFlg = False
'2021/01/26 行数カウントの方法修正
                'ページの明細件数を加算
'                lngPageMeiCount = lngPageMeiCount + 1
                '高さチェック
'                If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                    lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'2021/01/26 ここまで
                    If lngPageCount > 0 And lngPageCount >= PAGE_COUNT And lngPageMeiCount > 1 Then
                        blnBeforeFlg = True
                    End If
'2021/01/26 行数カウントの方法修正
'                End If
'2021/01/26 ここまで
            End If
        Next lngCount
    
    End With
    '印刷範囲の点線を消す（PageBreakを設定しているのでここをFalseにしないと点線が表示されてしまう）
    objSheet.DisplayPageBreaks = False
    
    Exit Sub
Error_CreatePageSum:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： CreatePageSumSeq
' 機  能 ： 15行毎に小計欄を追加する(通し番号があるシート用）
' 引  数 ： 処理するワークシート
'　 　　　　合計行の位置を判定する件数。（合計行の上に別の小計があるシートはその行数を。通常は0）
' 戻り値 ： 無し
'-------------------------------------------------------------------
Public Sub CreatePageSumSeq(ByVal objSheet As Worksheet, ByVal lngAddCnt As Long)

On Error GoTo Error_CreatePageSum:
    
    Dim lngCount As Long
    Dim lngViewCount As Long
    Dim lngLastRow As Long
    Dim lngFirstRow As Long
    Dim lngLeftCol As Long
    Dim rngRowNo As Range
    Dim lngCursolRow As Long
    Dim blnAddFlg As Boolean
    Dim lngSumColum As Long
    Dim i As Long
    Dim lngSumAddCount As Long
    Dim lngRowKbnColum As Long  'ROWKBNのカラム位置
    Dim RowKbnColum As String   'ROWKBNのカラム位置(アルファベット）
    Dim lngPageCount As Long        '1ページの明細件数
    Dim blnBeforeFlg As Boolean
    Dim lngCallStartRow As Long     '小計の計算範囲の開始位置
    Dim lngCallEndRow As Long       '小計の計算範囲の終了位置
    Dim lngPageMeiCount As Long     '1ページの明細件数
    Dim lngLastSumRow As Long       '最後に小計行を追加した行番号
'2021/01/26 行数カウント方法修正
    Dim lngNextAddRows As Long
    Dim blnFinalFlg As Boolean
    blnFinalFlg = False
'2021/01/26 ここまで
    
    '初期化
    lngPageCount = 0
    lngCount = 0
    lngViewCount = 0
    lngSumAddCount = 0
    blnAddFlg = False
    blnBeforeFlg = False
    If objSheet Is Nothing Then
        Set objSheet = ActiveSheet
    End If
    
    With objSheet
        
        '行末等を取得
        lngLastRow = .Range("行末").Row
        lngFirstRow = .Range("行頭").Row
        lngLeftCol = .Range("左端").column
        lngRowKbnColum = .Range("ROWKBN").column
        RowKbnColum = ColNum2Txt(lngRowKbnColum)
        lngCursolRow = lngFirstRow + 1
        '高さチェック
'2021/01/26 行数カウント方法修正
'        lngPageMeiCount = lngPageMeiCount + 1
'        If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'            lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'        End If
'2021/01/26 ここまで

        '全ての行をチェックする
'2021/01/26 行数カウント方法修正
'        For lngCount = 0 To ((lngLastRow) - (lngFirstRow + 1))
        For lngCount = 1 To ((lngLastRow) - (lngFirstRow + 1))
        
            lngPageCount = lngPageCount + 1
            lngPageMeiCount = lngPageMeiCount + 1
            If .Rows(lngCursolRow).Height > ROW_HIGHT Then
                lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
            End If
            If .Rows(lngCursolRow + 1).Height > ROW_HIGHT Then
                lngNextAddRows = 1 + (Application.RoundDown((.Rows(lngCursolRow + 1).Height / ROW_HIGHT), 0))
            Else
                lngNextAddRows = 1
            End If
'2021/01/26 ここまで
                        
            '最終行か？（行の追加を行っているので判定が必要）
            If ((lngFirstRow + 1) + (lngCount + lngSumAddCount)) >= (lngLastRow + lngSumAddCount) Then
'2021/01/26 行数カウント方法修正
'                If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'2021/01/26 ここまで
                    blnAddFlg = False
'2021/01/26 行数カウント方法修正
'                End If
'2021/01/26 ここまで

                If blnAddFlg = True Then
'2020/12/14 最終行への小計行挿入が検知できない問題への修正
'                Else
                ElseIf blnFinalFlg = False Then
'2020/12/14 ここまで
                    'カウント＋１
'2021/01/26 行数カウント方法修正
'                    lngPageCount = lngPageCount + 1
'2021/01/26 ここまで
                    '追加する行をセット
'2020/12/14 ループカウンタの調整にあわせて挿入位置の取得方法を変更
'                    lngCursolRow = ((lngFirstRow + 1) + (lngCount + lngSumAddCount))
                    lngCursolRow = lngLastRow + lngSumAddCount
'2020/12/14 ここまで
                    If blnBeforeFlg = True Then
                        lngCursolRow = lngCursolRow - 1
                    End If
                    '行番号のカウントはする
                    lngViewCount = lngViewCount + 1
                    '金額の位置は？
                    lngSumColum = .Range("KINGAKU").column
                    '合計行をコピーする
                    .Rows(Range("C" & (lngLastRow + lngAddCnt + lngSumAddCount)).Row).Copy
                    '行挿入
                    .Range(lngCursolRow & ":" & lngCursolRow).Insert
                    '行番号は空白
                    .Cells(lngCursolRow, 2).value = ""
                    'タイトルを指定
                    .Cells(lngCursolRow, 3).value = VIEW_PAGESUM_STR
                    '金額部にSUM関数をセット
                    If lngPageCount > 1 Then
                        lngPageCount = lngPageCount - 1
                    End If
                    '小計計算範囲の開始位置
                    If lngLastSumRow > 0 Then
                        lngCallStartRow = lngLastSumRow
                    Else
                        lngCallStartRow = lngCursolRow - lngPageMeiCount
                    End If
                    '小計計算範囲の終了位置
                    lngCallEndRow = lngCursolRow - 1
                    '小計のセルにSUM関数をセットする
                    .Cells(lngCursolRow, lngSumColum).Formula = "=SUMIF(" & RowKbnColum & lngCallStartRow & ":" & RowKbnColum & lngCallEndRow & _
                                                                ",""<>TRUE""," & _
                                                                "D" & lngCallStartRow & ":D" & lngCallEndRow & "" & ")"
                    '隠し列を設定。
                    .Cells(lngCursolRow, .Range("SEQ_NO").column).value = ""
                    .Cells(lngCursolRow, .Range("ROWKBN").column).value = True
                    .Cells(lngCursolRow, .Range("NOT_EMPTY").column).value = ""
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 START
                    '罫線を設定する
                    .Range(.Cells(lngCursolRow, 2), .Cells(lngCursolRow, 4)).Borders.Weight = xlMedium
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 END
                    'コピーや切取りの操作を取り消します
                    Application.CutCopyMode = False
                End If
                '最終行なので抜ける
                Exit For
            End If
            '行番号のカウントはする
            lngViewCount = lngViewCount + 1
'2021/01/26 行数カウントの方法修正
            '1ページの件数カウント
'            lngPageCount = lngPageCount + 1
'2021/01/26 ここまで
            '追加する行をセット
            lngCursolRow = lngCursolRow + 1

            '15行目か
'2021/01/26 行数カウントの方法修正
'            If lngPageCount > 0 And lngPageCount >= PAGE_COUNT Then
            If lngPageCount > 0 And (lngPageCount = PAGE_COUNT Or lngPageCount + lngNextAddRows > PAGE_COUNT) Then
'2021/01/26 ここまで
                '次の行チェックをスルーする為、フラグをTrueに（次の行はこの追加した行となるため）
                blnAddFlg = True
                '追加する
                '金額の位置は？
                lngSumColum = .Range("KINGAKU").column
                If blnBeforeFlg = True Then
                    lngCursolRow = lngCursolRow - 1
                End If
                '合計行をコピーする
                .Rows(Range("C" & (lngLastRow + lngAddCnt + lngSumAddCount)).Row).Copy
                '行挿入
                .Range(lngCursolRow & ":" & lngCursolRow).Insert
                '行番号は空白
                .Cells(lngCursolRow, 2).value = ""
                'タイトルを指定
                .Cells(lngCursolRow, 3).value = VIEW_PAGESUM_STR
                '金額部にSUM関数をセット
                If lngLastSumRow > 0 Then
                    lngCallStartRow = lngLastSumRow
                Else
                    lngCallStartRow = lngCursolRow - lngPageMeiCount
                End If
                lngCallEndRow = lngCursolRow - 1
                .Cells(lngCursolRow, lngSumColum).Formula = "=SUMIF(" & RowKbnColum & lngCallStartRow & ":" & RowKbnColum & lngCallEndRow & _
                                                            ",""<>TRUE""," & _
                                                            "D" & lngCallStartRow & ":D" & lngCallEndRow & "" & ")"
                '小計行を追加した行を記憶
                lngLastSumRow = lngCursolRow + 1
                
                '隠し列を設定。
                .Cells(lngCursolRow, .Range("SEQ_NO").column).value = ""
                .Cells(lngCursolRow, .Range("ROWKBN").column).value = True
                .Cells(lngCursolRow, .Range("NOT_EMPTY").column).value = ""
                '改ページ（ただし現在が最終行の場合は改ページしない）
                If lngCursolRow >= (lngLastRow + lngSumAddCount) Then
'2020/12/14 最終行への小計行挿入が検知できない問題への修正
                    blnFinalFlg = True
'2020/12/14 ここまで
                Else
                    .Range(lngCursolRow + 1 & ":" & lngCursolRow + 1).PageBreak = xlManual
                End If
                '1ページの件数をリセット
                lngPageCount = 0
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 START
                '罫線を設定する
                .Range(.Cells(lngCursolRow, 2), .Cells(lngCursolRow, 4)).Borders.Weight = xlMedium
'ADD 2015/05/20 Fujitsu)Nakajima H27政治資金 END
                'コピーや切取りの操作を取り消します
                Application.CutCopyMode = False
                '追加した件数を保持
                lngSumAddCount = lngSumAddCount + 1
                If blnBeforeFlg = True Then
                    blnBeforeFlg = False
                    blnAddFlg = False

                    'Windows10対応(2017/03/07)
                    lngCursolRow = lngCursolRow + 1
'2021/01/26 行数カウント方法修正
'                    If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                        lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'                    End If
'2021/01/26 ここまで
                    'Windows10対応ここまで
                Else
                    lngCursolRow = lngCursolRow + 1
                    'Windows10対応(2017/03/07)
'2021/01/26 行数カウント方法修正
'                    If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                        lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'                    End If
'2021/01/26 ここまで
                    'Windows10対応ここまで
                End If
                lngPageMeiCount = 0
           
            Else
                'フラグを戻す
                blnAddFlg = False
'2021/01/26 行数カウント方法修正
                'ページの明細件数を加算
'                lngPageMeiCount = lngPageMeiCount + 1
                '高さチェック
'                If .Rows(lngCursolRow).Height > ROW_HIGHT Then
'                    lngPageCount = lngPageCount + (Application.RoundDown((.Rows(lngCursolRow).Height / ROW_HIGHT), 0))
'2021/01/26 ここまで
                    If lngPageCount > 0 And lngPageCount >= PAGE_COUNT And lngPageMeiCount > 1 Then
                        blnBeforeFlg = True
                    End If
'2021/01/26 行数カウント方法修正
'                End If
'2021/01/26 ここまで
            End If
        Next lngCount
   
    End With
    '印刷範囲の点線を消す（PageBreakを設定しているのでここをFalseにしないと点線が表示されてしまう）
    objSheet.DisplayPageBreaks = False
    
    Exit Sub
Error_CreatePageSum:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException
End Sub
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END

'ADD 2014/12/19 Fujitsu)Ito H27政治資金 START
'-------------------------------------------------------------------
' 関数名 ： ColNum2Txt
' 機  能 ： 列番号を文字に変換する
' 引  数 ： 列番号
' 戻り値 ： 列のアルファベット（例：3→C）
'-------------------------------------------------------------------
Private Function ColNum2Txt(lngColNum As Long) As String
    On Error GoTo Rooro_ColNum2Txt
    
    Dim strAddr As String
    
    strAddr = Cells(1, lngColNum).Address(False, False)
    ColNum2Txt = Left(strAddr, Len(strAddr) - 1)
    
    Exit Function

Rooro_ColNum2Txt:
    
    ColNum2Txt = ""

End Function
'ADD 2014/12/19 Fujitsu)Ito H27政治資金 END


-------------------------------------------------------------------------------
VBA MACRO frmInsertSheet.frm 
in file: xl/vbaProject.bin - OLE stream: 'VBA/frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Const MAX_INSERT_ROW = 99
Private Const MIN_INSERT_ROW = 1

Private Sub cmdCancel_Click()

    Me.Tag = ""

    Me.Hide

End Sub

Private Sub cmdRun_Click()

    If IsEmptyString(txtCount.Text) Then

        MsgBox "シート数が入力されていません。" & vbCrLf & "1～99の数値を入力してください。", vbOKOnly + vbExclamation, "シートの追加"

        txtCount.SetFocus

    ElseIf IsValidNumber(txtCount.Text, MIN_INSERT_ROW, MAX_INSERT_ROW) Then

        Me.Tag = txtCount.Text

        Me.Hide

    Else

        MsgBox "入力されたシート数が正しくありません。" & vbCrLf & "1～99の数値を入力してください。", vbOKOnly + vbExclamation, "シートの追加"

        txtCount.SetFocus

    End If

End Sub

Private Sub spnCount_Change()

    If spnCount.value <> 0 Then

        txtCount.value = spnCount.value

    End If

End Sub

Private Sub txtCount_Change()

    ' スピンボタンに値を受け渡す
    If txtCount.value = "" Then

        'txtCount.value = 0

    Else

        On Error Resume Next

        spnCount.value = CLng(txtCount.value)

        On Error GoTo 0

    End If

End Sub

Private Sub UserForm_Initialize()

    With txtCount

        .SelStart = 0
        .SelLength = Len(.Text)

        .SetFocus

    End With

End Sub
-------------------------------------------------------------------------------
VBA MACRO ModuleCopyPartyNM.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleCopyPartyNM'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

'「選択したパーティー名をその10に転記」ボタン押下時の処理
Sub CopyPartyNameTo10()

    On Error GoTo ErrorTrap:
    
    '確認ダイアログを表示
    If (GetMessageBox(MESSAGE_G082_1, "パーティー名の転記") = False) Then
        'キャンセルされた
        Exit Sub
    End If
    
    Dim wsSelect As Worksheet
    Set wsSelect = ActiveSheet

    Dim lngFirstRow As Long
    Dim lngLastRow As Long
    
    Dim strPartyName As String
    
    With wsSelect
        lngFirstRow = .Range("行頭").Row
        lngLastRow = .Range("行末").Row
        
        '選択されたセルが明細行の範囲内の場合
        If ActiveCell.Row > lngFirstRow And ActiveCell.Row < lngLastRow Then
            '画面描画OFF
            Call ScreenRedraw(False)
            
            'パーティー名の取得
            strPartyName = .Cells(ActiveCell.Row, .Range("GIGYOU_SYURUI").column).value
            
            'パーティー名が取得できた場合
            If strPartyName <> "" Then
                Dim wsOut As Worksheet
                Set wsOut = Worksheets("その10")
                
                Dim lngI As Long
                Dim boolNoBlank As Boolean
                boolNoBlank = True
                
                'その10の「特定パーティーの名称」の空白行にパーティー名を転記する
                For lngI = wsOut.Range("行頭").Row + 1 To wsOut.Range("行末").Row - 1
                    If wsOut.Cells(lngI, wsOut.Range("PATYI_NM").column).value = "" And _
                        wsOut.Cells(lngI, wsOut.Range("KINGAKU").column).value = "" And _
                        wsOut.Cells(lngI, wsOut.Range("SHIHARAI_SU").column).value = "" And _
                        wsOut.Cells(lngI, wsOut.Range("KAISAI_DT").column).value = "" And _
                        wsOut.Cells(lngI, wsOut.Range("KAISAI_BASYO").column).value = "" And _
                        wsOut.Cells(lngI, wsOut.Range("BIKOU").column).value = "" Then
                        
                        'パーティー名を転記
                        wsOut.Cells(lngI, wsOut.Range("PATYI_NM").column).value = strPartyName
                        
                        boolNoBlank = False
                        Exit For
                    End If
                Next lngI
                
                '空白行がなかった場合、最終行に1行追加しパーティー名を転記する
                If boolNoBlank Then
                    'Excelの最大数を超えないかチェック(右下+10まで)
                    If Rows.Count <= 1 + wsOut.Range("行末").Row + 9 Then
                        Call GetMessageBox(MESSAGE_W161, "パーティー名の転記")
                        '画面描画ON
                        Call ScreenRedraw(True)
                        Exit Sub
                    End If
                    
                    '行追加
                    wsOut.Rows(wsOut.Range("行末").Row).Insert Shift:=xlShiftDown
                    '追加行の内容クリア
                    Call SheetClear(wsOut, wsOut.Range("行末").Row - 1)
                    '行番号振りなおし
                    Call RowNoRebuild(wsOut)
                    '枠線引きなおし
                    Call LineReDraw(wsOut, wsOut.Range("行頭").Row + 1, wsOut.Range("行末").Row - 1, _
                            wsOut.Range("左端").column - 1, wsOut.Range("右端").column)
                    'パーティー名を転記
                    wsOut.Cells(wsOut.Range("行末").Row - 1, wsOut.Range("PATYI_NM").column).value = strPartyName
                    '金額合計の計算式を設定 [例：=SUMIF(B6:B21,"<>",D6:D21) ]
                    wsOut.Range("KINGAKU_GK").Formula = _
                        "=SUMIF(" _
                        & wsOut.Range(wsOut.Cells(wsOut.Range("行頭").Row + 1, wsOut.Range("PATYI_NM").column - 1), _
                                wsOut.Cells(wsOut.Range("行末").Row - 1, wsOut.Range("PATYI_NM").column - 1)).Address(False, False) _
                        & ",""<>""," _
                        & wsOut.Range(wsOut.Cells(wsOut.Range("行頭").Row + 1, wsOut.Range("KINGAKU").column), _
                                wsOut.Cells(wsOut.Range("行末").Row - 1, wsOut.Range("KINGAKU").column)).Address(False, False) _
                        & ")"
                End If
            Else
                MsgBox MESSAGE_W176, vbExclamation, "パーティー名の転記"
            End If
            
            '画面描画ON
            Call ScreenRedraw(True)
        Else
            MsgBox MESSAGE_W175_2, vbExclamation, "パーティー名の転記"
        End If
    End With
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("パーティー名の転記")
    
End Sub

'「選択したパーティー名をその11に転記」ボタン押下時の処理
Sub CopyPartyNameTo11()

    On Error GoTo ErrorTrap:

    '確認ダイアログを表示
    If (GetMessageBox(MESSAGE_G083_1, "パーティー名の転記") = False) Then
        'キャンセルされた
        Exit Sub
    End If
    
    Dim wsSelect As Worksheet
    Set wsSelect = ActiveSheet

    Dim lngFirstRow As Long
    Dim lngLastRow As Long
    
    Dim strPartyName As String
    
    With wsSelect
        lngFirstRow = .Range("行頭").Row
        lngLastRow = .Range("行末").Row
        
        '選択されたセルが明細行の範囲内の場合
        If ActiveCell.Row > lngFirstRow And ActiveCell.Row < lngLastRow Then
            '画面描画OFF
            Call ScreenRedraw(False)
            
            'パーティー名の取得
            strPartyName = .Cells(ActiveCell.Row, .Range("GIGYOU_SYURUI").column).value
            
            'パーティー名が取得できた場合
            If strPartyName <> "" Then
                Dim wsOut As Worksheet
                Dim boolNoBlank As Boolean
                boolNoBlank = True
                
                '検索範囲（その11～その12）
                Dim lngFirstSheetIndex As Long
                Dim lngLastSheetIndex As Long
                Dim lngI As Long
                
                Dim strSheetName1 As String
                Dim strSheetName2 As String
                Dim strSheetName3 As String
                
                lngFirstSheetIndex = Worksheets("その10").Index + 1
                lngLastSheetIndex = Worksheets("その13").Index - 1
    
                'その11の政治資金パーティーの名称が空白のシートを探して、パーティー名を転記
                For lngI = lngFirstSheetIndex To lngLastSheetIndex
                    Set wsOut = Worksheets(lngI)
                    Dim strSheetName As String
                    strSheetName = wsOut.name
                    
                    If strSheetName Like "その11*" Then
                        '政治資金パーティーの名称が空白の時
                        If wsOut.Range("PATYI_NM").value = "" Then
                            'パーティー名を転記
                            wsOut.Range("PATYI_NM").value = strPartyName
                            
                            boolNoBlank = False
                        Else
                            'シート追加時に備えて、各区分の最終シート名を保持
                            If strSheetName Like "その11(1)*" Then
                                strSheetName1 = strSheetName
                            ElseIf strSheetName Like "その11(2)*" Then
                                strSheetName2 = strSheetName
                            ElseIf strSheetName Like "その11(3)*" Then
                                strSheetName3 = strSheetName
                            End If
                        End If
                    End If
                    
                Next lngI
                
                '政治資金パーティーの名称が空白のシートがなかった場合、シート追加しパーティー名を転記する
                If boolNoBlank Then
                
                    If strSheetName1 <> "" Then
                        'その11(1)シート追加&パーティー名転記
                        If Not sheetCopyParty(Worksheets(strSheetName1), strPartyName, "PATYI_NM") Then
                            'エラー時、ActiveSheetをその3に戻す
                            .Select
                            '画面描画ON
                            Call ScreenRedraw(True)
                            Exit Sub
                        End If
                    End If
                    
                    If strSheetName2 <> "" Then
                        'その11(2)シート追加&パーティー名転記
                        If Not sheetCopyParty(Worksheets(strSheetName2), strPartyName, "PATYI_NM") Then
                            'エラー時、ActiveSheetをその3に戻す
                            .Select
                            '画面描画ON
                            Call ScreenRedraw(True)
                            Exit Sub
                        End If
                    End If
                    
                    If strSheetName3 <> "" Then
                        'その11(3)シート追加&パーティー名転記
                        If Not sheetCopyParty(Worksheets(strSheetName3), strPartyName, "PATYI_NM") Then
                            'エラー時、ActiveSheetをその3に戻す
                            .Select
                            '画面描画ON
                            Call ScreenRedraw(True)
                            Exit Sub
                        End If
                    End If
                End If
            Else
                MsgBox MESSAGE_W176, vbExclamation, "パーティー名の転記"
            End If
            
            'ActiveSheetをその3に戻す
            .Select
            '画面描画ON
            Call ScreenRedraw(True)
        Else
            MsgBox MESSAGE_W175_2, vbExclamation, "パーティー名の転記"
        End If
    End With
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("パーティー名の転記")
    
End Sub

'「選択したパーティー名をその15に転記」ボタン押下時の処理
Sub CopyPartyNameTo15()

    On Error GoTo ErrorTrap:

    Dim wsSelect As Worksheet
    Set wsSelect = ActiveSheet

    Dim intResponse As Integer
        intResponse = MsgBox("この操作を実行すると、「その11」シート(政治資金パーティーの対価に係る収入の内訳)及び" & _
                             "「その12」シート(政治資金パーティーの対価に係る収入のうち対価の支払いのあっせんによ" & _
                             "るものの内訳)の並び順がリセットされます。" _
                             & vbCrLf & "実行してよろしいですか？", vbQuestion + vbYesNo, "シート追加")
        
        If intResponse = vbYes Then

        Else
            Exit Sub
        End If
    '確認ダイアログを表示
    If (GetMessageBox(MESSAGE_G084, "パーティー名の転記") = False) Then
        'キャンセルされた
        Exit Sub
    End If
    
    Dim lngFirstRow As Long
    Dim lngLastRow As Long
    
    Dim strPartyName As String
    
    With wsSelect
        lngFirstRow = .Range("行頭").Row
        lngLastRow = .Range("行末").Row
        
        '選択されたセルが明細行の範囲内の場合
        If ActiveCell.Row > lngFirstRow And ActiveCell.Row < lngLastRow Then
            '画面描画OFF
            Call ScreenRedraw(False)
            
            'パーティー名の取得
            strPartyName = .Cells(ActiveCell.Row, .Range("GIGYOU_SYURUI").column).value
            
            'パーティー名が取得できた場合
            If strPartyName <> "" Then
                Dim wsOut As Worksheet
                Dim boolNoBlank As Boolean
                boolNoBlank = True
                
                '検索範囲（その15）
                Dim lngFirstSheetIndex As Long
                Dim lngLastSheetIndex As Long
                Dim lngI As Long
                
                Dim strSheetName5 As String
                
                lngFirstSheetIndex = Worksheets("その14(3)").Index + 1
                lngLastSheetIndex = Worksheets("その16").Index - 1
    
                'その15(5)の費目が空白のシートを探して、パーティー名を転記
                For lngI = lngFirstSheetIndex To lngLastSheetIndex
                    Set wsOut = Worksheets(lngI)
                    Dim strSheetName As String
                    strSheetName = wsOut.name
                    
                    If strSheetName Like "その15(5)*" Then
                        '費目が空白の時
                        If wsOut.Range("HIMOKU").value = "" Then
                            'パーティー名を転記
                            wsOut.Range("HIMOKU").value = strPartyName
                            
                            boolNoBlank = False
                        Else
                            'シート追加時に備えて、最終シート名を保持
                            strSheetName5 = strSheetName
                        End If
                    End If
                    
                Next lngI
                
                '政治資金パーティーの名称が空白のシートがなかった場合、シート追加しパーティー名を転記する
                If boolNoBlank Then
                
                    If strSheetName5 <> "" Then
                        'その15(5)シート追加&パーティー名転記
                        If Not sheetCopyParty(Worksheets(strSheetName5), strPartyName, "HIMOKU") Then
                            'エラー時、ActiveSheetをその3に戻す
                            .Select
                            '画面描画ON
                            Call ScreenRedraw(True)
                            Exit Sub
                        End If
                    End If
                End If
            Else
                MsgBox MESSAGE_W176, vbExclamation, "パーティー名の転記"
            End If
            
            'ActiveSheetをその3に戻す
            .Select
            '画面描画ON
            Call ScreenRedraw(True)
        Else
            MsgBox MESSAGE_W175_2, vbExclamation, "パーティー名の転記"
        End If
    End With
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("パーティー名の転記")
    
End Sub

'----------------------------------------------------------------
' 関数名 ： sheetCopyParty
' 機　能 ： シート追加処理
' 引　数 ： wsSelectOrg  : コピー元のシート
'           strPartyName : 転記するパーティー名
'           strRangeName : 転記するセル名
' 戻り値 ： true:成功、false:失敗
'----------------------------------------------------------------
Private Function sheetCopyParty(wsSelectOrg As Worksheet, strPartyName As String, strRangeName As String) As Boolean

    sheetCopyParty = False
    
    Dim isSuccessCopy As Boolean
    Dim intResponse As Integer
    Dim isNormalizeSheets As Boolean
    isNormalizeSheets = False
        
    '対象がその11, 12の場合、シートがパーティー順に並んでいるかどうかチェックする
    If (wsSelectOrg.name Like "その11*" Or wsSelectOrg.name Like "その12*") _
        And Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = True Then
        
        intResponse = MsgBox("この操作を実行すると、「その11」シート(政治資金パーティーの対価に係る収入の内訳)及び" & _
                             "「その12」シート(政治資金パーティーの対価に係る収入のうち対価の支払いのあっせんによ" & _
                             "るものの内訳)の並び順がリセットされます。" _
                             & vbCrLf & "実行してよろしいですか？", vbQuestion + vbYesNo, "シート追加")
        
        If intResponse = vbYes Then
            isNormalizeSheets = True
        Else
            Exit Function
        End If
    End If
    
    'BOOKロック解除
    Call bUnlock
   
    'その11, 12で、シートのソート順を元に戻す場合
    '※各シートのソート番号のクリアは行わない（ステータス解除によって、XMLには出力されなくなるため）
    If isNormalizeSheets = True Then
        
        'シートを通常の順にソートする
        Call SortPartySheetsByNormal
        
        'パーティー順にソートすべきかどうかのステータスを解除する
        Worksheets("メニュー").Range("IS_SORT_PARTY_SHEET") = False
        
        'メニューの その11,12のリンクの遷移先を通常のものにする
        Call SetLinkPartySheets(False)
    End If
    
    'シートをコピー
    isSuccessCopy = CopySheetSimple(wsSelectOrg, isRaiseException:=False)
    
    If isSuccessCopy = False Then
        'シートのコピーに失敗した場合
        Call ScreenRedraw(True)
        MsgBox "シート追加ができませんでした。" & vbCrLf _
            & "一度 Excel を終了してから、やり直してください。", vbCritical, "シート追加"
        
        'BOOKロック
        Call bLock
        
        Exit Function
    End If
    
    With ActiveSheet
        
        Dim strKNo As String, strSKNo As String
        Call SheetNo(.name, strKNo, strSKNo)
    
        '行番号振りなおし
        Call RowNoRebuild
    
        'シート全体のセルのクリア
        Call SheetClear(ActiveSheet)
    
        'パーティー名を転記
        .Range(strRangeName).value = strPartyName
        
        '新規追加されたシートはロックされていないのでロックする
        '全SHEETロック
        Call zLock
    
    End With
    
    'BOOKロック
    Call bLock

    sheetCopyParty = True
    
End Function

-------------------------------------------------------------------------------
VBA MACRO ModuleIMP14to16.bas 
in file: xl/vbaProject.bin - OLE stream: 'VBA/ModuleIMP14to16'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Public Sub getSheet14_15To16()
    
    On Error GoTo ErrorTrap:
    
    Dim intResponse As Integer
    
    intResponse = MsgBox("「その14」の各シート(経常経費（人件費を除く。）の内訳）及び「その15」の各シート(政治活動費の内訳)において、" & _
                "「交付金に係る支出」欄に（交）が選択されている入力情報を取得して、「その16」シートに反映します。" & vbCrLf & _
                "実行してよろしいですか？", vbQuestion + vbYesNo + vbDefaultButton2, "その14・15内容取得")
    
    If intResponse = vbNo Then
        Exit Sub
    End If
    
    '画面描画オフ
    Call ScreenRedraw(False)
    
    Call CountTimeStart("その14・15内容取得(その16)")
    
    '作成実行
    Call MakeSheet16
    
    '画面描画オン
    Call ScreenRedraw(True)
    
    Call CountTimeStop("その14・15内容取得(その16)")
    
    Exit Sub
    
ErrorTrap:
    '共通のエラー処理で、エラーの表示や画面描画等の設定を元に戻す
    Call DispException("その14・15内容取得")

End Sub

Sub MakeSheet16()
    
    Dim wsSelect As Worksheet
    Dim intRColumn As Integer
    Dim lngRCount As Long
    Dim lngNasiCCount As Long
    Dim lngUB As Long
    Dim strKNo As Integer
    Dim strSNo As Integer '（その14）、（その15）の切り分け
    Dim lngI As Long
    Dim str項目() As String, dbl金額() As Double, str年月日() As String, str備考() As String
    Dim rngContents As Range, lngHRow As Long, lngFRow As Long, intLeftCol As Integer, intRightCol As Integer
    Dim LoopMax As Integer
    
    For strSNo = 14 To 15
        'シート毎のループ回数設定
        If strSNo = 14 Then
            LoopMax = 3
        Else
            LoopMax = 9
        End If
    
        For strKNo = 1 To LoopMax 'その14(1)～その14(3)、その15(1)～その15(9)
        
            For Each wsSelect In Worksheets
            With wsSelect
        
                If .name Like "その" & strSNo & "(" & strKNo & ")*" Then
                
                    lngHRow = .Range("行頭").Row
                    lngFRow = .Range("行末").Row
                    lngRCount = lngFRow - lngHRow - 1
                
                    intRColumn = .Range("KOUFUKIN").column '「領収書を徴し難かったもの」項目
                    
                    lngNasiCCount = 0
                    
                    For lngI = lngHRow + 1 To lngFRow - 1
                    
                        If .Cells(lngI, intRColumn).value = "（交）" Then
                            
                           lngNasiCCount = lngNasiCCount + 1
                        
                        End If
            
                    Next lngI
                    
                    If lngNasiCCount = 0 Then
                    Else
                    
                        ReDim Preserve str項目(1 To lngUB + lngNasiCCount) As String
                        ReDim Preserve dbl金額(1 To lngUB + lngNasiCCount) As Double
                        ReDim Preserve str年月日(1 To lngUB + lngNasiCCount) As String
                        ReDim Preserve str備考(1 To lngUB + lngNasiCCount) As String
                        
                        lngNasiCCount = 0
                        
                        For lngI = lngHRow + 1 To lngFRow - 1
                        
                            If .Cells(lngI, intRColumn).value = "（交）" Then
                                
                                lngNasiCCount = lngNasiCCount + 1
                            
                                str項目(lngNasiCCount + lngUB) = Mid(.Range("区分").value, 3, Len(.Range("区分").value) - 2)
                                dbl金額(lngNasiCCount + lngUB) = .Cells(lngI, .Range("KINGAKU").column).value
                                str年月日(lngNasiCCount + lngUB) = Format(.Cells(lngI, .Range("DT").column).value, "yyyy/mm/dd")
                                str備考(lngNasiCCount + lngUB) = .Cells(lngI, .Range("BIKOU").column).value
                            
                            End If
                
                        Next lngI
                    
                        lngUB = UBound(str項目) 'str項目の配列数の最大値
                    
                    End If
        
                End If
            
            End With
            Next wsSelect
        
        Next strKNo
    Next strSNo
    
    Set wsSelect = Nothing

    Dim str金額() As String
    Dim i As Long
    
    ReDim str金額(lngUB)
    For i = 1 To lngUB
        str金額(i) = dbl金額(i) & ""
    Next

    Call SetSheet16(lngUB, str項目, str金額, str年月日, str備考)
    
End Sub

Sub SetSheet16(lngUB As Long, koumoku() As String, kingaku() As String, dt() As String, bikou() As String)
    
    Dim wsSelect As Worksheet
    Dim cursolRow As Long                   'データ差込み位置（行）
    Dim pageCnt As Long                     '操作ページ
    Dim cursolPageCnt As Long               '行追加による最下行ページ
   
    Dim lngI As Long
    Dim kaiPageArray() As Long              '全改ページ行保持用
    Dim page1RowCnt As Integer              '1ページ目の一覧表行数
    Dim page1AddRowCnt As Integer           '1ページ目の一覧表追加必要行数
    Dim i As Integer
    Dim k As Long
    
    Dim intLCol As Integer
    Dim intRCol As Integer
    Dim lngHRow As Long
    Dim lngFRow As Long
        
    Set wsSelect = Worksheets("その16")
    With wsSelect
    .Activate
    
        intLCol = .Range("左端").column
        intRCol = .Range("右端").column
        lngHRow = .Range("行頭").Row
        lngFRow = .Range("行末").Row
        
        '一覧表の入力内容クリア
        Call CellColorChange(.Range(.Cells(lngHRow + 1, intLCol), .Cells(lngFRow - 1, intRCol)), False)
        
        '一覧表の色クリア
        .Range(lngHRow + 1 & ":" & lngFRow - 1).ClearContents
        
        '現在の明細行数
        page1RowCnt = (lngFRow - 1) - lngHRow
        
        '明細行に追加必要な行数
        page1AddRowCnt = lngUB - page1RowCnt
        
        '明細行2行目をコピー＆必要行数を挿入処理
        If page1AddRowCnt > 0 Then
            Rows(lngHRow + 2 & ":" & lngHRow + 2).Copy
            Rows(lngHRow + 2 & ":" & lngHRow + 2 + (page1AddRowCnt - 1)).Insert Shift:=xlDown
        End If
        
        '行番号振りなおし
        Call RowNoRebuild
        '枠線引きなおし
        Call LineReDraw(wsSelect, lngHRow + 1, .Range("行末").Row - 1, intLCol - 1, intRCol)
        
        'データが無い場合処理終了
        If lngUB = 0 Then
            '左上にカーソルを設定
            Range("A1").Select
            
            Exit Sub
        End If
        
        'データ数分ループ
        For lngI = 1 To lngUB
    
            '一覧にデータ設定
            Cells(lngHRow + lngI, Range("SHISYUTU_KMK").column) = koumoku(lngI)
            Cells(lngHRow + lngI, Range("KINGAKU").column) = kingaku(lngI)
            Cells(lngHRow + lngI, Range("DT").column) = dt(lngI)
            Cells(lngHRow + lngI, Range("BIKOU").column) = bikou(lngI)
            
        Next lngI
    
        '左上にカーソルを設定
        Range("A1").Select
    
    End With

End Sub
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��X0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
bY0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��S�f;u�P�0x��bW0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��S�f�{
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
tx0;
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
N�b�d�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
N�bx��b
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
x��bU0�0f0D0�0MOnk0L��0���RW0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
���RY0�0L�pe�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
c�[W0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�����
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
L�be{
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
x��bU0�0f0D0�0�0�0�0�0���RW0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
���RY0�0�0�0�0pe�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
c�[W0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�����
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0�0��
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0U0�0f0D0�0�Q�[�0\O
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
bW0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
bY0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��v�0x��bW0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b0�0�0�0�0�bW0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0����S/e1XJT�fn0X
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0�0\O
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
bY0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��S�f�c�Q�0�0�0�0�0\O
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
bY0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
S0n0�0�0�0n0�0�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�W0ju�S�0�e�N
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�g0&Ns0�fH0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
&Ns0�fH0�0L�F0h0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0eQ�RU0�0_0�0�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�W0ju�S�0�e�N
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�k0&Ns0�fH0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�W0ju�Sn0L�L0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�d0�N
NB0�0�0n0k0o0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�L�L0���RU0�0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�[L�Y0�0k0o0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0�[L�0�0�0�0�0�0�0�0�0W0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�0�0�0�0�0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�W0ju�S0�01
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
K0�0/c�0j0J0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
n0n0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�W0ju�SL0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
& 0n0�0F0j01
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
K0�0n0#�jug0j0D04X
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
& 0n0�0F0j0#�juh0j0�0�0F0k0/c�0j0J0W0~0Y0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
/c�0j0J0W0�0W0j0D04X
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0�0�0�0�0�0o0Z0W0f0O0`0U0D0
-------------------------------------------------------------------------------
VBA FORM STRING IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
MS UI Gothic
-------------------------------------------------------------------------------
VBA FORM Variable "b'FrameImage'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Close'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Make_Pdf'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'LBL_TITLE'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Goto_ReceiptSheet'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Clear_All'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Select_All'" IN 'xl/vbaProject.bin' - OLE stream: 'frmImageView'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'txtCount'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'5'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'spnCount'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdCancel'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdRun'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertRow'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'txtCount'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'1'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'spnCount'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdCancel'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdRun'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'xl/vbaProject.bin' - OLE stream: 'frmInsertSheet'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Frame1'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Make'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Btn_Cancel'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label18'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Chk_Make_Xml'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Chk_Make_Pdf'" IN 'xl/vbaProject.bin' - OLE stream: 'frmMakeXML/i06'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdRun'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'cmdCancel'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Frame1'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'chkRebuild'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'1'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'xl/vbaProject.bin' - OLE stream: 'frmNayose/i06'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |Auto_Open           |Runs when the Excel Workbook is opened       |
|AutoExec  |cmdCancel_Click     |Runs when the file is opened and ActiveX     |
|          |                    |objects trigger events                       |
|AutoExec  |Worksheet_Change    |Runs when the file is opened and ActiveX     |
|          |                    |objects trigger events                       |
|AutoExec  |Worksheet_FollowHype|Runs when the file is opened and ActiveX     |
|          |rlink               |objects trigger events                       |
|Suspicious|Open                |May open a file                              |
|Suspicious|Write               |May write to a file (if combined with Open)  |
|Suspicious|FileCopy            |May copy a file                              |
|Suspicious|CopyHere            |May copy a file                              |
|Suspicious|movehere            |May move a file                              |
|Suspicious|Kill                |May delete a file                            |
|Suspicious|CreateTextFile      |May create a text file                       |
|Suspicious|Shell               |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|Wscript.Shell       |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|Run                 |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|Call                |May call a DLL using Excel 4 Macros (XLM/XLF)|
|Suspicious|MkDir               |May create a directory                       |
|Suspicious|CreateObject        |May create an OLE object                     |
|Suspicious|Shell.Application   |May run an application (if combined with     |
|          |                    |CreateObject)                                |
|Suspicious|Windows             |May enumerate application windows (if        |
|          |                    |combined with Shell.Application object)      |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|VBProject           |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
|Suspicious|system              |May run an executable file or a system       |
|          |                    |command on a Mac (if combined with           |
|          |                    |libc.dylib)                                  |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|IOC       |https://kyoudou.soum|URL                                          |
|          |u.go.jp/kyoudou/Down|                                             |
|          |load?cid=MANU_M0001 |                                             |
|IOC       |msxml3.dll          |Executable file name                         |
|IOC       |scrrun.dll          |Executable file name                         |
|IOC       |ScanApplication.exe |Executable file name                         |
|Suspicious|VBA Stomping        |VBA Stomping was detected: the VBA source    |
|          |                    |code and P-code are different, this may have |
|          |                    |been used to hide malicious code             |
+----------+--------------------+---------------------------------------------+
VBA Stomping detection is experimental: please report any false positive/negative at https://github.com/decalage2/oletools/issues

