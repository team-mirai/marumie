# Devin Knowledge: marumie(admin) 実装結果の動画撮影・報告ガイド

このドキュメントは、Devinがmarumieのadminアプリケーションで実装した機能を動画で撮影し、PRで報告するための標準手順をまとめたものです。

## 目的と適用範囲

このガイドは以下の場合に使用します。

- adminアプリケーションの新機能実装後の動作確認
- UI変更の視覚的な確認
- バグ修正後の動作確認

動画撮影の目的は「操作したこと」ではなく「期待した結果が画面上で確認できること」を証明することです。

## ローカル環境セットアップ

### 初回セットアップ

初めて環境を構築する場合、以下の手順を実行します。

#### 1. 環境変数ファイルの作成

```bash
cp .env.example .env
```

#### 2. Supabaseの起動

```bash
pnpm supabase:start
```

#### 3. Supabaseキー情報の取得と設定

```bash
npx supabase status --output json
```

出力されたJSONから以下のキーを取得し、`.env`ファイルに追記します。

| 取得するキー | .envに設定する変数名 |
|-------------|---------------------|
| `ANON_KEY` | `SUPABASE_ANON_KEY`, `NEXT_PUBLIC_SUPABASE_ANON_KEY` |
| `SERVICE_ROLE_KEY` | `SUPABASE_SERVICE_ROLE_KEY` |

また、以下の固定値も追記します。

```env
SUPABASE_URL="http://127.0.0.1:54321"
NEXT_PUBLIC_SUPABASE_URL="http://127.0.0.1:54321"
```

#### 4. データベースのセットアップ

```bash
pnpm db:migrate
pnpm db:seed
```

シード実行時にトランザクション関連でエラーが出る場合がありますが、ユーザーデータは正常に作成されます。

### 毎回のセットアップ

既に初回セットアップが完了している場合は、以下のみ実行します。

```bash
pnpm supabase:start  # Supabaseが停止している場合
pnpm dev:admin       # adminサーバーの起動
```

サーバーが起動し、`http://localhost:3001`でアクセス可能になるまで待機します。

## 動画撮影の標準フロー

### 撮影前チェックリスト

- [ ] adminサーバーが起動している（`http://localhost:3001`）
- [ ] 撮影対象の機能が明確になっている
- [ ] 期待する結果（成功条件）が明確になっている

### 撮影手順

#### 1. 録画開始

`recording_start`ツールを使用して画面録画を開始します。

#### 2. ログイン（セッション確立）

1. ブラウザで`http://localhost:3001/login`にアクセス
2. テスト用認証情報でログイン
3. ダッシュボード画面が表示されることを確認

#### 3. 対象機能の操作と結果確認

実装した機能に応じて、以下のような操作を行います。

- 対象ページへの遷移
- 必要なデータの入力・操作
- **結果が分かる画面を必ず映す**（成功メッセージ、一覧への反映、トースト通知など）

#### 4. 撮影終了

1. 結果が確認できる画面で一時停止（2-3秒）
2. `recording_stop`ツールを使用して画面録画を停止

### 撮影時の注意事項

- **成功時**: 成功メッセージや結果が反映された画面を最後に映す
- **失敗時**: エラー表示やトースト通知を映してから停止する
- **個人情報・秘密情報は映さない**: シードデータのサンプルデータのみを使用する

## テスト用認証情報

| ロール | Email | Password |
|--------|-------|----------|
| Admin | foo@example.com | foo@example.com |
| User | bar@example.com | bar@example.com |

これらの認証情報は`prisma/seeds/users.ts`で定義されています。

## PRへの報告テンプレート

動画撮影後、PRの説明に以下の情報を含めます。

```markdown
## 動作確認

### 確認した機能
（実装した機能の概要）

### 再現手順
1. （操作手順1）
2. （操作手順2）
3. ...

### 期待結果
（期待される動作・表示）

### 実際の結果
（動画で確認できる結果）

### 動画
（recording_stopで取得した動画を添付）
```

## 機能別の撮影シナリオ例

### CSVアップロード機能

1. ログイン後、CSVアップロードページへ遷移
2. テスト用CSVファイルを選択・アップロード
3. プレビュー画面でデータを確認
4. 保存ボタンをクリック
5. 成功メッセージと一覧への反映を確認

### 取引先マスタ編集

1. ログイン後、取引先マスタページへ遷移
2. 編集対象の取引先を選択
3. 情報を編集して保存
4. 更新成功のトースト通知を確認
5. 一覧で更新内容が反映されていることを確認

### 報告書エクスポート

1. ログイン後、報告書エクスポートページへ遷移
2. 対象年度・団体を選択
3. エクスポートボタンをクリック
4. ダウンロードが開始されることを確認

## 開発ツール

Supabase起動時に以下の開発ツールが利用可能になります。

| ツール | URL | 用途 |
|--------|-----|------|
| Supabase Studio | http://127.0.0.1:54323 | データベースの中身をGUIで確認・編集、SQLの実行 |
| Mailpit | http://127.0.0.1:54324 | メール送信のテスト（パスワードリセット、招待メールなど） |

### Supabase Studio

データベースの内容を確認したい場合、Supabase Studioを使用します。

1. ブラウザで`http://127.0.0.1:54323`にアクセス
2. 左メニューから「Table Editor」を選択してテーブルを閲覧
3. 「SQL Editor」でSQLクエリを直接実行可能

データベースの状態確認が必要な機能（データ登録、更新、削除など）を撮影する場合は、Studioでのデータ確認画面も動画に含めると、期待結果がより明確になります。

### Mailpit

メールを介した操作（パスワードリセット、ユーザー招待など）をテストする場合、Mailpitを使用します。

1. ブラウザで`http://127.0.0.1:54324`にアクセス
2. アプリケーションからメール送信操作を実行
3. Mailpitの受信トレイに届いたメールを確認
4. メール内のリンクをクリックして操作を続行

メール関連の機能を撮影する場合は、Mailpitでのメール受信確認も動画に含めてください。

## 注意事項

- Supabaseの起動には数分かかる場合があります
- adminサーバーはポート3001で起動します（webappはポート3000）
- 動画はPRの説明に添付するか、`message_user`でユーザーに送信します

## 関連ファイル

- `prisma/seeds/users.ts`: テストユーザーの定義
- `admin/src/app/(public)/login/page.tsx`: ログインページ
- `admin/src/client/components/layout/Sidebar.tsx`: サイドバー（ナビゲーション）
