---
description: 指定された機能のE2Eテストを作成する (project)
---

## 対象

$ARGUMENTS

## タスク

指定された機能に対するE2Eテストを作成してください。

### 1. 対象の特定

- 引数が指定されている場合: その機能を対象とする
- 引数がない場合: 以下の順で対象を特定する
  1. unstaged の変更ファイル (`git diff --name-only`)
  2. develop ブランチからの差分 (`git diff --name-only develop...HEAD`)

対象ファイルから `app/` 配下のページコンポーネントを抽出し、E2Eテストが必要な機能を特定する。

### 2. 対象機能の調査

1. **ページ構造の把握**: 対象機能のページコンポーネントを読み込み、以下を確認する
   - URLパス（app ディレクトリ構造から特定）
   - 主要なUI要素（ボタン、フォーム、リンクなど）
   - ユーザーが行える操作

2. **既存テストの参考**: 既存のE2Eテストを参考にする
   - admin: `admin/e2e/tests/` 配下
   - webapp: `webapp/e2e/tests/` 配下

### 3. テストケースの設計

E2Eテストは**ページ表示と主要な操作フローの確認**に集中する。細かいバリデーションやエッジケースはユニットテストで担保するため、E2Eでは扱わない。

**読み込みテスト**
- ページが正常に表示されるか
- 既存データが正しく読み込まれるか

**書き込みテスト**
- 主要な操作フローが正常に完了するか（作成 → 一覧に反映、編集 → 更新が反映、など）

### 4. テスト実装

以下のルールに従ってテストを実装する：

1. **ロケーター**: 堅牢なロケーターを使用する
   - `getByRole`, `getByLabel`, `getByText` を優先
   - `.first()` は避け、特定の要素を明示的に選択する
   - 親要素から辿る場合は XPath の `ancestor` を活用

2. **シードデータ**: テストはシードデータ（`pnpm db:seed`）の存在を前提としてよい

3. **テストデータ**: 書き込みテストで作成するデータは一意性を確保する
   - 例: `test-org-${Date.now()}`

4. **ファイル配置**
   - admin: `admin/e2e/tests/{機能名}.spec.ts`
   - webapp: `webapp/e2e/tests/{機能名}.spec.ts`

### 5. テスト実行

作成したテストを実行して動作確認する：
- admin: `cd admin && pnpm test:e2e --grep "{テスト名}"`
- webapp: `cd webapp && pnpm test:e2e --grep "{テスト名}"`
