# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json

language: ja-JP

# ナレッジベース: プロジェクト固有のアーキテクチャガイドとルール
knowledge_base:
  code_guidelines:
    filePatterns:
      - "docs/admin-architecture-guide.md"
      - "docs/admin-ui-guidelines.md"
      - "docs/design-document-rules.md"
      - "CLAUDE.md"

reviews:
  request_changes_workflow: true
  poem: false
  collapse_walkthrough: false

  # レビュー強化機能
  auto_apply_labels: true

  path_filters:
    - "webapp/**"
    - "admin/**"
    - "shared/**"
    - "prisma/**"
    - "supabase/**"
    - "docs/**"
    - "!**/*.md"
    - "!**/*.mdx"
    - "!**/*.svg"
    - "!**/*.png"
    - "!**/*.jpg"
    - "!**/*.jpeg"
    - "!**/*.gif"
    - "!**/*.lock"
    - "!**/pnpm-lock.yaml"
    - "!**/yarn.lock"
    - "!**/package-lock.json"
    - "!**/dist/**"
    - "!**/.next/**"
    - "!**/coverage/**"
    - "!**/*.snap"

  # パス別のレビュー指示
  path_instructions:
    - path: "admin/src/server/contexts/**"
      instructions: |
        このコードはBounded ContextパターンとDDDに基づく設計です。
        以下のポイントを重点的にレビューしてください：
        - レイヤー間の依存関係（presentation→application→domain↔infrastructure）
        - loader/actionがusecaseを経由せずにrepositoryを直接呼んでいないか
        - ドメインロジックがドメインモデルに適切に実装されているか
        - server-onlyインポートの有無
        詳細は docs/admin-architecture-guide.md を参照してください。

    - path: "admin/src/client/**"
      instructions: |
        このコードはadmin UIコンポーネントです。
        以下のポイントを重点的にレビューしてください：
        - shadcn/ui コンポーネントを使用しているか（カスタム実装は非推奨）
        - CSS変数（bg-background, text-foreground等）を使用しているか
        - cn()ユーティリティでクラス名を合成しているか
        詳細は docs/admin-ui-guidelines.md を参照してください。

    - path: "webapp/src/**"
      instructions: |
        webappのコードです。
        サーバーコンポーネントを優先し、"use client"は必要最小限にしてください。
        データ取得はloaders、副作用はactionsに分離してください。

  auto_review:
    drafts: true
  labeling_instructions: []

  pre_merge_checks:
    docstrings:
      mode: "off"
